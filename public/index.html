<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.youtube.com/iframe_api"></script>.
       <!-- 
       <link rel="stylesheet" href="styles.css"/>
       <link rel="stylesheet" href="styles-divs-horizontais.css"/>
    <link rel="stylesheet" href="styles-divs-horizontais.css"/> <link rel="stylesheet" href="styles-modals-apostas.css"/>
       -->
    <link rel="stylesheet" href="modais-e-menus.css"/>
    <link rel="stylesheet" href="styles-header-login.css"/>
    <link rel="stylesheet" href="styles-chat.css"/>
    <link rel="stylesheet" href="styles-notificacoes.css"/>
    <link rel="stylesheet" href="chat-webrtc-modal.css"/>
       <link rel="stylesheet" href="styles-global.css"/>
    <link rel="stylesheet" href="styles-lives.css"/>
</head>
<body>
  
  
  <header>
             <div class="header-content">
                   <h2 class="header-title" onclick="criarMenuPrincipal()"  >multi strem app </h2>
              </div>

               <div class="header-actions">

              </div>
            <!-- outros bot√µes -->
             <button onclick="verRankingUsuarios()">Ranking</button>
             <button onclick="mostrarPainelNotificacoes()">Notifica√ß√µes</button>
    
              <div class="profile-icon" id="profileIcon" onclick="toggleProfileMenu()">üë§
               </div>
      </div>

  <!-- Menu flutuante do perfil -->
  <div class="login-floating" id="loginFloating">
    <!-- Conte√∫do ser√° preenchido pelo JavaScript -->
  </div>
 <!-- Overlay para fechar o menu -->
  <div class="overlay" id="overlay" onclick="toggleProfileMenu()"></div>
  
</header>
    
    <!-- Se√ß√£o de Jogos -->
    <div id="secao-jogos" class="secao">
        <h2>Jogos</h2>

        <div id="lista-jogos"></div>
    </div>
    
    <!-- Se√ß√£o de Est√°dios -->
    <div id="secao-estadios" class="secao" style="display:none;">
        <h2>Est√°dios</h2>
        <button onclick="voltarParaJogos()">‚Üê Voltar para Jogos</button>

        <div id="lista-estadios"></div>
    
    </div>
    
  
    <div id="secao-times" class="secao" style="display:none;">
    <h2>Times</h2>
    <button onclick="voltarParaEstadios()">‚Üê Voltar para Est√°dios</button>
  
    <div id="lista-times"></div>
</div>
    
    <!-- Se√ß√£o de Lives - CORRIGIDO -->
<div id="secao-lives" class="secao header-live" style="display:none;">

    <div class="secao-header">
        <h2>Lives</h2>
        <div class="secao-buttons">
            <button onclick="voltarParaTimes()">‚Üê Voltar para Times</button>
        </div>
    </div> 

    <div class="instructions">
        <h3>Como usar</h3>
        <p>‚Ä¢ Use os bot√µes + e - para controlar o zoom</p>
        <p>‚Ä¢ Clique em "Alternar Layout" para mudar entre modos</p>
        <p>‚Ä¢ <strong>Modo Vertical</strong>: Pilares de cards lado a lado</p>
        <p>‚Ä¢ <strong>Modo Horizontal</strong>: Linhas de cards uma abaixo da outra</p>
        <p>‚Ä¢ Em dispositivos touch, use gestos de pin√ßa para zoom</p>
        <div class="zoom-controls">
            <button id="zoomOut">- Zoom Out</button>
            <button id="zoomIn">+ Zoom In</button>
            <button id="resetZoom">‚Ü∫ Reset</button>
        </div>
    </div>

    <div class="time-container" id="timeContainer">
        </div>
    <div class="time-info" id="timeInfo"></div>

</div>

  










<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
<script src="/socket.io/socket.io.js"></script>
  

  <script src="carregamento.js" defer> </script>
    <script src="Intreterimento/core.js"></script>  
 <script src="Perfil/notifications.js" defer> </script>
  <script src="Perfil/comunidade.js" defer> </script>
  <script src="Perfil/auth.js" defer> </script>
  <script src="Perfil/perfil.js" defer> </script>
  <script src="Perfil/menu.js" defer> </script>
 <script src="criarMenuPrincipal/criarMenuPrincipal.js.js" defer> </script>
 <script src="Perfil/compartilhar.js" defer> </script>
  <script src="Perfil/modals.js" defer> </script>




<script src="componentes/toglleBotoes.js" defer></script>
  <script src="componentes/carregarComponentes.js" defer> </script>
<script src="componentes/Crud/Adicionar.js" defer> </script>
<script src="componentes/Crud/Atualizar.js" defer></script>
<script src="componentes/Crud/CopiarEColar.js" defer></script>
<script src="componentes/Crud/Criar.js" defer></script>
<script src="componentes/Crud/Edit.js" defer></script>
<script src="componentes/Crud/Excluir.js" defer></script>
<script src="componentes/Crud/Permissoes.js" defer></script>
<script src="componentes/navegar.js" defer></script>
  

<script>
  
  
const signaling = io(); // socket.io client
//src="js/Variaveis.js" 
let localStream = null;
const pcConfig = {
    iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' },
        { urls: 'stun:stun2.l.google.com:19302' },
        { urls: 'stun:stun3.l.google.com:19302' },
        { urls: 'stun:stun4.l.google.com:19302' },
        { urls: 'stun:stun.stunprotocol.org:3478' },
        { urls: 'stun:stun.voiparound.com' },
        // Adicione mais STUNs gratuitos se necess√°rio, sem TURN
    ]
};
let currentGameId = 'default_room'; // Sala "em foco"
let joinedRooms = new Set(['default_room']); // <-- ADICIONE ISSO
let startButton,  messageInput, sendButton, sendCustomDataButton, messagesDiv, localVideo, remoteContainer;
let roomsSelect, joinRoomButton, createRoomButton; window.dados = { // Inicializando dados se n√£o definido externamente
  apostasUsuarios: [],
  desafiosUsuarios: [],
  chats: [],
  usuarios: [],
  jogos: [],
  transacoes: [],
  version: Date.now()
}; // Ajuste conforme necess√°rio
let jogoTemporarioParaCompartilhar = null;
let acoesEstadioVisiveis = true;
let modalChatAtual = null;
let jogoCopiado = null;
let estadioCopiado = null; // Armazena o est√°dio copiado
let timeCopiado = null;
let liveCopiada = null;
let cardCopiado = null;
let divCopiada = null;
let scrollContainerCopiado = null;
let iframerCopiado = null;
const clipboard = {
    tipo: null, // 'jogo', 'estadio', 'time', 'live', 'div', 'card'
    dados: null
};
let toggleStatesJogos = {};
let toggleStatesLive = {};
let toggleStatesScrollContainer = {};
let toggleStatesDiv = {};
let toggleStatesIframer = {};
let globalHeadersVisiveis = true;

// ===== NOVO: YouTube Player API Control =====

// Mapeamento global para guardar as inst√¢ncias dos players
window.youtubePlayers = {}; 
// Flag para saber se a API do YouTube est√° pronta
window.ytApiReady = false;



let currentSelectedGameId = null;
const dataChannels = {};
let usuarioLogado = null;
let streamerLogado = null;
let notificacoes = [];
let socket = null;
let eventos = [];
let jogoSelecionadoId = null;
let estadioSelecionadoId = null;
let timeSelecionadoId = null;
let liveSelecionadoId = null;
let audioContext = null;
let audioAnalyser = null;
let audioParticipants = new Map();
let peers = {};
let chatModalAberto = false;
const commonBtnStyle = "padding:6px 10px; border:none; border-radius:5px; color:white; cursor:pointer; font-size:0.85em; margin: 2px;";


const TOKEN_JWT = localStorage.getItem('jwtToken') || '';  // Do login existente

    function escapeStringForHTML(str) {
    if (!str) return '';
    return str.replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
// variaveis-globais.js


        // === CONFIG (AJUSTE AQUI) ===
   const API_BASE = 'http://localhost:3000';  // Seu backend URL
    const SOCKET_SERVER = 'http://localhost:3000';  // Mesmo do chat, se compartilhado
    
    /*
const API_BASE = 'https://youtube-lives.onrender.com';
    const SOCKET_SERVER = 'https://youtube-lives.onrender.com';  // Mesmo do chat, se compartilhado
    const SIGNALING_SERVER = 'wss://youtube-lives.onrender.com';
    
    */
        /*
        // === CONFIG (AJUSTE AQUI) ===
   const API_BASE = 'http://localhost:3000';  // Seu backend URL
    const SOCKET_SERVER = 'http://localhost:3000';  // Mesmo do chat, se compartilhado
const API_BASE = 'https://youtube-lives.onrender.com';
    const SOCKET_SERVER = 'https://youtube-lives.onrender.com';  // Mesmo do chat, se compartilhado
    const SIGNALING_SERVER = 'wss://youtube-lives.onrender.com';
    
    */
    



function getCurrentGameId() {
    // Se o array de jogos existe e n√£o est√° vazio, usa o ID do primeiro jogo.
    // Em uma aplica√ß√£o real, voc√™ pegaria isso da URL ou de uma sele√ß√£o do usu√°rio.
    return dados.jogos && dados.jogos.length > 0 ? dados.jogos[0].id : 'default_lobby';
}
  // Fun√ß√£o para buscar dados do backend
async function buscarDadosBackend(endpoint) {
    try {
        const response = await fetch(`${API_BASE}${endpoint}`);
        if (!response.ok) throw new Error(`Erro ${response.status}`);
        
        const dadosRes = await response.json();
        //console.log(`${endpoint}:`, Array.isArray(dadosRes) ? dadosRes.length : 1, 'itens');
        return dadosRes;
        
    } catch (error) {
        console.error(`${endpoint}:`, error.message);
        return null;
    }
}
async function carregarDadosBackend() {
    try {
        const [
            usuariosBackend, 
            apostasBackend, 
            desafiosBackend, 

            chatsBackend, 
            jogosBackend
        ] = await Promise.all([
            buscarDadosBackend('/api/users'),
            buscarDadosBackend('/api/apostas'),
            buscarDadosBackend('/api/desafios'),
            buscarDadosBackend('/api/chats'),
            buscarDadosBackend('/api/jogos')
        ]);

        Object.assign(window.dados, {
            usuarios: usuariosBackend || [],
            apostasUsuarios: apostasBackend || [],
            desafiosUsuarios: desafiosBackend || [],
            chats: chatsBackend || [],
            jogos: jogosBackend || []
        });
        
        return true;
        
    } catch (error) {
        console.error('Erro no carregamento:', error);
        return false;
    }
}
async function carregarJogos() {
    const container = document.getElementById('lista-jogos');
    if (!container) return;
    container.innerHTML = '';

    // Inicializa bot√µes globais (se existir)
  await  inicializarBotoesGlobais();
  if (!dados || !dados.jogos) {
        console.error("ERRO GRAVE: carregarJogos() foi chamada, mas 'dados.jogos' n√£o existem. A 'race condition' ainda est√° ocorrendo.");
        container.innerHTML = '<p style="text-align:center; color:#B71C1C;">Erro cr√≠tico: Os dados n√£o puderam ser carregados a tempo.</p>';
        return; // Para a execu√ß√£o da fun√ß√£o aqui
    }

  console.log("_____dados.jogos",dados.jogos)
    if (dados.jogos.length === 0) {
      console.log("dados",dados)
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum jogo cadastrado.</p>';
        return;
    }

    for (let jogo of dados.jogos) {
        const jogoId = jogo.id;
        const isExpanded = toggleStatesJogos[jogoId] || false;

        const jogoEl = document.createElement('div');
        jogoEl.className = 'jogo-item';
        jogoEl.style = `
            border:1px solid #ddd; margin:15px 0; padding:15px; 
            border-radius:8px; background:#fafafa;
        `;

        // ==== Cabe√ßalho ====
        const header = document.createElement('div');
        header.style = `
            display:flex; align-items:center; 
            justify-content:space-between; margin-bottom:10px;
        `;

        const leftSide = document.createElement('div');
        leftSide.style = 'display:flex; align-items:center; gap:15px;';

        // ==== IFRAME ====
        const iframeContainer = document.createElement('div');
        iframeContainer.style = `
            position: relative; width:150%; height:100%; 
            overflow:hidden; border-radius:8px; cursor:pointer;
        `;

        if (jogo.iframeUrl) {
            const iframe = document.createElement('iframe');
            iframe.src = jogo.iframeUrl;
            iframe.style = 'width:100%; height:100%; border:none; border-radius:8px;';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.loading = 'lazy';
            iframe.title = jogo.nome;

            const overlay = document.createElement('div');
            overlay.style = `
                position:absolute; top:0; left:0; width:100%; height:100%;
                background: transparent; z-index:1; cursor:pointer;
            `;
            overlay.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                verEstadiosDoJogo(jogo.id);
            };

            iframeContainer.appendChild(iframe);
            iframeContainer.appendChild(overlay);
        } else {
            const placeholder = document.createElement('div');
            placeholder.style = `
                width:100%; height:100%; background:#e0e0e0; 
                display:flex; align-items:center; justify-content:center;
                border-radius:8px;
            `;
            placeholder.innerHTML = 'üéÆ';
            placeholder.onclick = () => verEstadiosDoJogo(jogo.id);
            iframeContainer.appendChild(placeholder);
        }

        leftSide.appendChild(iframeContainer);

        // ==== Texto ====
        const textoLado = document.createElement('div');
        const h3 = document.createElement('h3');
        h3.textContent = jogo.nome;
        h3.style = 'margin:0; cursor:pointer; color:#007bff; font-size:1.1em;';
        h3.onclick = () => verEstadiosDoJogo(jogo.id);

        const p = document.createElement('p');
        p.textContent = `ID: ${jogo.id} | Est√°dios: ${jogo.estadios.length}`;
        p.style = 'margin:3px 0; color:#555; font-size:0.9em;';

        textoLado.appendChild(h3);
        textoLado.appendChild(p);
        leftSide.appendChild(textoLado);

        // ==== Bot√£o de Toggle (√∫nico no topo) ====
        const acoesPrincipais = document.createElement('div');
        acoesPrincipais.style = 'display:flex; align-items:center; gap: 8px;';

        const toggleBtn = document.createElement('button');
        toggleBtn.innerHTML = isExpanded ? '‚àí' : '+';
        toggleBtn.style = `
            width:36px; height:36px; border:none; border-radius:50%; 
            background:#007bff; color:white; font-weight:bold; font-size:1.2em;
            cursor:pointer; display:flex; align-items:center; justify-content:center;
            transition:0.2s;
        `;
        toggleBtn.onmouseover = () => toggleBtn.style.background = '#0056b3';
        toggleBtn.onmouseout = () => toggleBtn.style.background = '#007bff';
        acoesPrincipais.appendChild(toggleBtn);

        // ==== Container dos bot√µes secund√°rios ====
        const botoesContainer = document.createElement('div');
        botoesContainer.id = `botoes-${jogoId}`;
        botoesContainer.style = `
            display: ${isExpanded ? 'flex' : 'none'};
            flex-wrap: wrap; gap: 8px; justify-content: flex-start;
            margin-top: 12px; padding: 10px; background: #f8f9fa;
            border-radius: 6px; transition: all 0.3s ease;
        `;

        toggleBtn.onclick = () => {
            const expanded = botoesContainer.style.display === 'flex';
            botoesContainer.style.display = expanded ? 'none' : 'flex';
            toggleBtn.innerHTML = expanded ? '+' : '‚àí';
            toggleStatesJogos[jogoId] = !expanded;
        };

        // ==== Bot√µes Secund√°rios ====
        // 1Ô∏è‚É£ Copiar
        const isCopiado = clipboard.tipo === 'jogo' && clipboard.originalId === jogo.id;
        const copyBtn = document.createElement('button');
        copyBtn.innerHTML = isCopiado ? '‚úÖ Copiado' : 'üìã Copiar';
        copyBtn.className = 'btn-copiar-secundario';
        copyBtn.style = `
            padding:6px 10px; border:none; border-radius:5px; 
            color:white; background:${isCopiado ? '#28a745' : '#6f42c1'}; 
            cursor:pointer; font-size:0.85em; transition:0.2s;
        `;
        copyBtn.onclick = () => copiarItem('jogo', jogo);
        botoesContainer.appendChild(copyBtn);

        // 2Ô∏è‚É£ Editar
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Editar';
        editBtn.className = 'btn-editar-secundario';
        editBtn.style = `
            padding:6px 10px; border:none; border-radius:5px;
            color:#333; background:#ffc107; cursor:pointer;
            font-size:0.85em; transition:0.2s;
        `;
        editBtn.onclick = () => acaoEditarJogo(jogo.id);
        botoesContainer.appendChild(editBtn);

        // 3Ô∏è‚É£ Demais bot√µes
        const botoesSecundarios = [
            { text: 'Ver Detalhes', color: '#17a2b8', click: () => verEstadiosDoJogo(jogo.id) },
            { text: 'Excluir Jogo', color: '#dc3545', click: () => acaoExcluirJogo(jogo.id) },
// ATUALIZADO AQUI
            { 
                text: 'Compartilhar Link', 
                color: '#007bff', 
                // Passa um objeto com os IDs relevantes
                click: () => compartilharLocal({ jogoId: jogo.id }) 
            },
            // ATUALIZADO AQUI
            { 
                text: 'Link App Sinc.', 
                color: '#28a745', 
                // Passa os IDs e o 'true' para sincronizar
                click: () => compartilharLocal({ jogoId: jogo.id }, true) 
            },
        ];

        botoesSecundarios.forEach(btn => {
            const button = document.createElement('button');
            button.textContent = btn.text;
            button.style = `
                padding:6px 10px; border:none; border-radius:5px; 
                color:white; background:${btn.color}; cursor:pointer; 
                font-size:0.85em; min-width:100px; transition:0.2s;
            `;
            button.onclick = btn.click;
            botoesContainer.appendChild(button);
        });

        // 4Ô∏è‚É£ Chat
        const btnSalaJogo = document.createElement('button');
        btnSalaJogo.innerHTML = 'üí¨ Entrar no Chat';
        btnSalaJogo.style = `
            padding:6px 10px; border:none; border-radius:5px; 
            color:white; background:#9c27b0; cursor:pointer; 
            font-size:0.85em; min-width:70px; transition:0.2s;
        `;
        btnSalaJogo.onclick = () => abrirChatParaItem('jogo', jogo.id, escapeStringForHTML(jogo.nome));
        botoesContainer.appendChild(btnSalaJogo);

        // 5Ô∏è‚É£ P2P (se houver item copiado)
        if (clipboard.tipo === 'jogo') {
            const btnP2P = document.createElement('button');
            btnP2P.textContent = '‚¨áÔ∏è P2P (Colar)';
            btnP2P.style = `
                padding:6px 10px; background:#ff6b35; color:white;
                border:none; border-radius:5px; font-size:0.85em; cursor:pointer;
            `;
            btnP2P.onclick = () => acaoColarJogo();
            botoesContainer.appendChild(btnP2P);
        }

        // ==== Montagem final ====
        header.appendChild(leftSide);
        header.appendChild(acoesPrincipais);
        jogoEl.appendChild(header);
        jogoEl.appendChild(botoesContainer);
        container.appendChild(jogoEl);
    }

}

function carregarEstadiosDoJogo(jogoId) {
    const container = document.getElementById('lista-estadios');
    container.innerHTML = '';

    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return alert("Jogo n√£o encontrado!");

    document.querySelector('#secao-estadios h2').textContent = `Est√°dios - ${jogo.nome}`;

    // === BOT√ÉO ADICIONAR + COMPARTILHAR ===
    const topo = document.createElement('div');
    topo.innerHTML = `
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button onclick="acaoAdicionarEstadio(${jogoId})" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo estadio
            </button>
            <button onclick="acaoColarEstadio(${jogoId})" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar estadio
            </button>
        </div>
    `;
    container.appendChild(topo);

    // === LISTAR EST√ÅDIOS USANDO A MESMA L√ìGICA DO carregarJogos ===
    for (let estadio of jogo.estadios) {
        const estadioEl = document.createElement('div');
        estadioEl.innerHTML = gerarHTMLCardEstadio(jogo, estadio);
        container.appendChild(estadioEl);
    }
}
function carregarTimesDoEstadio(jogoId, estadioId) {
    const container = document.getElementById('lista-times');
    container.innerHTML = '';

    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return alert("Jogo n√£o encontrado!");

    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return alert("Est√°dio n√£o encontrado!");

    document.querySelector('#secao-times h2').textContent = `Times - ${estadio.nome} (${jogo.nome})`;

    // === TOPO: ADICIONAR + COMPARTILHAR ===
    const topo = document.createElement('div');
    topo.innerHTML = `
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button onclick="acaoAdicionarTime(${jogoId}, ${estadioId})" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo Time
            </button>
            <button onclick="acaoColarTime(${jogoId}, ${estadioId})" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar Time
            </button>
        </div>
    `;
    container.appendChild(topo);

    // === LISTAR TIMES USANDO A MESMA L√ìGICA ===
    for (let time of estadio.times) {
        const timeEl = document.createElement('div');
        timeEl.innerHTML = gerarHTMLCardTime(jogo, estadio, time);
        container.appendChild(timeEl);
    }
}
function carregarEstadios() {
    const container = document.getElementById('lista-estadios');
    container.innerHTML = '';

    document.querySelector('#secao-estadios h2').textContent = 'Todos os Est√°dios';

    let totalEstadios = 0;
    for (const j of dados.jogos) totalEstadios += j.estadios.length;

    if (totalEstadios === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum est√°dio cadastrado.</p>';
        return;
    }

    for (const jogo of dados.jogos) {
        if (jogo.estadios.length === 0) continue;

        const titulo = document.createElement('h3');
        titulo.textContent = `Jogo: ${jogo.nome}`;
        titulo.style = 'margin:20px 0 10px; padding-bottom:5px; border-bottom:1px solid #ddd;';
        container.appendChild(titulo);

        for (const estadio of jogo.estadios) {
            const el = document.createElement('div');
            el.innerHTML = gerarHTMLCardEstadio(jogo, estadio, true); // sem await
            container.appendChild(el);
        }
    }
}
async function carregarTimes() {
    const container = document.getElementById('lista-times');
    container.innerHTML = '';

    document.querySelector('#secao-times h2').textContent = 'Todos os Times';

    let totalTimes = 0;
    dados.jogos.forEach(j => j.estadios.forEach(e => totalTimes += e.times.length));

    if (totalTimes === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum time cadastrado.</p>';
        return;
    }

    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            if (estadio.times.length === 0) return;

            const titulo = document.createElement('h3');
            titulo.textContent = `Est√°dio: ${estadio.nome} | Jogo: ${jogo.nome}`;
            titulo.style = 'margin:20px 0 10px; padding-bottom:5px; border-bottom:1px solid #ddd;';
            container.appendChild(titulo);

            estadio.times.forEach(time => {
                const el = document.createElement('div');
                el.innerHTML = gerarHTMLCardTime(jogo, estadio, time, true);
                container.appendChild(el);
            });
        });
    });
}
async function carregarEstruturaTime() {
            const timeData = JSON.parse(localStorage.getItem('timeSelecionado'));
            const timeContainer = document.getElementById('timeContainer');
            const timeInfo = document.getElementById('timeInfo');
            
            if (timeData) {
                // LINHAS REMOVIDAS (CAUSAVAM O ERRO):
                // document.getElementById('pageTitle').textContent = `Time: ${timeData.time}`;
                // document.getElementById('pageSubtitle').textContent = `${timeData.estadio} | ${timeData.jogo}`;
                
                // Apenas modifica o timeInfo, que existe
                timeInfo.innerHTML = `
                    <h3>${timeData.time}</h3>
                    <p><strong>Jogo:</strong> ${timeData.jogo} | <strong>Est√°dio:</strong> ${timeData.estadio}</p>
                `;
                
                if (timeData.lives && timeData.lives.length > 0) {
                    timeContainer.innerHTML = '';
                    
                    timeData.lives.forEach((live, liveIndex) => {
                        const liveSection = document.createElement('div');
                        liveSection.className = 'live-section vertical-mode';
                        liveSection.setAttribute('data-live-index', liveIndex);
                        
                        const liveHeader = document.createElement('div');
                        liveHeader.className = 'live-header';
                        liveHeader.innerHTML = `
                            <span>Live ${liveIndex + 1} - ${live.creatorId}</span>
                            <button class="layout-toggle" data-live-index="${liveIndex}">
                                ‚Üî Modo Horizontal
                            </button>
                        `;
                        liveSection.appendChild(liveHeader);
                        
                        const cardsContainer = document.createElement('div');
                        cardsContainer.className = 'cards-do-time-container';
                        
                        if (live.divsHorizontais && live.divsHorizontais.length > 0) {
                            live.divsHorizontais.forEach((cardsDoTime, cardsIndex) => {
                                const cardsElement = document.createElement('div');
                                cardsElement.className = 'cards-do-time';
                                
                                const innerCardsContainer = document.createElement('div');
                                innerCardsContainer.className = 'cards-container';
                                
                                if (cardsDoTime.cards && cardsDoTime.cards.length > 0) {
                                    cardsDoTime.cards.forEach((card, cardIndex) => {
                                        const cardElement = document.createElement('div');
                                        cardElement.className = 'card';
                                        cardElement.innerHTML = `
                                            <div class="card-header">${card.titulo || `Card ${cardIndex + 1}`}</div>
                                            <iframe class="card-iframe" src="${card.iframeUrl}"></iframe>
                                        `;
                                        innerCardsContainer.appendChild(cardElement);
                                    });
                                }
                                
                                cardsElement.appendChild(innerCardsContainer);
                                cardsContainer.appendChild(cardsElement);
                            });
                        }
                        
                        liveSection.appendChild(cardsContainer);
                        timeContainer.appendChild(liveSection);
                    });

                    // Adicionar event listeners para alternar layout
                 await   adicionarEventListenersLayout();
                } else {
                //    carregarEstruturaPadrao();
                }
            } else {
              //  carregarEstruturaPadrao();
            }
            
           await configurarZoom();
        }
        

/**
 * Esta √© a fun√ß√£o de callback global obrigat√≥ria da API do YouTube.
 * Ela √© chamada automaticamente assim que o script 'iframe_api' termina de carregar.
 */
function onYouTubeIframeAPIReady() {
    console.log('YouTube IFrame API est√° pronta.');
    window.ytApiReady = true;
    
    // Tenta inicializar players que j√° possam estar no DOM
    // (Caso a API tenha carregado depois da renderiza√ß√£o)
    inicializarTodosOsPlayersYouTube();
}

/**
 * Itera por todos os iframes na se√ß√£o 'lives' e cria 
 * um objeto YT.Player control√°vel para cada um.
 */
function inicializarTodosOsPlayersYouTube() {
    // S√≥ executa se a API estiver pronta E a se√ß√£o 'lives' estiver vis√≠vel
    if (!window.ytApiReady || document.getElementById('secao-lives').style.display !== 'block') {
        // console.log('API do YT n√£o pronta ou se√ß√£o 'lives' oculta. Pular inicializa√ß√£o.');
        return;
    }

    console.log('Inicializando players do YouTube...');
    
    // Limpa refer√™ncias antigas (importante ao recarregar a estrutura)
    window.youtubePlayers = {}; 
    
    const iframes = document.querySelectorAll('#secao-lives .card-iframe');
    
    iframes.forEach(iframeEl => {
        const iframeId = iframeEl.id; // Ex: "iframe-live1-div2-card3"
        
        // Ignora iframes sem ID ou sem SRC (que n√£o carregar√£o)
        if (!iframeId || !iframeEl.src) return; 

        const uniqueCardId = iframeId.replace('iframe-', '');
        
        try {
            // Cria uma nova inst√¢ncia do player e armazena no mapa global
            window.youtubePlayers[uniqueCardId] = new YT.Player(iframeEl, {
                events: {
                    'onReady': (event) => console.log(`Player ${uniqueCardId} pronto.`),
                    'onError': (event) => console.error(`Erro no Player ${uniqueCardId}:`, event.data)
                }
            });
        } catch (e) {
            console.error(`Falha ao criar YT.Player para ${iframeId}:`, e);
        }
    });
    
    console.log(`Players do YouTube inicializados: ${Object.keys(window.youtubePlayers).length}`);
}

/**
 * Fun√ß√£o de controle de volume para um player espec√≠fico.
 * @param {string} uniqueCardId - O ID do card (ex: "live1-div2-card3")
 * @param {number} volumeLevel - N√≠vel de volume (0-100)
 */
function controlarVolumePlayer(uniqueCardId, volumeLevel) {
    const player = window.youtubePlayers[uniqueCardId];
    
    if (player && typeof player.setVolume === 'function') {
        if (player.isMuted()) {
            player.unMute(); // Garante que n√£o est√° mutado
        }
        player.setVolume(volumeLevel);
        // console.log(`Volume do player ${uniqueCardId} definido para ${volumeLevel}`);
    } else {
        console.warn(`Player ${uniqueCardId} n√£o encontrado ou n√£o est√° pronto.`);
    }
}

// === CORRE√á√ÉO 2: Remover chamada autom√°tica em mostrarSecao ===
function mostrarSecao(secao) {
    document.querySelectorAll('.secao').forEach(el => el.style.display = 'none');
    const target = document.getElementById(`secao-${secao}`);
    if (target) target.style.display = 'block';
}
async function carregarSecao(secao) {
    switch(secao) {
        case 'jogos':
        await    carregarJogos();
            break;
        case 'estadios':
            if (jogoSelecionadoId) {
              await  carregarEstadiosDoJogo(jogoSelecionadoId);
            } else {
             await   carregarEstadios();
            }
            break;
        case 'times':
            if (jogoSelecionadoId && estadioSelecionadoId) {
                carregarTimesDoEstadio(jogoSelecionadoId, estadioSelecionadoId);
            } else {
             await   carregarTimes();
            }
            break;
        case 'lives':
            if (jogoSelecionadoId && estadioSelecionadoId && timeSelecionadoId) {
                carregarLivesDoTime(jogoSelecionadoId, estadioSelecionadoId, timeSelecionadoId);
            }
            break;
        case 'streamers':
            if (jogoSelecionadoId && estadioSelecionadoId && timeSelecionadoId && liveSelecionadoId) {
                carregarStreamersDaLive(jogoSelecionadoId, estadioSelecionadoId, timeSelecionadoId, liveSelecionadoId);
            }
            break;
    }
}


function carregarEstruturaTimeComDados(jogoId, estadioId, timeId) {
    const time = encontrarTime(dados, jogoId, estadioId, timeId);
    const timeContainer = document.getElementById('timeContainer');
    const timeInfo = document.getElementById('timeInfo');

    if (time) {
        timeInfo.innerHTML = `
            <h3>${time.nome || 'Time Sem Nome'}</h3>
            <p>ID: ${time.id} | Lives: ${time.lives.length}</p>
            ${clipboard.tipo === 'live' ? `
                <button class="btn-colar-dinamico" onclick="acaoColarLive(${jogoId}, ${estadioId}, ${timeId})" 
                        style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em; margin-left: 10px;">
                    Colar Live
                </button>
            ` : ''} `;

        timeContainer.innerHTML = '';

        if (time.lives && time.lives.length > 0) {
            time.lives.forEach((live, liveIndex) => {
                const liveId = live.id;
                const liveSection = document.createElement('div');
                liveSection.className = 'live-section vertical-mode';
                liveSection.setAttribute('data-live-index', liveIndex);

                const liveHeader = document.createElement('div');
                liveHeader.className = 'live-header';
                liveHeader.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <h3>${live.titulo || `Live ${liveIndex + 1}`}</h3>
                        <button id="toggle-live-${liveId}" onclick="toggleLiveBotoes(${liveId})">+</button>
                        <button class="btn-colar-dinamico" onclick="acaoColarDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                                style="background:#6f42c1; color:white; padding:6px 10px; border:none; border-radius:5px; font-size:0.85em; cursor:pointer;">
                            Colar Div
                        </button> <button class="layout-toggle" data-live-index="${liveIndex}">‚Üî Modo Horizontal</button>
                    </div>
                    <div id="botoes-live-${liveId}" style="display:none; flex-wrap:wrap; gap:8px; margin-top: 10px;">
                        ${gerarBotoesLive(jogoId, estadioId, timeId, liveId)}
                    </div>
                `;
                liveSection.appendChild(liveHeader);

                const cardsContainer = document.createElement('div');
                cardsContainer.className = 'cards-do-time-container';

                if (live.divsHorizontais && live.divsHorizontais.length > 0) {
                    live.divsHorizontais.forEach((divHorizontal, divIndex) => {
                        const divId = divHorizontal.id;
                        const cardsElement = document.createElement('div');
                        cardsElement.className = 'cards-do-time';
                        cardsElement.innerHTML = `
                            <div class="div-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                                <h4 class="div-title-header">${divHorizontal.titulo || `Div ${divIndex + 1}`}</h4>
                                <button id="toggle-div-${divId}" onclick="toggleDivBotoes(${divId})">+</button>
                                <button class="btn-colar-dinamico" onclick="acaoColarCard(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId})" 
                                        style="background:#6f42c1; color:white; padding:6px 10px; border:none; border-radius:5px; font-size:0.85em; cursor:pointer;">
                                    Colar Card
                                </button> </div>
                            <div id="botoes-div-${divId}" style="display:none; flex-wrap:wrap; gap:8px; margin-bottom: 10px;">
                                ${gerarBotoesDiv(jogoId, estadioId, timeId, liveId, divId)}
                            </div>
                        `;

                        const innerCardsContainer = document.createElement('div');
                        innerCardsContainer.className = 'cards-container';

                        if (divHorizontal.cards && divHorizontal.cards.length > 0) {
                            divHorizontal.cards.forEach((card, cardIndex) => {
                                const cardId = card.id;
                                const uniqueCardId = gerarUniqueCardId(liveId, divId, cardId);

       // Dentro do forEach dos cards, onde cria o iframe:
const cardElement = document.createElement('div');
cardElement.className = 'card';
cardElement.id = `card-${uniqueCardId}`;
cardElement.innerHTML = `
    <div class="card-header">${card.titulo || `Card ${cardIndex + 1}`}</div>
    <div style="position: relative; width: 100%; height: 100%;">
        <iframe class="card-iframe" src="${card.iframeUrl || ''}" 
                id="iframe-${uniqueCardId}"
                style="width: 100%; height: 100%; border: none;"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
        </iframe>
    </div>
    <button id="toggle-${uniqueCardId}" onclick="toggleIframerBotoes('${uniqueCardId}')">+</button>
`;

// Remove toda a parte dos controles de volume complexos que estava aqui
    /*
   const cardBotoesContainer = document.createElement('div');
  cardBotoesContainer.id = `botoes-${uniqueCardId}`;
  cardBotoesContainer.style = 'display:none; flex-wrap:wrap; gap:8px;';
  cardBotoesContainer.innerHTML = `<div style="padding: 5px;">${gerarBotoesCard(jogoId, estadioId, timeId, liveId, divId, cardId)}</div>`;
  cardElement.appendChild(cardBotoesContainer);
    */
    // SUBSTITUA PELO C√ìDIGO ABAIXO:
const cardBotoesContainer = document.createElement('div');
cardBotoesContainer.id = `botoes-${uniqueCardId}`;
cardBotoesContainer.style = 'display:none; flex-wrap:wrap; gap:8px; padding: 5px;'; // Adicionado padding aqui

// 1. Pega o HTML dos seus bot√µes CRUD (Editar, Excluir, etc.)
const crudButtonsHTML = gerarBotoesCard(jogoId, estadioId, timeId, liveId, divId, cardId);

// 2. Cria o HTML do controle de volume
// Ele chama a fun√ß√£o 'controlarVolumePlayer' que criamos no Passo 1
const volumeControlHTML = `
    <div class="volume-control" style="display: flex; align-items: center; gap: 5px; margin-top: 5px; width: 100%;">
        <span style="font-size: 1.1em; cursor: default;">üîà</span>
        <input type="range" min="0" max="100" value="100" 
               title="Controlar volume"
               style="flex: 1; width: 100px; cursor: pointer;"
               oninput="controlarVolumePlayer('${uniqueCardId}', this.value)"
               onclick="event.stopPropagation();">
    </div>
`;

// 3. Combina os HTMLs e adiciona ao cont√™iner
cardBotoesContainer.innerHTML = crudButtonsHTML + volumeControlHTML;
cardElement.appendChild(cardBotoesContainer);
  
  
  innerCardsContainer.appendChild(cardElement);
                            });
                        }

                        cardsElement.appendChild(innerCardsContainer);
                        cardsContainer.appendChild(cardsElement);
                    });
                }

                liveSection.appendChild(cardsContainer);
                timeContainer.appendChild(liveSection);
            });

            adicionarEventListenersLayout();
        } else {
            timeContainer.innerHTML = `
                <div style="text-align: center; color: white; padding: 20px;">
                    <p>Nenhuma live encontrada para este time.</p>
                    <button onclick="acaoAdicionarLive(${jogoId}, ${estadioId}, ${timeId})" 
                            style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em; margin: 10px;">
                        + Criar Nova Live
                    </button>
                    ${clipboard.tipo === 'live' ? `
                        <button class="btn-colar-dinamico" onclick="acaoColarLive(${jogoId}, ${estadioId}, ${timeId})" 
                                style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em; margin: 10px;">
                            Colar Live
                        </button>
                    ` : ''} </div>
            `;
        }

    } else {
        timeContainer.innerHTML = '<p style="text-align: center; color: white; padding: 20px;">Time n√£o encontrado.</p>';
    }
    inicializarTodosOsPlayersYouTube();

    configurarZoom();
}
function inicializarBotoesGlobais() {
    const container = document.getElementById('lista-jogos');
    if (!container) return;
    
    // Verifica se os bot√µes j√° existem
    const botoesExistentes = document.getElementById('botoes-globais-jogos');
    if (botoesExistentes) return; // J√° existem, n√£o faz nada
    
    const topoHtml = `
        <div id="botoes-globais-jogos" style="   display:flex; padding: 10px; text-align: center; background: #f0f0f0; border-radius: 8px; margin-bottom: 15px;">
            <button onclick="acaoAdicionarJogo()">+ Novo Jogo</button>
            <button onclick="acaoColarJogo()">Colar Jogo</button>
        </div>
    `;
    container.insertAdjacentHTML('beforebegin', topoHtml);
}
function adicionarEventListenersLayout() {
    const toggleButtons = document.querySelectorAll('.layout-toggle');
    
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const liveIndex = this.getAttribute('data-live-index');
            const liveSection = document.querySelector(`.live-section[data-live-index="${liveIndex}"]`);
            
            // Alternar entre modo vertical e horizontal
            const isVertical = liveSection.classList.contains('vertical-mode');
            liveSection.classList.remove('vertical-mode', 'horizontal-mode');
            
            if (isVertical) {
                liveSection.classList.add('horizontal-mode');
                this.textContent = '‚Üï Modo Vertical';
            } else {
                liveSection.classList.add('vertical-mode');
                this.textContent = '‚Üî Modo Horizontal';
            }
        });
    });

    // O C√ìDIGO QUE CRIAVA O BOT√ÉO '#toggle-headers' FOI REMOVIDO DAQUI.
}

function configurarZoom() {
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const resetZoomBtn = document.getElementById('resetZoom');
            
            let currentScale = 1;
            const minScale = 0.5;
            const maxScale = 3;
            const scaleStep = 0.1;
            
            function applyZoom() {
                const cards = document.querySelectorAll('.card');
                const newWidth = 280 * currentScale;
                const newHeight = 140 * currentScale;
                
                cards.forEach(card => {

                    // A condi√ß√£o 'if' foi removida.
                    // O zoom agora aplica a LARGURA em TODOS os modos.
                    card.style.width = `${newWidth}px`;
                    
                    const iframe = card.querySelector('.card-iframe');
                    iframe.style.height = `${newHeight}px`;
                    
                    const header = card.querySelector('.card-header');
                    header.style.fontSize = `${0.9 * currentScale}rem`;
                    header.style.padding = `${8 * currentScale}px`;
                });
            }
            
            zoomInBtn.addEventListener('click', () => {
                if (currentScale < maxScale) {
                    currentScale += scaleStep;
                    applyZoom();
                }
            });
            
            zoomOutBtn.addEventListener('click', () => {
                if (currentScale > minScale) {
                    currentScale -= scaleStep;
                    applyZoom();
                }
            });
            
            resetZoomBtn.addEventListener('click', () => {
                currentScale = 1;
                applyZoom();
            });
        }

/////
/////
/////
/////




/////
/////
/////
/////

// ===== SISTEMA DE CONVITES INTELIGENTES =====

// Fun√ß√£o para obter par√¢metros da URL
function getURLParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

// Processar convite quando a aplica√ß√£o carregar
async function inicializarSistemaConvites() {
    const inviteCode = getURLParameter('invite');
    
    if (inviteCode) {
        console.log('Processando convite:', inviteCode);
        await processarConvite(inviteCode);
        
        // Limpar o par√¢metro da URL sem recarregar a p√°gina
        const novaURL = window.location.pathname;
        window.history.replaceState({}, document.title, novaURL);
    }
}

async function processarConvite(inviteCode) {
    try {
        mostrarLoadingConvite();
        
        const response = await fetch(`${API_BASE}/invite-details/${inviteCode}`);
        if (!response.ok) {
            throw new Error('Convite inv√°lido ou expirado');
        }
        
        const inviteData = await response.json();
        await navegarParaDestinoConvite(inviteData);
        
    } catch (error) {
        console.error('Erro ao processar convite:', error);
        mostrarNotificacao('Erro ao processar convite: ' + error.message, 'erro');
    } finally {
        esconderLoadingConvite();
    }
}

async function navegarParaDestinoConvite(inviteData) {
    const { jogoId, estadioId, timeId, liveId, sync } = inviteData;
    
    // Aguardar a aplica√ß√£o carregar completamente
    await aguardarAplicacaoPronta();
    
    // Hierarquia de navega√ß√£o com await em todas as chamadas
    if (liveId && timeId && estadioId && jogoId) {
        await navegarParaLive(jogoId, estadioId, timeId, liveId, sync);
    } else if (timeId && estadioId && jogoId) {
        await navegarParaTime(jogoId, estadioId, timeId, sync);
    } else if (estadioId && jogoId) {
        await navegarParaEstadio(jogoId, estadioId, sync);
    } else if (jogoId) {
        await navegarParaJogo(jogoId, sync);
    } else {
        // Convite gen√©rico - j√° estamos na home
        console.log('Convite gen√©rico processado');
    }
    
    // Mostrar info do compartilhador se dispon√≠vel
    if (inviteData.creatorId) {
        setTimeout(() => {
            if (typeof mostrarNotificacao === 'function') {
                mostrarNotificacao('Convite recebido!', 'sucesso');
            } else {
                console.log('Convite recebido! (Notifica√ß√£o n√£o dispon√≠vel)');
            }
        }, 1000);
    }
}
// Fix navegarParaJogo: Handle notification safely, remove duplicate hide
async function navegarParaJogo(jogoId) {
    mostrarLoadingConvite();

    await carregarDadosAplicacao(); 

    const jogo = window.dados.jogos.find(j => j.id === jogoId);
    
    if (!jogo) {
        console.error(`[CONVITE] Jogo com ID ${jogoId} n√£o encontrado. Voltando para Jogos.`);
        if (typeof mostrarNotificacao === 'function') {
            mostrarNotificacao('O destino do convite (Jogo) n√£o foi encontrado.', 'erro');
        } else {
            console.error('O destino do convite (Jogo) n√£o foi encontrado.');
        }
        esconderLoadingConvite();
        mostrarSecao('jogos');
        return;
    }

    window.jogoSelecionadoId = jogoId;
    mostrarSecao('estadios');
    carregarEstadiosDoJogo(jogoId);
    console.log('Convite processado com sucesso! Jogo:', jogoId);
    esconderLoadingConvite();  // Only once
}

async function navegarParaEstadio(jogoId, estadioId, sync) {
    try {
        console.log('Navegando para est√°dio:', jogoId, estadioId);
        
        if (!window.dados) {
            await carregarDadosAplicacao();
        }
        
        const jogo = window.dados.jogos.find(j => j.id === jogoId);
        if (!jogo) throw new Error('Jogo n√£o encontrado');
        
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (!estadio) throw new Error('Est√°dio n√£o encontrado');
        
        window.jogoSelecionadoId = jogoId;
        window.estadioSelecionadoId = estadioId;
        mostrarSecao('times');
        carregarTimesDoEstadio(jogoId, estadioId);  // Removi await desnecess√°rio se n√£o for async
        
        if (sync) {
            ativarModoSincronizado('estadio', jogoId, estadioId);
        }
    } catch (error) {
        console.error('Erro ao navegar para est√°dio:', error);
        if (typeof mostrarNotificacao === 'function') {
            mostrarNotificacao('Erro ao carregar est√°dio do convite.', 'erro');
        }
        mostrarSecao('jogos');  // Volta para home em erro
    }
}
async function navegarParaTime(jogoId, estadioId, timeId, sync) {
    console.log('Navegando para time:', jogoId, estadioId, timeId);
    
    if (!window.dados) {
        await carregarDadosAplicacao();
    }
    
    const jogo = window.dados.jogos.find(j => j.id === jogoId);
    if (!jogo) throw new Error('Jogo n√£o encontrado');
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) throw new Error('Est√°dio n√£o encontrado');
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) throw new Error('Time n√£o encontrado');
    
    window.jogoSelecionadoId = jogoId;
    window.estadioSelecionadoId = estadioId;
    window.timeSelecionadoId = timeId;
    
    // Navegar para a estrutura do time
    await carregarEstruturaTimeComDados(jogoId, estadioId, timeId);
    
    if (sync) {
        ativarModoSincronizado('time', jogoId, estadioId, timeId);
    }
}
async function navegarParaLive(jogoId, estadioId, timeId, liveId, sync) {
    console.log('Navegando para live:', jogoId, estadioId, timeId, liveId);
    
    await navegarParaTime(jogoId, estadioId, timeId, sync);
    
    // Aguardar um pouco para a estrutura carregar e ent√£o destacar a live
    setTimeout(() => {
        const liveElement = document.querySelector(`[data-live-id="${liveId}"]`);
        if (liveElement) {
            liveElement.scrollIntoView({ behavior: 'smooth' });
            liveElement.style.border = '3px solid #28a745';
            liveElement.style.transition = 'border 0.5s ease';
        }
    }, 1500);
}
// Fun√ß√µes auxiliares
function aguardarAplicacaoPronta() {
    return new Promise((resolve) => {
        const checkReady = () => {
            if (window.dados && typeof mostrarSecao === 'function' && typeof carregarEstadiosDoJogo === 'function') {
                resolve();
            } else {
                setTimeout(checkReady, 100);
            }
        };
        checkReady();
    });
}
// Update carregarDadosAplicacao to use window.dados consistently
async function carregarDadosAplicacao() {
    if (!window.dados || !window.dados.jogos || window.dados.jogos.length === 0) { 
        console.log('Dados da aplica√ß√£o ainda n√£o carregados. For√ßando carregamento...');
        await carregarDadosBackend(); 
        if (typeof carregarJogos === 'function') {
            await carregarJogos();
        }
    }
}
function mostrarLoadingConvite() {
    // Use seu sistema de loading existente ou crie um simples
    const existingLoading = document.getElementById('loading-convite');
    if (existingLoading) return;
    
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loading-convite';
    loadingDiv.style = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 1.2em;
        z-index: 10000;
    `;
    loadingDiv.innerHTML = `
        <div style="text-align: center;">
            <div style="margin-bottom: 10px;">Carregando convite...</div>
            <div style="border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        </div>
    `;
    
    // Adicionar anima√ß√£o CSS se n√£o existir
    if (!document.querySelector('#convite-loading-style')) {
        const style = document.createElement('style');
        style.id = 'convite-loading-style';
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    }
    
    document.body.appendChild(loadingDiv);
}
function esconderLoadingConvite() {
    const loadingDiv = document.getElementById('loading-convite');
    if (loadingDiv) {
        loadingDiv.remove();
    }
}
function ativarModoSincronizado(tipo, ...ids) {
    console.log(`Modo sincronizado ativado para ${tipo}:`, ids);
    // Implemente sua l√≥gica de sincroniza√ß√£o aqui
}
async function inicializar() {
    console.log('Iniciando sistema...');
    
    const sucesso = await carregarDadosBackend();
    
    if (sucesso) {
      salvarDados()
      console.log("___dados",dados)
   //   console.log("___dados.jogos",dados.jogos)
       await carregarJogos(); // sua fun√ß√£o que renderiza a UI
        console.log('Sistema inicializado com sucesso');
    } else {
        document.getElementById('app').innerHTML = `
            <div class="erro">
                <h2>Erro ao conectar com o servidor</h2>
                <p>Verifique se o backend est√° rodando em <code>https://youtube-lives.onrender.com</code></p>
                <button onclick="location.reload()">Tentar novamente</button>
            </div>
        `;
    }
}
async function inicializarSistemaCompleto() {
    console.log('üöÄ Inicializando sistema completo...');
    // Criar menu principal
    
   await criarBadgeNotificacoes();
    // Inicializar badge de notifica√ß√µes
    // Inicializar sistema de apostas
   await inicializarSistemaApostasDesafios();
    // Criar eventos autom√°ticos
   await criarEventosAutomaticos();
  await   adicionarNotificacao
    if(adicionarNotificacao){
      
    setTimeout(() => {
        adicionarNotificacao(
            'üéâ Bem-vindo!',
            'Sistema completo carregado com sucesso!',
            'sucesso'
        );
    }, 1000);
    }
        // Adicionar notifica√ß√£o de boas-vindas
    console.log('‚úÖ Sistema completo inicializado!');
  
}
async function inicializarSistemaApostasDesafios() {
    console.log('üéØ Inicializando sistema de apostas e desafios...');
    // Verifica encerramentos agora tamb√©m
   await verificarEncerramentosAutomaticos();
    // Inicializa indicadores
  await  atualizarIndicadoresApostas();
    
    // Observa mudan√ßas no DOM para adicionar bot√µes dinamicamente
   await  inicializar()
  await carregarEstruturaTime()
  await carregarSessao()
 await  atualizarInterfaceLogin()
  
  
 //  fecharMenuPrincipal()
   await observarDOMParaBotoes();
  
    console.log('‚úÖ Sistema de apostas inicializado!');
    
}
async function adicionarEvento(titulo, descricao, tipo = 'info', duracaoHoras = 24) {
    const evento = {
        id: Date.now(),
        titulo: titulo,
        descricao: descricao,
        tipo: tipo,
        dataInicio: new Date(),
        dataFim: new Date(Date.now() + duracaoHoras * 60 * 60 * 1000),
        ativo: true
    };
    
    eventos.unshift(evento);
    
    // Limitar a 50 eventos
    if (eventos.length > 50) {
        eventos = eventos.slice(0, 50);
    }
    
    // Notificar sobre novo evento
    adicionarNotificacao('üéâ Novo Evento!', titulo, 'info');
    
    return evento.id;
}
async function criarEventosAutomaticos() {
    // Evento de fim de semana
    const hoje = new Date();
    if (hoje.getDay() === 6 || hoje.getDay() === 0) { // S√°bado ou Domingo
     await   adicionarEvento(
            'üéä Evento de Fim de Semana',
            'Ganhe o dobro de m√©ritos em todas as apostas e desafios!',
            'sucesso',
            48
        );
    }
    
    // Evento mensal
    if (hoje.getDate() === 1) { // Primeiro dia do m√™s
     await   adicionarEvento(
            'üìà Ranking Mensal',
            'Competi√ß√£o especial do ranking mensal! Os 3 primeiros ganham b√¥nus!',
            'info',
            720 // 30 dias
        );
    }
    
    // Evento aleat√≥rio
    if (Math.random() > 0.7) {
        const eventosAleatorios = [
            {
                titulo: '‚ö° Evento Rel√¢mpago',
                descricao: 'Apostas r√°pidas! Tempo limitado para participar!',
                duracao: 2
            },
            {
                titulo: 'üéØ Desafio em Grupo',
                descricao: 'Forme times e compita por pr√™mios especiais!',
                duracao: 12
            },
            {
                titulo: 'üí∞ B√¥nus de M√©rito',
                descricao: 'Todas as apostas d√£o 50% mais m√©ritos!',
                duracao: 6
            }
        ];
        
        const eventoAleatorio = eventosAleatorios[Math.floor(Math.random() * eventosAleatorios.length)];
      await  adicionarEvento(
            eventoAleatorio.titulo,
            eventoAleatorio.descricao,
            'alerta',
            eventoAleatorio.duracao
        );
    }
}
// Inicializar eventos autom√°ticos
setInterval(criarEventosAutomaticos, 60 * 60 * 1000); // A cada hora



// ADICIONE ESTE BLOCO NO LUGAR DE TUDO O QUE FOI REMOVIDO:

document.addEventListener('DOMContentLoaded', async function() {
    console.log('DOM carregado. Iniciando sequ√™ncia de inicializa√ß√£o √∫nica...');
    
    // 1. Adicionar ouvintes de eventos globais
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const floatingMenu = document.getElementById('loginFloating');
            const overlay = document.getElementById('overlay');
            if (floatingMenu) floatingMenu.classList.remove('show');
            if (overlay) overlay.classList.remove('show');
        }
    });

    // 2. Executar a rotina de inicializa√ß√£o principal (UMA S√ì VEZ)
    //    Esta fun√ß√£o j√° chama todas as outras na ordem correta:
    //    - inicializarSistemaApostasDesafios()
    //    - inicializar()
    //    - criarEventosAutomaticos()
    await inicializarSistemaCompleto();
   await  recuperarSessao();
  await  verificarEstadoLogin();

   // await inicializarDados();

    // 3. Iniciar o sistema de convites (ap√≥s tudo estar carregado)
    //    N√£o precisamos mais do setTimeout, pois agora temos o 'await'
    await inicializarSistemaConvites();
    
    console.log('‚úÖ Sequ√™ncia de inicializa√ß√£o do DOM conclu√≠da.');
});

</script>

<script src="Intreterimento/notificacoes.js"></script>
<script src="Intreterimento/eventos.js"></script>


  <script src="Wrtc/wrtc.js" defer> </script>
  <script src="Wrtc/Chat/pagamentoFrontend.js" defer> </script>
  <script src="Wrtc/Chat/criaSalas.js" defer> </script>
  <script src="Wrtc/Chat/modal.js" defer> </script>
  <script src="Wrtc/Chat/Chat.js" defer> </script>
  <script src="Intreterimento/Intreterimento.js" defer> </script>

<script src="Intreterimento/apostas.js"></script>
<script src="Intreterimento/pagamentos.js"></script>

<script src="Intreterimento/desafios.js"></script>  <!-- Se existir -->
<script src="Intreterimento/ui-modals.js"></script>
<script src="Intreterimento/transacoes.js"></script>
<script src="Intreterimento/pagamentoFrontend.js"></script>  <!-- Se separado, para WebRTC -->
  
</body>
</html>


