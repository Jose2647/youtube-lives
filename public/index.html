<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Sistema de Jogos e Transmiss√µes</title>
</head>
<body>
  
  <header >
    <button onclick="verRankingUsuarios()">Ranking</button>
    <button onclick="buscarStreamers()">Buscar</button>
    <button onclick="verNotificacoes()">Notifica√ß√µes</button>
    <button onclick="verEventos()">Eventos</button>
   <div class="profile-icon" id="profileIcon" onclick="toggleProfileMenu()">üë§</div>
  </header>
  <!-- Menu flutuante do perfil -->
  <div class="login-floating" id="loginFloating">
    <!-- Conte√∫do ser√° preenchido pelo JavaScript -->
  </div>
 <!-- Overlay para fechar o menu -->
  <div class="overlay" id="overlay" onclick="toggleProfileMenu()"></div>
  
</header>
    <h1>Sistema de Jogos e Transmiss√µes</h1>
    
    <!-- Se√ß√£o de Jogos -->
    <div id="secao-jogos" class="secao">
        <h2>Jogos</h2>

     
     
                 <button onclick="adicionarJogo()" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo Jogo
            </button>
            <button onclick="colarJogo()" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar Jogo
            </button>
    
        <div id="lista-jogos"></div>
    </div>
    
    <!-- Se√ß√£o de Est√°dios -->
    <div id="secao-estadios" class="secao" style="display:none;">
        <h2>Est√°dios</h2>
        <button onclick="voltarParaJogos()">‚Üê Voltar para Jogos</button>

        <button onclick="colarEstadioCopiado()">Adicionar colar</button>
        <div id="lista-estadios"></div>
    </div>
    
  
    <div id="secao-times" class="secao" style="display:none;">
    <h2>Times</h2>
    <button onclick="voltarParaEstadios()">‚Üê Voltar para Est√°dios</button>
    
    <!-- BOT√ÉO COLAR FIXO -->
    <button onclick="colarTimeCopiado(jogoSelecionadoId, estadioSelecionadoId)" 
            style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em; margin:10px 5px;">
        Colar Time Copiado
    </button>

    <div id="lista-times"></div>
</div>
    
    <!-- Se√ß√£o de Lives - CORRIGIDO -->
<div id="secao-lives" class="secao header-live" style="display:none;">
  
    <div class="secao-header">
        <h2>Lives</h2>
        <div class="secao-buttons">
  
            <button onclick="voltarParaTimes()">‚Üê Voltar para Times</button>
            
            
    </div>
    
    <div id="lista-lives"></div>
</div>

</div>





<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js">
</script>

  

  
<script >
  
  // ===== INICIALIZA√á√ÉO GLOBAL SEGURA =====
if (!window.AppState) {
    window.AppState = {};
}
if (!window.AppState.socket) {
    window.AppState.socket = null;
}
if (!window.salasDisponiveis) {
    window.salasDisponiveis = {};
}
if (typeof window.salaAtual === 'undefined') {
    window.salaAtual = null;
}

  

// variaveis-globais.js
let dados = {
    jogos: [],
    usuarios: [],
    transacoes: [],
    apostasUsuarios: [],
    desafiosUsuarios: [],
    chats: [] // Store chats per cardId
};

let jogoTemporarioParaCompartilhar = null;
let acoesEstadioVisiveis = true;
// Vari√°vel global para inst√¢ncia atual
let modalChatAtual = null;

// === CONEX√ïES WEBRTC ===
let jogoCopiado = null;
let estadioCopiado = null; // Armazena o est√°dio copiado
let timeCopiado = null;
let liveCopiada = null;
let cardCopiado = null;
let divCopiada = null;
let scrollContainerCopiado = null;
let iframerCopiado = null;




let toggleStatesLive = {};
let toggleStatesScrollContainer = {};
let toggleStatesDiv = {};
let toggleStatesIframer = {};
// Criar fun√ß√µes de toggle para diferentes tipos
//const toggleTimeBotoes = createToggleFunction('time');
//const toggleEstadioBotoes = createToggleFunction('estadio');
//const toggleScrollContainerBotoes = createToggleFunction('scrollContainer');



// ESTADO GLOBAL PARA DIVS
const dataChannels = {};

let peerConnections = {};
let usuarioLogado = null;
let streamerLogado = null;
let notificacoes = [];
let socket = null;
let eventos = [];
let jogoSelecionadoId = null;
let estadioSelecionadoId = null;
let timeSelecionadoId = null;
let liveSelecionadoId = null;

let peerConnection = null;
let localStream = null;
let dataChannel = null;
let audioContext = null;
let audioAnalyser = null;
let audioParticipants = new Map();

const configLives = {
    maxIframes: 8,
    maxCardsUsuario: 6,
    maxDivsPorLive: 4,
    maxCardsPorDiv: 8,
    iframeWidth: "180px",
    iframeHeight: "200px",
    autoplay: 1,
    mute: 1,
    enablejsapi: 1,
    tamanhosDisponiveis: {
        pequeno: { width: "100px", height: "161px", label: "Pequeno" },
        medio: { width: "150px", height: "241px", label: "M√©dio" },
        grande: { width: "200px", height: "321px", label: "Grande" },
        extraGrande: { width: "350px", height: "401px", label: "Extra Grande" }
    },
    tamanhosCards: {
        pequeno: { width: "135px", height: "135px", label: "Pequeno" },
        medio: { width: "180px", height: "180px", label: "M√©dio" },
        grande: { width: "225px", height: "225px", label: "Grande" },
        extraGrande: { width: "270px", height: "270px", label: "Extra Grande" }
    },
    alturasDiv: {
        pequeno: { height: "1200px", label: "Pequeno" },
        medio: { height: "1200px", label: "M√©dio" },
        grande: { height: "1200px", label: "Grande" },
        extraGrande: { height: "1200px", label: "Extra Grande" }
    }
};

window.configLives = configLives;

const imagensPadrao = {
    jogo: "https://via.placeholder.com/150/4CAF50/white?text=JOGO",
    estadio: "https://via.placeholder.com/150/2196F3/white?text=EST√ÅDIO",
    time: "https://via.placeholder.com/150/FF9800/white?text=TIME",
    live: "https://via.placeholder.com/150/9C27B0/white?text=LIVE",
    streamer: "https://via.placeholder.com/150/607D8B/white?text=STREAMER",
    usuario: "https://via.placeholder.com/150/795548/white?text=USU√ÅRIO"
};

function obterImagem(entidade, imagemCustom) {
    return imagemCustom && imagemCustom !== '' ? imagemCustom : imagensPadrao[entidade];
}



const API_BASE = 'http://localhost:3000';
    // === CONFIGURA√á√ïES ===
    const SIGNALING_SERVER = 'wss://localhost:3000';
  
  // Vari√°veis globais (devem ser definidas no escopo global do seu arquivo HTML/JS principal)









// Vari√°veis de controle do modal (para simula√ß√£o)


  
   // let socket = null;
    let salaAtual = null;
    let salasDisponiveis = {};
    let usuariosNaSala = new Set();
    let peers = {};
    let meuStream = null;
    let voiceEnabled = false;
    let abaAtual = 'salas';
    /*
        // === CONFIG (AJUSTE AQUI) ===
  //  const API_BASE = 'http://localhost:3000/api';  // Seu backend URL
    const SOCKET_SERVER = 'http://localhost:3000';  // Mesmo do chat, se compartilhado
    const TOKEN_JWT = localStorage.getItem('jwtToken') || '';  // Do login existente

    // === GLOBAIS ISOLADAS (N√ÉO TOCA NO CHAT) ===
    let socketApostas = null;
    let intervalEncerramentos = null;
    const ROOMS_APOSTAS = {};  // { cardId: roomName } para tracking
*/

    
    
    const API_BASE = 'https://youtube-lives.onrender.com';
    // === CONFIGURA√á√ïES ===
    const SIGNALING_SERVER = 'wss://youtube-lives.onrender.com';
   // let socket = null;
    let salaAtual = null;
    let salasDisponiveis = {};
    let usuariosNaSala = new Set();
    let peers = {};
    let meuStream = null;
    let voiceEnabled = false;
    let abaAtual = 'salas';
    
    
        // === CONFIG (AJUSTE AQUI) ===
  //  const API_BASE = 'https://youtube-lives.onrender.com/api';  // Seu backend URL
    const SOCKET_SERVER = 'https://youtube-lives.onrender.com';  // Mesmo do chat, se compartilhado
    const TOKEN_JWT = localStorage.getItem('jwtToken') || '';  // Do login existente

    // === GLOBAIS ISOLADAS (N√ÉO TOCA NO CHAT) ===
    let socketApostas = null;
    let intervalEncerramentos = null;
    const ROOMS_APOSTAS = {};  // { cardId: roomName } para tracking
    
    
// Fun√ß√£o para buscar dados do backend
async function buscarDadosBackend(endpoint) {
    try {
        const response = await fetch(`${API_BASE}${endpoint}`);
        if (!response.ok) throw new Error(`Erro ${response.status}`);
        
        const dadosRes = await response.json();
        //console.log(`${endpoint}:`, Array.isArray(dadosRes) ? dadosRes.length : 1, 'itens');
        return dadosRes;
        
    } catch (error) {
        console.error(`${endpoint}:`, error.message);
        return null;
    }
}

// Fun√ß√£o principal para carregar dados
async function carregarDadosBackend() {
    try {
        //console.log('Carregando dados do backend...');
        
        const [
            usuariosBackend, 
            apostasBackend, 
            desafiosBackend, 
            chatsBackend, 
            jogosBackend
        ] = await Promise.all([
            buscarDadosBackend('/api/users'),
            buscarDadosBackend('/api/apostas'),
            buscarDadosBackend('/api/desafios'),
            buscarDadosBackend('/api/chats'),
            buscarDadosBackend('/api/jogos') // ou '/api/jogos-completos' se preferir
        ]);

        // Atribuir dados diretamente
        Object.assign(dados, {
            usuarios: usuariosBackend || [],
            apostasUsuarios: apostasBackend || [],
            desafiosUsuarios: desafiosBackend || [],
            chats: chatsBackend || [],
            jogos: jogosBackend || []
        });

        //console.log('Dados carregados:');
        //console.log(`Usu√°rios: ${dados.usuarios.length}`);
        console.log(`Apostas: ${dados.apostasUsuarios.length}`);
        console.log(`Desafios: ${dados.desafiosUsuarios.length}`);
        //console.log(`Chats: ${dados.chats.length}`);
        //console.log(`Jogos: ${dados.jogos.length}`);
        
        return true;
        
    } catch (error) {
        console.error('Erro no carregamento:', error);
        return false;
    }
}

// Fun√ß√£o inicializadora
async function inicializar() {
    console.log('Iniciando sistema...');
    
    const sucesso = await carregarDadosBackend();
    
    if (sucesso) {
        carregarJogos(); // sua fun√ß√£o que renderiza a UI
        console.log('Sistema inicializado com sucesso');
    } else {
        document.getElementById('app').innerHTML = `
            <div class="erro">
                <h2>Erro ao conectar com o servidor</h2>
                <p>Verifique se o backend est√° rodando em <code>https://youtube-lives.onrender.com</code></p>
                <button onclick="location.reload()">Tentar novamente</button>
            </div>
        `;
    }
}

// Iniciar automaticamente
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', inicializar);
} else {
    inicializar();
}
//console.log("_____dados",dados)
// Adicionar Card na Div

/////
/////
function toggleEstadioBotoes(estadioId) {
    const container = document.getElementById(`botoes-estadio-${estadioId}`);
    const btn = document.getElementById(`toggle-${estadioId}`);
    const expanded = container.style.display === 'flex';
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
}
function toggleTimeBotoes(timeId) {
    const container = document.getElementById(`botoes-time-${timeId}`);
    const btn = document.getElementById(`toggle-time-${timeId}`);
    const expanded = container.style.display === 'flex';
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
}
function toggleLiveBotoes(liveId) {
    const container = document.getElementById(`botoes-live-${liveId}`);
    const btn = document.getElementById(`toggle-live-${liveId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesLive[liveId] = !expanded;
}
function toggleDivBotoes(divId) {
    const container = document.getElementById(`botoes-div-${divId}`);
    const btn = document.getElementById(`toggle-div-${divId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesDiv[divId] = !expanded;
}

function toggleScrollContainerBotoes(divId) {
  /*  botoes-scroll-${divId}
                    toggle-scroll-${divId}*/
      const container = document.getElementById(`botoes-scroll-${divId}`);
    const btn = document.getElementById(`toggle-scroll-${divId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesDiv[divId] = !expanded;
}
function toggleIframerBotoes(cardId) {
    const container = document.getElementById(`botoes-iframer-${cardId}`);
    const btn = document.getElementById(`toggle-iframer-${cardId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesIframer[cardId] = !expanded;
}

/////
/////



////////////
////////////
////////////
////////////
// social.js - VERS√ÉO CORRIGIDA
function adicionarAmigo(usuarioAlvo) {
    if (!usuarioLogado) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    if (usuarioAlvo === usuarioLogado.nome) {
        alert("Voc√™ n√£o pode adicionar a si mesmo!");
        return;
    }
    
    if (!usuarioLogado.amigos) usuarioLogado.amigos = [];
    
    if (usuarioLogado.amigos.includes(usuarioAlvo)) {
        alert("Voc√™ j√° √© amigo deste usu√°rio!");
        return;
    }
    
    usuarioLogado.amigos.push(usuarioAlvo);
    adicionarNotificacao("Novo amigo!", `Voc√™ e ${usuarioAlvo} agora s√£o amigos!`, 'sucesso');
    alert(`Agora voc√™ √© amigo de ${usuarioAlvo}!`);
}
function verAmigos() {
    if (!usuarioLogado) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    if (!usuarioLogado.amigos || usuarioLogado.amigos.length === 0) {
        alert("Voc√™ n√£o tem amigos adicionados");
        return;
    }
    
    let lista = "=== SEUS AMIGOS ===\n\n";
    usuarioLogado.amigos.forEach((amigo, index) => {
        const usuario = dados.usuarios.find(u => u.nome === amigo);
        if (usuario) {
            lista += `üë§ ${usuario.nome}\n`;
            lista += `M√©rito: ${usuario.merito}\n`;
            lista += `[Desafiar - digite 'd ${index}'] [Ver Perfil - 'v ${index}']\n\n`;
        }
    });
    
    lista += "\nComandos: 'd [n√∫mero]' - desafiar amigo | 'v [n√∫mero]' - ver perfil";
    const comando = prompt(lista);
    
    if (comando) {
        if (comando.startsWith('d ')) {
            const index = parseInt(comando.split(' ')[1]);
            if (!isNaN(index) && index >= 0 && index < usuarioLogado.amigos.length) {
                desafiarAmigo(usuarioLogado.amigos[index]);
            }
        } else if (comando.startsWith('v ')) {
            const index = parseInt(comando.split(' ')[1]);
            if (!isNaN(index) && index >= 0 && index < usuarioLogado.amigos.length) {
                verPerfilAmigo(usuarioLogado.amigos[index]);
            }
        }
    }
}
function desafiarAmigo(nomeAmigo) {
    alert(`Funcionalidade de desafio para ${nomeAmigo} em desenvolvimento...`);
    // Implementar l√≥gica de desafio entre amigos
}
function verPerfilAmigo(nomeAmigo) {
    const amigo = dados.usuarios.find(u => u.nome === nomeAmigo);
    if (!amigo) {
        alert("Amigo n√£o encontrado!");
        return;
    }
    
    let perfil = `=== PERFIL DE ${amigo.nome} ===\n\n`;
    perfil += `M√©rito: ${amigo.merito} pontos\n`;
    perfil += `Desafios cumpridos: ${amigo.desafiosCumpridos || 0}\n`;
    perfil += `Pagamentos realizados: ${amigo.pagamentosRealizados || 0}\n`;
    
    alert(perfil);
}



function buscarUsuarios() {
    const termo = prompt("Digite o nome do usu√°rio:");
    if (!termo) return;
    
    const usuariosEncontrados = dados.usuarios.filter(u => 
        u.nome.toLowerCase().includes(termo.toLowerCase())
    );
    
    if (usuariosEncontrados.length === 0) {
        alert("Nenhum usu√°rio encontrado!");
        return;
    }
    
    let lista = "=== USU√ÅRIOS ENCONTRADOS ===\n\n";
    usuariosEncontrados.forEach((usuario, index) => {
        lista += `üë§ ${usuario.nome}\n`;
        lista += `M√©rito: ${usuario.merito}\n`;
        
        if (usuarioLogado && usuario.nome !== usuarioLogado.nome) {
            const jaEhAmigo = usuarioLogado.amigos && usuarioLogado.amigos.includes(usuario.nome);
            if (!jaEhAmigo) {
                lista += `[Adicionar amigo - digite 'a ${index}']\n`;
            } else {
                lista += `‚úÖ J√° √© seu amigo\n`;
            }
        }
        lista += "------------------------\n";
    });
    
    if (usuarioLogado) {
        lista += "\nComandos: 'a [n√∫mero]' - adicionar como amigo";
    }
    
    const comando = prompt(lista);
    
    if (comando && comando.startsWith('a ')) {
        const index = parseInt(comando.split(' ')[1]);
        if (!isNaN(index) && index >= 0 && index < usuariosEncontrados.length) {
            adicionarAmigo(usuariosEncontrados[index].nome);
        }
    }
}
function adicionarNotificacao(titulo, mensagem, tipo = 'info') {
    const notificacao = {
        id: Date.now(),
        titulo: titulo,
        mensagem: mensagem,
        tipo: tipo, // 'info', 'alerta', 'sucesso'
        lida: false,
        data: new Date().toLocaleString()
    };
    notificacoes.unshift(notificacao);
    
    // Limitar a 50 notifica√ß√µes
    if (notificacoes.length > 50) {
        notificacoes = notificacoes.slice(0, 50);
    }
}
function verNotificacoes() {
    if (notificacoes.length === 0) {
        alert("Nenhuma notifica√ß√£o");
        return;
    }
    
    let lista = "=== NOTIFICA√á√ïES ===\n\n";
    notificacoes.forEach((not, index) => {
        lista += `${not.lida ? 'üì≠' : 'üì´'} ${not.titulo}\n`;
        lista += `Mensagem: ${not.mensagem}\n`;
        lista += `Data: ${not.data}\n`;
        lista += `Tipo: ${not.tipo}\n`;
        
        if (!not.lida) {
            lista += `[Marcar como lida - digite 'l ${index}']\n`;
        }
        lista += "------------------------\n";
    });
    
    lista += "\nComandos: 'l [n√∫mero]' - marcar como lida";
    const comando = prompt(lista);
    
    if (comando && comando.startsWith('l ')) {
        const index = parseInt(comando.split(' ')[1]);
        if (!isNaN(index) && index >= 0 && index < notificacoes.length) {
            notificacoes[index].lida = true;
            alert("Notifica√ß√£o marcada como lida!");
        }
    }
}
function limparNotificacoes() {
    if (confirm("Limpar todas as notifica√ß√µes?")) {
        notificacoes = [];
        alert("Notifica√ß√µes limpas!");
    }
}
function getNotificacoesNaoLidas() {
    return notificacoes.filter(not => !not.lida).length;
}
// Fun√ß√£o de m√©rito m√°ximo (referenciada em apostas.js e desafios.js)
function calcularMeritoMaximoAposta(usuario) {
    return Math.floor(usuario.merito * 0.3); // 30% do m√©rito atual
}
// Fun√ß√£o para atualizar m√©rito (referenciada em desafios.js)
function atualizarMerito(usuario, tipo, positivo) {
    let pontos = 0;
    
    switch(tipo) {
        case 'desafio_criado':
            pontos = positivo ? 10 : -5;
            break;
        case 'desafio_cumprido':
            pontos = positivo ? 20 : -15;
            break;
        case 'pagamento_realizado':
            pontos = positivo ? 15 : 0;
            break;
        case 'pagamento_pendente':
            pontos = positivo ? 0 : -20;
            break;
        case 'aposta_ganha':
            pontos = positivo ? 25 : 0;
            break;
        case 'aposta_perdida':
            pontos = positivo ? 0 : -10;
            break;
        default:
            pontos = positivo ? 5 : -5;
    }
    
    usuario.merito += pontos;
    return pontos;
}
// Fun√ß√£o para carregar v√≠deos do streamer
function carregarVideosStreamer(streamer) {
    if (!streamer.videos || streamer.videos.length === 0) {
        return '<p>Nenhum v√≠deo compartilhado</p>';
    }
    
    let html = '<h4>V√≠deos Compartilhados:</h4>';
    streamer.videos.forEach(video => {
        html += `<p><strong>${video.titulo}</strong> - ${video.data}<br>`;
        html += `<a href="${video.url}" target="_blank">Assistir</a></p>`;
    });
    return html;
}

function verTransacoes() {
    alert("Funcionalidade de transa√ß√µes em desenvolvimento...");
}
function enviarComprovantePix(jogoId, estadioId, timeId, liveId, streamerId, desafioId) {
    const streamer = encontrarStreamer(jogoId, estadioId, timeId, liveId, streamerId);
    if (!streamer) return;
    
    let desafio;
    if (streamer.desafiosEnviados) {
        desafio = streamer.desafiosEnviados.find(d => d.id === desafioId);
    }
    
    if (!desafio) {
        alert("Desafio n√£o encontrado!");
        return;
    }
    
    const comprovante = prompt("URL ou descri√ß√£o do comprovante PIX:");
    if (comprovante) {
        desafio.comprovantePix = comprovante;
        carregarStreamersDaLive(jogoId, estadioId, timeId, liveId);
        alert("Comprovante enviado!");
    }
}
// Fun√ß√£o para encontrar live
function encontrarLive(jogoId, estadioId, timeId, liveId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return null;
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return null;
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time || !time.lives) return null;
    
    return time.lives.find(l => l.id === liveId);
}
// Fun√ß√£o para encontrar streamer
function encontrarStreamer(jogoId, estadioId, timeId, liveId, streamerId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.streamers) return null;
    
    return live.streamers.find(s => s.id === streamerId);
}
// Fun√ß√£o para ver streamers de uma live
function verStreamersDaLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live) {
        alert("Live n√£o encontrada!");
        return;
    }
    
    mostrarSecao('streamers');
    carregarStreamersDaLive(jogoId, estadioId, timeId, liveId);
}
// Fun√ß√£o para mostrar se√ß√£o
function mostrarSecao(secao) {
    // Esconder todas as se√ß√µes
    document.querySelectorAll('.secao').forEach(sec => {
        sec.style.display = 'none';
    });
    
    // Mostrar a se√ß√£o desejada
    document.getElementById(`secao-${secao}`).style.display = 'block';
}
// Fun√ß√£o para voltar para jogos
function voltarParaJogos() {
    mostrarSecao('jogos');
}
// Fun√ß√£o para voltar para est√°dios
function voltarParaEstadios() {
    mostrarSecao('estadios');
}
// Fun√ß√£o para voltar para times
function voltarParaTimes() {
    mostrarSecao('times');
}
// Fun√ß√£o para voltar para lives
function voltarParaLives() {
    mostrarSecao('lives');
}
// FUN√á√ïES DE VOZ PARA LIVE








//////////// navegacao
//////////// navegacao
//////////// navegacao
//////////// navegacao
//////////// navegacao
//////////// navegacao

// Fun√ß√µes de navega√ß√£o
function mostrarSecao(secao) {
    document.querySelectorAll('.secao').forEach(el => {
        el.style.display = 'none';
    });
    document.getElementById(`secao-${secao}`).style.display = 'block';
    
    // S√≥ carrega automaticamente as se√ß√µes que n√£o precisam de par√¢metros
    if (secao === 'jogos' || secao === 'estadios' || secao === 'times') {
        carregarSecao(secao);
    }
}

// Fun√ß√£o para carregar dados da se√ß√£o
function carregarSecao(secao) {
    switch(secao) {
        case 'jogos':
            carregarJogos();
            break;
        case 'estadios':
            if (jogoSelecionadoId) {
                carregarEstadiosDoJogo(jogoSelecionadoId);
            } else {
                carregarEstadios();
            }
            break;
        case 'times':
            if (jogoSelecionadoId && estadioSelecionadoId) {
                carregarTimesDoEstadio(jogoSelecionadoId, estadioSelecionadoId);
            } else {
                carregarTimes();
            }
            break;
        case 'lives':
            if (jogoSelecionadoId && estadioSelecionadoId && timeSelecionadoId) {
                carregarLivesDoTime(jogoSelecionadoId, estadioSelecionadoId, timeSelecionadoId);
            }
            break;
        case 'streamers':
            if (jogoSelecionadoId && estadioSelecionadoId && timeSelecionadoId && liveSelecionadoId) {
                carregarStreamersDaLive(jogoSelecionadoId, estadioSelecionadoId, timeSelecionadoId, liveSelecionadoId);
            }
            break;
    }
}

// Fun√ß√µes para voltar - MANTENDO OS IDs SELECIONADOS
function voltarParaJogos() {
    mostrarSecao('jogos');
    // N√£o limpa jogoSelecionadoId para manter contexto
}
function voltarParaEstadios() {
    mostrarSecao('estadios');
    // N√£o limpa estadioSelecionadoId para manter contexto
}
function voltarParaTimes() {
    mostrarSecao('times');
    // N√£o limpa timeSelecionadoId para manter contexto
}
function voltarParaLives() {
    mostrarSecao('lives');
    // N√£o limpa liveSelecionadoId para manter contexto
}
function verEstadiosDoJogo(jogoId) {
    jogoSelecionadoId = jogoId;
    mostrarSecao('estadios');
}
function verTimesDoEstadio(jogoId, estadioId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    mostrarSecao('times');
}
function verLivesDoTime(jogoId, estadioId, timeId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    timeSelecionadoId = timeId;
    mostrarSecao('lives');
}
function verStreamersDaLive(jogoId, estadioId, timeId, liveId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    timeSelecionadoId = timeId;
    liveSelecionadoId = liveId;
    mostrarSecao('streamers');
}

// Inicializa√ß√£o
window.onload = function() {
    carregarJogos();
};




////////////
////////////
////////////
////////////jogos
////////////
////////////
////////////

/*

let modalSocket = null;
let modalUserName = '';
let modalCurrentRoom = '';
*/
let modalActiveRooms = new Map();
let chatModalAberto = false;
let chatModalElement = null;
// P2PChatHybrid.js
let modalSocket = null;
//let peerConnection = null;
//let dataChannel = null;
let remoteSocketId = null;

let modalUserName = 'Usuario';
let modalCurrentRoom = '';
let modalP2PMode = false; // false = modo servidor, true = modo P2P
// Fun√ß√µes para exibir jogos
function carregarJogos() {
    const container = document.getElementById('lista-jogos');
    if (!container) return;

    container.innerHTML = '';

    if (dados.jogos.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum jogo cadastrado.</p>';
        return;
    }

    // Estado do toggle (opcional: pode ser salvo em localStorage)
    const toggleStates = {};

    dados.jogos.forEach(jogo => {
        const jogoId = jogo.id;
        const isExpanded = toggleStates[jogoId] || false;

        // === CONTAINER PRINCIPAL ===
        const jogoEl = document.createElement('div');
        jogoEl.className = 'jogo-item';
        jogoEl.style = 'border:1px solid #ddd; margin:15px 0; padding:15px; border-radius:8px; background:#fafafa;';

        // === HEADER (IMAGEM + T√çTULO + TOGGLE) ===
        const header = document.createElement('div');
        header.style = 'display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;';

        const leftSide = document.createElement('div');
        leftSide.style = 'display:flex; align-items:center; gap:15px;';

        const img = document.createElement('img');
        img.src = obterImagem('jogo', jogo.imagem);
        img.alt = jogo.nome;
        img.title = 'Clique para ver est√°dios';
        img.style = 'width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer;';
        img.onclick = () => verEstadiosDoJogo(jogo.id);

        const textoLado = document.createElement('div');
        const h3 = document.createElement('h3');
        h3.textContent = jogo.nome;
        h3.style = 'margin:0; cursor:pointer; color:#007bff; font-size:1.1em;';
        h3.onclick = () => verEstadiosDoJogo(jogo.id);

        const p = document.createElement('p');
        p.textContent = `ID: ${jogo.id} | Est√°dios: ${jogo.estadios.length}`;
        p.style = 'margin:3px 0; color:#555; font-size:0.9em;';

        textoLado.appendChild(h3);
        textoLado.appendChild(p);
        leftSide.appendChild(img);
        leftSide.appendChild(textoLado);

        // === BOT√ÉO TOGGLE ===
        const toggleBtn = document.createElement('button');
        toggleBtn.innerHTML = isExpanded ? '‚àí' : '+';
        toggleBtn.style = `
            width:36px; height:36px; border:none; border-radius:50%; 
            background:#007bff; color:white; font-weight:bold; font-size:1.2em;
            cursor:pointer; display:flex; align-items:center; justify-content:center;
            transition:0.2s;
        `;
        toggleBtn.onmouseover = () => toggleBtn.style.background = '#0056b3';
        toggleBtn.onmouseout = () => toggleBtn.style.background = '#007bff';

        // === CONTAINER DE BOT√ïES (ocult√°vel) ===
        const botoesContainer = document.createElement('div');
        botoesContainer.id = `botoes-${jogoId}`;
        botoesContainer.style = `
            display: ${isExpanded ? 'flex' : 'none'};
            flex-wrap: wrap; gap: 8px; justify-content: center;
            margin-top: 12px; padding: 10px; background: #f8f9fa;
            border-radius: 6px; transition: all 0.3s ease;
        `;

        // === LISTA DE BOT√ïES ===
        const botoes = [
            { text: 'Ver', color: '#17a2b8', click: () => verDetalhesJogo(jogo.id) },
            { text: 'Editar', color: '#ffc107', click: () => editarJogo(jogo.id) },
            { text: 'Imagem', color: '#6c757d', click: () => alterarImagemJogo(jogo.id) },
            { text: 'Excluir', color: '#dc3545', click: () => excluirJogo(jogo.id) },
            { text: 'Compartilhar', color: '#007bff', click: () => compartilharJogo(jogo.id) },
            { text: 'App+Jogo', color: '#28a745', click: () => compartilharAppSintonizadaJogo(jogo.id) },
        ];

        botoes.forEach(btn => {
            const button = document.createElement('button');
            button.textContent = btn.text;
            button.style = `
                padding:6px 10px; border:none; border-radius:5px; 
                color:white; background:${btn.color}; cursor:pointer; 
                font-size:0.85em; min-width:70px; transition:0.2s;
            `;
            button.onclick = btn.click;
            botoesContainer.appendChild(button);
        });

        // === BOT√ÉO COPIAR ===
        const isCopiado = jogoCopiado && jogoCopiado.id === jogo.id;
        const btnCopiar = document.createElement('button');
        btnCopiar.innerHTML = isCopiado ? 'Copiado' : 'Copiar';
        btnCopiar.style = `
            padding:6px 10px; border:none; border-radius:5px; 
            color:white; cursor:pointer; font-size:0.85em;
            background: ${isCopiado ? '#28a745' : '#6f42c1'};
        `;
        
        btnCopiar.onclick = () => {
            jogoCopiado = JSON.parse(JSON.stringify(jogo));
            mostrarNotificacao(`Jogo "${jogo.nome}" copiado!`, 'sucesso');
            carregarJogos();
        };
        botoesContainer.appendChild(btnCopiar);

        // === BOT√ÉO P2P (se houver jogo copiado) ===
        if (jogoCopiado) {
            const btnP2P = document.createElement('button');
            btnP2P.textContent = 'P2P';
            btnP2P.style = 'padding:6px 10px; background:#ff6b35; color:white; border:none; border-radius:5px; font-size:0.85em; cursor:pointer;';
          //  btnP2P.onclick = enviarJogoCopiadoViaP2P;
            botoesContainer.appendChild(btnP2P);
        }

        // === TOGGLE FUNCIONALIDADE ===
        toggleBtn.onclick = () => {
            const expanded = botoesContainer.style.display === 'flex';
            botoesContainer.style.display = expanded ? 'none' : 'flex';
            toggleBtn.innerHTML = expanded ? '+' : '‚àí';
            toggleStates[jogoId] = !expanded;
        };
        
          // === BOT√ÉO CRIAR/ENTRAR NA SALA DO JOGO ===

          console.log("___jogo",jogo.nome)
          const btnSalaEstadio = document.createElement('button');
btnSalaEstadio.innerHTML = 'üí¨ Chat jogo';
btnSalaEstadio.onclick = () => abrirChatModal(jogo.id);
          botoesContainer.appendChild(btnSalaEstadio);

        // === MONTAGEM FINAL ===
        header.appendChild(leftSide);
        header.appendChild(toggleBtn);
        jogoEl.appendChild(header);
        jogoEl.appendChild(botoesContainer);
        jogoEl.appendChild(document.createElement('hr'));

        container.appendChild(jogoEl);
    });

}



/*

function updateModalActiveRoomsDisplay() {
    const display = document.getElementById('modalActiveRooms');
    if (!display) return;

    display.innerHTML = '';
    
    modalActiveRooms.forEach((messages, roomName) => {
        const roomDiv = document.createElement('div');
        roomDiv.innerHTML = `üìÅ ${roomName} (${messages.length} mensagens)`;
        display.appendChild(roomDiv);
    });
}
function joinServerRoom(roomType, roomId) {
  if (!modalSocket) return alert('Conecte primeiro');
  const roomName = `${roomType}-${roomId}-visitante`;
  modalCurrentRoom = roomName;

  modalSocket.emit('join-' + roomType, {
    [roomType + 'Id']: roomId,
    user: modalUserName,
    merito: 'visitante'
  });

  modalSocket.emit('request-chat-history', { room: roomName });
  addModalMessage('Sistema', `Entrou na sala ${roomName}`, 'system');
}
// Fun√ß√£o para atualizar o seletor de salas no modal
function updateModalRoomSelector() {
    const selector = document.getElementById('modalRoomSelector');
    if (!selector) return;

    selector.innerHTML = '<option value="">-- Selecionar Sala --</option>';
    
    modalActiveRooms.forEach((messages, roomName) => {
        const option = document.createElement('option');
        option.value = roomName;
        option.textContent = roomName;
        option.selected = (roomName === modalCurrentRoom);
        selector.appendChild(option);
    });
}
// Fun√ß√£o para entrar em sala no modal
function joinModalRoom() {
    if (!modalSocket) {
        alert('Conecte primeiro');
        return;
    }

    const roomType = document.getElementById('modalRoomType').value;
    const roomId = document.getElementById('modalRoomId').value;
    const roomName = `${roomType}-${roomId}-visitante`;

    // Se j√° est√° na sala, n√£o faz nada
    if (modalActiveRooms.has(roomName)) {
        addModalMessage('Sistema', `J√° est√° na sala ${roomName}`, 'system');
        return;
    }

    // Entra na sala via socket
    modalSocket.emit('join-' + roomType, {
        [roomType + 'Id']: roomId,
        user: modalUserName,
        merito: 0
    });

    // Adiciona sala √† lista local
    modalActiveRooms.set(roomName, []);
    
    // Se √© a primeira sala, seleciona automaticamente
    if (modalActiveRooms.size === 1) {
        modalCurrentRoom = roomName;
    }

    updateModalRoomSelector();
    updateModalActiveRoomsDisplay();
    // Fun√ß√£o para atualizar a exibi√ß√£o de salas ativas no modal

    addModalMessage('Sistema', `Entrou na sala: ${roomName}`, 'system');

    // Solicita hist√≥rico da sala
    modalSocket.emit('request-chat-history', { room: roomName });
}
// Fun√ß√£o para criar e abrir o modal
function abrirChatModal() {
    if (chatModalAberto) return;
    
    // Cria o elemento do modal
    chatModalElement = document.createElement('div');
    chatModalElement.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
    `;
    
    // Cria o conte√∫do do modal
    const modalContent = document.createElement('div');
    modalContent.style.cssText = `
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
    `;
    
    // Adiciona bot√£o de fechar
    const closeButton = document.createElement('button');
    closeButton.textContent = '√ó';
    closeButton.style.cssText = `
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
    `;
    closeButton.onclick = fecharChatModal;
    
    // Cria o conte√∫do do chat dentro do modal
    const chatHTML = `
        <div>
            <h3>Conectar</h3>
            <input type="text" id="modalServerUrl" value="http://localhost:3000" placeholder="URL do servidor">
            <input type="text" id="modalUserName" value="UsuarioTeste" placeholder="Seu nome">
            <button onclick="connectModalSocket()">Conectar</button>
            <button onclick="disconnectModalSocket()">Desconectar</button>
        </div>

        <div>
            <h3>Entrar em Salas</h3>
            <select id="modalRoomType">
                <option value="jogo">Jogo</option>
                <option value="time">Time</option>
                <option value="live">Live</option>
            </select>
            <input type="text" id="modalRoomId" value="123" placeholder="ID">
            <button onclick="joinModalRoom()">Entrar na Sala</button>
            
            <h4>Salas Ativas:</h4>
            <div id="modalActiveRooms" style="border:1px solid #ccc; height:100px; overflow-y:scroll; padding:10px; margin:10px 0;"></div>
        </div>

        <div>
            <h3>Mensagens</h3>
            <select id="modalRoomSelector" onchange="switchModalRoom()" style="margin-bottom:10px;">
                <option value="">-- Selecionar Sala --</option>
            </select>
            <div id="modalMessages" style="border:1px solid #ccc; height:300px; overflow-y:scroll; padding:10px;"></div>
            <input type="text" id="modalMessageInput" placeholder="Digite sua mensagem" style="width:70%">
            <button onclick="sendModalMessage()">Enviar</button>
        </div>
    `;
    
    modalContent.innerHTML = chatHTML;
    modalContent.appendChild(closeButton);
    chatModalElement.appendChild(modalContent);
    document.body.appendChild(chatModalElement);
    chatModalAberto = true;
    
    // CONECTA AUTOMATICAMENTE ao abrir o modal
    setTimeout(() => {
        connectModalSocket();
    }, 100);
    
    // Fecha modal ao clicar fora
    chatModalElement.onclick = function(e) {
        if (e.target === chatModalElement) {
          document.getElementById('modalMessages').innerHTML = '';

            fecharChatModal();
        }
    };

    // Enter para enviar mensagem no modal
    setTimeout(() => {
        const modalInput = document.getElementById('modalMessageInput');
        if (modalInput) {
            modalInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendModalMessage();
                }
            });
        }
    }, 200);
}
// Servidor de sinaliza√ß√£o (Socket.io)
function connectChat(serverUrl, userName) {
  modalUserName = userName;
  modalSocket = io(serverUrl);

  modalSocket.on('connect', () => {
    console.log('üîó Conectado ao servidor:', modalSocket.id);
    addModalMessage('Sistema', 'Conectado ao servidor', 'system');
  });

  modalSocket.on('disconnect', () => {
    addModalMessage('Sistema', 'Desconectado', 'system');
  });

  // Modo servidor ‚Üí mensagens
  modalSocket.on('chat-message', (data) => {
    const room = getModalRoomFromData(data);
    addModalMessage(data.usuario, data.mensagem, room);
  });

  modalSocket.on('chat-history', (history) => {
    history.forEach(msg => {
      const room = getModalRoomFromData(msg);
      addModalMessage(msg.usuario, msg.mensagem, room);
    });
  });

  // WebRTC Signaling (para P2P)
  modalSocket.on('offer', async (data) => {
    console.log('üì® Offer recebida');
    remoteSocketId = data.from;
    await criarPeer(false); // receptor
    await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
    const answer = await peerConnection.createAnswer();
    await peerConnection.setLocalDescription(answer);
    modalSocket.emit('answer', { to: data.from, answer });
  });

  modalSocket.on('answer', async (data) => {
    console.log('üì® Answer recebida');
    await peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
  });

  modalSocket.on('ice-candidate', async (data) => {
    try {
      await peerConnection.addIceCandidate(data.candidate);
    } catch (err) {
      console.error('Erro ao adicionar ICE:', err);
    }
  });
}
// Entrar em sala no modo servidor
function joinServerRoom(roomType, roomId) {
  if (!modalSocket) return alert('Conecte primeiro');
  const roomName = `${roomType}-${roomId}-visitante`;
  modalCurrentRoom = roomName;

  modalSocket.emit('join-' + roomType, {
    [roomType + 'Id']: roomId,
    user: modalUserName,
    merito: 'visitante'
  });

  modalSocket.emit('request-chat-history', { room: roomName });
  addModalMessage('Sistema', `Entrou na sala ${roomName}`, 'system');
}
// Enviar mensagem (modo h√≠brido)
function sendHybridMessage(message) {
  if (modalP2PMode && dataChannel && dataChannel.readyState === 'open') {
    const msg = { usuario: modalUserName, mensagem: message };
    dataChannel.send(JSON.stringify(msg));
    addModalMessage(modalUserName, message, modalCurrentRoom); // ‚úÖ CORRIGIDO: Exibe mensagem localmente
  } else {
    if (!modalSocket) return alert('Sem conex√£o com servidor');
    if (!modalCurrentRoom) return alert('Entre em uma sala primeiro');
    const [type, id] = modalCurrentRoom.split('-');

    const payload = {
      user: modalUserName,
      message,
      merito: 'visitante'
    };


    modalSocket.emit('chat-message', payload);
    addModalMessage(modalUserName, message, modalCurrentRoom); // ‚úÖ CORRIGIDO: Exibe mensagem localmente
  }
}
// =========================
// === FUN√á√ïES P2P CHAT ===
// =========================
async function iniciarP2PChat(serverUrl, userName, roomType, roomId) {
  modalP2PMode = true;
  connectChat(serverUrl, userName);

  modalSocket.on('connect', async () => {
    console.log('üîó Conectado (modo P2P)');
    modalCurrentRoom = `${roomType}-${roomId}-visitante`;

    // Entra na sala
    modalSocket.emit('join-' + roomType, {
      [roomType + 'Id']: roomId,
      user: modalUserName,
      merito: 'visitante'
    });

    // ‚úÖ CORRIGIDO: Solicita hist√≥rico da sala (mensagens salvas no servidor)
    modalSocket.emit('request-chat-history', { room: modalCurrentRoom });

    // Pede lista de peers na sala
    setTimeout(() => {
      modalSocket.emit('request-peers', { room: modalCurrentRoom });
    }, 500);
  });

  // Quando o servidor responder com a lista de peers:
  modalSocket.on('peers-list', async (peers) => {
    if (peers.length === 0) {
      console.log('üü¢ Sou o primeiro usu√°rio da sala ‚Üí caller');
      // Primeiro usu√°rio ‚Äî n√£o cria offer ainda, espera o segundo entrar
    } else {
      // J√° existe algu√©m na sala, ent√£o sou o segundo
      remoteSocketId = peers[0];
      console.log('üîµ Sou o segundo usu√°rio ‚Üí receiver de', remoteSocketId);
      await criarPeer(true); // chama o offer para o remote
    }
  });

  // Atualiza a lista de peers quando o segundo entra
  modalSocket.on('room-user-count', async ({ room, count }) => {
    if (room === modalCurrentRoom && count === 2 && !remoteSocketId) {
      console.log('üë• Dois usu√°rios conectados, iniciando handshake...');
      modalSocket.emit('request-peers', { room: modalCurrentRoom });
    }
  });
}
async function criarPeer(isCaller = true) {
  peerConnection = new RTCPeerConnection({
    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] // ‚úÖ Google STUN
  });

  peerConnection.onicecandidate = (event) => {
    if (event.candidate && remoteSocketId) {
      modalSocket.emit('ice-candidate', {
        to: remoteSocketId,
        candidate: event.candidate
      });
    }
  };

  peerConnection.onconnectionstatechange = () => {
    console.log('üåê Estado da conex√£o:', peerConnection.connectionState);
  };


    if (isCaller && remoteSocketId) {
  dataChannel = peerConnection.createDataChannel('chat');
  configurarDataChannel(dataChannel);
  const offer = await peerConnection.createOffer();
  await peerConnection.setLocalDescription(offer);
  modalSocket.emit('offer', { to: remoteSocketId, offer });
} else {
    peerConnection.ondatachannel = (event) => {
      dataChannel = event.channel;
      configurarDataChannel(dataChannel);
    };
  }
}
function configurarDataChannel(channel) {
  channel.onopen = () => console.log('üì° Canal P2P aberto');
  channel.onclose = () => console.log('üì¥ Canal P2P fechado');
  channel.onmessage = (event) => {
    const data = JSON.parse(event.data);
    addModalMessage(data.usuario, data.mensagem, modalCurrentRoom);
  };
}
// =========================
// === FUN√á√ïES AUXILIARES ===
// =========================
function getModalRoomFromData(data) {
  if (data.jogoId) return `jogo-${data.jogoId}-visitante`;
  if (data.timeId) return `time-${data.timeId}-visitante`;
  if (data.liveId) return `live-${data.liveId}-visitante`;
  return data.room || 'unknown';
}
async function connectModalSocket() {
  const serverUrl = document.getElementById('modalServerUrl').value;
  const userName = document.getElementById('modalUserName').value;
  const roomType = document.getElementById('modalRoomType').value;
  const roomId = document.getElementById('modalRoomId').value;

  try {
    modalP2PMode = true;
    await iniciarP2PChat(serverUrl, userName, roomType, roomId);
    console.log('‚úÖ Modo P2P ativo');
  } catch (err) {
    console.warn('‚ö†Ô∏è Erro no P2P, voltando para modo servidor:', err);
    modalP2PMode = false;
    connectChat(serverUrl, userName);
    joinServerRoom(roomType, roomId);
  }
}
function addModalMessage(user, text, room) {
  const box = document.getElementById('modalMessages');
  if (!box) return;
  const div = document.createElement('div');
  div.innerHTML = `<strong>${user}:</strong> ${text}`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
function sendModalMessage() {
  const input = document.getElementById('modalMessageInput');
  const message = input.value.trim();
  if (!message) return;
  sendHybridMessage(message);
  input.value = '';
}

*/

// Fun√ß√£o para desconectar o socket do modal
function disconnectModalSocket() {
    if (modalSocket) {
        modalSocket.disconnect();
        modalSocket = null;
        modalActiveRooms.clear();
        updateModalRoomSelector();
        updateModalActiveRoomsDisplay();
        addModalMessage('Sistema', 'Desconectado', 'system');
    }
}
// Fun√ß√£o para fechar o modal
function fecharChatModal() {
    if (chatModalElement && chatModalAberto) {
        // Desconecta o socket ao fechar o modal
        disconnectModalSocket();
        
        document.body.removeChild(chatModalElement);
        chatModalElement = null;
        chatModalAberto = false;
        modalActiveRooms.clear();
        modalCurrentRoom = '';
    }
}




function joinServerRoom(roomType, roomId) {
  if (!modalSocket) return alert('Conecte primeiro');
  const roomName = `${roomType}-${roomId}-visitante`;
  modalCurrentRoom = roomName;

  modalSocket.emit('join-' + roomType, {
    [roomType + 'Id']: roomId,
    user: modalUserName,
    merito: 'visitante'
  });

  modalSocket.emit('request-chat-history', { room: roomName });
  addModalMessage('Sistema', `Entrou na sala ${roomName}`, 'system');
}
// Fun√ß√£o para atualizar o seletor de salas no modal
function updateModalRoomSelector() {
    const selector = document.getElementById('modalRoomSelector');
    if (!selector) return;

    selector.innerHTML = '<option value="">-- Selecionar Sala --</option>';
    
    modalActiveRooms.forEach((messages, roomName) => {
        const option = document.createElement('option');
        option.value = roomName;
        option.textContent = roomName;
        option.selected = (roomName === modalCurrentRoom);
        selector.appendChild(option);
    });
}

function updateModalActiveRoomsDisplay() {
    const display = document.getElementById('modalActiveRooms');
    if (!display) return;

    display.innerHTML = '';
    
    modalActiveRooms.forEach((messages, roomName) => {
        const roomDiv = document.createElement('div');
        roomDiv.innerHTML = `üìÅ ${roomName} (${messages.length} mensagens)`;
        display.appendChild(roomDiv);
    });
}
// Fun√ß√£o para entrar em sala no modal
function joinModalRoom() {
    if (!modalSocket) {
        alert('Conecte primeiro');
        return;
    }

    const roomType = document.getElementById('modalRoomType').value;
    const roomId = document.getElementById('modalRoomId').value;
    const roomName = `${roomType}-${roomId}-visitante`;

    // Se j√° est√° na sala, n√£o faz nada
    if (modalActiveRooms.has(roomName)) {
        addModalMessage('Sistema', `J√° est√° na sala ${roomName}`, 'system');
        return;
    }

    // Entra na sala via socket
    modalSocket.emit('join-' + roomType, {
        [roomType + 'Id']: roomId,
        user: modalUserName,
        merito: 0
    });

    // Adiciona sala √† lista local
    modalActiveRooms.set(roomName, []);
    
    // Se √© a primeira sala, seleciona automaticamente
    if (modalActiveRooms.size === 1) {
        modalCurrentRoom = roomName;
    }

    updateModalRoomSelector();
    updateModalActiveRoomsDisplay();
    // Fun√ß√£o para atualizar a exibi√ß√£o de salas ativas no modal

    addModalMessage('Sistema', `Entrou na sala: ${roomName}`, 'system');

    // Solicita hist√≥rico da sala
    modalSocket.emit('request-chat-history', { room: roomName });
}


// Fun√ß√£o para criar e abrir o modal
function abrirChatModal() {
    if (chatModalAberto) return;
    
    // Cria o elemento do modal
    chatModalElement = document.createElement('div');
    chatModalElement.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
    `;
    
    // Cria o conte√∫do do modal
    const modalContent = document.createElement('div');
    modalContent.style.cssText = `
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
    `;
    
    // Adiciona bot√£o de fechar
    const closeButton = document.createElement('button');
    closeButton.textContent = '√ó';
    closeButton.style.cssText = `
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
    `;
    closeButton.onclick = fecharChatModal;
    
    // Cria o conte√∫do do chat dentro do modal
    const chatHTML = `
        <div>
            <h3>Conectar</h3>
            <input type="text" id="modalServerUrl" value="http://localhost:3000" placeholder="URL do servidor">
            <input type="text" id="modalUserName" value="UsuarioTeste" placeholder="Seu nome">
            <button onclick="connectModalSocket()">Conectar</button>
            <button onclick="disconnectModalSocket()">Desconectar</button>
        </div>

        <div>
            <h3>Entrar em Salas</h3>
            <select id="modalRoomType">
                <option value="jogo">Jogo</option>
                <option value="time">Time</option>
                <option value="live">Live</option>
            </select>
            <input type="text" id="modalRoomId" value="123" placeholder="ID">
            <button onclick="joinModalRoom()">Entrar na Sala</button>
            
            <h4>Salas Ativas:</h4>
            <div id="modalActiveRooms" style="border:1px solid #ccc; height:100px; overflow-y:scroll; padding:10px; margin:10px 0;"></div>
        </div>

        <div>
            <h3>Mensagens</h3>
            <select id="modalRoomSelector" onchange="switchModalRoom()" style="margin-bottom:10px;">
                <option value="">-- Selecionar Sala --</option>
            </select>
            <div id="modalMessages" style="border:1px solid #ccc; height:300px; overflow-y:scroll; padding:10px;"></div>
            <input type="text" id="modalMessageInput" placeholder="Digite sua mensagem" style="width:70%">
            <button onclick="sendModalMessage()">Enviar</button>
        </div>
    `;
    
    modalContent.innerHTML = chatHTML;
    modalContent.appendChild(closeButton);
    chatModalElement.appendChild(modalContent);
    document.body.appendChild(chatModalElement);
    chatModalAberto = true;
    
    // CONECTA AUTOMATICAMENTE ao abrir o modal
    setTimeout(() => {
        connectModalSocket();
    }, 100);
    
    // Fecha modal ao clicar fora
    chatModalElement.onclick = function(e) {
        if (e.target === chatModalElement) {
          document.getElementById('modalMessages').innerHTML = '';

            fecharChatModal();
        }
    };

    // Enter para enviar mensagem no modal
    setTimeout(() => {
        const modalInput = document.getElementById('modalMessageInput');
        if (modalInput) {
            modalInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendModalMessage();
                }
            });
        }
    }, 200);
}
// Fun√ß√£o para fechar o modal
function fecharChatModal() {
    if (chatModalElement && chatModalAberto) {
        // Desconecta o socket ao fechar o modal
        disconnectModalSocket();
        
        document.body.removeChild(chatModalElement);
        chatModalElement = null;
        chatModalAberto = false;
        modalActiveRooms.clear();
        modalCurrentRoom = '';
    }
}
// Servidor de sinaliza√ß√£o (Socket.io)
function connectChat(serverUrl, userName) {
  modalUserName = userName;
  modalSocket = io(serverUrl);

  modalSocket.on('connect', () => {
    console.log('üîó Conectado ao servidor:', modalSocket.id);
    addModalMessage('Sistema', 'Conectado ao servidor', 'system');
  });

  modalSocket.on('disconnect', () => {
    addModalMessage('Sistema', 'Desconectado', 'system');
  });

  // Modo servidor ‚Üí mensagens
  modalSocket.on('chat-message', (data) => {
    const room = getModalRoomFromData(data);
    addModalMessage(data.usuario, data.mensagem, room);
  });

  modalSocket.on('chat-history', (history) => {
    history.forEach(msg => {
      const room = getModalRoomFromData(msg);
      addModalMessage(msg.usuario, msg.mensagem, room);
    });
  });

  // WebRTC Signaling (para P2P)
  modalSocket.on('offer', async (data) => {
    console.log('üì® Offer recebida');
    remoteSocketId = data.from;
    await criarPeer(false); // receptor
    await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
    const answer = await peerConnection.createAnswer();
    await peerConnection.setLocalDescription(answer);
    modalSocket.emit('answer', { to: data.from, answer });
  });

  modalSocket.on('answer', async (data) => {
    console.log('üì® Answer recebida');
    await peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
  });

  modalSocket.on('ice-candidate', async (data) => {
    try {
      await peerConnection.addIceCandidate(data.candidate);
    } catch (err) {
      console.error('Erro ao adicionar ICE:', err);
    }
  });
}
// Entrar em sala no modo servidor
function joinServerRoom(roomType, roomId) {
  if (!modalSocket) return alert('Conecte primeiro');
  const roomName = `${roomType}-${roomId}-visitante`;
  modalCurrentRoom = roomName;

  modalSocket.emit('join-' + roomType, {
    [roomType + 'Id']: roomId,
    user: modalUserName,
    merito: 'visitante'
  });

  modalSocket.emit('request-chat-history', { room: roomName });
  addModalMessage('Sistema', `Entrou na sala ${roomName}`, 'system');
}
// Enviar mensagem (modo h√≠brido)
function sendHybridMessage(message) {
  if (modalP2PMode && dataChannel && dataChannel.readyState === 'open') {
    const msg = { usuario: modalUserName, mensagem: message };
    dataChannel.send(JSON.stringify(msg));
    addModalMessage(modalUserName, message, modalCurrentRoom); 
  } else {
    if (!modalSocket) return alert('Sem conex√£o com servidor');
    if (!modalCurrentRoom) return alert('Entre em uma sala primeiro');
    const [type, id] = modalCurrentRoom.split('-');

    const payload = {
      user: modalUserName,
      message,
      merito: 'visitante'
    };
   /* if (type === 'jogo') payload.jogoId = id;
    if (type === 'time') payload.timeId = id;
    if (type === 'live') payload.liveId = id;
    */

    modalSocket.emit('chat-message', payload);
    addModalMessage(modalUserName, message, modalCurrentRoom);
  }
}
// =========================
// === FUN√á√ïES P2P CHAT ===
// =========================
async function iniciarP2PChat(serverUrl, userName, roomType, roomId) {
  modalP2PMode = true;
  connectChat(serverUrl, userName);

  modalSocket.on('connect', async () => {
    console.log('üîó Conectado (modo P2P)');
    modalCurrentRoom = `${roomType}-${roomId}-visitante`;

    // Entra na sala
    modalSocket.emit('join-' + roomType, {
      [roomType + 'Id']: roomId,
      user: modalUserName,
      merito: 'visitante'
    });

    // Solicita hist√≥rico da sala (mensagens salvas no servidor)
    modalSocket.emit('request-chat-history', { room: modalCurrentRoom });

    // Pede lista de peers na sala
    setTimeout(() => {
      modalSocket.emit('request-peers', { room: modalCurrentRoom });
    }, 500);
  });

  // Quando o servidor responder com a lista de peers:
  modalSocket.on('peers-list', async (peers) => {
    if (peers.length === 0) {
      console.log('üü¢ Sou o primeiro usu√°rio da sala ‚Üí caller');
      // Primeiro usu√°rio ‚Äî n√£o cria offer ainda, espera o segundo entrar
    } else {
      // J√° existe algu√©m na sala, ent√£o sou o segundo
      remoteSocketId = peers[0];
      console.log('üîµ Sou o segundo usu√°rio ‚Üí receiver de', remoteSocketId);
      await criarPeer(true); // chama o offer para o remote
    }
  });

  // Atualiza a lista de peers quando o segundo entra
  modalSocket.on('room-user-count', async ({ room, count }) => {
    if (room === modalCurrentRoom && count === 2 && !remoteSocketId) {
      console.log('üë• Dois usu√°rios conectados, iniciando handshake...');
      modalSocket.emit('request-peers', { room: modalCurrentRoom });
    }
  });
}
async function criarPeer(isCaller = true) {
  peerConnection = new RTCPeerConnection({
    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] // ‚úÖ Google STUN
  });

  peerConnection.onicecandidate = (event) => {
    if (event.candidate && remoteSocketId) {
      modalSocket.emit('ice-candidate', {
        to: remoteSocketId,
        candidate: event.candidate
      });
    }
  };

  peerConnection.onconnectionstatechange = () => {
    console.log('üåê Estado da conex√£o:', peerConnection.connectionState);
  };


    if (isCaller && remoteSocketId) {
  dataChannel = peerConnection.createDataChannel('chat');
  configurarDataChannel(dataChannel);
  const offer = await peerConnection.createOffer();
  await peerConnection.setLocalDescription(offer);
  modalSocket.emit('offer', { to: remoteSocketId, offer });
} else {
    peerConnection.ondatachannel = (event) => {
      dataChannel = event.channel;
      configurarDataChannel(dataChannel);
    };
  }
}

// üéØ FUN√á√ÉO ATUALIZADA COM LOGS DE DIAGN√ìSTICO
function configurarDataChannel(channel) {
  channel.onopen = () => {
    console.log('üì° Canal P2P aberto. DataChannel ReadyState:', channel.readyState);
  };
  channel.onclose = () => {
    console.log('üì¥ Canal P2P fechado. DataChannel ReadyState:', channel.readyState);
  };
  channel.onerror = (error) => { // ‚ö†Ô∏è NOVO: Captura erros do canal
    console.error('‚ö†Ô∏è Erro no DataChannel:', error);
  };
  channel.onmessage = (event) => {
    console.log('üì¨ Mensagem P2P recebida:', event.data); // ‚ö†Ô∏è NOVO: Loga mensagem recebida
    try {
      const data = JSON.parse(event.data);
      addModalMessage(data.usuario, data.mensagem, modalCurrentRoom);
    } catch (err) {
      console.error('Erro ao processar mensagem P2P:', err);
    }
  };
}

// =========================
// === FUN√á√ïES AUXILIARES ===
// =========================
function getModalRoomFromData(data) {
  if (data.jogoId) return `jogo-${data.jogoId}-visitante`;
  if (data.timeId) return `time-${data.timeId}-visitante`;
  if (data.liveId) return `live-${data.liveId}-visitante`;
  return data.room || 'unknown';
}
async function connectModalSocket() {
  const serverUrl = document.getElementById('modalServerUrl').value;
  const userName = document.getElementById('modalUserName').value;
  const roomType = document.getElementById('modalRoomType').value;
  const roomId = document.getElementById('modalRoomId').value;

  try {
    modalP2PMode = true;
    await iniciarP2PChat(serverUrl, userName, roomType, roomId);
    console.log('‚úÖ Modo P2P ativo');
  } catch (err) {
    console.warn('‚ö†Ô∏è Erro no P2P, voltando para modo servidor:', err);
    modalP2PMode = false;
    connectChat(serverUrl, userName);
    joinServerRoom(roomType, roomId);
  }
}
function addModalMessage(user, text, room) {
  const box = document.getElementById('modalMessages');
  if (!box) return;
  const div = document.createElement('div');
  div.innerHTML = `<strong>${user}:</strong> ${text}`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
function sendModalMessage() {
  const input = document.getElementById('modalMessageInput');
  const message = input.value.trim();
  if (!message) return;
  sendHybridMessage(message);
  input.value = '';
}









function carregarEstadiosDoJogo(jogoId) {
    const container = document.getElementById('lista-estadios');
    container.innerHTML = '';

    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return alert("Jogo n√£o encontrado!");

    document.querySelector('#secao-estadios h2').textContent = `Est√°dios - ${jogo.nome}`;

    // === BOT√ÉO ADICIONAR + COMPARTILHAR ===
    const topo = document.createElement('div');
    topo.innerHTML = `
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">

            <button onclick="adicionarEstadio()" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo estadio
            </button>
            <button onclick="colarEstadioCopiado()" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar estadio
            </button>

        </div>
    `;
    container.appendChild(topo);

    // === LISTAR EST√ÅDIOS ===
    jogo.estadios.forEach(estadio => {
        const el = document.createElement('div');
        el.innerHTML = gerarHTMLCardEstadio(jogo, estadio);
        container.appendChild(el);
    });
}
// === 2. LISTAR TODOS OS EST√ÅDIOS (VIS√ÉO GERAL) ===
function carregarEstadios() {
    const container = document.getElementById('lista-estadios');
    container.innerHTML = '';

    document.querySelector('#secao-estadios h2').textContent = 'Todos os Est√°dios';

    let totalEstadios = 0;
    dados.jogos.forEach(j => totalEstadios += j.estadios.length);

    if (totalEstadios === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum est√°dio cadastrado.</p>';
        return;
    }

    dados.jogos.forEach(jogo => {
        if (jogo.estadios.length === 0) return;

        const titulo = document.createElement('h3');
        titulo.textContent = `Jogo: ${jogo.nome}`;
        titulo.style = 'margin:20px 0 10px; padding-bottom:5px; border-bottom:1px solid #ddd;';
        container.appendChild(titulo);

        jogo.estadios.forEach(estadio => {
            const el = document.createElement('div');
            el.innerHTML = gerarHTMLCardEstadio(jogo, estadio, true);
            container.appendChild(el);
        });
    });
}
function gerarBotoesEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    const estadio = jogo?.estadios.find(e => e.id === estadioId);
    if (!estadio) return '';

    const isCopiado = estadioCopiado && estadioCopiado.id === estadioId && estadioCopiado.jogoId === jogoId;

    let botoes = `
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#17a2b8; cursor:pointer; font-size:0.85em;" 
                onclick="verDetalhesEstadio(${jogoId}, ${estadioId})">Ver</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#ffc107; cursor:pointer; font-size:0.85em;" 
                onclick="editarEstadio(${jogoId}, ${estadioId})">Editar</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#6c757d; cursor:pointer; font-size:0.85em;" 
                onclick="alterarImagemEstadio(${jogoId}, ${estadioId})">Imagem</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#dc3545; cursor:pointer; font-size:0.85em;" 
                onclick="excluirEstadio(${jogoId}, ${estadioId})">Excluir</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#007bff; cursor:pointer; font-size:0.85em;" 
                onclick="compartilharEstadio(${jogoId}, ${estadioId})">Compartilhar</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#28a745; cursor:pointer; font-size:0.85em;" 
                onclick="compartilharAppSintonizadaEstadio(${estadioId})">App+Est√°dio</button>
    `;

    // Bot√£o Copiar
    botoes += `
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; cursor:pointer; font-size:0.85em; background:${isCopiado ? '#28a745' : '#6f42c1'};"
                onclick="copiarEstadio(${jogoId}, ${estadioId})">
            ${isCopiado ? 'Copiado' : 'Copiar'}
        </button>
    `;
    
        // Bot√£o Copiar
    botoes += `
        <button   onclick="entrarSalaEstadio(${jogoId}, ${estadioId})">
        entrar estadio
        </button>
    `;
  
    
    

  

    return botoes;
}
// === 1. LISTAR EST√ÅDIOS DE UM JOGO ESPEC√çFICO ===
function gerarHTMLCardEstadio(jogo, estadio, modoGeral = false) {
    const jogoId = jogo.id;
    const estadioId = estadio.id;
    const imagem = obterImagem('estadio', estadio.imagem);

    // Estado do toggle (pode ser salvo em localStorage depois)
    const toggleStates = {};
    const isExpanded = toggleStates[estadioId] || false;

    // === CONTAINER PRINCIPAL ===
    const cardHTML = `
        <div class="estadio-item" style="border:1px solid #ddd; margin:15px 0; padding:15px; border-radius:8px; background:#fafafa;">
            <!-- HEADER -->
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <img src="${imagem}" alt="${estadio.nome}" 
                         style="width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer;"
                         onclick="verTimesDoEstadio(${jogoId}, ${estadioId})"
                         title="Ver times">
                    <div>
                        <h3 style="margin:0; cursor:pointer; color:#007bff; font-size:1.1em;" 
                            onclick="verTimesDoEstadio(${jogoId}, ${estadioId})">
                            ${estadio.nome}
                        </h3>
                        <p style="margin:3px 0; color:#555; font-size:0.9em;">
                            ID: ${estadioId}${modoGeral ? ` | Jogo: ${jogo.nome}` : ''}
                            | Times: ${estadio.times.length}
                        </p>
                    </div>
                </div>
                <button id="toggle-${estadioId}" 
                        style="width:36px; height:36px; border:none; border-radius:50%; background:#007bff; color:white; font-weight:bold; font-size:1.2em; cursor:pointer; display:flex; align-items:center; justify-content:center;"
                        onclick="toggleEstadioBotoes(${estadioId})">
                    ${isExpanded ? '‚àí' : '+'}
                </button>
            </div>

            <!-- BOT√ïES (ocult√°veis) -->
            <div id="botoes-estadio-${estadioId}" 
                 style="display:${isExpanded ? 'flex' : 'none'}; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:12px; padding:10px; background:#f8f9fa; border-radius:6px;">
                ${gerarBotoesEstadio(jogoId, estadioId)}
            </div>
            <hr>
        </div>
    `;

    return cardHTML;
}
// === VARI√ÅVEIS GLOBAIS ===
// === 1. LISTAR TIMES DE UM EST√ÅDIO ===
function carregarTimesDoEstadio(jogoId, estadioId) {
    const container = document.getElementById('lista-times');
    container.innerHTML = '';

    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return alert("Jogo n√£o encontrado!");

    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return alert("Est√°dio n√£o encontrado!");

    document.querySelector('#secao-times h2').textContent = `Times - ${estadio.nome} (${jogo.nome})`;

    // === TOPO: ADICIONAR + COMPARTILHAR ===
    const topo = document.createElement('div');
    topo.innerHTML = `
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button onclick="adicionarTime(${jogoId}, ${estadioId})" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo Time
            </button>
            <button onclick="colarTimeCopiado(${jogoId}, ${estadioId})" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar Time
            </button>


        </div>
    `;
  
    container.appendChild(topo);

    // === LISTAR TIMES ===
    estadio.times.forEach(time => {
        const el = document.createElement('div');
        el.innerHTML = gerarHTMLCardTime(jogo, estadio, time);
        container.appendChild(el);
    });
}
// === 2. LISTAR TODOS OS TIMES (VIS√ÉO GERAL) ===
function carregarTimes() {
    const container = document.getElementById('lista-times');
    container.innerHTML = '';

    document.querySelector('#secao-times h2').textContent = 'Todos os Times';

    let totalTimes = 0;
    dados.jogos.forEach(j => j.estadios.forEach(e => totalTimes += e.times.length));

    if (totalTimes === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum time cadastrado.</p>';
        return;
    }

    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            if (estadio.times.length === 0) return;

            const titulo = document.createElement('h3');
            titulo.textContent = `Est√°dio: ${estadio.nome} | Jogo: ${jogo.nome}`;
            titulo.style = 'margin:20px 0 10px; padding-bottom:5px; border-bottom:1px solid #ddd;';
            container.appendChild(titulo);

            estadio.times.forEach(time => {
                const el = document.createElement('div');
                el.innerHTML = gerarHTMLCardTime(jogo, estadio, time, true);
                container.appendChild(el);
            });
        });
    });
}
// === GERA HTML DO CARD DO TIME COM CHAT ===
function gerarHTMLCardTime(jogo, estadio, time, modoGeral = false) {
    const jogoId = jogo.id;
    const estadioId = estadio.id;
    const timeId = time.id;
    const imagem = obterImagem('time', time.imagem);
    const isCopiado = timeCopiado && timeCopiado.id === timeId && timeCopiado.estadioId === estadioId && timeCopiado.jogoId === jogoId;

    return `
        <div class="time-item" style="border:1px solid #ddd; margin:15px 0; padding:15px; border-radius:8px; background:#fafafa;">
            <!-- HEADER -->
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <img src="${imagem}" alt="${time.nome}" 
                         style="width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer;"
                         onclick="verLivesDoTime(${jogoId}, ${estadioId}, ${timeId})"
                         title="Ver lives">
                    <div>
                        <h3 style="margin:0; cursor:pointer; color:#007bff; font-size:1.1em;" 
                            onclick="verLivesDoTime(${jogoId}, ${estadioId}, ${timeId})">
                            ${time.nome}
                        </h3>
                        <p style="margin:3px 0; color:#555; font-size:0.9em;">
                            ID: ${timeId}
                            ${modoGeral ? ` | Est√°dio: ${estadio.nome} | Jogo: ${jogo.nome}` : ''}
                            | Lives: ${time.lives ? time.lives.length : 0}
                        </p>
                    </div>
                </div>
                <button id="toggle-time-${timeId}" 
                        style="width:36px; height:36px; border:none; border-radius:50%; background:#007bff; color:white; font-weight:bold; font-size:1.2em; cursor:pointer; display:flex; align-items:center; justify-content:center;"
                        onclick="toggleTimeBotoes(${timeId})">
                    +
                </button>
            </div>

            <!-- BOT√ïES OCULT√ÅVEIS -->
            <div id="botoes-time-${timeId}" 
                 style="display:none; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:12px; padding:10px; background:#f8f9fa; border-radius:6px;">
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#17a2b8; cursor:pointer; font-size:0.85em;" 
                        onclick="verDetalhesTime(${jogoId}, ${estadioId}, ${timeId})">Ver</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#ffc107; cursor:pointer; font-size:0.85em;" 
                        onclick="editarTime(${jogoId}, ${estadioId}, ${timeId})">Editar</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#6c757d; cursor:pointer; font-size:0.85em;" 
                        onclick="alterarImagemTime(${jogoId}, ${estadioId}, ${timeId})">Imagem</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#dc3545; cursor:pointer; font-size:0.85em;" 
                        onclick="excluirTime(${jogoId}, ${estadioId}, ${timeId})">Excluir</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#007bff; cursor:pointer; font-size:0.85em;" 
                        onclick="compartilharTime(${timeId})">Compartilhar</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#28a745; cursor:pointer; font-size:0.85em;" 
                        onclick="compartilharAppSintonizadaTime(${timeId})">App+Time</button>

                <!-- BOT√ÉO COPIAR -->
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; cursor:pointer; font-size:0.85em; background:${isCopiado ? '#28a745' : '#6f42c1'};"
                        onclick="copiarTime(${jogoId}, ${estadioId}, ${timeId})">
                    ${isCopiado ? 'Copiado' : 'Copiar'}
                </button>

                <!-- BOT√ÉO CHAT DO TIME -->
                <button onclick="entrarSalaTime(${jogoId}, ${estadioId}, ${timeId})">
                    üí¨ Chat do time
                </button>
                
            </div>
            <hr>
        </div>
    `;
}

                    


function ContainnersDeLivers(live, jogoId, estadioId, timeId) {
    const divsHorizontais = live.divsHorizontais || [];
    const statusClass = live.status === 'ativa' ? 'live-status' : 'live-status inactive';
    const liveId = live.id;
    
    // Estado do toggle (usar mesmo padr√£o dos outros m√≥dulos)
    const isExpanded = toggleStatesLive[liveId] || false;
    const isCopiado = liveCopiada && liveCopiada.id === liveId && 
                     liveCopiada.jogoId === jogoId && 
                     liveCopiada.estadioId === estadioId && 
                     liveCopiada.timeId === timeId;

    return `
        <div class="live-container">
            <!-- HEADER COM TOGGLE -->
            <div class="live-header-with-toggle">
                <div class="live-header-content">
                    <h3 class="live-title">${live.titulo}</h3>
                    <p class="live-description">${live.descricao}</p>
                    <p class="live-meta">
                        Criado por: ${live.criador} | ${divsHorizontais.length} div(s)
                    </p>
                </div>
                <span class="${statusClass}">${live.status}</span>
                <button id="toggle-live-${liveId}" 
                        class="toggle-btn"
                        onclick="toggleLiveBotoes(${liveId})">
                    ${isExpanded ? '‚àí' : '+'}
                </button>
            </div>

            <!-- CONTAINER DE BOT√ïES (OCULT√ÅVEL) -->
            <div id="botoes-live-${liveId}" 
                 class="botoes-container"
                 style="display: ${isExpanded ? 'flex' : 'none'}">
                <!-- BOT√ïES EXISTENTES -->
                <button onclick="verDetalhesLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-info">Ver</button>
                <button onclick="editarLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-warning">Editar</button>
                <button onclick="excluirLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-danger">Excluir</button>
                <button onclick="copiarLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-copy ${isCopiado ? 'copied' : ''}">
                    ${isCopiado ? 'Copiado' : 'Copiar'}
                </button>
                <button onclick="colarLiveCopiada(${jogoId}, ${estadioId}, ${timeId})" 
                        class="btn btn-paste">Colar Live</button>
                
                <!-- BOT√ÉO CHAT DA LIVE -->
                

            <button onclick="entrarSalaLive(${jogoId}, ${estadioId}, ${timeId},${liveId})">
                    üí¨ Chat da live
                </button>



                ${usuarioLogado ? `
                    <button onclick="compartilharAppSintonizadaLive(${liveId})" 
                            class="btn" 
                            style="background:#FF9800; color:white;">
                        üì± App + Live
                    </button>
                ` : ''}
            </div>

            <!-- SE√á√ÉO DE DIVS HORIZONTAIS (MANTIDO ORIGINAL) -->
            <div class="divs-section">
                <div class="divs-header">
                    <h4 class="divs-title">üì∫ Divs de Transmiss√£o</h4>
                    ${usuarioLogado ? `
                        <button onclick="adicionarDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${live.id})" 
                                class="btn btn-secondary">
                            + Nova Div
                        </button>
                    ` : ''}
                </div>
                
                ${divsHorizontais.length > 0 ? `
                    <div id="divs-horizontais-${live.id}">
                        ${divsHorizontais.map(div => criarHTMLDivHorizontal(div, jogoId, estadioId, timeId, live.id)).join('')}
                    </div>
                ` : `
                    <div class="empty-state">
                        <p>Nenhuma div de transmiss√£o criada</p>
                    </div>
                `}
            </div>
        </div>
    `;
}
// Fun√ß√£o principal para carregar lives
function carregarLivesDoTime(jogoId, estadioId, timeId) {
    const container = document.getElementById('lista-lives');
    container.innerHTML = '';
  
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) {
        container.innerHTML = '<p>Jogo n√£o encontrado</p>';
        return;
    }
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) {
        container.innerHTML = '<p>Est√°dio n√£o encontrado</p>';
        return;
    }
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) {
        container.innerHTML = '<p>Time n√£o encontrado</p>';
        return;
    }
    
    document.querySelector('#secao-lives h2').textContent = `Lives - ${time.nome}`;
    /*
    if (!time.lives || time.lives.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <p>carregarLivesDoTime</p>
                <p>Nenhuma live cadastrada para este time</p>
                ${streamerLogado ? `
                    <button onclick="adicionarLive()" class="btn btn-primary btn-large">
                        Criar Live Principal
                    </button>
                ` : ''}
            </div>
        `;
        return;
    }
  */
  // ‚úÖ C√ìDIGO CORRIGIDO:
if (!time.lives || time.lives.length === 0) {
    container.innerHTML = `
        <div class="empty-state">
            <p>carregarLivesDoTime</p>
            <p>Nenhuma live cadastrada para este time</p>
            ${streamerLogado ? `
                <button onclick="adicionarLive(${jogoId}, ${estadioId}, ${timeId})" class="btn btn-primary btn-large">
                    Criar Live Principal
                </button>
            ` : ''}
        </div>
    `;
    return;
} else {
    console.log("Carregando lives encontradas:", time.lives.length);
    
    // ‚úÖ CONTINUA A EXECU√á√ÉO NORMAL
    if (typeof adicionarBotoesControleTamanho === 'function') {
        adicionarBotoesControleTamanho();
    }
    
    container.innerHTML = `
        <div class="actions-container">
            <div class="actions-container" style="text-align:center; margin:15px 0; padding:10px; background:#f8f9fa; border-radius:8px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
            ${streamerLogado ? `
                <button onclick="adicionarLive(${jogoId}, ${estadioId}, ${timeId})" class="btn btn-primary">
                    + Nova Live
                </button>
                <button onclick="colarLiveCopiada(${jogoId}, ${estadioId}, ${timeId})" class="btn" style="background:#6f42c1; color:white;">
                    Colar Live
                </button>
            ` : ''}
            </div>
        </div>
        
        <div id="grid-lives" class="lives-grid"></div>
    `;
    
    const gridContainer = document.getElementById('grid-lives');
    
    time.lives.forEach((live) => {
        const liveCard = document.createElement('div');
        liveCard.className = 'live-card';
        liveCard.innerHTML = ContainnersDeLivers(live, jogoId, estadioId, timeId);
        gridContainer.appendChild(liveCard);
    });
}
  
  
    console.log("time",time)
    console.log("time.lives",time.lives)
    if (typeof adicionarBotoesControleTamanho === 'function') {
        adicionarBotoesControleTamanho();
    }
    
    container.innerHTML = `
        <div class="actions-container">
       <!--     ${streamerLogado ? `
                <button onclick="adicionarLive()" class="btn btn-primary">
                    Criar Nova Live
                </button>
            ` : ''} -->

        </div>
            <div class="actions-container" style="text-align:center; margin:15px 0; padding:10px; background:#f8f9fa; border-radius:8px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
        ${streamerLogado ? `
            <button onclick="adicionarLive(${jogoId}, ${estadioId}, ${timeId})" class="btn btn-primary">
                + Nova Live
            </button>
            <button onclick="colarLiveCopiada(${jogoId}, ${estadioId}, ${timeId})" class="btn" style="background:#6f42c1; color:white;">
                Colar Live
            </button>
        ` : ''}
    </div>
        
        <div id="grid-lives" class="lives-grid"></div>
    `;
    const gridContainer = document.getElementById('grid-lives');

    time.lives.forEach((live) => {
        const liveCard = document.createElement('div');
        liveCard.className = 'live-card';
        liveCard.innerHTML = ContainnersDeLivers(live, jogoId, estadioId, timeId);
        gridContainer.appendChild(liveCard);
    });
    


   // inicializarBotoesApostas()
}





// Fun√ß√£o para adicionar jogo (COM LOG)
function adicionarJogo() {
    const novoId = dados.jogos.length > 0 ? Math.max(...dados.jogos.map(j => j.id)) + 1 : 1;
    
    const nome = prompt("Nome do Jogo:");
    if (!nome) return;
    
    const novoJogo = {
        id: novoId,
        nome: nome,
        imagem: "jogo.jpg",
        estadios: []
    };
    
    dados.jogos.push(novoJogo);
    
    // === LOG ADICIONADO ===
    console.group(`JOGO ADICIONADO: "${nome}" (ID: ${novoId})`);
    //console.log("Jogo adicionado:", novoJogo);
    //console.log("Objeto completo 'dados.jogos':", dados.jogos);
    //console.log("Estrutura completa 'dados':", JSON.parse(JSON.stringify(dados))); // deep clone para log
    console.groupEnd();
    // =======================

    carregarJogos();
    alert(`Jogo "${nome}" adicionado com ID: ${novoId}`);
}

function verEstadiosDoJogo(jogoId) {
    jogoSelecionadoId = jogoId;
    mostrarSecao('estadios');
    carregarEstadiosDoJogo(jogoId);
}
// Fun√ß√£o para ver detalhes do jogo
function verDetalhesJogo(jogoId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        alert(`Detalhes do Jogo:\nNome: ${jogo.nome}\nID: ${jogo.id}\nEst√°dios: ${jogo.estadios.length}`);
    }
}
// Fun√ß√£o para editar jogo
function editarJogo(id) {
    const jogo = dados.jogos.find(j => j.id === id);
    if (jogo) {
        const novoNome = prompt("Novo nome do Jogo:", jogo.nome);
        if (novoNome) {
            jogo.nome = novoNome;
            carregarJogos();
        }
    }
}
// Fun√ß√£o para excluir jogo
function excluirJogo(id) {
    if (confirm("Tem certeza que deseja excluir este jogo e todos os seus est√°dios, times e streamers?")) {
        dados.jogos = dados.jogos.filter(j => j.id !== id);
        carregarJogos();
    }
}


////////////
////////////
////////////estadio
////////////
////////////
////////////
// Fun√ß√£o para carregar est√°dios de um jogo espec√≠fico
// === ESTADIOS.JS ===
// M√≥dulo completo: lista por jogo + lista geral de todos os est√°dios
// === FUN√á√ÉO AUXILIAR: RECARREGA A LISTA ATUAL ===
function recarregarListaEstadiosAtual() {
    const urlParams = new URLSearchParams(window.location.search);
    const jogoId = parseInt(urlParams.get('jogo'));

    if (jogoId && document.getElementById('lista-estadios').innerHTML.includes('Est√°dios - ')) {
        carregarEstadiosDoJogo(jogoId);
    } else {
        carregarEstadios();
    }
}
// === ADICIONAR EST√ÅDIO (s√≥ no modo jogo selecionado) ===
function adicionarEstadio() {
    if (!jogoSelecionadoId) return alert("Selecione um jogo primeiro!");

    const jogo = dados.jogos.find(j => j.id === jogoSelecionadoId);
    const novoId = jogo.estadios.length ? Math.max(...jogo.estadios.map(e => e.id)) + 1 : 1;
    const nome = prompt("Nome do est√°dio:");
    if (!nome?.trim()) return;

    jogo.estadios.push({ id: novoId, nome: nome.trim(), imagem: "estadio.jpg", times: [] });
    carregarEstadiosDoJogo(jogoSelecionadoId);
    alert("Est√°dio adicionado!");
}
function alterarImagemEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return;
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return;
    
    const novaImagem = prompt("URL da nova imagem (deixe em branco para padr√£o):", estadio.imagem);
    if (novaImagem !== null) {
        estadio.imagem = novaImagem;
        carregarEstadiosDoJogo(jogoId);
        alert("Imagem atualizada!");
    }
}
// Fun√ß√£o para navegar para os times de um est√°dio espec√≠fico
function verTimesDoEstadio(jogoId, estadioId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    mostrarSecao('times');
    carregarTimesDoEstadio(jogoId, estadioId);
}
// Fun√ß√£o para ver detalhes do est√°dio
function verDetalhesEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            alert(`Detalhes do Est√°dio:\nNome: ${estadio.nome}\nID: ${estadio.id}\nTimes: ${estadio.times.length}`);
        }
    }
}
// Fun√ß√£o para editar est√°dio
function editarEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            const novoNome = prompt("Novo nome do Est√°dio:", estadio.nome);
            if (novoNome) {
                estadio.nome = novoNome;
                carregarEstadiosDoJogo(jogoId);
            }
        }
    }
}
// Fun√ß√£o para excluir est√°dio
function excluirEstadio(jogoId, estadioId) {
    if (confirm("Tem certeza que deseja excluir este est√°dio e todos os seus times e streamers?")) {
        const jogo = dados.jogos.find(j => j.id === jogoId);
        if (jogo) {
            jogo.estadios = jogo.estadios.filter(e => e.id !== estadioId);
            carregarEstadiosDoJogo(jogoId);
        }
    }
}
// Fun√ß√£o original para carregar todos os est√°dios (mantida para compatibilidade)




////////////
////////////
////////////  times
////////////
////////////
////////////
// Fun√ß√£o para carregar times de um est√°dio espec√≠fico






// Fun√ß√£o para alterar imagem do time
function alterarImagemTime(jogoId, estadioId, timeId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return;
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return;
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) return;
    
    const novaImagem = prompt("URL da nova imagem (deixe em branco para padr√£o):", time.imagem);
    if (novaImagem !== null) {
        time.imagem = novaImagem;
        carregarTimesDoEstadio(jogoId, estadioId);
        alert("Imagem atualizada!");
    }
}
// Fun√ß√£o para ver detalhes do time
function verDetalhesTime(jogoId, estadioId, timeId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            const time = estadio.times.find(t => t.id === timeId);
            if (time) {
                alert(`Detalhes do Time:\nNome: ${time.nome}\nID: ${time.id}\nLives: ${time.lives ? time.lives.length : 0}`);
            }
        }
    }
}
// Fun√ß√£o para editar time
function editarTime(jogoId, estadioId, timeId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            const time = estadio.times.find(t => t.id === timeId);
            if (time) {
                const novoNome = prompt("Novo nome do Time:", time.nome);
                if (novoNome) {
                    time.nome = novoNome;
                    carregarTimesDoEstadio(jogoId, estadioId);
                }
            }
        }
    }
}
// Fun√ß√£o para excluir time
function excluirTime(jogoId, estadioId, timeId) {
    if (confirm("Tem certeza que deseja excluir este time e todas as suas lives?")) {
        const jogo = dados.jogos.find(j => j.id === jogoId);
        if (jogo) {
            const estadio = jogo.estadios.find(e => e.id === estadioId);
            if (estadio) {
                estadio.times = estadio.times.filter(t => t.id !== timeId);
                carregarTimesDoEstadio(jogoId, estadioId);
            }
        }
    }
}
// Fun√ß√£o para navegar para as lives de um time espec√≠fico
function verLivesDoTime(jogoId, estadioId, timeId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    mostrarSecao('lives');
    carregarLivesDoTime(jogoId, estadioId, timeId);
}
function recarregarListaTimesAtual() {
    const urlParams = new URLSearchParams(window.location.search);
    const jogoId = parseInt(urlParams.get('jogo'));
    const estadioId = parseInt(urlParams.get('estadio'));

    if (jogoId && estadioId && document.getElementById('lista-times').innerHTML.includes('Times - ')) {
        carregarTimesDoEstadio(jogoId, estadioId);
    } else {
        carregarTimes();
    }
}
////////////
////////////
////////////  live.js
////////////
////////////
////////////




function adicionarDivHorizontal(jogoId, estadioId, timeId, liveId) {
    if (!usuarioLogado) {
        alert("Fa√ßa login para criar divs de transmiss√£o!");
        return;
    }
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live) return;
    
    // Verificar limite de divs
    if ((live.divsHorizontais || []).length >= configLives.maxDivsPorLive) {
        alert(`Limite de ${configLives.maxDivsPorLive} divs por live atingido!`);
        return;
    }
    
    const titulo = prompt("T√≠tulo da div horizontal:");
    if (!titulo) return;
    
    // Configurar layout e tamanho em uma √∫nica etapa
    const config = obterConfiguracaoDiv();
    if (!config) return;
    
    const novaDiv = {
        id: Date.now(),
        titulo: titulo,
        layout: config.layout,
        colunas: config.colunas,
        tamanhoCard: config.tamanhoCard,
        altura: config.altura,
        criador: usuarioLogado.usuario,
        cards: [],
        dataCriacao: new Date().toLocaleString()
    };
    
    if (!live.divsHorizontais) live.divsHorizontais = [];
    live.divsHorizontais.push(novaDiv);
    
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert(`Div "${titulo}" criada com sucesso!`);
}
// FUN√á√ÉO CHAT PARA LIVE
// FUN√á√ÉO TOGGLE PARA LIVES
function editarLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) {
        const novoTitulo = prompt("Novo t√≠tulo da Live:", live.titulo);
        if (novoTitulo) {
            live.titulo = novoTitulo;
            salvarDados();
            carregarLivesDoTime(jogoId, estadioId, timeId);
        }
    }
}
function excluirLive(jogoId, estadioId, timeId, liveId) {
    if (!confirm("Tem certeza que deseja excluir esta live?")) return;

    const time = encontrarTime(jogoId, estadioId, timeId);
    if (!time || !time.lives) return;

    time.lives = time.lives.filter(l => l.id !== liveId);
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    mostrarNotificacao("Live exclu√≠da!", "sucesso");
}
// FUN√á√ïES AUXILIARES PARA ENCONTRAR ELEMENTOS
function encontrarJogo(jogoId) {
    return dados.jogos.find(j => j.id === jogoId);
}
function encontrarEstadio(jogoId, estadioId) {
    const jogo = encontrarJogo(jogoId);
    return jogo ? jogo.estadios.find(e => e.id === estadioId) : null;
}
function encontrarTime(jogoId, estadioId, timeId) {
    const estadio = encontrarEstadio(jogoId, estadioId);
    return estadio ? estadio.times.find(t => t.id === timeId) : null;
}
// FUN√á√ÉO ENCONTRAR LIVE - VERIFICAR SE EST√Å COMPLETA
function encontrarLive(jogoId, estadioId, timeId, liveId) {
    console.log('üîç Buscando live:', { jogoId, estadioId, timeId, liveId });
    //console.log('üìä Dados dispon√≠veis:', dados);
    
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) {
        console.log('‚ùå Jogo n√£o encontrado');
        return null;
    }
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) {
        console.log('‚ùå Est√°dio n√£o encontrado');
        return null;
    }
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) {
        console.log('‚ùå Time n√£o encontrado');
        return null;
    }
    
    if (!time.lives || !Array.isArray(time.lives)) {
        console.log('‚ùå Lives n√£o encontradas ou n√£o √© array');
        return null;
    }
    
    const live = time.lives.find(l => l.id === liveId);
    if (!live) {
        console.log('‚ùå Live n√£o encontrada');
        return null;
    }
    
    //console.log('‚úÖ Live encontrada:', live);
    return live;
}
// FUN√á√ÉO VER DETALHES LIVE MELHORADA
function verDetalhesLive(jogoId, estadioId, timeId, liveId) {
    console.group('üîç VER DETALHES LIVE');
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) {
        const divsCount = live.divsHorizontais ? live.divsHorizontais.length : 0;
        let totalCards = 0;
        
        // CONTAR TOTAL DE CARDS EM TODAS AS DIVS
        if (live.divsHorizontais) {
            live.divsHorizontais.forEach(div => {
                if (div.cards && Array.isArray(div.cards)) {
                    totalCards += div.cards.length;
                }
            });
        }
        
        const detalhes = `
üìã DETALHES DA LIVE:

üè∑Ô∏è T√≠tulo: ${live.titulo}
üÜî ID: ${live.id}
üìä Status: ${live.status || 'N√£o definido'}
üë§ Criador: ${live.criador || 'N√£o informado'}
üìù Descri√ß√£o: ${live.descricao || 'Sem descri√ß√£o'}

üìä ESTAT√çSTICAS:
‚Ä¢ Divs de Transmiss√£o: ${divsCount}
‚Ä¢ Total de Cards: ${totalCards}
‚Ä¢ Cards por Div: ${divsCount > 0 ? (totalCards / divsCount).toFixed(1) : 0}

üèóÔ∏è ESTRUTURA:
‚Ä¢ Jogo ID: ${jogoId}
‚Ä¢ Est√°dio ID: ${estadioId} 
‚Ä¢ Time ID: ${timeId}
‚Ä¢ Live ID: ${liveId}
        `.trim();
        
        //console.log('üìÑ Detalhes da live:', detalhes);
        alert(detalhes);
    } else {
        const erro = `‚ùå LIVE N√ÉO ENCONTRADA!\n\nVerifique os IDs:\n‚Ä¢ Jogo: ${jogoId}\n‚Ä¢ Est√°dio: ${estadioId}\n‚Ä¢ Time: ${timeId}\n‚Ä¢ Live: ${liveId}`;
        console.error('Erro ao encontrar live:', erro);
        alert(erro);
    }
    
    console.groupEnd();
    return live;
}
// TESTE DE ACESSO AOS DADOS
function testarAcessoDados() {
   /* console.group('üß™ TESTE DE ACESSO A DADOS');
    console.log('üì¶ Objeto dados completo:', dados);
    console.log('üéÆ Jogos:', dados.jogos);
    console.log('üèüÔ∏è Total de est√°dios:', dados.jogos.reduce((acc, jogo) => acc + jogo.estadios.length, 0));
    console.log('‚è∞ Times:', dados.jogos.flatMap(jogo => jogo.estadios.flatMap(estadio => estadio.times)));
    console.log('üî¥ Lives:', dados.jogos.flatMap(jogo => 
        jogo.estadios.flatMap(estadio => 
            estadio.times.flatMap(time => 
                time.lives || []
            )
        )
    ));*/
    console.groupEnd();
}

// CHAMAR TESTE (opcional - remover depois)
// testarAcessoDados();
// FUN√á√ÉO EDITAR LIVE (CORRIGIDA)
function editarLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) {
        const novoTitulo = prompt("Novo t√≠tulo da Live:", live.titulo);
        if (novoTitulo) {
            live.titulo = novoTitulo;
            salvarDados();
            carregarLivesDoTime(jogoId, estadioId, timeId);
        }
    } else {
        alert("Live n√£o encontrada!");
    }
}

////////////
////////////
////////////
////////////
////////////
////////////
// cards.js - SEM ESTILOS INLINE
//ContainnersDeLivers

// Editar Card Horizontal
function editarCardHorizontal(jogoId, estadioId, timeId, liveId, divId, cardId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div || !div.cards) return;
    
    const card = div.cards.find(c => c.id === cardId);
    if (!card) return;
    
    if (!usuarioLogado || usuarioLogado.usuario !== card.criador) {
        alert("Apenas o criador pode editar este card!");
        return;
    }
    
    const novoTitulo = prompt("Novo t√≠tulo:", card.titulo);
    if (novoTitulo === null) return;
    
    const novoIframeUrl = prompt("Nova URL do iframe:", card.iframeUrl);
    if (!novoIframeUrl) return;
    
    card.titulo = novoTitulo;
    card.iframeUrl = novoIframeUrl;
    
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert("Card atualizado!");
}
// Remover Card da Div
function removerCardDaDiv(jogoId, estadioId, timeId, liveId, divId, cardId) {
    if (!confirm("Tem certeza que deseja remover este card?")) return;
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div || !div.cards) return;
    
    const card = div.cards.find(c => c.id === cardId);
    if (!card) return;
    
    if (!usuarioLogado || usuarioLogado.usuario !== card.criador) {
        alert("Apenas o criador pode remover este card!");
        return;
    }
    
    div.cards = div.cards.filter(c => c.id !== cardId);
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert("Card removido!");
}




////////////
////////////
////////////
////////////
////////////
////////////

// MODIFICAR A FUN√á√ÉO criarHTMLDivHorizontal PARA INCLUIR O SCROLL CONTAINER

function ContainersDeLivsHorizontais(div, jogoId, estadioId, timeId, liveId, divId, isExpanded = false, isCopiado = false) {
    const podeGerenciar = usuarioLogado && usuarioLogado.usuario === div.criador;
    const cardsCount = div.cards ? div.cards.length : 0;

    return `
        <div class="div-header">
            <div class="div-header-content">
                <h5 class="div-title">
                    ${div.titulo} 
                    <span class="div-count">(${cardsCount} cards)</span>
                </h5>
                <p class="div-meta">
                    Layout: ${div.layout === 'colunas' ? `${div.colunas} colunas` : 'horizontal'} 
                    | Cards: ${div.tamanhoCard || div.tamanho || 'medio'}
                    | Por: ${div.criador}
                    | Altura: ${div.altura}
                </p>
            </div>
            
            <div class="div-actions">
                <!-- BOT√ÉO TOGGLE -->
                <button id="toggle-div-${div.id}" 
                        class="toggle-btn"
                        onclick="toggleDivBotoes(${div.id})">
                    ${isExpanded ? '‚àí' : '+'}
                </button>
                
                ${podeGerenciar ? `
                    <button onclick="adicionarCardNaDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                            class="btn btn-primary"
                            ${cardsCount >= configLives.maxCardsPorDiv ? 'disabled' : ''}>
                        + Card
                    </button>
                ` : ''}
                
                <!-- BOT√ÉO CHAT DA DIV -->
                <button onclick="abrirChatDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                        class="btn" 
                        style="background:#9c27b0; color:white;">
                    üí¨ Chat Div
                </button>
                
                <!-- Dropdown Button (CONTE√öDO ORIGINAL COMPLETO) -->
                <div class="dropdown">
                    <button class="btn btn-dropdown" type="button" onclick="toggleDropdown(this)">
                        Settings
                    </button>
                    <div class="dropdown-menu">
                        <!-- Tamanhos -->
                        <div class="dropdown-header">Tamanho</div>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhoPequeno('${divId}'); fecharDropdown(this)">Pequeno</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhomedio('${divId}'); fecharDropdown(this)">M√©dio</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhogrande('${divId}'); fecharDropdown(this)">Grande</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhomuitoGrande('${divId}'); fecharDropdown(this)">Muito Grande</button>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Toggle Functions -->
                        <div class="dropdown-header">Toggle</div>
                        <button class="dropdown-item" onclick="adicionarBotaoToggleVideoInfo('${divId}'); fecharDropdown(this)">Toggle Video Info</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToggleVideoInfoAvancado('${divId}'); fecharDropdown(this)">Toggle Video Info Avan√ßado</button>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Layout -->
                        <div class="dropdown-header">Layout</div>
                        <button class="dropdown-item" onclick="adicionarBotaoMudarColunas('${divId}'); fecharDropdown(this)">Mudar Colunas</button>
                        <button class="dropdown-item" onclick="adicionarBotaoEscolherDiv('${divId}'); fecharDropdown(this)">Escolher Div</button>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Reset -->
                        <button class="dropdown-item text-danger" onclick="adicionarBotaoResetDisplay('${divId}'); fecharDropdown(this)">Reset Display</button>
                        
                        ${podeGerenciar ? `
                            <div class="dropdown-divider"></div>
                            <!-- A√ß√µes da Div -->
                            <button class="dropdown-item" onclick="configurarAparenciaDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id}); fecharDropdown(this)">Configurar Layout</button>
                            <button class="dropdown-item" onclick="configurarDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id}); fecharDropdown(this)">Configurar Div</button>
                            <button class="dropdown-item text-danger" onclick="excluirDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id}); fecharDropdown(this)">Excluir Div</button>
                        ` : ''}
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTAINER DE BOT√ïES DA DIV (OCULT√ÅVEL) -->
        <div id="botoes-div-${div.id}" 
             class="botoes-container"
             style="display: ${isExpanded ? 'flex' : 'none'}">
            <button onclick="verDetalhesDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-info">Ver</button>
            <button onclick="editarDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-warning">Editar</button>
            <button onclick="excluirDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-danger">Excluir</button>
            <button onclick="copiarDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-copy ${isCopiado ? 'copied' : ''}">
                ${isCopiado ? 'Copiado' : 'Copiar'}
            </button>
            <button onclick="colarDivHorizontalCopiada(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                   class="btn btn-paste">Colar Div
            </button>
           <button onclick="entrarSalaDiv(${jogoId}, ${estadioId}, ${timeId},${liveId},${div.id})">
                    üí¨ Chat da live
                </button>
        </div>
    `;
}
function adicionarCardNaDiv(jogoId, estadioId, timeId, liveId, divId) {
    if (!usuarioLogado) {
        alert("Fa√ßa login para adicionar cards!");
        return;
    }
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div) return;
    
    // Verificar limite de cards
    if (div.cards.length >= configLives.maxCardsPorDiv) {
        alert(`Limite de ${configLives.maxCardsPorDiv} cards por div atingido!`);
        return;
    }
    
    // Verificar permiss√£o
    if (usuarioLogado.usuario !== div.criador) {
        alert("Apenas o criador da div pode adicionar cards!");
        return;
    }
    
    const titulo = prompt("T√≠tulo do card:");
    if (!titulo) return;
    
    const iframeUrl = prompt("URL do iframe do YouTube (formato: https://www.youtube.com/embed/VIDEO_ID):");
    if (!iframeUrl) return;
    
    const novoCard = {
        id: Date.now(),
        titulo: titulo,
        iframeUrl: iframeUrl,
        criador: usuarioLogado.usuario,
        dataCriacao: new Date().toLocaleString()
    };
    
    div.cards.push(novoCard);
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert("Card adicionado √† div!");
}

function criarHTMLDivHorizontal(div, jogoId, estadioId, timeId, liveId) {
    const divId = `div-horizontal-${div.id}`;
    const layoutClass = div.layout === 'colunas' ? 'layout-colunas' : 'layout-horizontal';
    
    // Estado do toggle para divs
    const isExpanded = toggleStatesDiv[div.id] || false;
    const isCopiado = divCopiada && divCopiada.id === div.id && 
                     divCopiada.liveId === liveId;

    const estiloDiv = div.altura || div.colunas
        ? `style="--altura-div:${div.altura || ''}; --colunas:${div.colunas || ''}; max-height:${div.altura || 'none'};"`
        : '';

    return `
        <div class="div-horizontal ${layoutClass}" ${estiloDiv} id="${divId}">
            ${ContainersDeLivsHorizontais(div, jogoId, estadioId, timeId, liveId, divId, isExpanded, isCopiado)}
            ${criarScrollHorizontalContainer(div, jogoId, estadioId, timeId, liveId, layoutClass)}
        </div>
    `.trim();
}


// FUN√á√ÉO PARA CRIAR O CONTAINER DE SCROLL HORIZONTAL
function criarScrollHorizontalContainer(div, jogoId, estadioId, timeId, liveId, layoutClass) {
    const cards = div.cards || [];
    
    if (layoutClass === 'layout-colunas') {
        // Layout em colunas
        return `
            <div class="scroll-container-colunas" style="--colunas: ${div.colunas || 3}">
                ${cards.map(card => criarCardHTML(card, jogoId, estadioId, timeId, liveId, div.id)).join('')}
            </div>
        `;
    } else {
        // Layout horizontal com scroll
        return `
            <div class="scroll-container-horizontal">
                <div class="cards-wrapper">
                    ${cards.map(card => criarCardHTML(card, jogoId, estadioId, timeId, liveId, div.id)).join('')}
                </div>
            </div>
        `;
    }
}
// FUN√á√ÉO CHAT PARA DIV HORIZONTAL




function verDetalhesDiv(jogoId, estadioId, timeId, liveId, divId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (div) {
        alert(`Detalhes da Div:\nT√≠tulo: ${div.titulo}\nID: ${div.id}\nCards: ${div.cards ? div.cards.length : 0}\nLayout: ${div.layout}\nCriador: ${div.criador}`);
    }
}

function editarDiv(jogoId, estadioId, timeId, liveId, divId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (div) {
        const novoTitulo = prompt("Novo t√≠tulo da Div:", div.titulo);
        if (novoTitulo) {
            div.titulo = novoTitulo;
            salvarDados();
            carregarLivesDoTime(jogoId, estadioId, timeId);
        }
    }
}


// FUN√á√ÉO AUXILIAR PARA ENCONTRAR DIV
function encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    return live && live.divsHorizontais ? live.divsHorizontais.find(d => d.id === divId) : null;
}
////////////
////////////
////////////
////////////
////////////
////////////


// MODIFICAR A FUN√á√ÉO criarScrollHorizontalContainer COM BOT√ÉO CHAT
function criarScrollHorizontalContainer(div, jogoId, estadioId, timeId, liveId, layoutClass) {
    const cardsHTML = div.cards && div.cards.length > 0
        ? div.cards.map(card => iframers(
            card,
            div.tamanhoCard || div.tamanho || 'medio',
            jogoId, estadioId, timeId, liveId, div.id,
            div
          )).join('')
        : `<div class="empty-card">Nenhum card adicionado</div>`;

    // Estado para copiar scroll container e toggle
    const isCopiado = scrollContainerCopiado && scrollContainerCopiado.divId === div.id;
    const isExpanded = toggleStatesScrollContainer[div.id] || false;

    return `
        <div class="horizontal-scroll-container">
            <!-- HEADER COM TOGGLE E BOT√ïES -->
            <div class="scroll-container-header">
                <span class="scroll-info">${div.cards ? div.cards.length : 0} cards</span>
                <div class="scroll-actions">
                    <!-- BOT√ÉO TOGGLE -->
                    
                    
                    
                    <button id="toggle-scroll-${div.id}" 
                            class="toggle-btn"
                            onclick="toggleScrollContainerBotoes(${div.id})">
                        ${isExpanded ? '‚àí' : '+'}
                    </button>
                </div>
            </div>

            <!-- CONTAINER DE BOT√ïES (OCULT√ÅVEL) -->
            <div id="botoes-scroll-${div.id}" 
                 class="botoes-container"
                 style="display: ${isExpanded ? 'flex' : 'none'}">
                <button onclick="copiarScrollContainer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                        class="btn btn-small ${isCopiado ? 'btn-success' : 'btn-secondary'}">
                    ${isCopiado ? 'üìã Copiado' : 'üìã Copiar'}
                </button>
                <button onclick="colarScrollContainerCopiado(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-small btn-primary">
                    üìã Colar
                </button>
                <button onclick="excluirScrollContainer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                        class="btn btn-small btn-danger">
                    ‚ùå Excluir
                </button>
                
                <!-- BOT√ÉO CHAT DO SCROLL CONTAINER -->
           <button onclick="entrarSalaCard(${jogoId}, ${estadioId}, ${timeId},${liveId},${div.id},${div.cards.id})">
                    üí¨ Chat da live
                </button>
            </div>

            </div>
            
            <div class="cards-container ${layoutClass}">
                ${cardsHTML}
            </div>
        </div>
    `;
}

function excluirScrollContainer(jogoId, estadioId, timeId, liveId, divId) {
    if (!confirm("Tem certeza que deseja limpar todos os cards deste scroll container?")) return;

    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (!div) return;

    div.cards = [];
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    mostrarNotificacao("Scroll Container limpo!", "sucesso");
}



////////////
////////////
////////////
////////////
////////////
////////////

function iframers(card, tamanhoDiv, jogoId, estadioId, timeId, liveId, divId, div) {
    const sizeClass = `card-size-${tamanhoDiv}`;
    
    const isExpanded = toggleStatesIframer[card.id] || false;
    const isCopiado = iframerCopiado && iframerCopiado.id === card.id;

    return `
        <div class="video-card ${sizeClass}">
            <!-- APENAS O IFRAME PURO -->
            <div class="video-iframe-container">
                <iframe 
                    src="${card.iframeUrl}?autoplay=${configLives.autoplay}&mute=${configLives.mute}&enablejsapi=${configLives.enablejsapi}" 
                    class="video-iframe"
                    allow="autoplay; encrypted-media" 
                    allowfullscreen
                    loading="lazy">
                </iframe>
            </div>
            
            <!-- VIDEO-INFO COM TUDO: t√≠tulo, toggle e bot√µes -->
            <div class="video-info">
                <!-- HEADER COM T√çTULO E TOGGLE -->
                <div class="video-header">
                   <!-- <strong class="video-title">${card.titulo}</strong> -->
                    <div class="video-actions">
                        <button id="toggle-iframer-${card.id}" 
                                class="toggle-btn toggle-btn-small"
                                onclick="toggleIframerBotoes(${card.id})">
                            ${isExpanded ? '‚àí' : '+'}
                        </button>
                    </div>
                </div>

                <!-- CONTAINER DE BOT√ïES (OCULT√ÅVEL) -->
                <div id="botoes-iframer-${card.id}" 
                     class="botoes-container botoes-container-small"
                     style="display: ${isExpanded ? 'flex' : 'none'}">
                    <button onclick="verDetalhesIframer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small btn-info">Ver</button>
                    <button onclick="editarCardHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small btn-warning">Editar</button>
                    <button onclick="copiarIframer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small ${isCopiado ? 'btn-success' : 'btn-secondary'}">
                        ${isCopiado ? 'üìã Copiado' : 'üìã Copiar'}
                    </button>
                    <button onclick="colarIframerCopiado(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId})" 
                            class="btn btn-small btn-primary">Colar</button>
                    <button onclick="removerCardDaDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small btn-danger">Remover</button>
                    
                    <!-- BOT√ÉO CHAT -->
                      <button 
                          onclick="entrarSalaIframe(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})"
                          class="btn btn-small btn-primary">
                          üí¨ Chat da live
                      </button>

                </div>

                <!-- INFO ADICIONAL -->
              <!--  <p class="video-author">Por: ${card.criador}</p> -->
            </div>
        </div>
    `;
}
// FUN√á√ÉO AUXILIAR PARA ENCONTRAR CARD POR ID
function encontrarCardPorId(cardId) {
    for (const jogo of dados.jogos) {
        for (const estadio of jogo.estadios) {
            for (const time of estadio.times) {
                if (time.lives) {
                    for (const live of time.lives) {
                        if (live.divsHorizontais) {
                            for (const div of live.divsHorizontais) {
                                if (div.cards) {
                                    const card = div.cards.find(c => c.id === cardId);
                                    if (card) return card;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    return null;
}
// FUN√á√ÉO AUXILIAR PARA ENCONTRAR CARD (ADICIONAR NO lives.js)
function encontrarCard(jogoId, estadioId, timeId, liveId, divId, cardId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    return div && div.cards ? div.cards.find(c => c.id === cardId) : null;
}
// MANTER AS FUN√á√ïES EXISTENTES PARA IFRAMERS
function verDetalhesIframer(jogoId, estadioId, timeId, liveId, divId, cardId) {
    const card = encontrarCard(jogoId, estadioId, timeId, liveId, divId, cardId);
    if (card) {
        alert(`Detalhes do Iframer:\nT√≠tulo: ${card.titulo}\nID: ${card.id}\nURL: ${card.iframeUrl}\nCriador: ${card.criador}`);
    } else {
        alert("Card n√£o encontrado!");
    }
}

////////////
////////////
////////////
////////////
////////////
////////////



// ===== FUN√á√ÉO UNIFICADA DE CONFIGURA√á√ÉO =====
function configurarDiv(jogoId, estadioId, timeId, liveId, divId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div) return;
    
    if (!usuarioLogado || usuarioLogado.usuario !== div.criador) {
        alert("Apenas o criador pode configurar esta div!");
        return;
    }
    
    const opcao = prompt(`
CONFIGURAR DIV: ${div.titulo}

1. ‚úèÔ∏è Alterar t√≠tulo
2. üé® Configurar layout e apar√™ncia
3. üóëÔ∏è Excluir esta div

Digite o n√∫mero da op√ß√£o:`);

    switch(opcao) {
        case "1":
            const novoTitulo = prompt("Novo t√≠tulo:", div.titulo);
            if (novoTitulo) {
                div.titulo = novoTitulo;
                salvarEAtualizar(jogoId, estadioId, timeId);
            }
            break;
            
        case "2":
            configurarAparenciaDiv(div, jogoId, estadioId, timeId);
            break;
            
        case "3":
            if (confirm("Tem certeza que deseja excluir esta div e todos os seus cards?")) {
                live.divsHorizontais = live.divsHorizontais.filter(d => d.id !== divId);
                salvarEAtualizar(jogoId, estadioId, timeId);
                alert("Div exclu√≠da!");
            }
            break;
    }
}

// ===== FUN√á√ÉO AUXILIAR - CONFIGURA√á√ÉO DE APAR√äNCIA =====
function configurarAparenciaDiv(div, jogoId, estadioId, timeId) {
    const opcao = prompt(`
CONFIGURAR APAR√äNCIA - ${div.titulo}

1. üîÑ Layout Horizontal
2. üìä Layout em 2 Colunas
3. üìä Layout em 3 Colunas
4. üìä Layout em 4 Colunas
5. üìè Card Pequeno
6. üìè Card M√©dio  
7. üìè Card Grande
8. üìê Configurar Altura

Digite o n√∫mero:`);

    if (!opcao) return;

    switch(opcao) {
        case "1": div.layout = "horizontal"; delete div.colunas; break;
        case "2": div.layout = "colunas"; div.colunas = 2; break;
        case "3": div.layout = "colunas"; div.colunas = 3; break;
        case "4": div.layout = "colunas"; div.colunas = 4; break;
        case "5": div.tamanhoCard = "pequeno"; break;
        case "6": div.tamanhoCard = "medio"; break;
        case "7": div.tamanhoCard = "grande"; break;
        case "8": configurarAlturaIndividual(div); break;
        default: alert("Op√ß√£o inv√°lida!"); return;
    }

    salvarEAtualizar(jogoId, estadioId, timeId);
    alert("Configura√ß√£o aplicada!");
}

// ===== FUN√á√ÉO AUXILIAR - CONFIGURA√á√ÉO DE ALTURA =====
function configurarAlturaIndividual(div) {
    const opcao = prompt(`
CONFIGURAR ALTURA:

1. Pequena (250px)
2. M√©dia (500px)  
3. Grande (750px)
4. Extra Grande (1000px)
5. Personalizada

Digite o n√∫mero:`);

    switch(opcao) {
        case "1": div.altura = "250px"; break;
        case "2": div.altura = "500px"; break;
        case "3": div.altura = "750px"; break;
        case "4": div.altura = "1000px"; break;
        case "5": 
            const altura = prompt("Digite a altura (ex: 600px):", "600px");
            if (altura && altura.includes('px')) div.altura = altura;
            break;
    }
}

// ===== FUN√á√ÉO AUXILIAR - OBTER CONFIGURA√á√ÉO INICIAL =====
function obterConfiguracaoDiv() {
    // Layout
    const layoutOpcao = prompt(`
SELECIONE O LAYOUT:

1. üîÑ Horizontal (linha √∫nica)
2. üìä 2 Colunas
3. üìä 3 Colunas  
4. üìä 4 Colunas

Digite o n√∫mero:`);

    let layout, colunas;
    switch(layoutOpcao) {
        case "1": layout = "horizontal"; break;
        case "2": layout = "colunas"; colunas = 2; break;
        case "3": layout = "colunas"; colunas = 3; break;
        case "4": layout = "colunas"; colunas = 4; break;
        default: return null;
    }

    // Tamanho do card
    const tamanhoOpcao = prompt(`
SELECIONE O TAMANHO DOS CARDS:

1. üìè Pequeno
2. üìè M√©dio
3. üìè Grande

Digite o n√∫mero:`);

    const tamanhos = { "1": "pequeno", "2": "medio", "3": "grande" };
    const tamanhoCard = tamanhos[tamanhoOpcao] || 'medio';

    // Altura
    const alturaOpcao = prompt(`
SELECIONE A ALTURA:

1. Pequena (250px)
2. M√©dia (500px)
3. Grande (750px)
4. Extra Grande (1000px)

Digite o n√∫mero:`);

    const alturas = { "1": "250px", "2": "500px", "3": "750px", "4": "1000px" };
    const altura = alturas[alturaOpcao] || "500px";

    return { layout, colunas, tamanhoCard, altura };
}

// ===== FUN√á√ÉO AUXILIAR - SALVAR E ATUALIZAR =====
function salvarEAtualizar(jogoId, estadioId, timeId) {
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
}

////////////
////////////
////////////
////////////
////////////
////////////
// Fun√ß√µes para controlar o dropdown
function toggleDropdown(button, event) {
    // Caso o 'event' n√£o tenha sido passado no onclick
    if (!event) event = window.event;

    if (event) event.stopPropagation();

    const dropdown = button.closest('.dropdown');
    const menu = dropdown.querySelector('.dropdown-menu');
    const isOpen = menu.classList.contains('show');

    // Fecha todos os outros dropdowns primeiro
    fecharTodosDropdowns();

    // Toggle: se j√° est√° aberto, fecha
    if (isOpen) {
        menu.classList.remove('show');
        return;
    }

    // Abre o dropdown atual
    menu.classList.add('show');


}
function fecharDropdown(element) {
    const dropdown = element.closest('.dropdown');
    const menu = dropdown.querySelector('.dropdown-menu');
    menu.classList.remove('show');
}
function fecharTodosDropdowns() {
    document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
        menu.classList.remove('show');
    });
}
// Fecha dropdowns quando clicar fora
document.addEventListener('click', function(e) {
    if (!e.target.closest('.dropdown')) {
        fecharTodosDropdowns();
    }
});
// Fecha dropdowns quando pressionar ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        fecharTodosDropdowns();
    }
});

////////////
////////////
////////////
////////////
////////////
////////////
// lives-manager.js - FUN√á√ïES MODIFICADAS PARA APENAS EXECUTAR

// Fun√ß√£o para toggle do video-info
function toggleVideoInfo() {
    const videoInfos = document.querySelectorAll('.video-info');
    
    if (videoInfos.length === 0) {
        alert("Nenhum video-info encontrado na p√°gina!");
        return;
    }
    
    // Verificar o estado atual (pega o primeiro como refer√™ncia)
    const primeiroVideoInfo = videoInfos[0];
    const estaVisivel = primeiroVideoInfo.style.display !== 'none';
    
    // Toggle em todos os video-infos
    videoInfos.forEach(videoInfo => {
        videoInfo.style.display = estaVisivel ? 'none' : 'flex';
    });
    
    // Salvar prefer√™ncia no localStorage
    localStorage.setItem('videoInfoVisivel', !estaVisivel);
    
    alert(`Video-info ${estaVisivel ? 'oculto' : 'mostrado'}!`);
}

// Fun√ß√£o para aplicar estado salvo do video-info
function aplicarEstadoVideoInfo() {
    const videoInfoVisivel = localStorage.getItem('videoInfoVisivel');
    
    // Se n√£o tiver salvo, mostra por padr√£o (null = mostrar)
    if (videoInfoVisivel === 'false') {
        const videoInfos = document.querySelectorAll('.video-info');
        videoInfos.forEach(videoInfo => {
            videoInfo.style.display = 'none';
        });
    }
}

// VERS√ÉO SIMPLIFICADA - APENAS EXECUTA A FUN√á√ÉO
function adicionarBotaoToggleVideoInfo(divId = null) {
    // Se uma div espec√≠fica foi passada, aplica apenas nela
    if (divId) {
        const div = document.getElementById(divId);
        if (div) {
            const videoInfos = div.querySelectorAll('.video-info');
            videoInfos.forEach(videoInfo => {
                const estaVisivel = videoInfo.style.display !== 'none';
                videoInfo.style.display = estaVisivel ? 'none' : 'flex';
            });
        }
    } else {
        // Aplica em toda a p√°gina
        toggleVideoInfo();
    }
}

// VERS√ÉO SIMPLIFICADA - APENAS EXECUTA A FUN√á√ÉO
function adicionarBotaoToggleVideoInfoAvancado(divId = null) {
    if (divId) {
        const div = document.getElementById(divId);
        if (div) {
            const videoInfos = div.querySelectorAll('.video-info');
            if (videoInfos.length > 0) {
                const estaVisivel = videoInfos[0].style.display !== 'none';
                videoInfos.forEach(videoInfo => {
                    videoInfo.style.display = estaVisivel ? 'none' : 'flex';
                });
            }
        }
    } else {
        toggleVideoInfo();
    }
}

// VERS√ÉO SIMPLIFICADA - APENAS EXECUTA A FUN√á√ÉO
function adicionarBotaoResetDisplay(divId = null) {
    if (divId) {
        const div = document.getElementById(divId);
        if (div) {
            const videoInfos = div.querySelectorAll('.video-info');
            videoInfos.forEach(videoInfo => {
                videoInfo.style.display = 'flex';
            });
        }
    } else {
        // Mostrar todos os video-infos
        const videoInfos = document.querySelectorAll('.video-info');
        videoInfos.forEach(videoInfo => {
            videoInfo.style.display = 'flex';
        });
        
        // Limpar localStorage
        localStorage.removeItem('videoInfoVisivel');
        
        alert("Display resetado! Todos os video-infos est√£o vis√≠veis.");
    }
}

// Fun√ß√£o auxiliar para atualizar texto do bot√£o (mantida para compatibilidade)
function atualizarTextoBotaoToggle(botao, estaVisivel) {
    botao.textContent = estaVisivel ? 'üëÅÔ∏è Ocultar Nomes' : 'üôà Mostrar Nomes';
    botao.title = estaVisivel ? 'Clique para ocultar t√≠tulos e autores' : 'Clique para mostrar t√≠tulos e autores';
}

// Adicionar tamb√©m no CSS uma transi√ß√£o suave (opcional)
function adicionarCSSTransition() {
    if (!document.getElementById('video-info-css')) {
        const style = document.createElement('style');
        style.id = 'video-info-css';
        style.textContent = `
            .video-info {
                transition: opacity 0.3s ease, display 0.3s ease;
            }
        `;
        document.head.appendChild(style);
    }
}

// Aplicar estado salvo quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
    aplicarEstadoVideoInfo()
});


////////////
////////////
////////////
////////////
////////////
////////////
// Fun√ß√£o para escolher n√∫mero de colunas
function escolherNumeroColunas() {
    const opcoes = `
Escolha o n√∫mero de colunas:

1. 1 Coluna
2. 2 Colunas  
3. 3 Colunas
4. 4 Colunas
5. 5 Colunas
6. 6 Colunas

Digite o n√∫mero da op√ß√£o:`;
    
    const opcao = prompt(opcoes);
    if (!opcao) return null;
    
    const colunasMap = {
        "1": 1,
        "2": 2,
        "3": 3,
        "4": 4,
        "5": 5,
        "6": 6
    };
    
    return colunasMap[opcao] || 3;
}
// Fun√ß√£o para encontrar a div nos dados pelo ID do elemento HTML
function encontrarDivPorElementoId(elementoId) {
    const divId = parseInt(elementoId.replace('div-horizontal-', ''));
    
    for (const jogo of dados.jogos) {
        for (const estadio of jogo.estadios) {
            for (const time of estadio.times) {
                for (const live of time.lives) {
                    if (live.divsHorizontais) {
                        const div = live.divsHorizontais.find(d => d.id === divId);
                        if (div) {
                            return { jogo, estadio, time, live, div };
                        }
                    }
                }
            }
        }
    }
    return null;
}
// VERS√ÉO CORRIGIDA - USANDO CONFIGLIVES COMO NAS FUN√á√ïES ANTIGAS
function adicionarBotaoToTamanhoPequeno(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'pequeno', colunas);
}
function adicionarBotaoToTamanhomedio(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'medio', colunas);
}
function adicionarBotaoToTamanhogrande(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'grande', colunas);
}
function adicionarBotaoToTamanhomuitoGrande(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'extraGrande', colunas);
}
function adicionarBotaoMudarColunas(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarApenasColunas(divId, colunas);
}
function adicionarBotaoEscolherDiv(divId = null) {
    if (divId) {
        alert(`Div selecionada: ${divId}`);
    } else {
        alert("Funcionalidade em desenvolvimento!\nPor enquanto usando a primeira div dispon√≠vel.");
    }
}
// FUN√á√ÉO PRINCIPAL CORRIGIDA - COMO NAS VERS√ïES ANTIGAS
function aplicarConfiguracaoDiv(elementoId, tamanho, colunas) {
    let resultado;
    
    if (elementoId) {
        // Aplica na div espec√≠fica
        resultado = encontrarDivPorElementoId(elementoId);
        if (!resultado) {
            alert("Div n√£o encontrada nos dados!");
            return;
        }
    } else {
        // Usa a primeira div dispon√≠vel (comportamento original)
        const jogo = dados.jogos[0];
        const estadio = jogo.estadios[0];
        const time = estadio.times[0];
        const live = time.lives[0];
        const div = live.divsHorizontais[0];
        
        if (!div) {
            alert("Nenhuma div encontrada!");
            return;
        }
        
        resultado = { jogo, estadio, time, live, div };
    }
    
    const { jogo, estadio, time, live, div } = resultado;
    
    // CONFIGURA√á√ÉO COMPLETA COMO NAS FUN√á√ïES ANTIGAS
    div.layout = "colunas";
    div.colunas = colunas;
    div.tamanho = tamanho;
    div.tamanhoCard = tamanho;
    
    // USANDO CONFIGLIVES COMO NAS FUN√á√ïES ANTIGAS
    if (configLives && configLives.alturasDiv && configLives.alturasDiv[tamanho]) {
        div.altura = configLives.alturasDiv[tamanho].height;
    } else {
        // Fallback se configLives n√£o estiver dispon√≠vel
        const alturasFallback = {
            'pequeno': '250px',
            'medio': '500px', 
            'grande': '750px',
            'extraGrande': '1000px'
        };
        div.altura = alturasFallback[tamanho] || '500px';
    }
    
    console.log("Div ap√≥s mudan√ßa:", div);
    
    // SALVAR E RECARREGAR COMO NAS FUN√á√ïES ANTIGAS
    salvarDados();
    carregarLivesDoTime(jogo.id, estadio.id, time.id);
    
    const mensagem = elementoId 
        ? `Configura√ß√£o aplicada na div "${div.titulo}"!\n- Cards: ${tamanho}\n- Colunas: ${colunas}\n- Altura: ${div.altura}`
        : `Layout aplicado!\n- Cards: ${tamanho}\n- Colunas: ${colunas}\n- Altura: ${div.altura}`;
    
    alert(mensagem);
}
// FUN√á√ÉO PARA APENAS MUDAR COLUNAS
function aplicarApenasColunas(elementoId, colunas) {
    let resultado;
    
    if (elementoId) {
        resultado = encontrarDivPorElementoId(elementoId);
        if (!resultado) {
            alert("Div n√£o encontrada nos dados!");
            return;
        }
    } else {
        const jogo = dados.jogos[0];
        const estadio = jogo.estadios[0];
        const time = estadio.times[0];
        const live = time.lives[0];
        const div = live.divsHorizontais[0];
        
        if (!div) {
            alert("Nenhuma div encontrada!");
            return;
        }
        
        resultado = { jogo, estadio, time, live, div };
    }
    
    const { jogo, estadio, time, live, div } = resultado;
    
    // Apenas mudar colunas, manter o resto
    div.layout = "colunas";
    div.colunas = colunas;
    
    console.log("Div ap√≥s mudan√ßa de colunas:", div);
    
    salvarDados();
    carregarLivesDoTime(jogo.id, estadio.id, time.id);
    
    const mensagem = elementoId
        ? `Colunas alteradas para: ${colunas} na div "${div.titulo}"`
        : `Colunas alteradas para: ${colunas}`;
    
    alert(mensagem);
}

  
////////////
////////////
////////////
////////////
////////////
////////////
function painelAdmin() {
    const senha = prompt("Senha de administrador:");
    if (senha !== "admin123") {
        alert("Senha incorreta!");
        return;
    }
    
    let painel = "=== PAINEL ADMIN ===\n\n";
    painel += "1. Estat√≠sticas Gerais\n";
    painel += "2. Gerenciar Usu√°rios\n";
    painel += "3. Gerenciar Streamers\n";
    painel += "4. Limpar Dados\n";
    painel += "5. Backup/Restore\n";
    
    const opcao = prompt(painel);
    
    switch(opcao) {
        case '1':
            verEstatisticas();
            break;
        case '2':
            gerenciarUsuarios();
            break;
        case '4':
            limparDados();
            break;
    }
}
function verEstatisticas() {
    let stats = "=== ESTAT√çSTICAS ===\n\n";
    stats += `Total de Usu√°rios: ${dados.usuarios.length}\n`;
    stats += `Total de Streamers: ${contarStreamers()}\n`;
    stats += `Total de Desafios: ${contarDesafios()}\n`;
    stats += `Total de Transa√ß√µes: ${dados.transacoes.length}\n`;
    stats += `Total em M√©rito Circulante: ${calcularMeritoTotal()}\n`;
    alert(stats);
}
function contarStreamers() {
    let count = 0;
    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            estadio.times.forEach(time => {
                if (time.lives) {
                    time.lives.forEach(live => {
                        count += live.streamers ? live.streamers.length : 0;
                    });
                }
            });
        });
    });
    return count;
}

  
////////////
////////////
////////////
////////////
////////////
////////////
function criarEvento() {
    if (!streamerLogado) {
        alert("Apenas streamers podem criar eventos");
        return;
    }
    
    const nome = prompt("Nome do evento:");
    if (!nome) return;
    
    const descricao = prompt("Descri√ß√£o do evento:");
    const data = prompt("Data do evento (ex: 25/12/2023 20:00):");
    const premio = prompt("Pr√™mio do evento:");
    
    const novoEvento = {
        id: Date.now(),
        nome: nome,
        descricao: descricao,
        data: data,
        premio: premio,
        criador: streamerLogado.nome,
        participantes: [],
        status: "inscricoes_abertas"
    };
    
    eventos.push(novoEvento);
    adicionarNotificacao("Novo Evento!", `${streamerLogado.nome} criou o evento: ${nome}`, 'info');
    alert("Evento criado com sucesso!");
}
function verEventos() {
    if (eventos.length === 0) {
        alert("Nenhum evento agendado");
        return;
    }
    
    let lista = "=== EVENTOS ===\n\n";
    eventos.forEach((evento, index) => {
        lista += `üéØ ${evento.nome}\n`;
        lista += `Descri√ß√£o: ${evento.descricao}\n`;
        lista += `Data: ${evento.data}\n`;
        lista += `Pr√™mio: ${evento.premio}\n`;
        lista += `Criador: ${evento.criador}\n`;
        lista += `Participantes: ${evento.participantes.length}\n`;
        lista += `Status: ${evento.status}\n`;
        
        if (usuarioLogado && evento.status === "inscricoes_abertas") {
            lista += `[Participar - digite 'p ${index}']\n`;
        }
        lista += "------------------------\n";
    });
    
    if (usuarioLogado) {
        lista += "\nComandos: 'p [n√∫mero]' - participar do evento";
    }
    
    const comando = prompt(lista);
    
    if (comando && comando.startsWith('p ')) {
        const index = parseInt(comando.split(' ')[1]);
        if (!isNaN(index) && index >= 0 && index < eventos.length) {
            participarEvento(eventos[index].id);
        }
    }
}
function participarEvento(eventoId) {
    if (!usuarioLogado) {
        alert("Fa√ßa login como usu√°rio para participar!");
        return;
    }
    
    const evento = eventos.find(e => e.id === eventoId);
    if (!evento) {
        alert("Evento n√£o encontrado!");
        return;
    }
    
    if (evento.status !== "inscricoes_abertas") {
        alert("Inscri√ß√µes encerradas para este evento!");
        return;
    }
    
    if (evento.participantes.includes(usuarioLogado.nome)) {
        alert("Voc√™ j√° est√° participando deste evento!");
        return;
    }
    
    evento.participantes.push(usuarioLogado.nome);
    adicionarNotificacao("Inscri√ß√£o Confirmada!", `Voc√™ se inscreveu no evento: ${evento.nome}`, 'sucesso');
    alert(`Inscri√ß√£o confirmada no evento: ${evento.nome}`);
}
function finalizarEvento(eventoId, vencedor) {
    const evento = eventos.find(e => e.id === eventoId);
    if (!evento) return;
    
    evento.status = "finalizado";
    evento.vencedor = vencedor;
    evento.dataFinalizacao = new Date().toLocaleString();
    
    adicionarNotificacao("Evento Finalizado!", `O evento ${evento.nome} foi finalizado. Vencedor: ${vencedor}`, 'info');
    alert(`Evento finalizado! Vencedor: ${vencedor}`);
}

  
  
////////////
//////////
////////////
////////////
////////////
////////////
////////////
////////////
// Sistema de c√°lculo de m√©rito
function calcularMeritoMaximoAposta(usuario) {
    // M√©rito m√°ximo = m√©rito atual * 2 (pode apostar at√© o dobro do seu m√©rito)
    return usuario.merito * 2;
}
function atualizarMerito(usuario, tipoAcao, sucesso) {
    let pontos = 0;
    
    switch(tipoAcao) {
        case 'desafio_cumprido':
            pontos = sucesso ? 50 : -30;
            if (sucesso) usuario.desafiosCumpridos++;
            else usuario.desafiosFalhados++;
            break;
            
        case 'pagamento_realizado':
            pontos = 100;
            usuario.pagamentosRealizados++;
            break;
            
        case 'pagamento_pendente':
            pontos = -150; // Penalidade alta por n√£o pagar
            usuario.pagamentosPendentes++;
            break;
            
        case 'aposta_ganha':
            pontos = 25;
            break;
            
        case 'aposta_perdida':
            pontos = -10;
            break;
            
        case 'desafio_criado':
            pontos = 5;
            break;
    }
    
    usuario.merito = Math.max(0, usuario.merito + pontos);
    return pontos;
}
// No merito.js, substituir a fun√ß√£o verPerfil por:
function verPerfil() {
    verPerfilCompleto(); // Usar a nova fun√ß√£o completa
}


  
  
////////////
////////////
/////////////
////////////
////////////
////////////
function verRankingUsuarios() {
    const usuariosOrdenados = [...dados.usuarios].sort((a, b) => b.merito - a.merito);
    
    let ranking = "=== RANKING DE USU√ÅRIOS ===\n\n";
    usuariosOrdenados.forEach((usuario, index) => {
        ranking += `${index + 1}¬∫ - ${usuario.nome}\n`;
        ranking += `M√©rito: ${usuario.merito} pontos\n`;
        ranking += `Desafios: ${usuario.desafiosCumpridos}/${usuario.desafiosCumpridos + usuario.desafiosFalhados} cumpridos\n`;
        ranking += "------------------------\n";
    });
    alert(ranking);
}
function verRankingStreamers() {
    let todosStreamers = [];
    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            estadio.times.forEach(time => {
                if (time.lives) {
                    time.lives.forEach(live => {
                        if (live.streamers) {
                            todosStreamers = todosStreamers.concat(live.streamers);
                        }
                    });
                }
            });
        });
    });
    
    const streamersOrdenados = todosStreamers.sort((a, b) => b.merito - a.merito);
    
    let ranking = "=== RANKING DE STREAMERS ===\n\n";
    streamersOrdenados.forEach((streamer, index) => {
        ranking += `${index + 1}¬∫ - ${streamer.nome}\n`;
        ranking += `M√©rito: ${streamer.merito} pontos\n`;
        ranking += `Online: ${streamer.online ? 'üü¢' : 'üî¥'}\n`;
        ranking += "------------------------\n";
    });
    alert(ranking);
}

 
  
////////////
////////////
////////////
////////////
////////////
////////////

// common.js
// =====‡∑É

// ===== VARI√ÅVEIS GLOBAIS =====
// ===== INICIALIZA√á√ÉO =====


// ===== INICIALIZA√á√ÉO =====
function inicializarSistemaApostasDesafios() {
    console.log("Inicializando sistema de apostas e desafios...");

    limparSalasInvalidas();
    usuarioLogado = window.usuarioLogado || null;
    observarDOMParaBotoes();
    setInterval(() => {
        dados.apostasUsuarios.forEach(sala => verificarEncerramentosAutomaticos(sala, 'apostas'));
        dados.desafiosUsuarios.forEach(sala => verificarEncerramentosAutomaticos(sala, 'desafios'));
        salvarDados();
    }, 300000); // 5 minutos
    console.log("Sistema de apostas e desafios pronto!");
}
// ===== SALVAR DADOS =====
function salvarDados() {
    localStorage.setItem('sistemaTransmissao', JSON.stringify(dados));
    localStorage.setItem('sistemaNotificacoes', JSON.stringify(notificacoes));
    atualizarIndicadoresApostas()
}
// ===== LIMPAR SALAS INV√ÅLIDAS =====
function limparSalasInvalidas() {
    dados.apostasUsuarios = dados.apostasUsuarios.filter(sala => sala.cardId === "card-VHJhbnNt-1" || sala.apostas.length > 0);
    dados.desafiosUsuarios = dados.desafiosUsuarios.filter(sala => sala.cardId === "card-VHJhbnNt-1" || sala.desafios.length > 0);
    salvarDados();
    console.log("Salas inv√°lidas removidas!", { apostasUsuarios: dados.apostasUsuarios, desafiosUsuarios: dados.desafiosUsuarios });
}
// ===== VERIFICAR ENCERRAMENTOS AUTOM√ÅTICOS =====
function verificarEncerramentosAutomaticos(sala, tipo) {
    const agora = new Date();
    const itens = tipo === 'apostas' ? sala.apostas : sala.desafios;
    itens.forEach(item => {
        if (item.status === (tipo === 'apostas' ? 'aberta' : 'aberto') && item.dataEncerramento) {
            const dataEncerramento = new Date(item.dataEncerramento);
            if (dataEncerramento < agora) {
                item.status = tipo === 'apostas' ? 'encerrada' : 'encerrado';
                item.opcaoVencedora = null;
                console.log(`${tipo === 'apostas' ? 'Aposta' : 'Desafio'} ${item.titulo} encerrado automaticamente.`);
            }
        }
    });
    salvarDados();
}
// ===== ADICIONAR BOT√ïES DE APOSTAS E DESAFIOS =====
function adicionarBotoesApostasDesafios() {
    const videoInfos = document.querySelectorAll('.video-info');
    videoInfos.forEach(videoInfo => {
        const container = videoInfo.querySelector('.apostas-desafios-container') || document.createElement('div');
        container.className = 'apostas-desafios-container';
        
        const cardId = gerarCardId(videoInfo);
        const salaApostas = dados.apostasUsuarios.find(s => s.cardId === cardId);
        const salaDesafios = dados.desafiosUsuarios.find(s => s.cardId === cardId);

        // Bot√£o de Apostas
        if (!videoInfo.querySelector('.botao-apostas-custom')) {
            const botaoApostas = document.createElement('button');
            botaoApostas.className = 'botao-apostas-custom';
            botaoApostas.setAttribute('aria-label', 'Abrir sala de apostas');
            botaoApostas.innerHTML = 'üí∞ Apostas';
            if (salaApostas && salaApostas.apostas.length > 0) {
                botaoApostas.classList.add('with-red-dot');
            }
            botaoApostas.addEventListener('click', () => abrirModalApostas(videoInfo));
            container.appendChild(botaoApostas);
        }


        if (!videoInfo.contains(container)) {
            videoInfo.appendChild(container);
        }
    });
}
// ===== OBSERVADOR DE DOM PARA BOT√ïES =====
function observarDOMParaBotoes() {
    adicionarBotoesApostasDesafios();
    const observer = new MutationObserver(adicionarBotoesApostasDesafios);
    observer.observe(document.body, { childList: true, subtree: true });
}
// ===== GERAR CARD ID =====
function gerarCardId(videoInfo) {
    const card = videoInfo.closest('.card');
    if (card && card.id) return card.id;

    let titulo = videoInfo.querySelector('h3, h4, .title, .card-title, .video-title, [data-titulo]')?.textContent?.trim();
    if (!titulo) {
        const cardTitle = card?.querySelector('h3, h4, .title, .card-title, .video-title, [data-titulo]')?.textContent?.trim();
        titulo = card?.dataset?.titulo || cardTitle || 'card';
    }

    const container = videoInfo.closest('.div-horizontal, .live-container, .video-container, .live-grid') || document.body;
    const cards = container.querySelectorAll('.card');
    const index = Array.from(cards).indexOf(card) + 1 || 1;
    const id = `card-${btoa(encodeURIComponent(titulo)).substring(0, 8)}-${index}`;
    
    if (card) card.id = id;
    console.log(`gerarCardId: title=${titulo}, index=${index}, id=${id}, container=${container.className}`);
  //  console.log(`videoInfo HTML: ${videoInfo.outerHTML}`);
    return id;
}
// ===== NOTIFICA√á√ïES =====
function mostrarNotificacao(mensagem, tipo = 'info', targetUser = null) {
    const notificacao = document.createElement('div');
    notificacao.className = `notificacao ${tipo}`;
    notificacao.innerHTML = mensagem;
    document.body.appendChild(notificacao);
    setTimeout(() => notificacao.remove(), 5000);
    if (targetUser && usuarioLogado && usuarioLogado.nome === targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    } else if (!targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    }
}







function atualizarIndicadoresApostas() {
    const videoInfos = document.querySelectorAll('.video-info');

    videoInfos.forEach(videoInfo => {
        const cardId = gerarCardId(videoInfo);
        const salaApostas = dados.apostasUsuarios.find(s => s.cardId === cardId);

        const botaoApostas = videoInfo.querySelector('.botao-apostas-custom');
        if (botaoApostas) {
            const temApostasAbertas = salaApostas && salaApostas.apostas.some(a => a.status === 'aberta');
            const temApostasEncerradas = salaApostas && salaApostas.apostas.some(a => a.status === 'encerrada');

            if (temApostasAbertas || temApostasEncerradas) {
                botaoApostas.classList.add('with-red-dot');
            } else {
                botaoApostas.classList.remove('with-red-dot');
            }
        }
    });
}
// ===== ATUALIZAR INDICADORES DE DESAFIOS (NOVO - SIM√âTRICO A APOSTAS) =====
function atualizarIndicadoresDesafios() {
    const videoInfos = document.querySelectorAll('.video-info');

    videoInfos.forEach(videoInfo => {
        const cardId = gerarCardId(videoInfo);
        const salaDesafios = dados.desafiosUsuarios.find(s => s.cardId === cardId);

        const botaoDesafios = videoInfo.querySelector('.botao-desafios-custom');
        if (botaoDesafios) {
            const temDesafiosAbertos = salaDesafios && salaDesafios.desafios.some(d => d.status === 'aberto');
            const temDesafiosEncerrados = salaDesafios && salaDesafios.desafios.some(d => d.status === 'encerrado');

            if (temDesafiosAbertos || temDesafiosEncerrados) {
                botaoDesafios.classList.add('with-red-dot');
            } else {
                botaoDesafios.classList.remove('with-red-dot');
            }
        }
    });
}

// ===== MODAL DE APOSTAS =====
function abrirModalApostas(videoInfo) {
    // Check if videoInfo is a modal (from logarUsuario)
    const isModal = videoInfo.classList && videoInfo.classList.contains('modal-apostas');
    const effectiveVideoInfo = isModal ? document.querySelector(`.video-info [data-card-id="${videoInfo.querySelector('.modal-content').dataset.cardId}"]`) || videoInfo : videoInfo;

    let cardId = gerarCardId(effectiveVideoInfo);
    console.log("Generated cardId:", cardId);
    if (cardId.startsWith("card-Y2FyZA==")) {
        const expectedSala = dados.apostasUsuarios.find(s => s.cardId === "card-VHJhbnNt-1");
        if (expectedSala) {
            console.log(`Fallback: Using card-VHJhbnNt-1 instead of ${cardId}`);
            cardId = "card-VHJhbnNt-1";
        }
    }
    
    let sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    if (!sala) {
        sala = { cardId, apostas: [], criador: 'Sistema', dataCriacao: new Date().toLocaleString() };
        dados.apostasUsuarios.push(sala);
        salvarDados();
    }
    
    verificarEncerramentosAutomaticos(sala, 'apostas');
    const botaoApostas = effectiveVideoInfo.querySelector('.botao-apostas-custom');
    if (botaoApostas && botaoApostas.classList.contains('with-red-dot')) {
        botaoApostas.classList.remove('with-red-dot');
        console.log(`Ponto vermelho removido do bot√£o do card para cardId=${cardId}`);
    }
    
    console.log("Sala Apostas:", sala);
    let modal = isModal ? videoInfo : document.createElement('div');
    if (!isModal) {
        modal.className = 'modal-apostas';
        modal.setAttribute('role', 'dialog');
        modal.setAttribute('aria-modal', 'true');
    }
    const content = modal.querySelector('.modal-content') || document.createElement('div');
    if (!modal.querySelector('.modal-content')) {
        content.className = 'modal-content';
        content.setAttribute('tabindex', '-1');
        content.dataset.cardId = cardId; // Store cardId for later use
        modal.appendChild(content);
    }
    atualizarConteudoModalApostas(content, cardId, sala, effectiveVideoInfo);
    if (!isModal) {
        document.body.appendChild(modal);
    }
    content.focus();
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}
// ===== ATUALIZA√á√ÉO NA EXIBI√á√ÉO DAS APOSTAS =====
function atualizarConteudoModalApostas(content, cardId, sala, videoInfo) {
    // Filtrar apostas por m√©rito apenas se usu√°rio estiver logado
    const apostasFiltradas = usuarioLogado ? 
        sala.apostas.filter(aposta => {
            const criador = dados.usuarios.find(u => u.nome === aposta.criador);
            return criador && criador.merito === usuarioLogado.merito;
        }) : 
        sala.apostas; // Usu√°rios n√£o logados veem todas as apostas
    
    const chat = dados.chats.find(c => c.cardId === cardId) || { messages: [], voiceParticipants: [] };
    const hasUnreadMessages = chat.messages.some(m => !m.readBy?.includes(usuarioLogado?.nome));
    const hasVoiceParticipants = chat.voiceParticipants?.length > 0;

    content.innerHTML = `
        <div class="modal-header">
            <h3>üí∞ Sala de Apostas</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        ${usuarioLogado ? `
            <div class="user-info">
                <div class="user-details">
                    <span>üë§ ${usuarioLogado.nome}</span>
                    <span>Email: ${usuarioLogado.email}</span>
                    <span>Pontos: ${usuarioLogado.merito}</span>
                    ${usuarioLogado.contaBancaria ? `<span>Conta: ${usuarioLogado.contaBancaria}</span>` : ''}
                    <span>Chave Pix: ${usuarioLogado.chavePix}</span>
                </div>
                <button class="logout-button" onclick="logout()">Sair</button>
            </div>
        ` : `
            <div class="user-info">
                <div class="user-details">
                    <span>üë§ Visitante</span>
                    <span>üí° Voc√™ pode ver apostas e participar de apostas de at√© 50 pontos sem login</span>
                    <button class="login-button" onclick="abrirFormularioLoginApostas('${cardId}')">Fazer Login</button>
                </div>
            </div>
        `}
        <div class="apostas-options">
            ${usuarioLogado ? `
                <button class="create-bet-button" onclick="abrirFormularioCriarAposta('${cardId}')">üéØ Criar Nova Aposta</button>
            ` : `
                <button class="create-bet-button disabled" onclick="mostrarNotificacao('Fa√ßa login para criar apostas', 'erro')">üéØ Criar Nova Aposta</button>
            `}
            <button class="view-bets-button ${apostasFiltradas.length > 0 ? 'with-red-dot' : ''}" onclick="mostrarApostasExistentes('${cardId}')">üìã Ver Apostas (${apostasFiltradas.length})</button>
            ${usuarioLogado ? `
                <button class="open-chat-button ${hasUnreadMessages || hasVoiceParticipants ? 'with-red-dot' : ''}" onclick="abrirChat('${cardId}')">üí¨ Abrir Chat</button>
            ` : ''}
        </div>
        <div class="apostas-list hidden" id="apostas-list-${cardId}">
            <h4>üé≤ Apostas Ativas (${apostasFiltradas.length})</h4>
            ${apostasFiltradas.length === 0 ?
                '<p class="no-apostas">Nenhuma aposta ativa' + (usuarioLogado ? ' com seu m√©rito' : '') + '</p>' :
                apostasFiltradas.map(aposta => {
                    const participacao = usuarioLogado ? aposta.participantes.find(p => p.usuario === usuarioLogado.nome) : null;
                    const isParticipating = !!participacao;
                    const winner = aposta.status === 'encerrada' ? aposta.participantes.find(p => p.opcao === aposta.opcaoVencedora) : null;
                    const winnerUser = winner ? dados.usuarios.find(u => u.nome === winner.usuario) : null;
                    const isWinner = winner && winner.usuario === usuarioLogado?.nome;
                    const isLoser = isParticipating && !isWinner && aposta.status === 'encerrada';
                    const comprovanteEnviado = aposta.comprovantes?.some(c => c.usuario === usuarioLogado?.nome);

                    let resultado = '';
                    if (aposta.status === 'encerrada' && isParticipating) {
                        resultado = isWinner ?
                            '<p class="resultado-ganhou">üéâ Voc√™ ganhou!</p>' :
                            `<p class="resultado-perdeu">üòî Voc√™ perdeu. Envie ${aposta.valor} pontos via Pix para ${winnerUser?.chavePix || 'indefinido'} (vencedor: ${winner?.usuario || 'indefinido'}).</p>`;
                    }

                    return `
                        <div class="aposta-card">
                            <div class="aposta-info">
                                <strong>${aposta.titulo}</strong>
                                ${isParticipating ? `<p class="participacao">‚úÖ Voc√™ est√° participando (Op√ß√£o: ${participacao.opcao})</p>` : ''}
                                ${aposta.descricao ? `<p class="aposta-descricao">${aposta.descricao}</p>` : ''}
                                ${aposta.dataEncerramento ? `<small class="aposta-encerramento">Encerra em: ${new Date(aposta.dataEncerramento).toLocaleString()}</small>` : ''}
                                <p>Op√ß√µes: ${aposta.opcoes.join(', ')}</p>
                                <p>Valor: ${aposta.valor} pontos</p>
                                <p>Participantes: ${aposta.participantes.length}</p>
                                <small>Criado por: ${aposta.criador} em ${aposta.dataCriacao}</small>
                                ${resultado}
                                ${aposta.status === 'encerrada' && winnerUser ? `<p>Chave Pix do vencedor: ${winnerUser.chavePix}</p>` : ''}
                            </div>
                            <div class="aposta-actions">
                                ${aposta.status === "aberta" ? `
                                    ${!usuarioLogado && aposta.valor <= 50 ? `
                                        <button class="participar-button" onclick="abrirFormularioParticiparApostaVisitante('${cardId}', ${aposta.id})">Participar</button>
                                    ` : usuarioLogado ? `
                                        <button class="participar-button" onclick="abrirFormularioParticiparAposta('${cardId}', ${aposta.id})">Participar</button>
                                    ` : `
                                        <button class="participar-button disabled" onclick="mostrarNotificacao('Fa√ßa login para apostar mais de 50 pontos', 'erro')">Participar</button>
                                    `}
                                    ${aposta.criador === usuarioLogado?.nome ? `
                                        <button class="encerrar-button" onclick="abrirFormularioEncerrarAposta('${cardId}', ${aposta.id})">Encerrar</button>
                                    ` : ''}
                                ` : `
                                    <p class="encerrada">‚ùå Encerrada</p>
                                    <p>Vencedor: ${aposta.opcaoVencedora || 'N√£o definido'}</p>
                                    ${isLoser && !comprovanteEnviado ? `
                                        <div class="comprovante-form">
                                            <label for="comprovante-${aposta.id}">Comprovante de Pagamento:</label>
                                            <input type="text" id="comprovante-${aposta.id}" placeholder="Insira o ID da transa√ß√£o">
                                            <button onclick="enviarComprovantePagamento('${cardId}', ${aposta.id})">Enviar Comprovante</button>
                                        </div>
                                    ` : ''}
                                    ${comprovanteEnviado ? `<p>Comprovante enviado: ${aposta.comprovantes.find(c => c.usuario === usuarioLogado.nome)?.comprovante}</p>` : ''}
                                    ${(aposta.criador === usuarioLogado?.nome || isWinner) ? `
                                        <div class="comprovantes-list">
                                            <h5>Comprovantes Recebidos:</h5>
                                            ${aposta.comprovantes?.length > 0 ? aposta.comprovantes.map(c => `
                                                <p>${c.usuario}: ${c.comprovante} (${c.status}) - ${c.data}</p>
                                            `).join('') : '<p>Nenhum comprovante recebido.</p>'}
                                        </div>
                                    ` : ''}
                                `}
                            </div>
                        </div>
                    `;
                }).join('')
            }
        </div>
    `;
    
    content.querySelector('.close-button').addEventListener('click', () => {
        content.closest('.modal-apostas').remove();
    });
    console.log(`Modal rendered for cardId=${cardId}, apostas count=${apostasFiltradas.length}`);
}
// ===== PARTICIPA√á√ÉO PARA VISITANTES (AT√â 50 PONTOS) =====
function abrirFormularioParticiparApostaVisitante(cardId, apostaId) {
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;
    
    // Verificar se a aposta √© de at√© 50 pontos
    if (aposta.valor > 50) {
        mostrarNotificacao('Para apostas acima de 50 pontos √© necess√°rio fazer login!', 'erro');
        abrirFormularioLoginApostas(cardId);
        return;
    }
    
    const content = document.querySelector('.modal-content');
    content.innerHTML = `
        <div class="modal-header">
            <h3>Participar como Visitante - "${aposta.titulo}"</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        <div class="aposta-form-visitante">
            <p>üí∞ Valor da aposta: ${aposta.valor} pontos</p>
            <p>üí° Voc√™ est√° participando como visitante (sem login)</p>
            <label class="form-label" for="opcao-aposta-visitante">Escolha uma op√ß√£o:</label>
            <select class="form-input" id="opcao-aposta-visitante">
                ${aposta.opcoes.map((op, index) => `<option value="${index}">${op}</option>`).join('')}
            </select>
            <div class="form-actions">
                <button class="confirm-button" type="button" onclick="confirmarParticipacaoVisitante('${cardId}', ${apostaId})">Confirmar Aposta</button>
                <button class="cancel-button" type="button" onclick="atualizarConteudoModalApostas(this.closest('.modal-content'), '${cardId}', dados.apostasUsuarios.find(s => s.cardId === '${cardId}'))">Cancelar</button>
            </div>
        </div>
    `;
}
function confirmarParticipacaoVisitante(cardId, apostaId) {
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;

    const opcaoIndex = parseInt(document.getElementById('opcao-aposta-visitante').value);
    if (isNaN(opcaoIndex) || opcaoIndex < 0 || opcaoIndex >= aposta.opcoes.length) {
        mostrarNotificacao('Op√ß√£o inv√°lida!', 'erro');
        return;
    }
    
    const opcaoEscolhida = aposta.opcoes[opcaoIndex];
    
    // Verificar novamente o valor (seguran√ßa)
    if (aposta.valor > 50) {
        mostrarNotificacao('Esta aposta requer login!', 'erro');
        return;
    }
    
    // Participar como "Visitante_[ID]"
    const visitanteId = `Visitante_${Date.now()}`;
    aposta.participantes.push({
        usuario: visitanteId,
        opcao: opcaoEscolhida,
        data: new Date().toLocaleString()
    });
    
    salvarDados();
    mostrarNotificacao(`Voc√™ apostou em "${opcaoEscolhida}" como visitante!`);
    atualizarConteudoModalApostas(document.querySelector('.modal-content'), cardId, sala);
}
// ===== MOSTRAR APOSTAS EXISTENTES =====
function mostrarApostasExistentes(cardId) {
    const apostasList = document.getElementById(`apostas-list-${cardId}`);
    const viewBetsButton = document.querySelector('.view-bets-button');
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    
    // Filtrar apostas conforme o status do usu√°rio
    const apostasFiltradas = usuarioLogado ? 
        sala?.apostas.filter(aposta => {
            const criador = dados.usuarios.find(u => u.nome === aposta.criador);
            return criador && criador.merito === usuarioLogado.merito;
        }) || [] : 
        sala?.apostas || [];

    if (apostasList && viewBetsButton) {
        const isHidden = apostasList.classList.contains('hidden');
        apostasList.classList.toggle('hidden', !isHidden);
        viewBetsButton.textContent = isHidden ? 
            `üìã Ocultar Apostas (${apostasFiltradas.length})` : 
            `üìã Ver Apostas (${apostasFiltradas.length})`;
        if (isHidden && viewBetsButton.classList.contains('with-red-dot')) {
            viewBetsButton.classList.remove('with-red-dot');
            console.log(`Ponto vermelho removido do bot√£o 'Ver Apostas' para cardId=${cardId}`);
        }
    }
}
// ===== FORMUL√ÅRIO DE CRIA√á√ÉO DE APOSTA =====
function abrirFormularioCriarAposta(cardId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para criar apostas!', 'erro');
        abrirFormularioLoginApostas(cardId);
        return;
    }
  
    const content = document.querySelector('.modal-content');
    content.innerHTML = `
        <div class="modal-header">
            <h3>Criar Nova Aposta</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        <form id="form-criar-aposta" class="aposta-form">
            <label class="form-label" for="titulo-aposta">T√≠tulo:</label>
            <input class="form-input" type="text" id="titulo-aposta" required>
            
            <label class="form-label" for="descricao-aposta">Descri√ß√£o (opcional):</label>
            <textarea class="form-input" id="descricao-aposta" rows="3" placeholder="Explica√ß√£o sobre a aposta..."></textarea>
            
            <label class="form-label" for="opcoes-aposta">Op√ß√µes (separadas por v√≠rgula):</label>
            <input class="form-input" type="text" id="opcoes-aposta" required>
            
            <label class="form-label" for="valor-aposta">Valor (pontos):</label>
            <input class="form-input" type="number" id="valor-aposta" min="1" required>
            
            <label class="form-label" for="data-encerramento">Encerramento autom√°tico (opcional):</label>
            <input class="form-input" type="datetime-local" id="data-encerramento" step="1">
            <small>Deixe vazio para encerramento manual.</small>
            
            <div class="form-actions">
                <button class="confirm-button" type="button" onclick="confirmarCriacaoAposta('${cardId}')">Criar</button>
                <button class="cancel-button" type="button" onclick="atualizarConteudoModalApostas(this.closest('.modal-content'), '${cardId}', dados.apostasUsuarios.find(s => s.cardId === '${cardId}'))">Cancelar</button>
            </div>
        </form>
    `;
    content.querySelector('.close-button').addEventListener('click', () => {
        content.closest('.modal-apostas').remove();
    });
}
// ===== CONFIRMA√á√ÉO DE CRIA√á√ÉO DE APOSTA =====
function confirmarCriacaoAposta(cardId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para criar apostas!', 'erro');
        return;
    }
    
    const titulo = document.getElementById('titulo-aposta').value.trim();
    const descricao = document.getElementById('descricao-aposta').value.trim();
    const opcoes = document.getElementById('opcoes-aposta').value.trim();
    const valor = parseInt(document.getElementById('valor-aposta').value);
    const dataEncerramento = document.getElementById('data-encerramento').value ? new Date(document.getElementById('data-encerramento').value).toISOString() : null;
    
    if (!titulo || !opcoes || isNaN(valor) || valor <= 0) {
        mostrarNotificacao('Preencha os campos obrigat√≥rios corretamente!', 'erro');
        return;
    }
    
    if (dataEncerramento && new Date(dataEncerramento) <= new Date()) {
        mostrarNotificacao('A data de encerramento deve ser futura!', 'erro');
        return;
    }
    
    const opcoesArray = opcoes.split(',').map(op => op.trim()).filter(op => op);
    if (opcoesArray.length < 2) {
        mostrarNotificacao('Precisa de pelo menos 2 op√ß√µes!', 'erro');
        return;
    }
    
    if (valor > usuarioLogado.merito) {
        mostrarNotificacao(`Saldo insuficiente! Voc√™ tem ${usuarioLogado.merito} pontos.`, 'erro');
        return;
    }
    
    const novaAposta = {
        id: Date.now(),
        titulo,
        descricao: descricao || null,
        opcoes: opcoesArray,
        valor,
        dataEncerramento,
        criador: usuarioLogado.nome,
        participantes: [],
        status: "aberta",
        dataCriacao: new Date().toLocaleString(),
        opcaoVencedora: null
    };
    
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    if (sala) {
        sala.apostas.push(novaAposta);
    } else {
        dados.apostasUsuarios.push({
            cardId,
            apostas: [novaAposta],
            criador: usuarioLogado.nome,
            dataCriacao: new Date().toLocaleString()
        });
    }
    usuarioLogado.merito -= valor;
    
    salvarDados();
    mostrarNotificacao(`Aposta criada! -${valor} pontos`);
    
    atualizarConteudoModalApostas(document.querySelector('.modal-content'), cardId, dados.apostasUsuarios.find(s => s.cardId === cardId));
}
// ===== FORMUL√ÅRIO PARTICIPAR APOSTA =====
function abrirFormularioParticiparAposta(cardId, apostaId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para participar desta aposta!', 'erro');
        abrirFormularioLoginApostas(cardId);
        return;
    }
    
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;
    
    const content = document.querySelector('.modal-content');
    content.innerHTML = `
        <div class="modal-header">
            <h3>Participar de "${aposta.titulo}"</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        <form id="form-participar-aposta" class="aposta-form">
            <label class="form-label" for="opcao-aposta">Escolha uma op√ß√£o:</label>
            <select class="form-input" id="opcao-aposta">
                ${aposta.opcoes.map((op, index) => `<option value="${index}">${op}</option>`).join('')}
            </select>
            <div class="form-actions">
                <button class="confirm-button" type="button" onclick="confirmarParticipacaoAposta('${cardId}', ${apostaId})">Confirmar</button>
                <button class="cancel-button" type="button" onclick="atualizarConteudoModalApostas(this.closest('.modal-content'), '${cardId}', dados.apostasUsuarios.find(s => s.cardId === '${cardId}'))">Cancelar</button>
            </div>
        </form>
    `;
    content.querySelector('.close-button').addEventListener('click', () => {
        content.closest('.modal-apostas').remove();
    });
}
// ===== CONFIRMA√á√ÉO DE PARTICIPA√á√ÉO =====
function confirmarParticipacaoAposta(cardId, apostaId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para participar!', 'erro');
        return;
    }
    
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;

    // Check if creator's merito matches usuarioLogado.merito
    const criador = dados.usuarios.find(u => u.nome === aposta.criador);
    if (!criador || criador.merito !== usuarioLogado.merito) {
        mostrarNotificacao('Voc√™ s√≥ pode participar de apostas de usu√°rios com o mesmo m√©rito!', 'erro');
        return;
    }

    const opcaoIndex = parseInt(document.getElementById('opcao-aposta').value);
    if (isNaN(opcaoIndex) || opcaoIndex < 0 || opcaoIndex >= aposta.opcoes.length) {
        mostrarNotificacao('Op√ß√£o inv√°lida!', 'erro');
        return;
    }
    const opcaoEscolhida = aposta.opcoes[opcaoIndex];
    if (aposta.participantes.some(p => p.usuario === usuarioLogado.nome)) {
        mostrarNotificacao('Voc√™ j√° participa desta aposta!', 'erro');
        return;
    }
    if (aposta.valor > usuarioLogado.merito) {
        mostrarNotificacao(`Saldo insuficiente! Voc√™ tem ${usuarioLogado.merito} pontos.`, 'erro');
        return;
    }
    aposta.participantes.push({
        usuario: usuarioLogado.nome,
        opcao: opcaoEscolhida,
        data: new Date().toLocaleString()
    });
    usuarioLogado.merito -= aposta.valor;
    salvarDados();
    mostrarNotificacao(`Voc√™ apostou em "${opcaoEscolhida}"! -${aposta.valor} pontos`);
    atualizarConteudoModalApostas(document.querySelector('.modal-content'), cardId, sala);
}

// desafios.js


// desafios.js
// desafios.js
// desafios.js








////////////
////////////
////////////
////////////
////////////
////////////
// chat.js




////////////
////////////
////////////
////////////
////////////
////////////




// ===== ESTILOS GLOBAIS =====
const style = document.createElement('style');
style.innerHTML = `
/* TAMANHOS */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
html, body {
    max-width: 100vw;
   /* width: 100%;*/
    height: 100%;
}
.secao {
 max-width: 100%;
 /*  
    max-width: 100vw;
 */
    min-height: fit-content;
}
.secao-header {
  max-width: 100%;
}
.lives-container {
    max-width: 100%;
    height: auto;
}
header {
    max-width: calc(100vw - 20px);
    width: auto;
}
/* DISPLAY & LAYOUT */
html, body {
   /* overflow-x: hidden;*/
}
header {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}
.secao-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
   /* gap: 15px;*/
}
.secao-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}
.divs-section {
    display: block;
}
.divs-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}
.div-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}
.div-actions {
    display: flex;
    gap: 5px;
    flex-wrap: nowrap;
}
.cards-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px;
    flex-wrap: nowrap;
    
}
.cards-container.layout-colunas {
        grid-template-columns: repeat(2, 1fr);
    }
.layout-horizontal {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px;
    flex-wrap: nowrap;
    
}
.video-card {
    display: flex;
    flex-direction: column;
    flex: 0 0 auto;
    flex-shrink: 0;
    overflow: hidden;

}
.video-actions {
    display: flex;
    gap: 3px;
    flex-shrink: 0;
    
}
.video-footer {
    display: block;
    
}
.empty-state {
    display: block;
    
}
.lives-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 400px), 1fr));
    
    
}
.item-clickable {
    display: block;
    
}
.secao img {
    display: block;
    
}
.jogo-item {
    animation: fadeIn 0.3s ease-in;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
/* OUTRAS PROPRIEDADES */
html, body {
    font-family: Arial, sans-serif;
   
}
body {
    padding: 10px;
   
}
.secao {
    
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin: 0 ;/*auto 15px auto;*/
    padding: 15px;
}
header {
    background: rgba(255, 255, 255, 0.95);
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
   
}
header button {
    padding: 6px 10px;
    font-size: 11px;
    border: none;
    border-radius: 4px;
    background: #2196F3;
    color: white;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.2s ease;
   
}
header button:hover {
    background: #1976D2;
   
}
h1 {
    margin-top: 60px;
    text-align: center;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.secao-header {
   margin-bottom: 20px;
    padding: 10px 0;
    
    border-bottom: 2px solid #e0e0e0;
  
}
.secao-header {
    background: linear-gradient(135deg, #45a049, #4CAF50);
    padding: 15px;
    margin: -15px -15px 20px -15px;
   
   
    border-radius: 8px 8px 0 0;
    border-bottom: none;

}
.secao-buttons button {
    background: rgba(255,255,255,0.9);
    color: #45a049;
    border: 1px solid white;
    font-weight: 600;
    transition: all 0.3s ease;
   /**/
}
.live-title {
    color: #333;
    font-size: 1.3rem;
    font-weight: 700;
    line-height: 1.3;
    word-wrap: break-word;
    overflow-wrap: break-word;
    margin: 0;
  /* */
}
.live-description {
    color: #555;
    font-size: 14px;
    line-height: 1.4;
    word-wrap: break-word;
    overflow-wrap: break-word;
    margin: 8px 0 0 0;
    
    
    
}
.live-meta {
    color: #777;
    font-size: 12px;
    line-height: 1.3;
    margin: 6px 0 0 0;
  
}
.live-status {
    background: #4CAF50;
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    margin-top: 2px;

}
.live-status.inactive {
    background: #ff9800;

}
.divs-section {
    margin-bottom: 20px;

}
.divs-header {
    margin-bottom: 15px;

}
.divs-title {
    color: #2196F3;
    font-size: 1.1rem;
    margin: 0;
    
}
.div-header {
    margin-bottom: 10px;
    
}
.div-title {
    color: #333;
    font-size: 14px;
    word-wrap: break-word;
    margin: 0;
    background-color: #333;
}
.div-count {
    color: #666;
    font-size: 12px;
    margin-left: 6px;
    
}
.div-meta {
    color: #888;
    font-size: 11px;
    margin: 2px 0 0 0;
    
}
.btn {
    padding: 6px 12px;
    font-size: 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.2s ease, transform 0.2s ease;
}
.btn-primary {
    background: #4CAF50;
    color: white;
}
.btn-primary:hover {
    background: #45a049;
    transform: translateY(-1px);
}
.btn-secondary {
    background: #2196F3;
    color: white;
}
.btn-secondary:hover {
    background: #1976D2;
    transform: translateY(-1px);
}
.btn-warning {
    background: #FF9800;
    color: white;
}
.btn-warning:hover {
    background: #F57C00;
    transform: translateY(-1px);
}
.btn-danger {
    background: #f44336;
    color: white;
}
.btn-danger:hover {
    background: #d32f2f;
    transform: translateY(-1px);
}
.btn-large {
    padding: 10px 16px;
    font-size: 14px;
}
.btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none;
}
.secao button {
    padding: 8px 16px;
    font-size: 14px;
    border: none;
    border-radius: 6px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
    margin: 0;
    transition: all 0.3s ease;
}
.secao button:hover {
    background: #45a049;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.secao button:disabled {
    background: #99cccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
.empty-state {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 30px;
    text-align: center;
   background: #f9f9f9;
   
}

.empty-state p {
    color: #666;
    margin: 0 0 15px 0;
    
}

.secao img {
    border-radius: 5px;
    object-fit: cover;
    border: 2px solid #e0e0e0;
    background: linear-gradient(45deg, #f5f5f5, #e0e0e0);
    padding: 2px;
  
}

.item-clickable {
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
    
}

.item-clickable:hover {
    transform: scale(1.02);
    opacity: 0.9;
    
}

.item-clickable:active {
    transform: scale(0.98);
  
}

@media (max-width: 480px) {
    body {
        padding: 5px;
    }

    header {
        position: relative;
        top: auto;
        right: auto;
        max-width: 100%;
        margin-bottom: 10px;
        justify-content: center;
    }

    h1 {
        margin-top: 10px;
        font-size: 1.3em;
    }

    .secao {
        padding: 10px;
        margin-bottom: 10px;
    }

    .secao-buttons {
        flex-direction: column;
        width: 100%;
    }

    .secao-buttons button {
        width: 100%;
        margin: 2px 0;
    }


    .secao button {
        padding: 6px 10px;
        font-size: 11px;
    }
}

/* RESPONSIVIDADE */
@media (max-width: 768px) {
    body {
        padding: 8px;
    }

    header {
        top: 5px;
        right: 5px;
        max-width: calc(100vw - 10px);
        padding: 6px;
    }

    header button {
        padding: 5px 8px;
        font-size: 10px;
    }

    h1 {
        margin-top: 50px;
        font-size: 1.5em;
    }

    .secao {
        padding: 12px;
        margin-bottom: 12px;
    }

    .secao-header {
        flex-direction: column;
        text-align: center;
       /* gap: 10px;*/
    }

    .secao-buttons {
        width: 100%;
        justify-content: center;
    }

    

    .lives-grid {
        grid-template-columns: 1fr;
    }

    



@media (min-width: 1200px) {
    .secao {
        min-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }

}


/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/* DROPDOWN BUTTON - VERS√ÉO REVISADA PRA N√ÉO BUGAR A DIV M√ÉE */
.dropdown {
    position: relative !important;
    display: inline-block !important;
    width: auto;
    isolation: isolate; /* Isola pra evitar heran√ßa do live-card.css */
}

.dropdown-menu {
    position: absolute !important;
    top: calc(100% + 4px) !important; /* Espa√ßo pra n√£o colar no bot√£o */
    right: -10px !important; /* Puxa mais pra direita sem mexer no left */
    margin-right: -20px !important; /* Ajuste fino pra alinhar √† direita */
    z-index: 10000 !important; /* Z-index alto pra ficar por cima */
    display: none;
    min-width: 200px;
    padding: 8px 0;
    margin-top: 0;
    font-size: 14px;
    text-align: left;
    background-color: #ffffff !important; /* Fundo branco pra contrastar com o verde */
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 6px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.175);
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.dropdown-menu.show {
    display: block !important;
    opacity: 1 !important;
    transform: translateY(0) !important;
}

.btn-dropdown {
    background: #6c757d !important;
    color: white !important;
    border: none !important;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 36px;
    box-sizing: border-box;
}

.btn-dropdown:hover {
    background: #5a6268 !important;
    transform: translateY(-1px);
}

.btn-dropdown:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.3);
}

.dropdown-header {
    padding: 8px 16px 4px;
    font-size: 12px;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    background-color: #f8f9fa !important;
}

.dropdown-item {
    display: block !important;
    width: 100% !important;
    padding: 8px 16px !important;
    border: none !important;
    background: none !important;
    text-align: left !important;
    font-size: 13px !important;
    cursor: pointer;
    color: #212529 !important;
    transition: background-color 0.2s ease;
    position: relative !important;
    z-index: 10001 !important; /* Um pouco mais alto que o menu */
}

.dropdown-item:hover {
    background-color: #f1f3f5 !important;
}

.dropdown-divider {
    height: 1px;
    margin: 6px 0;
    background-color: #e9ecef !important;
    border: none;
}

.dropdown-item.text-danger {
    color: #dc3545 !important;
}

.dropdown-item.text-danger:hover {
    background-color: #fce8e6 !important;
}

@keyframes dropdownFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsividade pra n√£o bugar no mobile */
@media (max-width: 768px) {
    .dropdown-menu {
        min-width: 160px;
        right: -155px !important; /* Ajustado pro mobile */
        margin-right: -15px !important; /* Menos deslocamento no mobile */
    }
    .btn-dropdown {
        min-width: 36px;
        padding: 6px 10px;
    }
}

/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/* HEADER ESPEC√çFICO - N√ÉO AFETA OUTRAS DIVS */
header {
    position: fixed ;
    top: 10px ;
    right: 10px ;
    z-index: 1000 ;
    max-width: calc(100vw - 20px) ;
    background: rgba(255, 255, 255, 0.95) ;
    padding: 8px ;
    border-radius: 8px ;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2) ;
    display: flex ;
    gap: 5px ;
    flex-wrap: wrap ;
    align-items: center ;
}

header button {
    padding: 6px 10px ;
    font-size: 11px ;
    border: none ;
    border-radius: 4px ;
    background: #2196F3 ;
    color: white ;
    cursor: pointer ;
    white-space: nowrap ;
    transition: background-color 0.2s ease ;
}

header button:hover {
    background: #1976D2 ;
}

/* √çCONE DE PERFIL NO HEADER */
.profile-icon {
    width: 35px ;
    height: 35px ;
    border-radius: 50% ;
    background: linear-gradient(45deg, #4CAF50, #2196F3) ;
    display: flex ;
    align-items: center ;
    justify-content: center ;
    cursor: pointer ;
    border: 2px solid white ;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2) ;
    transition: transform 0.2s ease ;
    font-weight: bold ;
    color: white ;
    font-size: 16px ;
}

.profile-icon:hover {
    transform: scale(1.1) ;
}

.profile-icon.logged-in {
    background: linear-gradient(45deg, #FF9800, #FF5722) ;
}

/* CONTAINER DE LOGIN FLUTUANTE */
.login-floating {
    position: fixed ;
    top: 60px ;
    right: 10px ;
    background: white ;
    padding: 15px ;
    border-radius: 8px ;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3) ;
    z-index: 1001 ;
    min-width: 200px ;
    border: 2px solid #2196F3 ;
    display: none ;
}

.login-floating.show {
    display: block ;
    animation: slideDown 0.3s ease ;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.login-floating .user-info {
    text-align: center ;
    margin-bottom: 10px ;
    padding-bottom: 10px ;
    border-bottom: 1px solid #e0e0e0 ;
}

.login-floating .user-name {
    font-weight: bold ;
    color: #333 ;
    margin: 0 0 5px 0 ;
    font-size: 14px ;
}

.login-floating .user-merito {
    color: #666 ;
    font-size: 12px ;
    margin: 0 ;
}

.login-floating .user-actions {
    display: flex ;
    flex-direction: column ;
    gap: 5px ;
}

.login-floating button {
    padding: 8px 12px ;
    font-size: 12px ;
    border: none ;
    border-radius: 4px ;
    cursor: pointer ;
    transition: background-color 0.2s ease ;
}

.login-floating .btn-profile {
    background: #4CAF50 ;
    color: white ;
}

.login-floating .btn-pix {
    background: #2196F3 ;
    color: white ;
}

.login-floating .btn-logout {
    background: #f44336 ;
    color: white ;
}

.login-floating .btn-login {
    background: #4CAF50 ;
    color: white ;
    padding: 10px ;
    font-size: 13px ;
}

.login-floating button:hover {
    opacity: 0.9 ;
}

/* OVERLAY PARA FECHAR AO CLICAR FORA */
.overlay {
    position: fixed ;
    top: 0 ;
    left: 0 ;
    width: 100vw ;
    height: 100vh ;
    background: transparent ;
    z-index: 1000 ;
    display: none ;
}

.overlay.show {
    display: block ;
}

/* MEDIA QUERIES PARA O HEADER */
@media (max-width: 768px) {
    header {
        top: 5px ;
        right: 5px ;
        max-width: calc(100vw - 10px) ;
        padding: 6px ;
    }
    
    .profile-icon {
        width: 30px ;
        height: 30px ;
        font-size: 14px ;
    }
    
    .login-floating {
        top: 50px ;
        right: 5px ;
        min-width: 180px ;
    }
}

@media (max-width: 480px) {
    header {
        position: relative ;
        top: auto ;
        right: auto ;
        max-width: 100% ;
        margin-bottom: 10px ;
        justify-content: center ;
    }
    
    .login-floating {
        top: 120px ;
        right: 50% ;
        transform: translateX(50%) ;
        min-width: 200px ;
    }
}


/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/* LAYOUTS DE CARDS - CORRIGIDO */
.cards-container.layout-colunas {
    display: grid;
    grid-template-columns: repeat(var(--colunas, 3), 1fr);
    gap: 10px;
    padding: 10px;
    overflow-y: auto;
    max-height: 100%;

}
    .live-title {
        font-size: 1.1rem;
    }

    .live-description {
        font-size: 12px;
    }

    .video-card {
        min-width: 260px;
    }


.cards-container.layout-colunas {

    padding: 10px;
}

.cards-container.layout-horizontal {
  
    padding: 10px;
}


.video-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    /*background: white;*/
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);

}
    
.video-title {
    font-size: 12px;
    line-height: 1.2;
    margin-bottom: 4px;
    color: #333;

}

.video-author {
    font-size: 10px;
    color: #666;
    margin: 0;

}

.video-footer {
    padding: 4px 8px;
  
    border-top: 1px solid #eee;
    text-align: center;
    background-color: #f5f5f5;
}




.header-live  {
    border-bottom: none;

}
.header-live .secao-header h2 {
    color: white;
    margin: 0;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);

}
.header-live  button {
    background: rgba(255,255,255,0.9);
    color: #45a049;
    border: 1px solid white;
    font-weight: 600;
    transition: all 0.3s ease;

}
.header-live .secao-buttons button:hover {
    background: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);

}
.header-live .secao-header {
        padding: 10px;
        margin: -10px -10px 12px -10px;
    }
.secao img {
    min-width: 200px;
    min-height: 200px;
    max-width: 100vw;
    width: auto;
    height: auto;
}
.live-title {
    width: 100%;
    max-width: 100%;
}
.live-description {
    width: 100%;
    max-width: 100%;
}
.video-card {
   
   width: auto;
    height: auto;
}
.video-title {
    width: 100%;
    max-width: 100%;
}
/* comportamento padr√£o: DESKTOP */
.live-card {
  width: 100%;              /* ocupa toda a largura dispon√≠vel */
  max-width: 100%;          /* n√£o ultrapassa o pai */
  
}
/* MOBILE ‚Äî impedir transbordamento */
@media (max-width: 768px) {
  .live-card {
    max-width: 100vw; /* mant√©m dentro da tela */
    overflow-x: hidden;
  }
}

.live-card {
  flex: 1 1 auto;           /* cresce junto com o pai */
  
  margin: 10px;             /* espa√ßamento visual */
  padding: 10px;
  
  box-sizing: border-box;
}

.live-header-content {
    min-width: 0;
  /*  width: auto;*/
    max-width: 100%;
}
.live-header-content {
    display: block;
    overflow: hidden;
    
}

.live-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
}



.live-status {
    display: inline-block;
    white-space: nowrap;
    flex-shrink: 0;
}
.div-horizontal {
    max-width: 100%;
/*    min-height: 200px;*/
}
.div-horizontal {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 15px;
  
  
  background: #fafafa;
    
  
  
}
.div-horizontal {
    display: flex;
    flex-direction: column;
}
.div-header-content {
    min-width: 200px;

}
.div-header-content {
    display: block;
    overflow: hidden;
    
}
.horizontal-scroll-container {
    width: 100%;
   
}
.horizontal-scroll-container {
    display: block;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
}
.horizontal-scroll-container {
    scrollbar-width: thin;
    scrollbar-color: #c1c1c1 #f1f1f1;
    margin: 0;
    background: #3afafa;
  background: #fafafa;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
}
.horizontal-scroll-container::-webkit-scrollbar {
    height: 8px;
    
}
.horizontal-scroll-container::-webkit-scrollbar-track {
    background: #f971f1;
    border-radius: 4px;
}
.horizontal-scroll-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}
.horizontal-scroll-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
.cards-flex-container {
    min-height: fit-content;
    width: max-content;
    height: auto;
    min-width: 100%;
    
}
.cards-flex-container {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    flex-wrap: wrap;
    align-content: flex-start;
}

.card-size-pequeno {
    width: 135px;
    height: 135px;
}

.card-size-medio {
    width: 180px;
    height: 180px;
}

.card-size-grande {
    width: 225px;
    height: 225px;
}

.card-size-extra-grande {
    width: 270px;
    height: 270px;
}
.video-iframe-container {
    max-width: 100%;
    height: 100%;
    
}
.video-iframe-container {
    display: block;
    overflow: hidden;
    
}
.video-iframe-container {
    background: #000;
}
.video-iframe {
    border: none;
    
}
.video-iframe {
    width: 100%;
    height: 100%;
}
.video-info {
   display: flex;
   
    flex-direction: column;
    justify-content: space-between;
    
}
.video-info {
    padding: 8px;
    
}
.video-info {
    width: 100%;
    height: 30%;
    min-height: 60px;
}

.empty-card {
    min-width: 250px;
    width: 100%;
    height: 100px;
}
.empty-card {
    color: #999;
    font-style: italic;
    border: 1px dashed #ccc;
    border-radius: 6px;
    padding: 20px;
   background: #f9f9f9;
    
}
.empty-card {
    display: flex;
    align-items: center;
    justify-content: center;
    
}

    .live-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .live-header {
    margin-bottom: 15px;

}

    .live-status {
        align-self: flex-start;
    }

    .live-title {
        font-size: 1.2rem;
    }

    .live-description {
        font-size: 13px;
    }

    .divs-title {
        font-size: 1rem;
    }



    .video-card {
        min-width: 280px;
    }

    .btn {
        padding: 8px 12px;
        font-size: 13px;
    }
}


/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */

/* ===== Modal principal ===== */
.modal-sala-webrtc {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  z-index: 10001;
  display: flex;
  flex-direction: column;
  color: white;
  font-family: Arial, sans-serif;
  
  /* üîí ESSENCIAIS para toque */
  pointer-events: auto;
  touch-action: none;
  overscroll-behavior: contain;
}
@media (max-width: 768px) {
  .modal-sala-webrtc {
    position: fixed;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    pointer-events: auto;
    touch-action: none;
  }
}




/* ===== Cabe√ßalho do modal ===== */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  border-bottom: 1px solid #333;
  background: #1a1a1a;
}

.modal-header h3 {
  margin: 0;
  color: #4caf50;
}

.modal-header button {
  background: #f44336;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
}

/* ===== Layout interno ===== */
.modal-content {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* ===== Coluna esquerda ===== */
.col-esquerda {
  flex: 3;
  display: flex;
  flex-direction: column;
  padding: 15px;
  border-right: 1px solid #333;
}

.video-container {
  flex: 1;
  background: #000;
  border-radius: 10px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
}

.video-participant {
  background: #333;
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  min-width: 150px;
}

/* ===== Bot√µes ===== */
.btn-audio {
  flex: 1;
  background: #4caf50;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 5px;
  cursor: pointer;
}

.btn-video {
  flex: 1;
  background: #2196f3;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 5px;
  cursor: pointer;
}

/* ===== Apostas & Desafios ===== */
.section-apostas,
.section-desafios {
  background: #2a2a2a;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 10px;
}

.section-apostas h4 {
  margin: 0 0 10px 0;
  color: #ff9800;
}

.section-desafios h4 {
  margin: 0 0 10px 0;
  color: #9c27b0;
}

.btn-aposta,
.btn-desafio {
  width: 100%;
  color: white;
  border: none;
  padding: 8px;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}

.btn-aposta {
  background: #ff9800;
}

.btn-desafio {
  background: #9c27b0;
}

/* ===== Coluna direita ===== */
.col-direita {
  flex: 2;
  display: flex;
  flex-direction: column;
}

.participantes-header {
  padding: 15px;
  border-bottom: 1px solid #333;
  background: #1a1a1a;
}

.participante-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 5px;
  border-radius: 5px;
  background: #2a2a2a;
  margin: 2px 0;
}

.participante-item .status {
  width: 8px;
  height: 8px;
  background: #4caf50;
  border-radius: 50%;
}

/* ===== Chat ===== */
.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.chat-messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #1a1a1a;
}

.chat-input-area {
  padding: 15px;
  border-top: 1px solid #333;
  background: #2a2a2a;
  display: flex;
  gap: 10px;
}

.chat-input-area input {
  flex: 1;
  padding: 10px;
  border: 1px solid #444;
  border-radius: 5px;
  background: #333;
  color: white;
}

.chat-input-area button {
  background: #4caf50;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
}



/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */




.div-horizontal {
  /*  background:red;*/
}
.apostas-desafios-container {
    display: flex;
  /*  background:red;*/
    gap: 10px;
}
     .modal-apostas, .modal-desafios, .modal-chat {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease-in-out;
    }
    .modal-content {
        background: white;
        padding: 20px;
        border-radius: 12px;
        max-width: 90%;
        width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        gap: 20px;
        box-sizing: border-box;
    }
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
    }
    .modal-header h3 {
        font-size: 1.5rem;
        color: #333;
        margin: 0;
        flex: 1;
        text-align: center;
    }
.close-button {
        background: transparent;
        color: #f44336;
        font-size: 1.2rem;
        font-weight: bold;
        border: 2px solid #f44336;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
    }
    .close-button:hover {
        background: #f44336;
        color: white;
    }
    .user-info {
        background: #f0f4f8;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .user-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
    }
    .user-details span {
        font-size: 1rem;
        color: #333;
        font-weight: 500;
    }
    .logout-button {
        background: #f44336;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        align-self: flex-end;
        font-size: 0.9rem;
        transition: background 0.2s;
    }
    .logout-button:hover {
        background: #d32f2f;
    }
    .apostas-options {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

        .create-bet-button, .view-bets-button, .open-chat-button {
        background: linear-gradient(90deg, #4CAF50, #66BB6A);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        transition: background 0.2s, transform 0.2s;
    }
    
    
.create-challenge-button, .view-challenges-button {
        background: linear-gradient(90deg, #4CAF50, #66BB6A);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        transition: background 0.2s, transform 0.2s;
    }
    
    
    .create-challenge-button:hover, .view-challenges-button:hover {
        background: linear-gradient(90deg, #45a049, #5cb860);
        transform: scale(1.02);
    }
    
        .create-bet-button:hover, .view-bets-button:hover, .open-chat-button:hover {
        background: linear-gradient(90deg, #45a049, #5cb860);
        transform: scale(1.02);
    }
    .open-chat-button {
        background: linear-gradient(90deg, #FF9800, #FFB300);
    }
    .open-chat-button:hover {
        background: linear-gradient(90deg, #F57C00, #FFA000);
    }
    .view-bets-button {
        background: linear-gradient(90deg, #2196F3, #42A5F5);
    }
    .view-bets-button:hover {
        background: linear-gradient(90deg, #1e88e5, #3d9df4);
    }
.view-challenges-button {
        background: linear-gradient(90deg, #2196F3, #42A5F5);
    }
    .view-challenges-button:hover {
        background: linear-gradient(90deg, #1e88e5, #3d9df4);
    }
    .with-red-dot {
        position: relative;
    }
    .with-red-dot::after {
        content: '';
        position: absolute;
        top: -4px;
        right: -4px;
        width: 10px;
        height: 10px;
        background: #f44336;
        border-radius: 50%;
        border: 1px solid white;
        box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
    }
  .apostas-list, .desafios-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}
.apostas-list.hidden, .desafios-list.hidden {
    opacity: 0;
    visibility: hidden;
}
.apostas-list h4, .desafios-list h4 {
    font-size: 1.2rem;
    color: #333;
    margin: 0 0 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid #e0e0e0;
}
    .aposta-card,.desafio-card {
        display: flex;
        flex-direction: row;
        gap: 15px;
        border: 1px solid #e0e0e0;
        padding: 15px;
        border-radius: 8px;
        background: #fafafa;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .aposta-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    .aposta-info strong {
        font-size: 1.1rem;
        color: #333;
        font-weight: 600;
    }
    .aposta-info p {
        margin: 3px 0;
        color: #555;
        font-size: 0.9rem;
    }
    .aposta-info small {
        color: #777;
        font-size: 0.8rem;
    }
    .aposta-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
    }
    .participar-button, .encerrar-button {
        background: #2196F3;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s;
    }
    .encerrar-button {
        background: #f44336;
    }
    .participar-button:hover {
        background: #1e88e5;
    }
    .encerrar-button:hover {
        background: #d32f2f;
    }
    .encerrada {
        color: #f44336;
        margin: 0;
        font-size: 0.9rem;
        font-weight: 500;
    }
    .no-apostas {
        color: #666;
        margin: 0;
        font-size: 0.9rem;
        text-align: center;
        padding: 10px;
    }
    .aposta-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
.form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        font-size: 1rem;
        color: #333;
    }
    .form-input {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 100%;
        font-size: 1rem;
        box-sizing: border-box;
    }
    .form-input:focus {
        outline: none;
        border-color: #4CAF50;
        box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
    }
    .form-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    .confirm-button {
        background: #4CAF50;
        color: white;
        padding: 8px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        flex: 1;
        font-size: 1rem;
        transition: background 0.2s;
    }
    .confirm-button:hover {
        background: #45a049;
    }
    .cancel-button {
        background: #f44336;
        color: white;
        padding: 8px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        flex: 1;
        font-size: 1rem;
        transition: background 0.2s;
    }
    .cancel-button:hover {
        background: #d32f2f;
    }
    .login-form, .comprovante-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
        text-align: center;
        padding: 20px;
    }
    .login-form h3 {
        font-size: 1.5rem;
        color: #333;
        margin: 0;
    }
.login-form p {
        color: #555;
        font-size: 1rem;
        margin: 5px 0;
    }
    .login-form input {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
        box-sizing: border-box;
    }
    .login-form button {
        background: #4CAF50;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
    }
    .login-form button:hover {
        background: #45a049;
    }
    .apostas-container {
        display: flex;
        gap: 5px;
        margin-top: 5px;
        flex-wrap: wrap;
    }
    .botao-apostas-custom,.botao-desafios-custom {
        background: #FF9800;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        min-width: 100px;
        transition: background 0.2s, transform 0.2s;
        position: relative;
    }
    .botao-apostas-custom,.botao-desafios-custom:hover {
        background: #F57C00;
        transform: scale(1.05);
    }
    
        .comprovantes-list {
        margin-top: 10px;
        padding: 10px;
        border-top: 1px solid #ccc;
    }
    .resultado-ganhou {
        color: green;
        font-weight: bold;
    }
    .resultado-perdeu {
        color: red;
        font-weight: bold;
    }
    
    .notificacao {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 5px;
        color: white;
        background: #4CAF50;
        z-index: 10001;
        animation: slideIn 0.3s ease-in-out;
        font-size: 1rem;
    }
    .notificacao.erro {
        background: #f44336;
    }
    
    
        .chat-modal {
        background: white;
        padding: 20px;
        border-radius: 12px;
        max-width: 90%;
        width: 600px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .chat-messages {
        max-height: 50vh;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background: #f9f9f9;
    }
    .chat-message {
        padding: 8px;
        margin: 5px 0;
        border-radius: 5px;
        background: #e0f7fa;
        font-size: 0.9rem;
    }
    .chat-message.own {
        background: #c8e6c9;
        margin-left: 20%;
    }
    .chat-input {
        display: flex;
        gap: 10px;
    }
    .chat-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
    }
    .chat-input button {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
    }
    .chat-input button:hover {
        background: #45a049;
    }
    .voice-controls {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    .voice-controls button {
        background: #2196F3;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
    }
    .voice-controls button:hover {
        background: #1e88e5;
    }
    .voice-controls button:disabled {
        background: #b0bec5;
        cursor: not-allowed;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
   @keyframes slideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 800px) {
        .modal-content {
            width: 95%;
            padding: 15px;
            max-height: 90vh;
        }
        .modal-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
        .user-details {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        .apostas-options {
            flex-direction: column;
            gap: 10px;
        }
        .aposta-card {
            flex-direction: column;
            gap: 10px;
        }
        .form-actions {
            flex-direction: column;
            gap: 8px;
        }
        .botao-apostas-custom {
            font-size: 11px;
            padding: 6px 10px;
            min-width: 90px;
        }
        .create-bet-button, .view-bets-button {
            font-size: 0.9rem;
            padding: 10px;
        }
        .aposta-info strong {
            font-size: 1rem;
        }
        .aposta-info p, .aposta-info small {
            font-size: 0.85rem;
        }
        .participar-button, .encerrar-button {
            font-size: 0.85rem;
            padding: 6px 10px;
        }
        .confirm-button, .cancel-button {
            font-size: 0.9rem;
            padding: 8px;
        }
        .form-label {
            font-size: 0.9rem;
        }
        .form-input {
            font-size: 0.9rem;
        }
        
        .chat-float-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: #25D366;
    color: white;
    border-radius: 50%;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 999;
    transition: all 0.3s;
}

.chat-float-btn:hover {
    transform: scale(1.1);
    background: #128C7E;
}

.chat-window {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 320px;
    height: 450px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    z-index: 998;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

.chat-header {
    background: #25D366;
    color: white;
    padding: 12px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chat-close {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
}

.chat-body {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: #f4f4f4;
}

.chat-footer {
    padding: 10px;
    background: white;
    display: flex;
    gap: 8px;
    border-top: 1px solid #ddd;
}

.chat-footer input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 20px;
    outline: none;
}

.chat-footer button {
    padding: 10px 16px;
    background: #25D366;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
}
.btn-chat {
    background: #25D366;
    color: white;
}
    }
`;
document.head.appendChild(style);
/*
// modalChatJogo.js
class ModalChatJogo {
    constructor(jogoId, jogoNome) {
        this.jogoId = jogoId;
        this.jogoNome = jogoNome;
        this.salaId = `jogo-${jogoId}`;
        this.peers = new Map();
        this.localStream = null;
        this.isAudioEnabled = false;
        this.socket = null;
        this.init();
    }

    init() {
        this.createModal();
        this.initializeSocket();
    }

    initializeSocket() {
        // Verificar se o socket global existe
        if (typeof socket !== 'undefined' && socket) {
            this.socket = socket;
            this.setupSocketListeners();
            this.joinRoom();
        } else {
            // Tentar inicializar o socket
            this.initializeSocketConnection();
        }
    }

    initializeSocketConnection() {
        // Inicializar conex√£o Socket.IO se n√£o existir
        try {
            this.socket = io();
            this.setupSocketListeners();
            this.joinRoom();
            
            // Salvar no escopo global para reutiliza√ß√£o
            window.socket = this.socket;
            
        } catch (error) {
            console.error('Erro ao conectar com Socket.IO:', error);
            this.showError('Erro de conex√£o. Recarregue a p√°gina e tente novamente.');
        }
    }

    setupSocketListeners() {
        if (!this.socket) {
            console.error('Socket n√£o dispon√≠vel');
            return;
        }

        // Listeners do Socket.IO para chat de jogo
        this.socket.on('chat-jogo-message', (data) => {
            this.displayMessage(data);
        });

        this.socket.on('chat-jogo-users-update', (data) => {
            this.updateUsersList(data.users);
        });

        this.socket.on('chat-jogo-history', (data) => {
            this.loadChatHistory(data.messages);
        });

        // WebRTC Signaling
        this.socket.on('webrtc-offer', (data) => this.handleOffer(data));
        this.socket.on('webrtc-answer', (data) => this.handleAnswer(data));
        this.socket.on('webrtc-ice-candidate', (data) => this.handleICECandidate(data));
        this.socket.on('user-joined-voice', (data) => this.handleUserJoinedVoice(data));
        this.socket.on('user-left-voice', (data) => this.handleUserLeftVoice(data));

        // Listeners de conex√£o
        this.socket.on('connect', () => {
            console.log('Conectado ao servidor Socket.IO');
            this.updateConnectionStatus(true);
        });

        this.socket.on('disconnect', () => {
            console.log('Desconectado do servidor Socket.IO');
            this.updateConnectionStatus(false);
        });

        this.socket.on('connect_error', (error) => {
            console.error('Erro de conex√£o Socket.IO:', error);
            this.updateConnectionStatus(false);
        });
    }

    updateConnectionStatus(connected) {
        const statusElement = document.getElementById('connection-status');
        if (!statusElement) return;

        if (connected) {
            statusElement.innerHTML = 'üü¢ Conectado';
            statusElement.style.color = '#28a745';
        } else {
            statusElement.innerHTML = 'üî¥ Desconectado';
            statusElement.style.color = '#dc3545';
        }
    }

    showError(message) {
        const messagesContainer = document.getElementById('chat-messages');
        if (messagesContainer) {
            messagesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #dc3545;">
                    <div>‚ùå ${message}</div>
                    <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Recarregar P√°gina
                    </button>
                </div>
            `;
        }
    }

    createModal() {
        // Remove modal existente se houver
        const existingModal = document.getElementById('modal-chat-jogo');
        if (existingModal) existingModal.remove();

        const modalHTML = `
        <div id="modal-chat-jogo" class="modal-chat-jogo" style="
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; max-width: 600px; height: 70vh;
            background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000; display: flex; flex-direction: column;
            font-family: Arial, sans-serif;
        ">
            <!-- Header -->
            <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #007bff; color: white; border-radius: 12px 12px 0 0;">
                <div>
                    <h3 style="margin: 0; font-size: 1.2em;">üí¨ Chat - ${this.jogoNome}</h3>
                    <div id="connection-status" style="font-size: 0.7em; opacity: 0.9;">üü¢ Conectando...</div>
                </div>
                <button id="close-chat-modal" style="background: none; border: none; color: white; font-size: 1.5em; cursor: pointer;">√ó</button>
            </div>

            <!-- Content -->
            <div style="flex: 1; display: flex; height: calc(100% - 120px);">
                <!-- Lista de Usu√°rios -->
                <div style="width: 200px; border-right: 1px solid #eee; padding: 10px; background: #f8f9fa;">
                    <h4 style="margin: 0 0 10px 0; color: #555;">üë• Online</h4>
                    <div id="chat-users-list" style="font-size: 0.9em;">
                        <div style="padding: 5px; color: #28a745;">‚óè Voc√™</div>
                    </div>
                </div>

                <!-- √Årea do Chat -->
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <!-- Mensagens -->
                    <div id="chat-messages" style="flex: 1; padding: 15px; overflow-y: auto; background: white;">
                        <div style="text-align: center; padding: 20px; color: #666;">
                            Conectando ao chat...
                        </div>
                    </div>
                    
                    <!-- Controles de √Åudio -->
                    <div style="padding: 10px; border-top: 1px solid #eee; background: #f8f9fa; display: flex; gap: 10px; align-items: center;">
                        <button id="toggle-audio" style="padding: 8px 12px; border: 1px solid #dc3545; background: #dc3545; color: white; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                            üé§ Ativar Voz
                        </button>
                        <div id="audio-status" style="font-size: 0.8em; color: #666;">
                            √Åudio: Desativado
                        </div>
                    </div>

                    <!-- Input de Mensagem -->
                    <div style="padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px;">
                        <input type="text" id="chat-message-input" placeholder="Digite sua mensagem..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 0.9em;">
                        <button id="send-message" style="padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                            Enviar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-chat-backdrop" style="
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 9999;
        "></div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        this.setupEventListeners();
    }

    setupEventListeners() {
        // Fechar modal
        document.getElementById('close-chat-modal').onclick = () => this.close();
        document.getElementById('modal-chat-backdrop').onclick = () => this.close();

        // Enviar mensagem
        document.getElementById('send-message').onclick = () => this.sendMessage();
        document.getElementById('chat-message-input').onkeypress = (e) => {
            if (e.key === 'Enter') this.sendMessage();
        };

        // Controle de √°udio
        document.getElementById('toggle-audio').onclick = () => this.toggleAudio();
    }

    joinRoom() {
        if (!this.socket || !this.socket.connected) {
            console.error('Socket n√£o conectado');
            return;
        }

        // Entrar na sala do jogo
        this.socket.emit('join-jogo-chat', {
            jogoId: this.jogoId,
            salaId: this.salaId,
            usuario: this.getUsuarioAtual()
        });

        // Solicitar hist√≥rico
        this.socket.emit('request-jogo-chat-history', { salaId: this.salaId });
    }

    getUsuarioAtual() {
        // Tenta obter o usu√°rio de diferentes fontes
        if (typeof usuarioAtual !== 'undefined' && usuarioAtual) {
            return usuarioAtual.nome || 'An√¥nimo';
        }
        
        if (typeof currentUser !== 'undefined' && currentUser) {
            return currentUser.nome || 'An√¥nimo';
        }
        
        return 'An√¥nimo';
    }

    sendMessage() {
        if (!this.socket || !this.socket.connected) {
            this.showError('N√£o conectado ao servidor. Tente novamente.');
            return;
        }

        const input = document.getElementById('chat-message-input');
        const message = input.value.trim();
        
        if (!message) return;

        this.socket.emit('chat-jogo-message', {
            salaId: this.salaId,
            mensagem: message,
            usuario: this.getUsuarioAtual(),
            jogoId: this.jogoId
        });

        input.value = '';
    }

    displayMessage(data) {
        const messagesContainer = document.getElementById('chat-messages');
        if (!messagesContainer) return;

        // Limpar mensagem de "conectando" se for a primeira mensagem
        if (messagesContainer.children.length === 1 && 
            messagesContainer.children[0].textContent.includes('Conectando')) {
            messagesContainer.innerHTML = '';
        }

        const messageEl = document.createElement('div');
        messageEl.style.padding = '8px 0';
        messageEl.style.borderBottom = '1px solid #f0f0f0';
        
        const time = new Date(data.data).toLocaleTimeString();
        messageEl.innerHTML = `
            <strong style="color: #007bff;">${data.usuario}</strong>
            <span style="font-size: 0.8em; color: #666; margin-left: 10px;">${time}</span>
            <div style="margin-top: 2px; color: #333;">${this.escapeHtml(data.mensagem)}</div>
        `;

        messagesContainer.appendChild(messageEl);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    loadChatHistory(messages) {
        const messagesContainer = document.getElementById('chat-messages');
        if (!messagesContainer) return;

        messagesContainer.innerHTML = '';
        
        if (messages.length === 0) {
            messagesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #666;">
                    Nenhuma mensagem ainda. Seja o primeiro a conversar!
                </div>
            `;
            return;
        }
        
        messages.forEach(message => this.displayMessage(message));
    }

    updateUsersList(users) {
        const usersList = document.getElementById('chat-users-list');
        if (!usersList) return;

        const currentUser = this.getUsuarioAtual();
        usersList.innerHTML = `<div style="padding: 5px; color: #28a745;">‚óè ${currentUser}</div>`;
        
        users.forEach(user => {
            if (user !== currentUser) {
                const userEl = document.createElement('div');
                userEl.style.padding = '5px';
                userEl.style.display = 'flex';
                userEl.style.alignItems = 'center';
                userEl.style.gap = '5px';
                userEl.innerHTML = `
                    <span style="color: #28a745;">‚óè</span>
                    <span>${user}</span>
                    <span id="voice-indicator-${user}" style="margin-left: auto; font-size: 0.8em; color: #007bff; display: none;">üé§</span>
                `;
                usersList.appendChild(userEl);
            }
        });
    }

    async toggleAudio() {
        if (!this.socket || !this.socket.connected) {
            this.showError('N√£o conectado ao servidor. Ative a conex√£o primeiro.');
            return;
        }

        const button = document.getElementById('toggle-audio');
        const status = document.getElementById('audio-status');

        if (!this.isAudioEnabled) {
            try {
                // Verificar permiss√µes primeiro
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Navegador n√£o suporta acesso ao microfone');
                }

                this.localStream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }, 
                    video: false 
                });
                
                this.isAudioEnabled = true;
                button.innerHTML = 'üé§ Desativar Voz';
                button.style.background = '#28a745';
                button.style.borderColor = '#28a745';
                status.innerHTML = '√Åudio: Ativado';
                status.style.color = '#28a745';

                // Notificar outros usu√°rios
                this.socket.emit('join-voice-chat', {
                    salaId: this.salaId,
                    usuario: this.getUsuarioAtual()
                });

            } catch (error) {
                console.error('Erro ao acessar microfone:', error);
                this.showError('N√£o foi poss√≠vel acessar o microfone. Verifique as permiss√µes do navegador.');
            }
        } else {
            // Desativar √°udio
            this.deactivateAudio();
        }
    }

    deactivateAudio() {
        if (this.localStream) {
            this.localStream.getTracks().forEach(track => track.stop());
            this.localStream = null;
        }

        // Desconectar de todos os peers
        this.peers.forEach(peer => peer.close());
        this.peers.clear();

        this.isAudioEnabled = false;
        
        const button = document.getElementById('toggle-audio');
        const status = document.getElementById('audio-status');
        
        if (button) {
            button.innerHTML = 'üé§ Ativar Voz';
            button.style.background = '#dc3545';
            button.style.borderColor = '#dc3545';
        }
        
        if (status) {
            status.innerHTML = '√Åudio: Desativado';
            status.style.color = '#666';
        }

        // Notificar outros usu√°rios
        if (this.socket) {
            this.socket.emit('leave-voice-chat', {
                salaId: this.salaId,
                usuario: this.getUsuarioAtual()
            });
        }
    }

    // ... (restante dos m√©todos WebRTC permanecem iguais)

    close() {
        // Sair da sala
        if (this.socket) {
            this.socket.emit('leave-jogo-chat', {
                salaId: this.salaId,
                usuario: this.getUsuarioAtual()
            });
        }

        // Sair do chat de voz se estiver ativo
        this.deactivateAudio();

        // Remover listeners do socket
        if (this.socket) {
            this.socket.off('chat-jogo-message');
            this.socket.off('chat-jogo-users-update');
            this.socket.off('chat-jogo-history');
            this.socket.off('webrtc-offer');
            this.socket.off('webrtc-answer');
            this.socket.off('webrtc-ice-candidate');
            this.socket.off('user-joined-voice');
            this.socket.off('user-left-voice');
        }

        // Remover modal
        const modal = document.getElementById('modal-chat-jogo');
        const backdrop = document.getElementById('modal-chat-backdrop');
        if (modal) modal.remove();
        if (backdrop) backdrop.remove();

        // Limpar refer√™ncia
        window.modalChatAtual = null;
    }

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// Fun√ß√£o global para abrir o chat do jogo
function entrarSalaJogo(jogoId) {
    const jogo = window.dados?.jogos?.find(j => j.id === jogoId);
    if (!jogo) {
        alert('Jogo n√£o encontrado');
        return;
    }

    // Fechar modal existente se houver
    if (window.modalChatAtual) {
        window.modalChatAtual.close();
    }

    // Criar nova inst√¢ncia do modal
    window.modalChatAtual = new ModalChatJogo(jogoId, jogo.nome);
}

// Fun√ß√£o para abrir o chat do jogo (chamada pelo bot√£o)
function entrarSalaJogo(jogoId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return;

    // Fechar modal existente se houver
    if (modalChatAtual) {
        modalChatAtual.close();
    }

    modalChatAtual = new ModalChatJogo(jogoId, jogo.nome);
}


// globalChatInjetado.js - Adicionar esta fun√ß√£o

function entrarSalaJogo(jogoId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) {
        mostrarNotificacao('Jogo n√£o encontrado', 'erro');
        return;
    }

    // Fechar modal existente se houver
    if (typeof window.modalChatAtual !== 'undefined' && window.modalChatAtual) {
        window.modalChatAtual.close();
    }

    // Criar nova inst√¢ncia do modal
    window.modalChatAtual = new ModalChatJogo(jogoId, jogo.nome);
}


// Inicializa√ß√£o segura do Socket.IO (adicionar no main.js ou no in√≠cio do script)
function initializeSocketIO() {
    if (typeof io === 'undefined') {
        console.error('Socket.IO n√£o carregado. Verifique se o script foi inclu√≠do.');
        return null;
    }
    
    try {
        const socket = io();
        
        socket.on('connect', () => {
            console.log('‚úÖ Conectado ao servidor Socket.IO');
        });
        
        socket.on('disconnect', () => {
            console.log('‚ùå Desconectado do servidor Socket.IO');
        });
        
        socket.on('connect_error', (error) => {
            console.error('‚ùå Erro de conex√£o Socket.IO:', error);
        });
        
        return socket;
    } catch (error) {
        console.error('‚ùå Erro ao inicializar Socket.IO:', error);
        return null;
    }
}

// Inicializar automaticamente se n√£o existir
if (typeof socket === 'undefined') {
    window.socket = initializeSocketIO();
}


*/


// ===== SISTEMA DE SESS√ÉO UNIFICADO =====
function salvarSessao() {
    const sessao = {
        usuarioLogado: usuarioLogado,
        streamerLogado: streamerLogado,
        timestamp: new Date().getTime()
    };
    localStorage.setItem('sistemaSessao', JSON.stringify(sessao));
}
function carregarSessao() {
    const sessaoSalva = localStorage.getItem('sistemaSessao');
    if (sessaoSalva) {
        const sessao = JSON.parse(sessaoSalva);
        
        const agora = new Date().getTime();
        const diffHoras = (agora - sessao.timestamp) / (1000 * 60 * 60);
        
        if (diffHoras < 24) {
            usuarioLogado = sessao.usuarioLogado;
            streamerLogado = sessao.streamerLogado;
            
            if (streamerLogado) {
                streamerLogado.online = true;
            }
        } else {
            limparSessao();
        }
    }
}
function limparSessao() {
    localStorage.removeItem('sistemaSessao');
    usuarioLogado = null;
    streamerLogado = null;
}
// ===== LOGIN PRINCIPAL =====
function fazerLogin() {
    const tipo = prompt("Voc√™ √©:\n1 - Usu√°rio\n2 - Streamer\n\nDigite 1 ou 2:");
    
    if (tipo === "1") {
        loginUsuario();
    } else if (tipo === "2") {
        loginStreamer();
    } else {
        alert("Op√ß√£o inv√°lida!");
    }
}
function loginUsuario() {
    const usuario = prompt("Usu√°rio:");
    if (!usuario) {
        alert("Usu√°rio √© obrigat√≥rio!");
        return;
    }
    
    const senha = prompt("Senha:");
    if (!senha) {
        alert("Senha √© obrigat√≥ria!");
        return;
    }
    
    const usuarioEncontrado = dados.usuarios.find(u => u.usuario === usuario && u.senha === senha);
    
    if (usuarioEncontrado) {
        usuarioLogado = usuarioEncontrado;
        salvarSessao();
        alert(`Bem-vindo, ${usuarioLogado.nome}!`);
        atualizarInterfaceLogin();
    } else {
        if (confirm("Usu√°rio n√£o encontrado. Deseja criar uma nova conta?")) {
            criarNovoUsuario(usuario, senha);
        }
    }
}
function loginStreamer() {
    const usuario = prompt("Usu√°rio do Streamer:");
    if (!usuario) {
        alert("Usu√°rio √© obrigat√≥rio!");
        return;
    }
    
    const senha = prompt("Senha:");
    if (!senha) {
        alert("Senha √© obrigat√≥ria!");
        return;
    }
    
    const streamerEncontrado = encontrarStreamerGlobal(usuario, senha);
    
    if (streamerEncontrado) {
        streamerLogado = streamerEncontrado;
        streamerLogado.online = true;
        salvarSessao();
        alert(`Bem-vindo, Streamer ${streamerLogado.nome}!`);
        atualizarInterfaceLogin();
    } else {
        if (confirm("Streamer n√£o encontrado. Deseja criar uma nova conta de streamer?")) {
            criarNovoStreamer(usuario, senha);
        }
    }
}
// ===== LOGOUT UNIFICADO =====
function logout() {
    if (usuarioLogado) {
        alert(`At√© logo, ${usuarioLogado.nome}!`);
        usuarioLogado = null;
    }
    if (streamerLogado) {
        streamerLogado.online = false;
        alert(`At√© logo, Streamer ${streamerLogado.nome}!`);
        streamerLogado = null;
    }
    
    limparSessao();
    atualizarInterfaceLogin();
    
    const floatingMenu = document.getElementById('loginFloating');
    const overlay = document.getElementById('overlay');
    if (floatingMenu) floatingMenu.classList.remove('show');
    if (overlay) overlay.classList.remove('show');
}

// ===== INICIAR SISTEMA =====
if (document.readyState === 'loading') {
 //   document.addEventListener('DOMContentLoaded', inicializarSistemaApostas);
   document.addEventListener('DOMContentLoaded',inicializarSistemaApostasDesafios);
} else {
  //  inicializarSistemaApostas();
    inicializarSistemaApostasDesafios();
}

// ===== CRIA√á√ÉO DE CONTAS =====
function criarNovoUsuario(usuario, senha) {
    const nome = prompt("Seu nome completo:");
    if (!nome) return;
    
    const confirmarSenha = prompt("Confirme a senha:");
    if (senha !== confirmarSenha) {
        alert("As senhas n√£o coincidem!");
        return;
    }
    
    const novoUsuario = {
        id: Date.now(),
        nome: nome,
        usuario: usuario,
        senha: senha,
        imagem: "default-usuario.png",
        chavePix: "",
        merito: 100,
        desafiosCumpridos: 0,
        desafiosFalhados: 0,
        pagamentosRealizados: 0,
        pagamentosPendentes: 0,
        amigos: [],
        dataCriacao: new Date().toLocaleString()
    };
    
    dados.usuarios.push(novoUsuario);
    usuarioLogado = novoUsuario;
    salvarSessao();
    salvarDados();
    
    alert(`Conta criada com sucesso! Bem-vindo, ${nome}!\n\nUsu√°rio: ${usuario}\nSenha: ${senha}\nM√©rito inicial: 100 pontos`);
    atualizarInterfaceLogin();
}
function criarNovoStreamer(usuario, senha) {
    const nome = prompt("Nome do Streamer:");
    if (!nome) return;
    
    const confirmarSenha = prompt("Confirme a senha:");
    if (senha !== confirmarSenha) {
        alert("As senhas n√£o coincidem!");
        return;
    }
    
    if (!dados.jogos.length) {
        alert("Primeiro crie um jogo, est√°dio e time!");
        return;
    }
    
    const novostreamer = {
        id: Date.now(),
        nome: nome,
        usuario: usuario,
        senha: senha,
        imagem: "default-streamer.png",
        chavePix: "",
        online: true,
        merito: 500,
        videos: [],
        desafiosRecebidos: [],
        desafiosEnviados: []
    };
    
    const novaLive = criarLiveParaStreamer(nome, usuario, novostreamer);
    
    streamerLogado = novostreamer;
    salvarSessao();
    salvarDados();
    
    alert(`Streamer e live criados com sucesso!\n\nStreamer: ${nome}\nUsu√°rio: ${usuario}\nSenha: ${senha}\nLive criada automaticamente!`);
    atualizarInterfaceLogin();
    
    mostrarSecao('lives');
    carregarLivesDoTime(dados.jogos[0].id, dados.jogos[0].estadios[0].id, dados.jogos[0].estadios[0].times[0].id);
}
// ===== SISTEMA DE PIX UNIFICADO =====
function configurarChavePix() {
    const usuario = usuarioLogado || streamerLogado;
    if (!usuario) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    const chaveAtual = usuario.chavePix || "N√£o configurada";
    const novaChave = prompt(`Sua chave PIX atual: ${chaveAtual}\n\nNova chave PIX (email, telefone, CPF, ou chave aleat√≥ria):\nDeixe em branco para remover:`, usuario.chavePix);
    
    if (novaChave !== null) {
        usuario.chavePix = novaChave.trim();
        salvarSessao();
        salvarDados();
        
        if (usuario.chavePix) {
            alert(`Chave PIX atualizada: ${usuario.chavePix}`);
        } else {
            alert("Chave PIX removida.");
        }
    }
}
// ===== INTERFACE DE USU√ÅRIO =====
function atualizarInterfaceLogin() {
    atualizarMenuPerfil();
    
    const floatingMenu = document.getElementById('loginFloating');
    const overlay = document.getElementById('overlay');
    if (floatingMenu) floatingMenu.classList.remove('show');
    if (overlay) overlay.classList.remove('show');
}
function toggleProfileMenu() {
    const floatingMenu = document.getElementById('loginFloating');
    const overlay = document.getElementById('overlay');
    const profileIcon = document.getElementById('profileIcon');
    
    if (floatingMenu && floatingMenu.classList.contains('show')) {
        floatingMenu.classList.remove('show');
        if (overlay) overlay.classList.remove('show');
    } else {
        atualizarMenuPerfil();
        if (floatingMenu) floatingMenu.classList.add('show');
        if (overlay) overlay.classList.add('show');
    }
}
function atualizarMenuPerfil() {
    const floatingMenu = document.getElementById('loginFloating');
    const profileIcon = document.getElementById('profileIcon');
    
    if (!floatingMenu || !profileIcon) return;
    
    if (usuarioLogado || streamerLogado) {
        const usuario = usuarioLogado || streamerLogado;
        const tipo = usuarioLogado ? 'üë§ Usu√°rio' : 'üé• Streamer';
        
        profileIcon.textContent = usuarioLogado ? 'üë§' : 'üé•';
        profileIcon.classList.add('logged-in');
        
        floatingMenu.innerHTML = `
            <div class="user-info">
                <p class="user-name">${usuario.nome}</p>
                <p class="user-merito">${tipo} | M√©rito: ${usuario.merito}</p>
            </div>
            <div class="user-actions">
                <button class="btn-profile" onclick="verPerfilCompleto(); toggleProfileMenu()">Ver Perfil</button>
                <button class="btn-pix" onclick="configurarChavePix(); toggleProfileMenu()">Configurar PIX</button>
                <button class="btn-logout" onclick="logout(); toggleProfileMenu()">Sair</button>
            </div>
        `;
    } else {
        profileIcon.textContent = 'üë§';
        profileIcon.classList.remove('logged-in');
        
        floatingMenu.innerHTML = `
            <div class="user-actions">
                <button class="btn-login" onclick="fazerLogin(); toggleProfileMenu()">Fazer Login</button>
            </div>
        `;
    }
}
// ===== FUN√á√ïES AUXILIARES =====
function encontrarStreamerGlobal(usuario, senha) {
    for (const jogo of dados.jogos) {
        for (const estadio of jogo.estadios) {
            for (const time of estadio.times) {
                if (time.lives) {
                    for (const live of time.lives) {
                        if (live.streamers) {
                            const streamer = live.streamers.find(s => 
                                s.usuario === usuario && s.senha === senha
                            );
                            if (streamer) return streamer;
                        }
                    }
                }
            }
        }
    }
    return null;
}
function criarLiveParaStreamer(nomeStreamer, usuario, streamer) {
    const jogo = dados.jogos[0];
    const estadio = jogo.estadios[0];
    const time = estadio.times[0];
    
    const novaLive = {
        id: Date.now(),
        titulo: `Live de ${nomeStreamer}`,
        descricao: "Nova live criada automaticamente",
        status: "ativa",
        imagem: "default-live.png",
        criador: usuario,
        cards: [],
        streamers: [streamer],
        usuariosOnline: [],
        dataCriacao: new Date().toLocaleString()
    };
    
    if (!time.lives) time.lives = [];
    time.lives.push(novaLive);
    
    return novaLive;
}
// ===== PERFIL COMPLETO =====
function verPerfilCompleto() {
    const usuario = usuarioLogado || streamerLogado;
    if (!usuario) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    let perfil = `=== PERFIL ===\n\n`;
    perfil += `Nome: ${usuario.nome}\n`;
    perfil += `Usu√°rio: ${usuario.usuario}\n`;
    perfil += `M√©rito: ${usuario.merito} pontos\n`;
    perfil += `Chave PIX: ${usuario.chavePix || "N√£o configurada"}\n`;
    
    if (usuarioLogado) {
        perfil += `\n--- Estat√≠sticas ---\n`;
        perfil += `Desafios cumpridos: ${usuario.desafiosCumpridos}\n`;
        perfil += `Desafios falhados: ${usuario.desafiosFalhados}\n`;
        perfil += `Pagamentos realizados: ${usuario.pagamentosRealizados}\n`;
        perfil += `Pagamentos pendentes: ${usuario.pagamentosPendentes}\n`;
        perfil += `Amigos: ${usuario.amigos ? usuario.amigos.length : 0}\n`;
    } else if (streamerLogado) {
        perfil += `\n--- Status ---\n`;
        perfil += `Online: ${streamerLogado.online ? 'Sim' : 'N√£o'}\n`;
        perfil += `V√≠deos: ${streamerLogado.videos ? streamerLogado.videos.length : 0}\n`;
    }
    
    perfil += `\n--- A√ß√µes ---\n`;
    perfil += `1. Configurar PIX\n`;
    perfil += `2. Ver Conquistas\n`;
    perfil += `3. Ver Ranking\n`;
    
    const opcao = prompt(perfil + "\nDigite o n√∫mero da a√ß√£o:");
    
    switch(opcao) {
        case "1":
            configurarChavePix();
            break;
        case "2":
            verConquistas();
            break;
        case "3":
            verRankingUsuarios();
            break;
    }
}
// ===== NOTIFICA√á√ïES =====
function mostrarNotificacao(mensagem, tipo = 'info', targetUser = null) {
    const notificacao = document.createElement('div');
    notificacao.className = `notificacao ${tipo}`;
    notificacao.innerHTML = mensagem;
    document.body.appendChild(notificacao);
    setTimeout(() => notificacao.remove(), 5000);
    if (targetUser && usuarioLogado && usuarioLogado.nome === targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    } else if (!targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    }
}
// ===== INICIALIZA√á√ÉO =====
document.addEventListener('DOMContentLoaded', function() {
    carregarSessao();
    atualizarInterfaceLogin();
    
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const floatingMenu = document.getElementById('loginFloating');
            const overlay = document.getElementById('overlay');
            if (floatingMenu) floatingMenu.classList.remove('show');
            if (overlay) overlay.classList.remove('show');
        }
    });
});




</script>
    <!-- Carregar scripts 
    <script src="variaveis-globais.js"></script>
    <script src="funcoes-auxiliares.js"></script>
    <script src="storage.js"></script>
    
    
    <script src="Perfil/login.js"></script>
    <script src="Perfil/merito.js"></script>
    <script src="Perfil/ranking.js"></script>
    <script src="Perfil/social.js"></script>
    <script src="Perfil/notificacoes.js"></script>





    
    
    <script src="Wrtc/Chat/ModalChat.js"></script>
    <script src="Wrtc/Chat/Chat.js"></script>
    <script src="Wrtc/Chat/Voice.js"></script>

    <script src="Wrtc/Apostas/ModalApostas.js"></script>
    <script src="Wrtc/Apostas/apostas.js"></script>
    <script src="Wrtc/Wrtc_geral.js"></script>
  
    <script src="Header/busca.js"></script>
    <script src="Header/navegacao.js"></script>

    
    
    
    <script src="Eventos/jogos.js"></script>
    <script src="Eventos/estadios.js"></script>
    <script src="Eventos/times.js"></script>
    <script src="Eventos/streamers.js"></script>
    <script src="Eventos/Lives/lives-manager.js"></script>
    <script src="Eventos/Lives/cards.js"></script>
    <script src="Eventos/Lives/divs-horizontais.js"></script>
    <script src="Eventos/Lives/BotoesNoheader.js"></script>
    <script src="Eventos/Lives/TamanhoDosIframes.js"></script>
    <script src="Eventos/Lives/dropdownButton.js"></script>

    -->
  
</body>
</html>
