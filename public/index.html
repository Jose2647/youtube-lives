<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Sistema de Jogos e Transmiss√µes</title>
</head>
<body>
  
  <header >
    <button onclick="verRankingUsuarios()">Ranking</button>
    <button onclick="buscarStreamers()">Buscar</button>
    <button onclick="verNotificacoes()">Notifica√ß√µes</button>
    <button onclick="verEventos()">Eventos</button>
   <div class="profile-icon" id="profileIcon" onclick="toggleProfileMenu()">üë§</div>
  </header>
  <!-- Menu flutuante do perfil -->
  <div class="login-floating" id="loginFloating">
    <!-- Conte√∫do ser√° preenchido pelo JavaScript -->
  </div>
 <!-- Overlay para fechar o menu -->
  <div class="overlay" id="overlay" onclick="toggleProfileMenu()"></div>
  
</header>
    <h1>Sistema de Jogos e Transmiss√µes</h1>
    
    <!-- Se√ß√£o de Jogos -->
    <div id="secao-jogos" class="secao">
        <h2>Jogos</h2>
        <!--
       <button onclick="adicionarJogo()">Criar Jogo</button> 
     <button onclick="colarJogoCopiado()">Adicionar Jogo</button> 
     -->
     
     
                 <button onclick="adicionarJogo()" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo Jogo
            </button>
            <button onclick="colarJogo()" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar Jogo
            </button>
    
        <div id="lista-jogos"></div>
    </div>
    
    <!-- Se√ß√£o de Est√°dios -->
    <div id="secao-estadios" class="secao" style="display:none;">
        <h2>Est√°dios</h2>
        <button onclick="voltarParaJogos()">‚Üê Voltar para Jogos</button>

        <button onclick="colarEstadioCopiado()">Adicionar colar</button>
        <div id="lista-estadios"></div>
    </div>
    
  
    <div id="secao-times" class="secao" style="display:none;">
    <h2>Times</h2>
    <button onclick="voltarParaEstadios()">‚Üê Voltar para Est√°dios</button>
    
    <!-- BOT√ÉO COLAR FIXO -->
    <button onclick="colarTimeCopiado(jogoSelecionadoId, estadioSelecionadoId)" 
            style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em; margin:10px 5px;">
        Colar Time Copiado
    </button>

    <div id="lista-times"></div>
</div>
    
    <!-- Se√ß√£o de Lives - CORRIGIDO -->
<div id="secao-lives" class="secao header-live" style="display:none;">
  
    <div class="secao-header">
        <h2>Lives</h2>
        <div class="secao-buttons">
  
            <button onclick="voltarParaTimes()">‚Üê Voltar para Times</button>
            
            
    </div>
    
    <div id="lista-lives"></div>
</div>


</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js">
</script>
  
  
<script src="css.js">
</script>
  
<script>

  
  
  /////////////
/////////////
///////////// variaveis-globais.js
/////////////
/////////////



</script>
<script >
  
  // ===== INICIALIZA√á√ÉO GLOBAL SEGURA =====
if (!window.AppState) {
    window.AppState = {};
}
if (!window.AppState.socket) {
    window.AppState.socket = null;
}
if (!window.salasDisponiveis) {
    window.salasDisponiveis = {};
}
if (typeof window.salaAtual === 'undefined') {
    window.salaAtual = null;
}

  

// variaveis-globais.js
let dados = {
    jogos: [],
    usuarios: [],
    transacoes: [],
    apostasUsuarios: [],
    desafiosUsuarios: [],
    chats: [] // Store chats per cardId
};

let jogoTemporarioParaCompartilhar = null;
let acoesEstadioVisiveis = true;


// === CONEX√ïES WEBRTC ===
let jogoCopiado = null;
let estadioCopiado = null; // Armazena o est√°dio copiado
let timeCopiado = null;
let liveCopiada = null;
let cardCopiado = null;
let divCopiada = null;
let scrollContainerCopiado = null;
let iframerCopiado = null;




let toggleStatesLive = {};
let toggleStatesScrollContainer = {};
let toggleStatesDiv = {};
let toggleStatesIframer = {};
// Criar fun√ß√µes de toggle para diferentes tipos
//const toggleTimeBotoes = createToggleFunction('time');
//const toggleEstadioBotoes = createToggleFunction('estadio');
//const toggleScrollContainerBotoes = createToggleFunction('scrollContainer');



// ESTADO GLOBAL PARA DIVS
const dataChannels = {};

let peerConnections = {};
let usuarioLogado = null;
let streamerLogado = null;
let notificacoes = [];
let socket = null;
let eventos = [];
let jogoSelecionadoId = null;
let estadioSelecionadoId = null;
let timeSelecionadoId = null;
let liveSelecionadoId = null;

let peerConnection = null;
let localStream = null;
let dataChannel = null;
let audioContext = null;
let audioAnalyser = null;
let audioParticipants = new Map();

const configLives = {
    maxIframes: 8,
    maxCardsUsuario: 6,
    maxDivsPorLive: 4,
    maxCardsPorDiv: 8,
    iframeWidth: "180px",
    iframeHeight: "200px",
    autoplay: 1,
    mute: 1,
    enablejsapi: 1,
    tamanhosDisponiveis: {
        pequeno: { width: "100px", height: "161px", label: "Pequeno" },
        medio: { width: "150px", height: "241px", label: "M√©dio" },
        grande: { width: "200px", height: "321px", label: "Grande" },
        extraGrande: { width: "350px", height: "401px", label: "Extra Grande" }
    },
    tamanhosCards: {
        pequeno: { width: "135px", height: "135px", label: "Pequeno" },
        medio: { width: "180px", height: "180px", label: "M√©dio" },
        grande: { width: "225px", height: "225px", label: "Grande" },
        extraGrande: { width: "270px", height: "270px", label: "Extra Grande" }
    },
    alturasDiv: {
        pequeno: { height: "1200px", label: "Pequeno" },
        medio: { height: "1200px", label: "M√©dio" },
        grande: { height: "1200px", label: "Grande" },
        extraGrande: { height: "1200px", label: "Extra Grande" }
    }
};

window.configLives = configLives;

const imagensPadrao = {
    jogo: "https://via.placeholder.com/150/4CAF50/white?text=JOGO",
    estadio: "https://via.placeholder.com/150/2196F3/white?text=EST√ÅDIO",
    time: "https://via.placeholder.com/150/FF9800/white?text=TIME",
    live: "https://via.placeholder.com/150/9C27B0/white?text=LIVE",
    streamer: "https://via.placeholder.com/150/607D8B/white?text=STREAMER",
    usuario: "https://via.placeholder.com/150/795548/white?text=USU√ÅRIO"
};

function obterImagem(entidade, imagemCustom) {
    return imagemCustom && imagemCustom !== '' ? imagemCustom : imagensPadrao[entidade];
}



/*
const API_BASE = 'http://localhost:3000';
    // === CONFIGURA√á√ïES ===
    const SIGNALING_SERVER = 'ws://localhost:3000';
   // let socket = null;
    let salaAtual = null;
    let salasDisponiveis = {};
    let usuariosNaSala = new Set();
    let peers = {};
    let meuStream = null;
    let voiceEnabled = false;
    let abaAtual = 'salas';
    
        // === CONFIG (AJUSTE AQUI) ===
  //  const API_BASE = 'http://localhost:3000/api';  // Seu backend URL
    const SOCKET_SERVER = 'http://localhost:3000';  // Mesmo do chat, se compartilhado
    const TOKEN_JWT = localStorage.getItem('jwtToken') || '';  // Do login existente

    // === GLOBAIS ISOLADAS (N√ÉO TOCA NO CHAT) ===
    let socketApostas = null;
    let intervalEncerramentos = null;
    const ROOMS_APOSTAS = {};  // { cardId: roomName } para tracking
*/

    
    
    const API_BASE = 'https://youtube-lives.onrender.com';
    // === CONFIGURA√á√ïES ===
    const SIGNALING_SERVER = 'wss://youtube-lives.onrender.com';
   // let socket = null;
    let salaAtual = null;
    let salasDisponiveis = {};
    let usuariosNaSala = new Set();
    let peers = {};
    let meuStream = null;
    let voiceEnabled = false;
    let abaAtual = 'salas';
    
    
        // === CONFIG (AJUSTE AQUI) ===
  //  const API_BASE = 'https://youtube-lives.onrender.com/api';  // Seu backend URL
    const SOCKET_SERVER = 'https://youtube-lives.onrender.com';  // Mesmo do chat, se compartilhado
    const TOKEN_JWT = localStorage.getItem('jwtToken') || '';  // Do login existente

    // === GLOBAIS ISOLADAS (N√ÉO TOCA NO CHAT) ===
    let socketApostas = null;
    let intervalEncerramentos = null;
    const ROOMS_APOSTAS = {};  // { cardId: roomName } para tracking
    
    
// Fun√ß√£o para buscar dados do backend
async function buscarDadosBackend(endpoint) {
    try {
        const response = await fetch(`${API_BASE}${endpoint}`);
        if (!response.ok) throw new Error(`Erro ${response.status}`);
        
        const dadosRes = await response.json();
        //console.log(`${endpoint}:`, Array.isArray(dadosRes) ? dadosRes.length : 1, 'itens');
        return dadosRes;
        
    } catch (error) {
        console.error(`${endpoint}:`, error.message);
        return null;
    }
}

// Fun√ß√£o principal para carregar dados
async function carregarDadosBackend() {
    try {
        //console.log('Carregando dados do backend...');
        
        const [
            usuariosBackend, 
            apostasBackend, 
            desafiosBackend, 
            chatsBackend, 
            jogosBackend
        ] = await Promise.all([
            buscarDadosBackend('/api/users'),
            buscarDadosBackend('/api/apostas'),
            buscarDadosBackend('/api/desafios'),
            buscarDadosBackend('/api/chats'),
            buscarDadosBackend('/api/jogos') // ou '/api/jogos-completos' se preferir
        ]);

        // Atribuir dados diretamente
        Object.assign(dados, {
            usuarios: usuariosBackend || [],
            apostasUsuarios: apostasBackend || [],
            desafiosUsuarios: desafiosBackend || [],
            chats: chatsBackend || [],
            jogos: jogosBackend || []
        });

        //console.log('Dados carregados:');
        //console.log(`Usu√°rios: ${dados.usuarios.length}`);
        console.log(`Apostas: ${dados.apostasUsuarios.length}`);
        console.log(`Desafios: ${dados.desafiosUsuarios.length}`);
        //console.log(`Chats: ${dados.chats.length}`);
        //console.log(`Jogos: ${dados.jogos.length}`);
        
        return true;
        
    } catch (error) {
        console.error('Erro no carregamento:', error);
        return false;
    }
}

// Fun√ß√£o inicializadora
async function inicializar() {
    console.log('Iniciando sistema...');
    
    const sucesso = await carregarDadosBackend();
    
    if (sucesso) {
        carregarJogos(); // sua fun√ß√£o que renderiza a UI
        console.log('Sistema inicializado com sucesso');
    } else {
        document.getElementById('app').innerHTML = `
            <div class="erro">
                <h2>Erro ao conectar com o servidor</h2>
                <p>Verifique se o backend est√° rodando em <code>https://youtube-lives.onrender.com</code></p>
                <button onclick="location.reload()">Tentar novamente</button>
            </div>
        `;
    }
}

// Iniciar automaticamente
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', inicializar);
} else {
    inicializar();
}
//console.log("_____dados",dados)
// Adicionar Card na Div

/////
/////
function toggleEstadioBotoes(estadioId) {
    const container = document.getElementById(`botoes-estadio-${estadioId}`);
    const btn = document.getElementById(`toggle-${estadioId}`);
    const expanded = container.style.display === 'flex';
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
}
function toggleTimeBotoes(timeId) {
    const container = document.getElementById(`botoes-time-${timeId}`);
    const btn = document.getElementById(`toggle-time-${timeId}`);
    const expanded = container.style.display === 'flex';
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
}
function toggleLiveBotoes(liveId) {
    const container = document.getElementById(`botoes-live-${liveId}`);
    const btn = document.getElementById(`toggle-live-${liveId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesLive[liveId] = !expanded;
}
function toggleDivBotoes(divId) {
    const container = document.getElementById(`botoes-div-${divId}`);
    const btn = document.getElementById(`toggle-div-${divId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesDiv[divId] = !expanded;
}

function toggleScrollContainerBotoes(divId) {
  /*  botoes-scroll-${divId}
                    toggle-scroll-${divId}*/
      const container = document.getElementById(`botoes-scroll-${divId}`);
    const btn = document.getElementById(`toggle-scroll-${divId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesDiv[divId] = !expanded;
}
function toggleIframerBotoes(cardId) {
    const container = document.getElementById(`botoes-iframer-${cardId}`);
    const btn = document.getElementById(`toggle-iframer-${cardId}`);
    const expanded = container.style.display === 'flex';
    
    container.style.display = expanded ? 'none' : 'flex';
    btn.innerHTML = expanded ? '+' : '‚àí';
    toggleStatesIframer[cardId] = !expanded;
}

/////
/////



////////////
////////////
////////////
////////////
// social.js - VERS√ÉO CORRIGIDA
function adicionarAmigo(usuarioAlvo) {
    if (!usuarioLogado) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    if (usuarioAlvo === usuarioLogado.nome) {
        alert("Voc√™ n√£o pode adicionar a si mesmo!");
        return;
    }
    
    if (!usuarioLogado.amigos) usuarioLogado.amigos = [];
    
    if (usuarioLogado.amigos.includes(usuarioAlvo)) {
        alert("Voc√™ j√° √© amigo deste usu√°rio!");
        return;
    }
    
    usuarioLogado.amigos.push(usuarioAlvo);
    adicionarNotificacao("Novo amigo!", `Voc√™ e ${usuarioAlvo} agora s√£o amigos!`, 'sucesso');
    alert(`Agora voc√™ √© amigo de ${usuarioAlvo}!`);
}
function verAmigos() {
    if (!usuarioLogado) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    if (!usuarioLogado.amigos || usuarioLogado.amigos.length === 0) {
        alert("Voc√™ n√£o tem amigos adicionados");
        return;
    }
    
    let lista = "=== SEUS AMIGOS ===\n\n";
    usuarioLogado.amigos.forEach((amigo, index) => {
        const usuario = dados.usuarios.find(u => u.nome === amigo);
        if (usuario) {
            lista += `üë§ ${usuario.nome}\n`;
            lista += `M√©rito: ${usuario.merito}\n`;
            lista += `[Desafiar - digite 'd ${index}'] [Ver Perfil - 'v ${index}']\n\n`;
        }
    });
    
    lista += "\nComandos: 'd [n√∫mero]' - desafiar amigo | 'v [n√∫mero]' - ver perfil";
    const comando = prompt(lista);
    
    if (comando) {
        if (comando.startsWith('d ')) {
            const index = parseInt(comando.split(' ')[1]);
            if (!isNaN(index) && index >= 0 && index < usuarioLogado.amigos.length) {
                desafiarAmigo(usuarioLogado.amigos[index]);
            }
        } else if (comando.startsWith('v ')) {
            const index = parseInt(comando.split(' ')[1]);
            if (!isNaN(index) && index >= 0 && index < usuarioLogado.amigos.length) {
                verPerfilAmigo(usuarioLogado.amigos[index]);
            }
        }
    }
}
function desafiarAmigo(nomeAmigo) {
    alert(`Funcionalidade de desafio para ${nomeAmigo} em desenvolvimento...`);
    // Implementar l√≥gica de desafio entre amigos
}
function verPerfilAmigo(nomeAmigo) {
    const amigo = dados.usuarios.find(u => u.nome === nomeAmigo);
    if (!amigo) {
        alert("Amigo n√£o encontrado!");
        return;
    }
    
    let perfil = `=== PERFIL DE ${amigo.nome} ===\n\n`;
    perfil += `M√©rito: ${amigo.merito} pontos\n`;
    perfil += `Desafios cumpridos: ${amigo.desafiosCumpridos || 0}\n`;
    perfil += `Pagamentos realizados: ${amigo.pagamentosRealizados || 0}\n`;
    
    alert(perfil);
}



function buscarUsuarios() {
    const termo = prompt("Digite o nome do usu√°rio:");
    if (!termo) return;
    
    const usuariosEncontrados = dados.usuarios.filter(u => 
        u.nome.toLowerCase().includes(termo.toLowerCase())
    );
    
    if (usuariosEncontrados.length === 0) {
        alert("Nenhum usu√°rio encontrado!");
        return;
    }
    
    let lista = "=== USU√ÅRIOS ENCONTRADOS ===\n\n";
    usuariosEncontrados.forEach((usuario, index) => {
        lista += `üë§ ${usuario.nome}\n`;
        lista += `M√©rito: ${usuario.merito}\n`;
        
        if (usuarioLogado && usuario.nome !== usuarioLogado.nome) {
            const jaEhAmigo = usuarioLogado.amigos && usuarioLogado.amigos.includes(usuario.nome);
            if (!jaEhAmigo) {
                lista += `[Adicionar amigo - digite 'a ${index}']\n`;
            } else {
                lista += `‚úÖ J√° √© seu amigo\n`;
            }
        }
        lista += "------------------------\n";
    });
    
    if (usuarioLogado) {
        lista += "\nComandos: 'a [n√∫mero]' - adicionar como amigo";
    }
    
    const comando = prompt(lista);
    
    if (comando && comando.startsWith('a ')) {
        const index = parseInt(comando.split(' ')[1]);
        if (!isNaN(index) && index >= 0 && index < usuariosEncontrados.length) {
            adicionarAmigo(usuariosEncontrados[index].nome);
        }
    }
}
function adicionarNotificacao(titulo, mensagem, tipo = 'info') {
    const notificacao = {
        id: Date.now(),
        titulo: titulo,
        mensagem: mensagem,
        tipo: tipo, // 'info', 'alerta', 'sucesso'
        lida: false,
        data: new Date().toLocaleString()
    };
    notificacoes.unshift(notificacao);
    
    // Limitar a 50 notifica√ß√µes
    if (notificacoes.length > 50) {
        notificacoes = notificacoes.slice(0, 50);
    }
}
function verNotificacoes() {
    if (notificacoes.length === 0) {
        alert("Nenhuma notifica√ß√£o");
        return;
    }
    
    let lista = "=== NOTIFICA√á√ïES ===\n\n";
    notificacoes.forEach((not, index) => {
        lista += `${not.lida ? 'üì≠' : 'üì´'} ${not.titulo}\n`;
        lista += `Mensagem: ${not.mensagem}\n`;
        lista += `Data: ${not.data}\n`;
        lista += `Tipo: ${not.tipo}\n`;
        
        if (!not.lida) {
            lista += `[Marcar como lida - digite 'l ${index}']\n`;
        }
        lista += "------------------------\n";
    });
    
    lista += "\nComandos: 'l [n√∫mero]' - marcar como lida";
    const comando = prompt(lista);
    
    if (comando && comando.startsWith('l ')) {
        const index = parseInt(comando.split(' ')[1]);
        if (!isNaN(index) && index >= 0 && index < notificacoes.length) {
            notificacoes[index].lida = true;
            alert("Notifica√ß√£o marcada como lida!");
        }
    }
}
function limparNotificacoes() {
    if (confirm("Limpar todas as notifica√ß√µes?")) {
        notificacoes = [];
        alert("Notifica√ß√µes limpas!");
    }
}
function getNotificacoesNaoLidas() {
    return notificacoes.filter(not => !not.lida).length;
}
// Fun√ß√£o de m√©rito m√°ximo (referenciada em apostas.js e desafios.js)
function calcularMeritoMaximoAposta(usuario) {
    return Math.floor(usuario.merito * 0.3); // 30% do m√©rito atual
}
// Fun√ß√£o para atualizar m√©rito (referenciada em desafios.js)
function atualizarMerito(usuario, tipo, positivo) {
    let pontos = 0;
    
    switch(tipo) {
        case 'desafio_criado':
            pontos = positivo ? 10 : -5;
            break;
        case 'desafio_cumprido':
            pontos = positivo ? 20 : -15;
            break;
        case 'pagamento_realizado':
            pontos = positivo ? 15 : 0;
            break;
        case 'pagamento_pendente':
            pontos = positivo ? 0 : -20;
            break;
        case 'aposta_ganha':
            pontos = positivo ? 25 : 0;
            break;
        case 'aposta_perdida':
            pontos = positivo ? 0 : -10;
            break;
        default:
            pontos = positivo ? 5 : -5;
    }
    
    usuario.merito += pontos;
    return pontos;
}
// Fun√ß√£o para carregar v√≠deos do streamer
function carregarVideosStreamer(streamer) {
    if (!streamer.videos || streamer.videos.length === 0) {
        return '<p>Nenhum v√≠deo compartilhado</p>';
    }
    
    let html = '<h4>V√≠deos Compartilhados:</h4>';
    streamer.videos.forEach(video => {
        html += `<p><strong>${video.titulo}</strong> - ${video.data}<br>`;
        html += `<a href="${video.url}" target="_blank">Assistir</a></p>`;
    });
    return html;
}

function verTransacoes() {
    alert("Funcionalidade de transa√ß√µes em desenvolvimento...");
}
function enviarComprovantePix(jogoId, estadioId, timeId, liveId, streamerId, desafioId) {
    const streamer = encontrarStreamer(jogoId, estadioId, timeId, liveId, streamerId);
    if (!streamer) return;
    
    let desafio;
    if (streamer.desafiosEnviados) {
        desafio = streamer.desafiosEnviados.find(d => d.id === desafioId);
    }
    
    if (!desafio) {
        alert("Desafio n√£o encontrado!");
        return;
    }
    
    const comprovante = prompt("URL ou descri√ß√£o do comprovante PIX:");
    if (comprovante) {
        desafio.comprovantePix = comprovante;
        carregarStreamersDaLive(jogoId, estadioId, timeId, liveId);
        alert("Comprovante enviado!");
    }
}
// Fun√ß√£o para encontrar live
function encontrarLive(jogoId, estadioId, timeId, liveId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return null;
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return null;
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time || !time.lives) return null;
    
    return time.lives.find(l => l.id === liveId);
}
// Fun√ß√£o para encontrar streamer
function encontrarStreamer(jogoId, estadioId, timeId, liveId, streamerId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.streamers) return null;
    
    return live.streamers.find(s => s.id === streamerId);
}
// Fun√ß√£o para ver streamers de uma live
function verStreamersDaLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live) {
        alert("Live n√£o encontrada!");
        return;
    }
    
    mostrarSecao('streamers');
    carregarStreamersDaLive(jogoId, estadioId, timeId, liveId);
}
// Fun√ß√£o para mostrar se√ß√£o
function mostrarSecao(secao) {
    // Esconder todas as se√ß√µes
    document.querySelectorAll('.secao').forEach(sec => {
        sec.style.display = 'none';
    });
    
    // Mostrar a se√ß√£o desejada
    document.getElementById(`secao-${secao}`).style.display = 'block';
}
// Fun√ß√£o para voltar para jogos
function voltarParaJogos() {
    mostrarSecao('jogos');
}
// Fun√ß√£o para voltar para est√°dios
function voltarParaEstadios() {
    mostrarSecao('estadios');
}
// Fun√ß√£o para voltar para times
function voltarParaTimes() {
    mostrarSecao('times');
}
// Fun√ß√£o para voltar para lives
function voltarParaLives() {
    mostrarSecao('lives');
}
// FUN√á√ïES DE VOZ PARA LIVE








//////////// navegacao
//////////// navegacao
//////////// navegacao
//////////// navegacao
//////////// navegacao
//////////// navegacao

// Fun√ß√µes de navega√ß√£o
function mostrarSecao(secao) {
    document.querySelectorAll('.secao').forEach(el => {
        el.style.display = 'none';
    });
    document.getElementById(`secao-${secao}`).style.display = 'block';
    
    // S√≥ carrega automaticamente as se√ß√µes que n√£o precisam de par√¢metros
    if (secao === 'jogos' || secao === 'estadios' || secao === 'times') {
        carregarSecao(secao);
    }
}

// Fun√ß√£o para carregar dados da se√ß√£o
function carregarSecao(secao) {
    switch(secao) {
        case 'jogos':
            carregarJogos();
            break;
        case 'estadios':
            if (jogoSelecionadoId) {
                carregarEstadiosDoJogo(jogoSelecionadoId);
            } else {
                carregarEstadios();
            }
            break;
        case 'times':
            if (jogoSelecionadoId && estadioSelecionadoId) {
                carregarTimesDoEstadio(jogoSelecionadoId, estadioSelecionadoId);
            } else {
                carregarTimes();
            }
            break;
        case 'lives':
            if (jogoSelecionadoId && estadioSelecionadoId && timeSelecionadoId) {
                carregarLivesDoTime(jogoSelecionadoId, estadioSelecionadoId, timeSelecionadoId);
            }
            break;
        case 'streamers':
            if (jogoSelecionadoId && estadioSelecionadoId && timeSelecionadoId && liveSelecionadoId) {
                carregarStreamersDaLive(jogoSelecionadoId, estadioSelecionadoId, timeSelecionadoId, liveSelecionadoId);
            }
            break;
    }
}

// Fun√ß√µes para voltar - MANTENDO OS IDs SELECIONADOS
function voltarParaJogos() {
    mostrarSecao('jogos');
    // N√£o limpa jogoSelecionadoId para manter contexto
}
function voltarParaEstadios() {
    mostrarSecao('estadios');
    // N√£o limpa estadioSelecionadoId para manter contexto
}
function voltarParaTimes() {
    mostrarSecao('times');
    // N√£o limpa timeSelecionadoId para manter contexto
}
function voltarParaLives() {
    mostrarSecao('lives');
    // N√£o limpa liveSelecionadoId para manter contexto
}
function verEstadiosDoJogo(jogoId) {
    jogoSelecionadoId = jogoId;
    mostrarSecao('estadios');
}
function verTimesDoEstadio(jogoId, estadioId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    mostrarSecao('times');
}
function verLivesDoTime(jogoId, estadioId, timeId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    timeSelecionadoId = timeId;
    mostrarSecao('lives');
}
function verStreamersDaLive(jogoId, estadioId, timeId, liveId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    timeSelecionadoId = timeId;
    liveSelecionadoId = liveId;
    mostrarSecao('streamers');
}

// Inicializa√ß√£o
window.onload = function() {
    carregarJogos();
};




////////////
////////////
////////////
////////////jogos
////////////
////////////
////////////

// Fun√ß√µes para exibir jogos
function carregarJogos() {
    const container = document.getElementById('lista-jogos');
    if (!container) return;

    container.innerHTML = '';

    if (dados.jogos.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum jogo cadastrado.</p>';
        return;
    }

    // Estado do toggle (opcional: pode ser salvo em localStorage)
    const toggleStates = {};

    dados.jogos.forEach(jogo => {
        const jogoId = jogo.id;
        const isExpanded = toggleStates[jogoId] || false;

        // === CONTAINER PRINCIPAL ===
        const jogoEl = document.createElement('div');
        jogoEl.className = 'jogo-item';
        jogoEl.style = 'border:1px solid #ddd; margin:15px 0; padding:15px; border-radius:8px; background:#fafafa;';

        // === HEADER (IMAGEM + T√çTULO + TOGGLE) ===
        const header = document.createElement('div');
        header.style = 'display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;';

        const leftSide = document.createElement('div');
        leftSide.style = 'display:flex; align-items:center; gap:15px;';

        const img = document.createElement('img');
        img.src = obterImagem('jogo', jogo.imagem);
        img.alt = jogo.nome;
        img.title = 'Clique para ver est√°dios';
        img.style = 'width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer;';
        img.onclick = () => verEstadiosDoJogo(jogo.id);

        const textoLado = document.createElement('div');
        const h3 = document.createElement('h3');
        h3.textContent = jogo.nome;
        h3.style = 'margin:0; cursor:pointer; color:#007bff; font-size:1.1em;';
        h3.onclick = () => verEstadiosDoJogo(jogo.id);

        const p = document.createElement('p');
        p.textContent = `ID: ${jogo.id} | Est√°dios: ${jogo.estadios.length}`;
        p.style = 'margin:3px 0; color:#555; font-size:0.9em;';

        textoLado.appendChild(h3);
        textoLado.appendChild(p);
        leftSide.appendChild(img);
        leftSide.appendChild(textoLado);

        // === BOT√ÉO TOGGLE ===
        const toggleBtn = document.createElement('button');
        toggleBtn.innerHTML = isExpanded ? '‚àí' : '+';
        toggleBtn.style = `
            width:36px; height:36px; border:none; border-radius:50%; 
            background:#007bff; color:white; font-weight:bold; font-size:1.2em;
            cursor:pointer; display:flex; align-items:center; justify-content:center;
            transition:0.2s;
        `;
        toggleBtn.onmouseover = () => toggleBtn.style.background = '#0056b3';
        toggleBtn.onmouseout = () => toggleBtn.style.background = '#007bff';

        // === CONTAINER DE BOT√ïES (ocult√°vel) ===
        const botoesContainer = document.createElement('div');
        botoesContainer.id = `botoes-${jogoId}`;
        botoesContainer.style = `
            display: ${isExpanded ? 'flex' : 'none'};
            flex-wrap: wrap; gap: 8px; justify-content: center;
            margin-top: 12px; padding: 10px; background: #f8f9fa;
            border-radius: 6px; transition: all 0.3s ease;
        `;

        // === LISTA DE BOT√ïES ===
        const botoes = [
            { text: 'Ver', color: '#17a2b8', click: () => verDetalhesJogo(jogo.id) },
            { text: 'Editar', color: '#ffc107', click: () => editarJogo(jogo.id) },
            { text: 'Imagem', color: '#6c757d', click: () => alterarImagemJogo(jogo.id) },
            { text: 'Excluir', color: '#dc3545', click: () => excluirJogo(jogo.id) },
            { text: 'Compartilhar', color: '#007bff', click: () => compartilharJogo(jogo.id) },
            { text: 'App+Jogo', color: '#28a745', click: () => compartilharAppSintonizadaJogo(jogo.id) },
        ];

        botoes.forEach(btn => {
            const button = document.createElement('button');
            button.textContent = btn.text;
            button.style = `
                padding:6px 10px; border:none; border-radius:5px; 
                color:white; background:${btn.color}; cursor:pointer; 
                font-size:0.85em; min-width:70px; transition:0.2s;
            `;
            button.onclick = btn.click;
            botoesContainer.appendChild(button);
        });

        // === BOT√ÉO COPIAR ===
        const isCopiado = jogoCopiado && jogoCopiado.id === jogo.id;
        const btnCopiar = document.createElement('button');
        btnCopiar.innerHTML = isCopiado ? 'Copiado' : 'Copiar';
        btnCopiar.style = `
            padding:6px 10px; border:none; border-radius:5px; 
            color:white; cursor:pointer; font-size:0.85em;
            background: ${isCopiado ? '#28a745' : '#6f42c1'};
        `;
        
        btnCopiar.onclick = () => {
            jogoCopiado = JSON.parse(JSON.stringify(jogo));
            mostrarNotificacao(`Jogo "${jogo.nome}" copiado!`, 'sucesso');
            carregarJogos();
        };
        botoesContainer.appendChild(btnCopiar);

        // === BOT√ÉO P2P (se houver jogo copiado) ===
        if (jogoCopiado) {
            const btnP2P = document.createElement('button');
            btnP2P.textContent = 'P2P';
            btnP2P.style = 'padding:6px 10px; background:#ff6b35; color:white; border:none; border-radius:5px; font-size:0.85em; cursor:pointer;';
          //  btnP2P.onclick = enviarJogoCopiadoViaP2P;
            botoesContainer.appendChild(btnP2P);
        }

        // === TOGGLE FUNCIONALIDADE ===
        toggleBtn.onclick = () => {
            const expanded = botoesContainer.style.display === 'flex';
            botoesContainer.style.display = expanded ? 'none' : 'flex';
            toggleBtn.innerHTML = expanded ? '+' : '‚àí';
            toggleStates[jogoId] = !expanded;
        };
        
          // === BOT√ÉO CRIAR/ENTRAR NA SALA DO JOGO ===
       /*   const btnSala = document.createElement('button');
          btnSala.innerHTML = 'üè† Sala';
          btnSala.style = `
              padding:6px 10px; border:none; border-radius:5px; 
              color:white; background:#e83e8c; cursor:pointer; 
              font-size:0.85em; min-width:70px; transition:0.2s;
          `;
          btnSala.onclick = () => criarOuEntrarSalaJogo(jogo.id);
          btnSala.title = `Criar/Entrar na sala: ${jogo.nome}`;
          */
          console.log("___jogo",jogo.nome)
          const btnSalaEstadio = document.createElement('button');
btnSalaEstadio.innerHTML = 'üí¨ Chat jogo';
btnSalaEstadio.onclick = () => entrarSalaJogo(jogo.id);
          botoesContainer.appendChild(btnSalaEstadio);

        // === MONTAGEM FINAL ===
        header.appendChild(leftSide);
        header.appendChild(toggleBtn);
        jogoEl.appendChild(header);
        jogoEl.appendChild(botoesContainer);
        jogoEl.appendChild(document.createElement('hr'));

        container.appendChild(jogoEl);
    });

}
function carregarEstadiosDoJogo(jogoId) {
    const container = document.getElementById('lista-estadios');
    container.innerHTML = '';

    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return alert("Jogo n√£o encontrado!");

    document.querySelector('#secao-estadios h2').textContent = `Est√°dios - ${jogo.nome}`;

    // === BOT√ÉO ADICIONAR + COMPARTILHAR ===
    const topo = document.createElement('div');
    topo.innerHTML = `
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">

            <button onclick="adicionarEstadio()" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo estadio
            </button>
            <button onclick="colarEstadioCopiado()" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar estadio
            </button>

        </div>
    `;
    container.appendChild(topo);

    // === LISTAR EST√ÅDIOS ===
    jogo.estadios.forEach(estadio => {
        const el = document.createElement('div');
        el.innerHTML = gerarHTMLCardEstadio(jogo, estadio);
        container.appendChild(el);
    });
}
// === 2. LISTAR TODOS OS EST√ÅDIOS (VIS√ÉO GERAL) ===
function carregarEstadios() {
    const container = document.getElementById('lista-estadios');
    container.innerHTML = '';

    document.querySelector('#secao-estadios h2').textContent = 'Todos os Est√°dios';

    let totalEstadios = 0;
    dados.jogos.forEach(j => totalEstadios += j.estadios.length);

    if (totalEstadios === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum est√°dio cadastrado.</p>';
        return;
    }

    dados.jogos.forEach(jogo => {
        if (jogo.estadios.length === 0) return;

        const titulo = document.createElement('h3');
        titulo.textContent = `Jogo: ${jogo.nome}`;
        titulo.style = 'margin:20px 0 10px; padding-bottom:5px; border-bottom:1px solid #ddd;';
        container.appendChild(titulo);

        jogo.estadios.forEach(estadio => {
            const el = document.createElement('div');
            el.innerHTML = gerarHTMLCardEstadio(jogo, estadio, true);
            container.appendChild(el);
        });
    });
}
function gerarBotoesEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    const estadio = jogo?.estadios.find(e => e.id === estadioId);
    if (!estadio) return '';

    const isCopiado = estadioCopiado && estadioCopiado.id === estadioId && estadioCopiado.jogoId === jogoId;

    let botoes = `
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#17a2b8; cursor:pointer; font-size:0.85em;" 
                onclick="verDetalhesEstadio(${jogoId}, ${estadioId})">Ver</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#ffc107; cursor:pointer; font-size:0.85em;" 
                onclick="editarEstadio(${jogoId}, ${estadioId})">Editar</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#6c757d; cursor:pointer; font-size:0.85em;" 
                onclick="alterarImagemEstadio(${jogoId}, ${estadioId})">Imagem</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#dc3545; cursor:pointer; font-size:0.85em;" 
                onclick="excluirEstadio(${jogoId}, ${estadioId})">Excluir</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#007bff; cursor:pointer; font-size:0.85em;" 
                onclick="compartilharEstadio(${jogoId}, ${estadioId})">Compartilhar</button>
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#28a745; cursor:pointer; font-size:0.85em;" 
                onclick="compartilharAppSintonizadaEstadio(${estadioId})">App+Est√°dio</button>
    `;

    // Bot√£o Copiar
    botoes += `
        <button style="padding:6px 10px; border:none; border-radius:5px; color:white; cursor:pointer; font-size:0.85em; background:${isCopiado ? '#28a745' : '#6f42c1'};"
                onclick="copiarEstadio(${jogoId}, ${estadioId})">
            ${isCopiado ? 'Copiado' : 'Copiar'}
        </button>
    `;
    
        // Bot√£o Copiar
    botoes += `
        <button   onclick="entrarSalaEstadio(${jogoId}, ${estadioId})">
        entrar estadio
        </button>
    `;
  
    
    

  

    return botoes;
}
// === 1. LISTAR EST√ÅDIOS DE UM JOGO ESPEC√çFICO ===
function gerarHTMLCardEstadio(jogo, estadio, modoGeral = false) {
    const jogoId = jogo.id;
    const estadioId = estadio.id;
    const imagem = obterImagem('estadio', estadio.imagem);

    // Estado do toggle (pode ser salvo em localStorage depois)
    const toggleStates = {};
    const isExpanded = toggleStates[estadioId] || false;

    // === CONTAINER PRINCIPAL ===
    const cardHTML = `
        <div class="estadio-item" style="border:1px solid #ddd; margin:15px 0; padding:15px; border-radius:8px; background:#fafafa;">
            <!-- HEADER -->
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <img src="${imagem}" alt="${estadio.nome}" 
                         style="width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer;"
                         onclick="verTimesDoEstadio(${jogoId}, ${estadioId})"
                         title="Ver times">
                    <div>
                        <h3 style="margin:0; cursor:pointer; color:#007bff; font-size:1.1em;" 
                            onclick="verTimesDoEstadio(${jogoId}, ${estadioId})">
                            ${estadio.nome}
                        </h3>
                        <p style="margin:3px 0; color:#555; font-size:0.9em;">
                            ID: ${estadioId}${modoGeral ? ` | Jogo: ${jogo.nome}` : ''}
                            | Times: ${estadio.times.length}
                        </p>
                    </div>
                </div>
                <button id="toggle-${estadioId}" 
                        style="width:36px; height:36px; border:none; border-radius:50%; background:#007bff; color:white; font-weight:bold; font-size:1.2em; cursor:pointer; display:flex; align-items:center; justify-content:center;"
                        onclick="toggleEstadioBotoes(${estadioId})">
                    ${isExpanded ? '‚àí' : '+'}
                </button>
            </div>

            <!-- BOT√ïES (ocult√°veis) -->
            <div id="botoes-estadio-${estadioId}" 
                 style="display:${isExpanded ? 'flex' : 'none'}; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:12px; padding:10px; background:#f8f9fa; border-radius:6px;">
                ${gerarBotoesEstadio(jogoId, estadioId)}
            </div>
            <hr>
        </div>
    `;

    return cardHTML;
}
// === VARI√ÅVEIS GLOBAIS ===
// === 1. LISTAR TIMES DE UM EST√ÅDIO ===
function carregarTimesDoEstadio(jogoId, estadioId) {
    const container = document.getElementById('lista-times');
    container.innerHTML = '';

    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return alert("Jogo n√£o encontrado!");

    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return alert("Est√°dio n√£o encontrado!");

    document.querySelector('#secao-times h2').textContent = `Times - ${estadio.nome} (${jogo.nome})`;

    // === TOPO: ADICIONAR + COMPARTILHAR ===
    const topo = document.createElement('div');
    topo.innerHTML = `
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button onclick="adicionarTime(${jogoId}, ${estadioId})" style="background:#28a745; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                + Criar novo Time
            </button>
            <button onclick="colarTimeCopiado(${jogoId}, ${estadioId})" style="background:#6f42c1; color:white; padding:8px 12px; border:none; border-radius:5px; font-size:0.9em;">
                Colar Time
            </button>


        </div>
    `;
  
    container.appendChild(topo);

    // === LISTAR TIMES ===
    estadio.times.forEach(time => {
        const el = document.createElement('div');
        el.innerHTML = gerarHTMLCardTime(jogo, estadio, time);
        container.appendChild(el);
    });
}
// === 2. LISTAR TODOS OS TIMES (VIS√ÉO GERAL) ===
function carregarTimes() {
    const container = document.getElementById('lista-times');
    container.innerHTML = '';

    document.querySelector('#secao-times h2').textContent = 'Todos os Times';

    let totalTimes = 0;
    dados.jogos.forEach(j => j.estadios.forEach(e => totalTimes += e.times.length));

    if (totalTimes === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhum time cadastrado.</p>';
        return;
    }

    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            if (estadio.times.length === 0) return;

            const titulo = document.createElement('h3');
            titulo.textContent = `Est√°dio: ${estadio.nome} | Jogo: ${jogo.nome}`;
            titulo.style = 'margin:20px 0 10px; padding-bottom:5px; border-bottom:1px solid #ddd;';
            container.appendChild(titulo);

            estadio.times.forEach(time => {
                const el = document.createElement('div');
                el.innerHTML = gerarHTMLCardTime(jogo, estadio, time, true);
                container.appendChild(el);
            });
        });
    });
}
// === GERA HTML DO CARD DO TIME COM CHAT ===
function gerarHTMLCardTime(jogo, estadio, time, modoGeral = false) {
    const jogoId = jogo.id;
    const estadioId = estadio.id;
    const timeId = time.id;
    const imagem = obterImagem('time', time.imagem);
    const isCopiado = timeCopiado && timeCopiado.id === timeId && timeCopiado.estadioId === estadioId && timeCopiado.jogoId === jogoId;

    return `
        <div class="time-item" style="border:1px solid #ddd; margin:15px 0; padding:15px; border-radius:8px; background:#fafafa;">
            <!-- HEADER -->
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <img src="${imagem}" alt="${time.nome}" 
                         style="width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer;"
                         onclick="verLivesDoTime(${jogoId}, ${estadioId}, ${timeId})"
                         title="Ver lives">
                    <div>
                        <h3 style="margin:0; cursor:pointer; color:#007bff; font-size:1.1em;" 
                            onclick="verLivesDoTime(${jogoId}, ${estadioId}, ${timeId})">
                            ${time.nome}
                        </h3>
                        <p style="margin:3px 0; color:#555; font-size:0.9em;">
                            ID: ${timeId}
                            ${modoGeral ? ` | Est√°dio: ${estadio.nome} | Jogo: ${jogo.nome}` : ''}
                            | Lives: ${time.lives ? time.lives.length : 0}
                        </p>
                    </div>
                </div>
                <button id="toggle-time-${timeId}" 
                        style="width:36px; height:36px; border:none; border-radius:50%; background:#007bff; color:white; font-weight:bold; font-size:1.2em; cursor:pointer; display:flex; align-items:center; justify-content:center;"
                        onclick="toggleTimeBotoes(${timeId})">
                    +
                </button>
            </div>

            <!-- BOT√ïES OCULT√ÅVEIS -->
            <div id="botoes-time-${timeId}" 
                 style="display:none; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:12px; padding:10px; background:#f8f9fa; border-radius:6px;">
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#17a2b8; cursor:pointer; font-size:0.85em;" 
                        onclick="verDetalhesTime(${jogoId}, ${estadioId}, ${timeId})">Ver</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#ffc107; cursor:pointer; font-size:0.85em;" 
                        onclick="editarTime(${jogoId}, ${estadioId}, ${timeId})">Editar</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#6c757d; cursor:pointer; font-size:0.85em;" 
                        onclick="alterarImagemTime(${jogoId}, ${estadioId}, ${timeId})">Imagem</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#dc3545; cursor:pointer; font-size:0.85em;" 
                        onclick="excluirTime(${jogoId}, ${estadioId}, ${timeId})">Excluir</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#007bff; cursor:pointer; font-size:0.85em;" 
                        onclick="compartilharTime(${timeId})">Compartilhar</button>
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; background:#28a745; cursor:pointer; font-size:0.85em;" 
                        onclick="compartilharAppSintonizadaTime(${timeId})">App+Time</button>

                <!-- BOT√ÉO COPIAR -->
                <button style="padding:6px 10px; border:none; border-radius:5px; color:white; cursor:pointer; font-size:0.85em; background:${isCopiado ? '#28a745' : '#6f42c1'};"
                        onclick="copiarTime(${jogoId}, ${estadioId}, ${timeId})">
                    ${isCopiado ? 'Copiado' : 'Copiar'}
                </button>

                <!-- BOT√ÉO CHAT DO TIME -->
                <button onclick="entrarSalaTime(${jogoId}, ${estadioId}, ${timeId})">
                    üí¨ Chat do time
                </button>
                
            </div>
            <hr>
        </div>
    `;
}

                    


function ContainnersDeLivers(live, jogoId, estadioId, timeId) {
    const divsHorizontais = live.divsHorizontais || [];
    const statusClass = live.status === 'ativa' ? 'live-status' : 'live-status inactive';
    const liveId = live.id;
    
    // Estado do toggle (usar mesmo padr√£o dos outros m√≥dulos)
    const isExpanded = toggleStatesLive[liveId] || false;
    const isCopiado = liveCopiada && liveCopiada.id === liveId && 
                     liveCopiada.jogoId === jogoId && 
                     liveCopiada.estadioId === estadioId && 
                     liveCopiada.timeId === timeId;

    return `
        <div class="live-container">
            <!-- HEADER COM TOGGLE -->
            <div class="live-header-with-toggle">
                <div class="live-header-content">
                    <h3 class="live-title">${live.titulo}</h3>
                    <p class="live-description">${live.descricao}</p>
                    <p class="live-meta">
                        Criado por: ${live.criador} | ${divsHorizontais.length} div(s)
                    </p>
                </div>
                <span class="${statusClass}">${live.status}</span>
                <button id="toggle-live-${liveId}" 
                        class="toggle-btn"
                        onclick="toggleLiveBotoes(${liveId})">
                    ${isExpanded ? '‚àí' : '+'}
                </button>
            </div>

            <!-- CONTAINER DE BOT√ïES (OCULT√ÅVEL) -->
            <div id="botoes-live-${liveId}" 
                 class="botoes-container"
                 style="display: ${isExpanded ? 'flex' : 'none'}">
                <!-- BOT√ïES EXISTENTES -->
                <button onclick="verDetalhesLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-info">Ver</button>
                <button onclick="editarLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-warning">Editar</button>
                <button onclick="excluirLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-danger">Excluir</button>
                <button onclick="copiarLive(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-copy ${isCopiado ? 'copied' : ''}">
                    ${isCopiado ? 'Copiado' : 'Copiar'}
                </button>
                <button onclick="colarLiveCopiada(${jogoId}, ${estadioId}, ${timeId})" 
                        class="btn btn-paste">Colar Live</button>
                
                <!-- BOT√ÉO CHAT DA LIVE -->
                

            <button onclick="entrarSalaLive(${jogoId}, ${estadioId}, ${timeId},${liveId})">
                    üí¨ Chat da live
                </button>



                ${usuarioLogado ? `
                    <button onclick="compartilharAppSintonizadaLive(${liveId})" 
                            class="btn" 
                            style="background:#FF9800; color:white;">
                        üì± App + Live
                    </button>
                ` : ''}
            </div>

            <!-- SE√á√ÉO DE DIVS HORIZONTAIS (MANTIDO ORIGINAL) -->
            <div class="divs-section">
                <div class="divs-header">
                    <h4 class="divs-title">üì∫ Divs de Transmiss√£o</h4>
                    ${usuarioLogado ? `
                        <button onclick="adicionarDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${live.id})" 
                                class="btn btn-secondary">
                            + Nova Div
                        </button>
                    ` : ''}
                </div>
                
                ${divsHorizontais.length > 0 ? `
                    <div id="divs-horizontais-${live.id}">
                        ${divsHorizontais.map(div => criarHTMLDivHorizontal(div, jogoId, estadioId, timeId, live.id)).join('')}
                    </div>
                ` : `
                    <div class="empty-state">
                        <p>Nenhuma div de transmiss√£o criada</p>
                    </div>
                `}
            </div>
        </div>
    `;
}
// Fun√ß√£o principal para carregar lives
function carregarLivesDoTime(jogoId, estadioId, timeId) {
    const container = document.getElementById('lista-lives');
    container.innerHTML = '';
  
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) {
        container.innerHTML = '<p>Jogo n√£o encontrado</p>';
        return;
    }
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) {
        container.innerHTML = '<p>Est√°dio n√£o encontrado</p>';
        return;
    }
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) {
        container.innerHTML = '<p>Time n√£o encontrado</p>';
        return;
    }
    
    document.querySelector('#secao-lives h2').textContent = `Lives - ${time.nome}`;
    /*
    if (!time.lives || time.lives.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <p>carregarLivesDoTime</p>
                <p>Nenhuma live cadastrada para este time</p>
                ${streamerLogado ? `
                    <button onclick="adicionarLive()" class="btn btn-primary btn-large">
                        Criar Live Principal
                    </button>
                ` : ''}
            </div>
        `;
        return;
    }
  */
  // ‚úÖ C√ìDIGO CORRIGIDO:
if (!time.lives || time.lives.length === 0) {
    container.innerHTML = `
        <div class="empty-state">
            <p>carregarLivesDoTime</p>
            <p>Nenhuma live cadastrada para este time</p>
            ${streamerLogado ? `
                <button onclick="adicionarLive(${jogoId}, ${estadioId}, ${timeId})" class="btn btn-primary btn-large">
                    Criar Live Principal
                </button>
            ` : ''}
        </div>
    `;
    return;
} else {
    console.log("Carregando lives encontradas:", time.lives.length);
    
    // ‚úÖ CONTINUA A EXECU√á√ÉO NORMAL
    if (typeof adicionarBotoesControleTamanho === 'function') {
        adicionarBotoesControleTamanho();
    }
    
    container.innerHTML = `
        <div class="actions-container">
            <div class="actions-container" style="text-align:center; margin:15px 0; padding:10px; background:#f8f9fa; border-radius:8px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
            ${streamerLogado ? `
                <button onclick="adicionarLive(${jogoId}, ${estadioId}, ${timeId})" class="btn btn-primary">
                    + Nova Live
                </button>
                <button onclick="colarLiveCopiada(${jogoId}, ${estadioId}, ${timeId})" class="btn" style="background:#6f42c1; color:white;">
                    Colar Live
                </button>
            ` : ''}
            </div>
        </div>
        
        <div id="grid-lives" class="lives-grid"></div>
    `;
    
    const gridContainer = document.getElementById('grid-lives');
    
    time.lives.forEach((live) => {
        const liveCard = document.createElement('div');
        liveCard.className = 'live-card';
        liveCard.innerHTML = ContainnersDeLivers(live, jogoId, estadioId, timeId);
        gridContainer.appendChild(liveCard);
    });
}
  
  
    console.log("time",time)
    console.log("time.lives",time.lives)
    if (typeof adicionarBotoesControleTamanho === 'function') {
        adicionarBotoesControleTamanho();
    }
    
    container.innerHTML = `
        <div class="actions-container">
       <!--     ${streamerLogado ? `
                <button onclick="adicionarLive()" class="btn btn-primary">
                    Criar Nova Live
                </button>
            ` : ''} -->

        </div>
            <div class="actions-container" style="text-align:center; margin:15px 0; padding:10px; background:#f8f9fa; border-radius:8px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
        ${streamerLogado ? `
            <button onclick="adicionarLive(${jogoId}, ${estadioId}, ${timeId})" class="btn btn-primary">
                + Nova Live
            </button>
            <button onclick="colarLiveCopiada(${jogoId}, ${estadioId}, ${timeId})" class="btn" style="background:#6f42c1; color:white;">
                Colar Live
            </button>
        ` : ''}
    </div>
        
        <div id="grid-lives" class="lives-grid"></div>
    `;
    const gridContainer = document.getElementById('grid-lives');

    time.lives.forEach((live) => {
        const liveCard = document.createElement('div');
        liveCard.className = 'live-card';
        liveCard.innerHTML = ContainnersDeLivers(live, jogoId, estadioId, timeId);
        gridContainer.appendChild(liveCard);
    });
    


   // inicializarBotoesApostas()
}





// Fun√ß√£o para adicionar jogo (COM LOG)
function adicionarJogo() {
    const novoId = dados.jogos.length > 0 ? Math.max(...dados.jogos.map(j => j.id)) + 1 : 1;
    
    const nome = prompt("Nome do Jogo:");
    if (!nome) return;
    
    const novoJogo = {
        id: novoId,
        nome: nome,
        imagem: "jogo.jpg",
        estadios: []
    };
    
    dados.jogos.push(novoJogo);
    
    // === LOG ADICIONADO ===
    console.group(`JOGO ADICIONADO: "${nome}" (ID: ${novoId})`);
    //console.log("Jogo adicionado:", novoJogo);
    //console.log("Objeto completo 'dados.jogos':", dados.jogos);
    //console.log("Estrutura completa 'dados':", JSON.parse(JSON.stringify(dados))); // deep clone para log
    console.groupEnd();
    // =======================

    carregarJogos();
    alert(`Jogo "${nome}" adicionado com ID: ${novoId}`);
}

function verEstadiosDoJogo(jogoId) {
    jogoSelecionadoId = jogoId;
    mostrarSecao('estadios');
    carregarEstadiosDoJogo(jogoId);
}
// Fun√ß√£o para ver detalhes do jogo
function verDetalhesJogo(jogoId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        alert(`Detalhes do Jogo:\nNome: ${jogo.nome}\nID: ${jogo.id}\nEst√°dios: ${jogo.estadios.length}`);
    }
}
// Fun√ß√£o para editar jogo
function editarJogo(id) {
    const jogo = dados.jogos.find(j => j.id === id);
    if (jogo) {
        const novoNome = prompt("Novo nome do Jogo:", jogo.nome);
        if (novoNome) {
            jogo.nome = novoNome;
            carregarJogos();
        }
    }
}
// Fun√ß√£o para excluir jogo
function excluirJogo(id) {
    if (confirm("Tem certeza que deseja excluir este jogo e todos os seus est√°dios, times e streamers?")) {
        dados.jogos = dados.jogos.filter(j => j.id !== id);
        carregarJogos();
    }
}


////////////
////////////
////////////estadio
////////////
////////////
////////////
// Fun√ß√£o para carregar est√°dios de um jogo espec√≠fico
// === ESTADIOS.JS ===
// M√≥dulo completo: lista por jogo + lista geral de todos os est√°dios
// === FUN√á√ÉO AUXILIAR: RECARREGA A LISTA ATUAL ===
function recarregarListaEstadiosAtual() {
    const urlParams = new URLSearchParams(window.location.search);
    const jogoId = parseInt(urlParams.get('jogo'));

    if (jogoId && document.getElementById('lista-estadios').innerHTML.includes('Est√°dios - ')) {
        carregarEstadiosDoJogo(jogoId);
    } else {
        carregarEstadios();
    }
}
// === ADICIONAR EST√ÅDIO (s√≥ no modo jogo selecionado) ===
function adicionarEstadio() {
    if (!jogoSelecionadoId) return alert("Selecione um jogo primeiro!");

    const jogo = dados.jogos.find(j => j.id === jogoSelecionadoId);
    const novoId = jogo.estadios.length ? Math.max(...jogo.estadios.map(e => e.id)) + 1 : 1;
    const nome = prompt("Nome do est√°dio:");
    if (!nome?.trim()) return;

    jogo.estadios.push({ id: novoId, nome: nome.trim(), imagem: "estadio.jpg", times: [] });
    carregarEstadiosDoJogo(jogoSelecionadoId);
    alert("Est√°dio adicionado!");
}
function alterarImagemEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return;
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return;
    
    const novaImagem = prompt("URL da nova imagem (deixe em branco para padr√£o):", estadio.imagem);
    if (novaImagem !== null) {
        estadio.imagem = novaImagem;
        carregarEstadiosDoJogo(jogoId);
        alert("Imagem atualizada!");
    }
}
// Fun√ß√£o para navegar para os times de um est√°dio espec√≠fico
function verTimesDoEstadio(jogoId, estadioId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    mostrarSecao('times');
    carregarTimesDoEstadio(jogoId, estadioId);
}
// Fun√ß√£o para ver detalhes do est√°dio
function verDetalhesEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            alert(`Detalhes do Est√°dio:\nNome: ${estadio.nome}\nID: ${estadio.id}\nTimes: ${estadio.times.length}`);
        }
    }
}
// Fun√ß√£o para editar est√°dio
function editarEstadio(jogoId, estadioId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            const novoNome = prompt("Novo nome do Est√°dio:", estadio.nome);
            if (novoNome) {
                estadio.nome = novoNome;
                carregarEstadiosDoJogo(jogoId);
            }
        }
    }
}
// Fun√ß√£o para excluir est√°dio
function excluirEstadio(jogoId, estadioId) {
    if (confirm("Tem certeza que deseja excluir este est√°dio e todos os seus times e streamers?")) {
        const jogo = dados.jogos.find(j => j.id === jogoId);
        if (jogo) {
            jogo.estadios = jogo.estadios.filter(e => e.id !== estadioId);
            carregarEstadiosDoJogo(jogoId);
        }
    }
}
// Fun√ß√£o original para carregar todos os est√°dios (mantida para compatibilidade)




////////////
////////////
////////////  times
////////////
////////////
////////////
// Fun√ß√£o para carregar times de um est√°dio espec√≠fico






// Fun√ß√£o para alterar imagem do time
function alterarImagemTime(jogoId, estadioId, timeId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) return;
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) return;
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) return;
    
    const novaImagem = prompt("URL da nova imagem (deixe em branco para padr√£o):", time.imagem);
    if (novaImagem !== null) {
        time.imagem = novaImagem;
        carregarTimesDoEstadio(jogoId, estadioId);
        alert("Imagem atualizada!");
    }
}
// Fun√ß√£o para ver detalhes do time
function verDetalhesTime(jogoId, estadioId, timeId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            const time = estadio.times.find(t => t.id === timeId);
            if (time) {
                alert(`Detalhes do Time:\nNome: ${time.nome}\nID: ${time.id}\nLives: ${time.lives ? time.lives.length : 0}`);
            }
        }
    }
}
// Fun√ß√£o para editar time
function editarTime(jogoId, estadioId, timeId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) {
        const estadio = jogo.estadios.find(e => e.id === estadioId);
        if (estadio) {
            const time = estadio.times.find(t => t.id === timeId);
            if (time) {
                const novoNome = prompt("Novo nome do Time:", time.nome);
                if (novoNome) {
                    time.nome = novoNome;
                    carregarTimesDoEstadio(jogoId, estadioId);
                }
            }
        }
    }
}
// Fun√ß√£o para excluir time
function excluirTime(jogoId, estadioId, timeId) {
    if (confirm("Tem certeza que deseja excluir este time e todas as suas lives?")) {
        const jogo = dados.jogos.find(j => j.id === jogoId);
        if (jogo) {
            const estadio = jogo.estadios.find(e => e.id === estadioId);
            if (estadio) {
                estadio.times = estadio.times.filter(t => t.id !== timeId);
                carregarTimesDoEstadio(jogoId, estadioId);
            }
        }
    }
}
// Fun√ß√£o para navegar para as lives de um time espec√≠fico
function verLivesDoTime(jogoId, estadioId, timeId) {
    jogoSelecionadoId = jogoId;
    estadioSelecionadoId = estadioId;
    mostrarSecao('lives');
    carregarLivesDoTime(jogoId, estadioId, timeId);
}
function recarregarListaTimesAtual() {
    const urlParams = new URLSearchParams(window.location.search);
    const jogoId = parseInt(urlParams.get('jogo'));
    const estadioId = parseInt(urlParams.get('estadio'));

    if (jogoId && estadioId && document.getElementById('lista-times').innerHTML.includes('Times - ')) {
        carregarTimesDoEstadio(jogoId, estadioId);
    } else {
        carregarTimes();
    }
}
////////////
////////////
////////////  live.js
////////////
////////////
////////////




function adicionarDivHorizontal(jogoId, estadioId, timeId, liveId) {
    if (!usuarioLogado) {
        alert("Fa√ßa login para criar divs de transmiss√£o!");
        return;
    }
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live) return;
    
    // Verificar limite de divs
    if ((live.divsHorizontais || []).length >= configLives.maxDivsPorLive) {
        alert(`Limite de ${configLives.maxDivsPorLive} divs por live atingido!`);
        return;
    }
    
    const titulo = prompt("T√≠tulo da div horizontal:");
    if (!titulo) return;
    
    // Configurar layout e tamanho em uma √∫nica etapa
    const config = obterConfiguracaoDiv();
    if (!config) return;
    
    const novaDiv = {
        id: Date.now(),
        titulo: titulo,
        layout: config.layout,
        colunas: config.colunas,
        tamanhoCard: config.tamanhoCard,
        altura: config.altura,
        criador: usuarioLogado.usuario,
        cards: [],
        dataCriacao: new Date().toLocaleString()
    };
    
    if (!live.divsHorizontais) live.divsHorizontais = [];
    live.divsHorizontais.push(novaDiv);
    
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert(`Div "${titulo}" criada com sucesso!`);
}
// FUN√á√ÉO CHAT PARA LIVE
// FUN√á√ÉO TOGGLE PARA LIVES
function editarLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) {
        const novoTitulo = prompt("Novo t√≠tulo da Live:", live.titulo);
        if (novoTitulo) {
            live.titulo = novoTitulo;
            salvarDados();
            carregarLivesDoTime(jogoId, estadioId, timeId);
        }
    }
}
function excluirLive(jogoId, estadioId, timeId, liveId) {
    if (!confirm("Tem certeza que deseja excluir esta live?")) return;

    const time = encontrarTime(jogoId, estadioId, timeId);
    if (!time || !time.lives) return;

    time.lives = time.lives.filter(l => l.id !== liveId);
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    mostrarNotificacao("Live exclu√≠da!", "sucesso");
}
// FUN√á√ïES AUXILIARES PARA ENCONTRAR ELEMENTOS
function encontrarJogo(jogoId) {
    return dados.jogos.find(j => j.id === jogoId);
}
function encontrarEstadio(jogoId, estadioId) {
    const jogo = encontrarJogo(jogoId);
    return jogo ? jogo.estadios.find(e => e.id === estadioId) : null;
}
function encontrarTime(jogoId, estadioId, timeId) {
    const estadio = encontrarEstadio(jogoId, estadioId);
    return estadio ? estadio.times.find(t => t.id === timeId) : null;
}
// FUN√á√ÉO ENCONTRAR LIVE - VERIFICAR SE EST√Å COMPLETA
function encontrarLive(jogoId, estadioId, timeId, liveId) {
    console.log('üîç Buscando live:', { jogoId, estadioId, timeId, liveId });
    //console.log('üìä Dados dispon√≠veis:', dados);
    
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (!jogo) {
        console.log('‚ùå Jogo n√£o encontrado');
        return null;
    }
    
    const estadio = jogo.estadios.find(e => e.id === estadioId);
    if (!estadio) {
        console.log('‚ùå Est√°dio n√£o encontrado');
        return null;
    }
    
    const time = estadio.times.find(t => t.id === timeId);
    if (!time) {
        console.log('‚ùå Time n√£o encontrado');
        return null;
    }
    
    if (!time.lives || !Array.isArray(time.lives)) {
        console.log('‚ùå Lives n√£o encontradas ou n√£o √© array');
        return null;
    }
    
    const live = time.lives.find(l => l.id === liveId);
    if (!live) {
        console.log('‚ùå Live n√£o encontrada');
        return null;
    }
    
    //console.log('‚úÖ Live encontrada:', live);
    return live;
}
// FUN√á√ÉO VER DETALHES LIVE MELHORADA
function verDetalhesLive(jogoId, estadioId, timeId, liveId) {
    console.group('üîç VER DETALHES LIVE');
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) {
        const divsCount = live.divsHorizontais ? live.divsHorizontais.length : 0;
        let totalCards = 0;
        
        // CONTAR TOTAL DE CARDS EM TODAS AS DIVS
        if (live.divsHorizontais) {
            live.divsHorizontais.forEach(div => {
                if (div.cards && Array.isArray(div.cards)) {
                    totalCards += div.cards.length;
                }
            });
        }
        
        const detalhes = `
üìã DETALHES DA LIVE:

üè∑Ô∏è T√≠tulo: ${live.titulo}
üÜî ID: ${live.id}
üìä Status: ${live.status || 'N√£o definido'}
üë§ Criador: ${live.criador || 'N√£o informado'}
üìù Descri√ß√£o: ${live.descricao || 'Sem descri√ß√£o'}

üìä ESTAT√çSTICAS:
‚Ä¢ Divs de Transmiss√£o: ${divsCount}
‚Ä¢ Total de Cards: ${totalCards}
‚Ä¢ Cards por Div: ${divsCount > 0 ? (totalCards / divsCount).toFixed(1) : 0}

üèóÔ∏è ESTRUTURA:
‚Ä¢ Jogo ID: ${jogoId}
‚Ä¢ Est√°dio ID: ${estadioId} 
‚Ä¢ Time ID: ${timeId}
‚Ä¢ Live ID: ${liveId}
        `.trim();
        
        //console.log('üìÑ Detalhes da live:', detalhes);
        alert(detalhes);
    } else {
        const erro = `‚ùå LIVE N√ÉO ENCONTRADA!\n\nVerifique os IDs:\n‚Ä¢ Jogo: ${jogoId}\n‚Ä¢ Est√°dio: ${estadioId}\n‚Ä¢ Time: ${timeId}\n‚Ä¢ Live: ${liveId}`;
        console.error('Erro ao encontrar live:', erro);
        alert(erro);
    }
    
    console.groupEnd();
    return live;
}
// TESTE DE ACESSO AOS DADOS
function testarAcessoDados() {
   /* console.group('üß™ TESTE DE ACESSO A DADOS');
    console.log('üì¶ Objeto dados completo:', dados);
    console.log('üéÆ Jogos:', dados.jogos);
    console.log('üèüÔ∏è Total de est√°dios:', dados.jogos.reduce((acc, jogo) => acc + jogo.estadios.length, 0));
    console.log('‚è∞ Times:', dados.jogos.flatMap(jogo => jogo.estadios.flatMap(estadio => estadio.times)));
    console.log('üî¥ Lives:', dados.jogos.flatMap(jogo => 
        jogo.estadios.flatMap(estadio => 
            estadio.times.flatMap(time => 
                time.lives || []
            )
        )
    ));*/
    console.groupEnd();
}

// CHAMAR TESTE (opcional - remover depois)
// testarAcessoDados();
// FUN√á√ÉO EDITAR LIVE (CORRIGIDA)
function editarLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) {
        const novoTitulo = prompt("Novo t√≠tulo da Live:", live.titulo);
        if (novoTitulo) {
            live.titulo = novoTitulo;
            salvarDados();
            carregarLivesDoTime(jogoId, estadioId, timeId);
        }
    } else {
        alert("Live n√£o encontrada!");
    }
}

////////////
////////////
////////////
////////////
////////////
////////////
// cards.js - SEM ESTILOS INLINE
//ContainnersDeLivers

// Editar Card Horizontal
function editarCardHorizontal(jogoId, estadioId, timeId, liveId, divId, cardId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div || !div.cards) return;
    
    const card = div.cards.find(c => c.id === cardId);
    if (!card) return;
    
    if (!usuarioLogado || usuarioLogado.usuario !== card.criador) {
        alert("Apenas o criador pode editar este card!");
        return;
    }
    
    const novoTitulo = prompt("Novo t√≠tulo:", card.titulo);
    if (novoTitulo === null) return;
    
    const novoIframeUrl = prompt("Nova URL do iframe:", card.iframeUrl);
    if (!novoIframeUrl) return;
    
    card.titulo = novoTitulo;
    card.iframeUrl = novoIframeUrl;
    
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert("Card atualizado!");
}
// Remover Card da Div
function removerCardDaDiv(jogoId, estadioId, timeId, liveId, divId, cardId) {
    if (!confirm("Tem certeza que deseja remover este card?")) return;
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div || !div.cards) return;
    
    const card = div.cards.find(c => c.id === cardId);
    if (!card) return;
    
    if (!usuarioLogado || usuarioLogado.usuario !== card.criador) {
        alert("Apenas o criador pode remover este card!");
        return;
    }
    
    div.cards = div.cards.filter(c => c.id !== cardId);
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert("Card removido!");
}




////////////
////////////
////////////
////////////
////////////
////////////

// MODIFICAR A FUN√á√ÉO criarHTMLDivHorizontal PARA INCLUIR O SCROLL CONTAINER

function ContainersDeLivsHorizontais(div, jogoId, estadioId, timeId, liveId, divId, isExpanded = false, isCopiado = false) {
    const podeGerenciar = usuarioLogado && usuarioLogado.usuario === div.criador;
    const cardsCount = div.cards ? div.cards.length : 0;

    return `
        <div class="div-header">
            <div class="div-header-content">
                <h5 class="div-title">
                    ${div.titulo} 
                    <span class="div-count">(${cardsCount} cards)</span>
                </h5>
                <p class="div-meta">
                    Layout: ${div.layout === 'colunas' ? `${div.colunas} colunas` : 'horizontal'} 
                    | Cards: ${div.tamanhoCard || div.tamanho || 'medio'}
                    | Por: ${div.criador}
                    | Altura: ${div.altura}
                </p>
            </div>
            
            <div class="div-actions">
                <!-- BOT√ÉO TOGGLE -->
                <button id="toggle-div-${div.id}" 
                        class="toggle-btn"
                        onclick="toggleDivBotoes(${div.id})">
                    ${isExpanded ? '‚àí' : '+'}
                </button>
                
                ${podeGerenciar ? `
                    <button onclick="adicionarCardNaDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                            class="btn btn-primary"
                            ${cardsCount >= configLives.maxCardsPorDiv ? 'disabled' : ''}>
                        + Card
                    </button>
                ` : ''}
                
                <!-- BOT√ÉO CHAT DA DIV -->
                <button onclick="abrirChatDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                        class="btn" 
                        style="background:#9c27b0; color:white;">
                    üí¨ Chat Div
                </button>
                
                <!-- Dropdown Button (CONTE√öDO ORIGINAL COMPLETO) -->
                <div class="dropdown">
                    <button class="btn btn-dropdown" type="button" onclick="toggleDropdown(this)">
                        Settings
                    </button>
                    <div class="dropdown-menu">
                        <!-- Tamanhos -->
                        <div class="dropdown-header">Tamanho</div>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhoPequeno('${divId}'); fecharDropdown(this)">Pequeno</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhomedio('${divId}'); fecharDropdown(this)">M√©dio</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhogrande('${divId}'); fecharDropdown(this)">Grande</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToTamanhomuitoGrande('${divId}'); fecharDropdown(this)">Muito Grande</button>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Toggle Functions -->
                        <div class="dropdown-header">Toggle</div>
                        <button class="dropdown-item" onclick="adicionarBotaoToggleVideoInfo('${divId}'); fecharDropdown(this)">Toggle Video Info</button>
                        <button class="dropdown-item" onclick="adicionarBotaoToggleVideoInfoAvancado('${divId}'); fecharDropdown(this)">Toggle Video Info Avan√ßado</button>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Layout -->
                        <div class="dropdown-header">Layout</div>
                        <button class="dropdown-item" onclick="adicionarBotaoMudarColunas('${divId}'); fecharDropdown(this)">Mudar Colunas</button>
                        <button class="dropdown-item" onclick="adicionarBotaoEscolherDiv('${divId}'); fecharDropdown(this)">Escolher Div</button>
                        
                        <div class="dropdown-divider"></div>
                        
                        <!-- Reset -->
                        <button class="dropdown-item text-danger" onclick="adicionarBotaoResetDisplay('${divId}'); fecharDropdown(this)">Reset Display</button>
                        
                        ${podeGerenciar ? `
                            <div class="dropdown-divider"></div>
                            <!-- A√ß√µes da Div -->
                            <button class="dropdown-item" onclick="configurarAparenciaDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id}); fecharDropdown(this)">Configurar Layout</button>
                            <button class="dropdown-item" onclick="configurarDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id}); fecharDropdown(this)">Configurar Div</button>
                            <button class="dropdown-item text-danger" onclick="excluirDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id}); fecharDropdown(this)">Excluir Div</button>
                        ` : ''}
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTAINER DE BOT√ïES DA DIV (OCULT√ÅVEL) -->
        <div id="botoes-div-${div.id}" 
             class="botoes-container"
             style="display: ${isExpanded ? 'flex' : 'none'}">
            <button onclick="verDetalhesDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-info">Ver</button>
            <button onclick="editarDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-warning">Editar</button>
            <button onclick="excluirDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-danger">Excluir</button>
            <button onclick="copiarDivHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                    class="btn btn-copy ${isCopiado ? 'copied' : ''}">
                ${isCopiado ? 'Copiado' : 'Copiar'}
            </button>
            <button onclick="colarDivHorizontalCopiada(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                   class="btn btn-paste">Colar Div
            </button>
           <button onclick="entrarSalaDiv(${jogoId}, ${estadioId}, ${timeId},${liveId},${div.id})">
                    üí¨ Chat da live
                </button>
        </div>
    `;
}
function adicionarCardNaDiv(jogoId, estadioId, timeId, liveId, divId) {
    if (!usuarioLogado) {
        alert("Fa√ßa login para adicionar cards!");
        return;
    }
    
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div) return;
    
    // Verificar limite de cards
    if (div.cards.length >= configLives.maxCardsPorDiv) {
        alert(`Limite de ${configLives.maxCardsPorDiv} cards por div atingido!`);
        return;
    }
    
    // Verificar permiss√£o
    if (usuarioLogado.usuario !== div.criador) {
        alert("Apenas o criador da div pode adicionar cards!");
        return;
    }
    
    const titulo = prompt("T√≠tulo do card:");
    if (!titulo) return;
    
    const iframeUrl = prompt("URL do iframe do YouTube (formato: https://www.youtube.com/embed/VIDEO_ID):");
    if (!iframeUrl) return;
    
    const novoCard = {
        id: Date.now(),
        titulo: titulo,
        iframeUrl: iframeUrl,
        criador: usuarioLogado.usuario,
        dataCriacao: new Date().toLocaleString()
    };
    
    div.cards.push(novoCard);
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    alert("Card adicionado √† div!");
}

function criarHTMLDivHorizontal(div, jogoId, estadioId, timeId, liveId) {
    const divId = `div-horizontal-${div.id}`;
    const layoutClass = div.layout === 'colunas' ? 'layout-colunas' : 'layout-horizontal';
    
    // Estado do toggle para divs
    const isExpanded = toggleStatesDiv[div.id] || false;
    const isCopiado = divCopiada && divCopiada.id === div.id && 
                     divCopiada.liveId === liveId;

    const estiloDiv = div.altura || div.colunas
        ? `style="--altura-div:${div.altura || ''}; --colunas:${div.colunas || ''}; max-height:${div.altura || 'none'};"`
        : '';

    return `
        <div class="div-horizontal ${layoutClass}" ${estiloDiv} id="${divId}">
            ${ContainersDeLivsHorizontais(div, jogoId, estadioId, timeId, liveId, divId, isExpanded, isCopiado)}
            ${criarScrollHorizontalContainer(div, jogoId, estadioId, timeId, liveId, layoutClass)}
        </div>
    `.trim();
}


// FUN√á√ÉO PARA CRIAR O CONTAINER DE SCROLL HORIZONTAL
function criarScrollHorizontalContainer(div, jogoId, estadioId, timeId, liveId, layoutClass) {
    const cards = div.cards || [];
    
    if (layoutClass === 'layout-colunas') {
        // Layout em colunas
        return `
            <div class="scroll-container-colunas" style="--colunas: ${div.colunas || 3}">
                ${cards.map(card => criarCardHTML(card, jogoId, estadioId, timeId, liveId, div.id)).join('')}
            </div>
        `;
    } else {
        // Layout horizontal com scroll
        return `
            <div class="scroll-container-horizontal">
                <div class="cards-wrapper">
                    ${cards.map(card => criarCardHTML(card, jogoId, estadioId, timeId, liveId, div.id)).join('')}
                </div>
            </div>
        `;
    }
}
// FUN√á√ÉO CHAT PARA DIV HORIZONTAL




function verDetalhesDiv(jogoId, estadioId, timeId, liveId, divId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (div) {
        alert(`Detalhes da Div:\nT√≠tulo: ${div.titulo}\nID: ${div.id}\nCards: ${div.cards ? div.cards.length : 0}\nLayout: ${div.layout}\nCriador: ${div.criador}`);
    }
}

function editarDiv(jogoId, estadioId, timeId, liveId, divId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (div) {
        const novoTitulo = prompt("Novo t√≠tulo da Div:", div.titulo);
        if (novoTitulo) {
            div.titulo = novoTitulo;
            salvarDados();
            carregarLivesDoTime(jogoId, estadioId, timeId);
        }
    }
}


// FUN√á√ÉO AUXILIAR PARA ENCONTRAR DIV
function encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    return live && live.divsHorizontais ? live.divsHorizontais.find(d => d.id === divId) : null;
}
////////////
////////////
////////////
////////////
////////////
////////////


// MODIFICAR A FUN√á√ÉO criarScrollHorizontalContainer COM BOT√ÉO CHAT
function criarScrollHorizontalContainer(div, jogoId, estadioId, timeId, liveId, layoutClass) {
    const cardsHTML = div.cards && div.cards.length > 0
        ? div.cards.map(card => iframers(
            card,
            div.tamanhoCard || div.tamanho || 'medio',
            jogoId, estadioId, timeId, liveId, div.id,
            div
          )).join('')
        : `<div class="empty-card">Nenhum card adicionado</div>`;

    // Estado para copiar scroll container e toggle
    const isCopiado = scrollContainerCopiado && scrollContainerCopiado.divId === div.id;
    const isExpanded = toggleStatesScrollContainer[div.id] || false;

    return `
        <div class="horizontal-scroll-container">
            <!-- HEADER COM TOGGLE E BOT√ïES -->
            <div class="scroll-container-header">
                <span class="scroll-info">${div.cards ? div.cards.length : 0} cards</span>
                <div class="scroll-actions">
                    <!-- BOT√ÉO TOGGLE -->
                    
                    
                    
                    <button id="toggle-scroll-${div.id}" 
                            class="toggle-btn"
                            onclick="toggleScrollContainerBotoes(${div.id})">
                        ${isExpanded ? '‚àí' : '+'}
                    </button>
                </div>
            </div>

            <!-- CONTAINER DE BOT√ïES (OCULT√ÅVEL) -->
            <div id="botoes-scroll-${div.id}" 
                 class="botoes-container"
                 style="display: ${isExpanded ? 'flex' : 'none'}">
                <button onclick="copiarScrollContainer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                        class="btn btn-small ${isCopiado ? 'btn-success' : 'btn-secondary'}">
                    ${isCopiado ? 'üìã Copiado' : 'üìã Copiar'}
                </button>
                <button onclick="colarScrollContainerCopiado(${jogoId}, ${estadioId}, ${timeId}, ${liveId})" 
                        class="btn btn-small btn-primary">
                    üìã Colar
                </button>
                <button onclick="excluirScrollContainer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${div.id})" 
                        class="btn btn-small btn-danger">
                    ‚ùå Excluir
                </button>
                
                <!-- BOT√ÉO CHAT DO SCROLL CONTAINER -->
           <button onclick="entrarSalaCard(${jogoId}, ${estadioId}, ${timeId},${liveId},${div.id},${div.cards.id})">
                    üí¨ Chat da live
                </button>
            </div>

            </div>
            
            <div class="cards-container ${layoutClass}">
                ${cardsHTML}
            </div>
        </div>
    `;
}

function excluirScrollContainer(jogoId, estadioId, timeId, liveId, divId) {
    if (!confirm("Tem certeza que deseja limpar todos os cards deste scroll container?")) return;

    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (!div) return;

    div.cards = [];
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
    mostrarNotificacao("Scroll Container limpo!", "sucesso");
}



////////////
////////////
////////////
////////////
////////////
////////////

function iframers(card, tamanhoDiv, jogoId, estadioId, timeId, liveId, divId, div) {
    const sizeClass = `card-size-${tamanhoDiv}`;
    
    const isExpanded = toggleStatesIframer[card.id] || false;
    const isCopiado = iframerCopiado && iframerCopiado.id === card.id;

    return `
        <div class="video-card ${sizeClass}">
            <!-- APENAS O IFRAME PURO -->
            <div class="video-iframe-container">
                <iframe 
                    src="${card.iframeUrl}?autoplay=${configLives.autoplay}&mute=${configLives.mute}&enablejsapi=${configLives.enablejsapi}" 
                    class="video-iframe"
                    allow="autoplay; encrypted-media" 
                    allowfullscreen
                    loading="lazy">
                </iframe>
            </div>
            
            <!-- VIDEO-INFO COM TUDO: t√≠tulo, toggle e bot√µes -->
            <div class="video-info">
                <!-- HEADER COM T√çTULO E TOGGLE -->
                <div class="video-header">
                   <!-- <strong class="video-title">${card.titulo}</strong> -->
                    <div class="video-actions">
                        <button id="toggle-iframer-${card.id}" 
                                class="toggle-btn toggle-btn-small"
                                onclick="toggleIframerBotoes(${card.id})">
                            ${isExpanded ? '‚àí' : '+'}
                        </button>
                    </div>
                </div>

                <!-- CONTAINER DE BOT√ïES (OCULT√ÅVEL) -->
                <div id="botoes-iframer-${card.id}" 
                     class="botoes-container botoes-container-small"
                     style="display: ${isExpanded ? 'flex' : 'none'}">
                    <button onclick="verDetalhesIframer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small btn-info">Ver</button>
                    <button onclick="editarCardHorizontal(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small btn-warning">Editar</button>
                    <button onclick="copiarIframer(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small ${isCopiado ? 'btn-success' : 'btn-secondary'}">
                        ${isCopiado ? 'üìã Copiado' : 'üìã Copiar'}
                    </button>
                    <button onclick="colarIframerCopiado(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId})" 
                            class="btn btn-small btn-primary">Colar</button>
                    <button onclick="removerCardDaDiv(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})" 
                            class="btn btn-small btn-danger">Remover</button>
                    
                    <!-- BOT√ÉO CHAT -->
                      <button 
                          onclick="entrarSalaIframe(${jogoId}, ${estadioId}, ${timeId}, ${liveId}, ${divId}, ${card.id})"
                          class="btn btn-small btn-primary">
                          üí¨ Chat da live
                      </button>

                </div>

                <!-- INFO ADICIONAL -->
              <!--  <p class="video-author">Por: ${card.criador}</p> -->
            </div>
        </div>
    `;
}
// FUN√á√ÉO AUXILIAR PARA ENCONTRAR CARD POR ID
function encontrarCardPorId(cardId) {
    for (const jogo of dados.jogos) {
        for (const estadio of jogo.estadios) {
            for (const time of estadio.times) {
                if (time.lives) {
                    for (const live of time.lives) {
                        if (live.divsHorizontais) {
                            for (const div of live.divsHorizontais) {
                                if (div.cards) {
                                    const card = div.cards.find(c => c.id === cardId);
                                    if (card) return card;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    return null;
}
// FUN√á√ÉO AUXILIAR PARA ENCONTRAR CARD (ADICIONAR NO lives.js)
function encontrarCard(jogoId, estadioId, timeId, liveId, divId, cardId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    return div && div.cards ? div.cards.find(c => c.id === cardId) : null;
}
// MANTER AS FUN√á√ïES EXISTENTES PARA IFRAMERS
function verDetalhesIframer(jogoId, estadioId, timeId, liveId, divId, cardId) {
    const card = encontrarCard(jogoId, estadioId, timeId, liveId, divId, cardId);
    if (card) {
        alert(`Detalhes do Iframer:\nT√≠tulo: ${card.titulo}\nID: ${card.id}\nURL: ${card.iframeUrl}\nCriador: ${card.criador}`);
    } else {
        alert("Card n√£o encontrado!");
    }
}

////////////
////////////
////////////
////////////
////////////
////////////



// ===== FUN√á√ÉO UNIFICADA DE CONFIGURA√á√ÉO =====
function configurarDiv(jogoId, estadioId, timeId, liveId, divId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (!live || !live.divsHorizontais) return;
    
    const div = live.divsHorizontais.find(d => d.id === divId);
    if (!div) return;
    
    if (!usuarioLogado || usuarioLogado.usuario !== div.criador) {
        alert("Apenas o criador pode configurar esta div!");
        return;
    }
    
    const opcao = prompt(`
CONFIGURAR DIV: ${div.titulo}

1. ‚úèÔ∏è Alterar t√≠tulo
2. üé® Configurar layout e apar√™ncia
3. üóëÔ∏è Excluir esta div

Digite o n√∫mero da op√ß√£o:`);

    switch(opcao) {
        case "1":
            const novoTitulo = prompt("Novo t√≠tulo:", div.titulo);
            if (novoTitulo) {
                div.titulo = novoTitulo;
                salvarEAtualizar(jogoId, estadioId, timeId);
            }
            break;
            
        case "2":
            configurarAparenciaDiv(div, jogoId, estadioId, timeId);
            break;
            
        case "3":
            if (confirm("Tem certeza que deseja excluir esta div e todos os seus cards?")) {
                live.divsHorizontais = live.divsHorizontais.filter(d => d.id !== divId);
                salvarEAtualizar(jogoId, estadioId, timeId);
                alert("Div exclu√≠da!");
            }
            break;
    }
}

// ===== FUN√á√ÉO AUXILIAR - CONFIGURA√á√ÉO DE APAR√äNCIA =====
function configurarAparenciaDiv(div, jogoId, estadioId, timeId) {
    const opcao = prompt(`
CONFIGURAR APAR√äNCIA - ${div.titulo}

1. üîÑ Layout Horizontal
2. üìä Layout em 2 Colunas
3. üìä Layout em 3 Colunas
4. üìä Layout em 4 Colunas
5. üìè Card Pequeno
6. üìè Card M√©dio  
7. üìè Card Grande
8. üìê Configurar Altura

Digite o n√∫mero:`);

    if (!opcao) return;

    switch(opcao) {
        case "1": div.layout = "horizontal"; delete div.colunas; break;
        case "2": div.layout = "colunas"; div.colunas = 2; break;
        case "3": div.layout = "colunas"; div.colunas = 3; break;
        case "4": div.layout = "colunas"; div.colunas = 4; break;
        case "5": div.tamanhoCard = "pequeno"; break;
        case "6": div.tamanhoCard = "medio"; break;
        case "7": div.tamanhoCard = "grande"; break;
        case "8": configurarAlturaIndividual(div); break;
        default: alert("Op√ß√£o inv√°lida!"); return;
    }

    salvarEAtualizar(jogoId, estadioId, timeId);
    alert("Configura√ß√£o aplicada!");
}

// ===== FUN√á√ÉO AUXILIAR - CONFIGURA√á√ÉO DE ALTURA =====
function configurarAlturaIndividual(div) {
    const opcao = prompt(`
CONFIGURAR ALTURA:

1. Pequena (250px)
2. M√©dia (500px)  
3. Grande (750px)
4. Extra Grande (1000px)
5. Personalizada

Digite o n√∫mero:`);

    switch(opcao) {
        case "1": div.altura = "250px"; break;
        case "2": div.altura = "500px"; break;
        case "3": div.altura = "750px"; break;
        case "4": div.altura = "1000px"; break;
        case "5": 
            const altura = prompt("Digite a altura (ex: 600px):", "600px");
            if (altura && altura.includes('px')) div.altura = altura;
            break;
    }
}

// ===== FUN√á√ÉO AUXILIAR - OBTER CONFIGURA√á√ÉO INICIAL =====
function obterConfiguracaoDiv() {
    // Layout
    const layoutOpcao = prompt(`
SELECIONE O LAYOUT:

1. üîÑ Horizontal (linha √∫nica)
2. üìä 2 Colunas
3. üìä 3 Colunas  
4. üìä 4 Colunas

Digite o n√∫mero:`);

    let layout, colunas;
    switch(layoutOpcao) {
        case "1": layout = "horizontal"; break;
        case "2": layout = "colunas"; colunas = 2; break;
        case "3": layout = "colunas"; colunas = 3; break;
        case "4": layout = "colunas"; colunas = 4; break;
        default: return null;
    }

    // Tamanho do card
    const tamanhoOpcao = prompt(`
SELECIONE O TAMANHO DOS CARDS:

1. üìè Pequeno
2. üìè M√©dio
3. üìè Grande

Digite o n√∫mero:`);

    const tamanhos = { "1": "pequeno", "2": "medio", "3": "grande" };
    const tamanhoCard = tamanhos[tamanhoOpcao] || 'medio';

    // Altura
    const alturaOpcao = prompt(`
SELECIONE A ALTURA:

1. Pequena (250px)
2. M√©dia (500px)
3. Grande (750px)
4. Extra Grande (1000px)

Digite o n√∫mero:`);

    const alturas = { "1": "250px", "2": "500px", "3": "750px", "4": "1000px" };
    const altura = alturas[alturaOpcao] || "500px";

    return { layout, colunas, tamanhoCard, altura };
}

// ===== FUN√á√ÉO AUXILIAR - SALVAR E ATUALIZAR =====
function salvarEAtualizar(jogoId, estadioId, timeId) {
    salvarDados();
    carregarLivesDoTime(jogoId, estadioId, timeId);
}

////////////
////////////
////////////
////////////
////////////
////////////
// Fun√ß√µes para controlar o dropdown
function toggleDropdown(button, event) {
    // Caso o 'event' n√£o tenha sido passado no onclick
    if (!event) event = window.event;

    if (event) event.stopPropagation();

    const dropdown = button.closest('.dropdown');
    const menu = dropdown.querySelector('.dropdown-menu');
    const isOpen = menu.classList.contains('show');

    // Fecha todos os outros dropdowns primeiro
    fecharTodosDropdowns();

    // Toggle: se j√° est√° aberto, fecha
    if (isOpen) {
        menu.classList.remove('show');
        return;
    }

    // Abre o dropdown atual
    menu.classList.add('show');


}
function fecharDropdown(element) {
    const dropdown = element.closest('.dropdown');
    const menu = dropdown.querySelector('.dropdown-menu');
    menu.classList.remove('show');
}
function fecharTodosDropdowns() {
    document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
        menu.classList.remove('show');
    });
}
// Fecha dropdowns quando clicar fora
document.addEventListener('click', function(e) {
    if (!e.target.closest('.dropdown')) {
        fecharTodosDropdowns();
    }
});
// Fecha dropdowns quando pressionar ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        fecharTodosDropdowns();
    }
});

////////////
////////////
////////////
////////////
////////////
////////////
// lives-manager.js - FUN√á√ïES MODIFICADAS PARA APENAS EXECUTAR

// Fun√ß√£o para toggle do video-info
function toggleVideoInfo() {
    const videoInfos = document.querySelectorAll('.video-info');
    
    if (videoInfos.length === 0) {
        alert("Nenhum video-info encontrado na p√°gina!");
        return;
    }
    
    // Verificar o estado atual (pega o primeiro como refer√™ncia)
    const primeiroVideoInfo = videoInfos[0];
    const estaVisivel = primeiroVideoInfo.style.display !== 'none';
    
    // Toggle em todos os video-infos
    videoInfos.forEach(videoInfo => {
        videoInfo.style.display = estaVisivel ? 'none' : 'flex';
    });
    
    // Salvar prefer√™ncia no localStorage
    localStorage.setItem('videoInfoVisivel', !estaVisivel);
    
    alert(`Video-info ${estaVisivel ? 'oculto' : 'mostrado'}!`);
}

// Fun√ß√£o para aplicar estado salvo do video-info
function aplicarEstadoVideoInfo() {
    const videoInfoVisivel = localStorage.getItem('videoInfoVisivel');
    
    // Se n√£o tiver salvo, mostra por padr√£o (null = mostrar)
    if (videoInfoVisivel === 'false') {
        const videoInfos = document.querySelectorAll('.video-info');
        videoInfos.forEach(videoInfo => {
            videoInfo.style.display = 'none';
        });
    }
}

// VERS√ÉO SIMPLIFICADA - APENAS EXECUTA A FUN√á√ÉO
function adicionarBotaoToggleVideoInfo(divId = null) {
    // Se uma div espec√≠fica foi passada, aplica apenas nela
    if (divId) {
        const div = document.getElementById(divId);
        if (div) {
            const videoInfos = div.querySelectorAll('.video-info');
            videoInfos.forEach(videoInfo => {
                const estaVisivel = videoInfo.style.display !== 'none';
                videoInfo.style.display = estaVisivel ? 'none' : 'flex';
            });
        }
    } else {
        // Aplica em toda a p√°gina
        toggleVideoInfo();
    }
}

// VERS√ÉO SIMPLIFICADA - APENAS EXECUTA A FUN√á√ÉO
function adicionarBotaoToggleVideoInfoAvancado(divId = null) {
    if (divId) {
        const div = document.getElementById(divId);
        if (div) {
            const videoInfos = div.querySelectorAll('.video-info');
            if (videoInfos.length > 0) {
                const estaVisivel = videoInfos[0].style.display !== 'none';
                videoInfos.forEach(videoInfo => {
                    videoInfo.style.display = estaVisivel ? 'none' : 'flex';
                });
            }
        }
    } else {
        toggleVideoInfo();
    }
}

// VERS√ÉO SIMPLIFICADA - APENAS EXECUTA A FUN√á√ÉO
function adicionarBotaoResetDisplay(divId = null) {
    if (divId) {
        const div = document.getElementById(divId);
        if (div) {
            const videoInfos = div.querySelectorAll('.video-info');
            videoInfos.forEach(videoInfo => {
                videoInfo.style.display = 'flex';
            });
        }
    } else {
        // Mostrar todos os video-infos
        const videoInfos = document.querySelectorAll('.video-info');
        videoInfos.forEach(videoInfo => {
            videoInfo.style.display = 'flex';
        });
        
        // Limpar localStorage
        localStorage.removeItem('videoInfoVisivel');
        
        alert("Display resetado! Todos os video-infos est√£o vis√≠veis.");
    }
}

// Fun√ß√£o auxiliar para atualizar texto do bot√£o (mantida para compatibilidade)
function atualizarTextoBotaoToggle(botao, estaVisivel) {
    botao.textContent = estaVisivel ? 'üëÅÔ∏è Ocultar Nomes' : 'üôà Mostrar Nomes';
    botao.title = estaVisivel ? 'Clique para ocultar t√≠tulos e autores' : 'Clique para mostrar t√≠tulos e autores';
}

// Adicionar tamb√©m no CSS uma transi√ß√£o suave (opcional)
function adicionarCSSTransition() {
    if (!document.getElementById('video-info-css')) {
        const style = document.createElement('style');
        style.id = 'video-info-css';
        style.textContent = `
            .video-info {
                transition: opacity 0.3s ease, display 0.3s ease;
            }
        `;
        document.head.appendChild(style);
    }
}

// Aplicar estado salvo quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
    aplicarEstadoVideoInfo()
});


////////////
////////////
////////////
////////////
////////////
////////////
// Fun√ß√£o para escolher n√∫mero de colunas
function escolherNumeroColunas() {
    const opcoes = `
Escolha o n√∫mero de colunas:

1. 1 Coluna
2. 2 Colunas  
3. 3 Colunas
4. 4 Colunas
5. 5 Colunas
6. 6 Colunas

Digite o n√∫mero da op√ß√£o:`;
    
    const opcao = prompt(opcoes);
    if (!opcao) return null;
    
    const colunasMap = {
        "1": 1,
        "2": 2,
        "3": 3,
        "4": 4,
        "5": 5,
        "6": 6
    };
    
    return colunasMap[opcao] || 3;
}
// Fun√ß√£o para encontrar a div nos dados pelo ID do elemento HTML
function encontrarDivPorElementoId(elementoId) {
    const divId = parseInt(elementoId.replace('div-horizontal-', ''));
    
    for (const jogo of dados.jogos) {
        for (const estadio of jogo.estadios) {
            for (const time of estadio.times) {
                for (const live of time.lives) {
                    if (live.divsHorizontais) {
                        const div = live.divsHorizontais.find(d => d.id === divId);
                        if (div) {
                            return { jogo, estadio, time, live, div };
                        }
                    }
                }
            }
        }
    }
    return null;
}
// VERS√ÉO CORRIGIDA - USANDO CONFIGLIVES COMO NAS FUN√á√ïES ANTIGAS
function adicionarBotaoToTamanhoPequeno(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'pequeno', colunas);
}
function adicionarBotaoToTamanhomedio(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'medio', colunas);
}
function adicionarBotaoToTamanhogrande(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'grande', colunas);
}
function adicionarBotaoToTamanhomuitoGrande(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarConfiguracaoDiv(divId, 'extraGrande', colunas);
}
function adicionarBotaoMudarColunas(divId = null) {
    const colunas = escolherNumeroColunas();
    if (colunas === null) return;
    
    aplicarApenasColunas(divId, colunas);
}
function adicionarBotaoEscolherDiv(divId = null) {
    if (divId) {
        alert(`Div selecionada: ${divId}`);
    } else {
        alert("Funcionalidade em desenvolvimento!\nPor enquanto usando a primeira div dispon√≠vel.");
    }
}
// FUN√á√ÉO PRINCIPAL CORRIGIDA - COMO NAS VERS√ïES ANTIGAS
function aplicarConfiguracaoDiv(elementoId, tamanho, colunas) {
    let resultado;
    
    if (elementoId) {
        // Aplica na div espec√≠fica
        resultado = encontrarDivPorElementoId(elementoId);
        if (!resultado) {
            alert("Div n√£o encontrada nos dados!");
            return;
        }
    } else {
        // Usa a primeira div dispon√≠vel (comportamento original)
        const jogo = dados.jogos[0];
        const estadio = jogo.estadios[0];
        const time = estadio.times[0];
        const live = time.lives[0];
        const div = live.divsHorizontais[0];
        
        if (!div) {
            alert("Nenhuma div encontrada!");
            return;
        }
        
        resultado = { jogo, estadio, time, live, div };
    }
    
    const { jogo, estadio, time, live, div } = resultado;
    
    // CONFIGURA√á√ÉO COMPLETA COMO NAS FUN√á√ïES ANTIGAS
    div.layout = "colunas";
    div.colunas = colunas;
    div.tamanho = tamanho;
    div.tamanhoCard = tamanho;
    
    // USANDO CONFIGLIVES COMO NAS FUN√á√ïES ANTIGAS
    if (configLives && configLives.alturasDiv && configLives.alturasDiv[tamanho]) {
        div.altura = configLives.alturasDiv[tamanho].height;
    } else {
        // Fallback se configLives n√£o estiver dispon√≠vel
        const alturasFallback = {
            'pequeno': '250px',
            'medio': '500px', 
            'grande': '750px',
            'extraGrande': '1000px'
        };
        div.altura = alturasFallback[tamanho] || '500px';
    }
    
    console.log("Div ap√≥s mudan√ßa:", div);
    
    // SALVAR E RECARREGAR COMO NAS FUN√á√ïES ANTIGAS
    salvarDados();
    carregarLivesDoTime(jogo.id, estadio.id, time.id);
    
    const mensagem = elementoId 
        ? `Configura√ß√£o aplicada na div "${div.titulo}"!\n- Cards: ${tamanho}\n- Colunas: ${colunas}\n- Altura: ${div.altura}`
        : `Layout aplicado!\n- Cards: ${tamanho}\n- Colunas: ${colunas}\n- Altura: ${div.altura}`;
    
    alert(mensagem);
}
// FUN√á√ÉO PARA APENAS MUDAR COLUNAS
function aplicarApenasColunas(elementoId, colunas) {
    let resultado;
    
    if (elementoId) {
        resultado = encontrarDivPorElementoId(elementoId);
        if (!resultado) {
            alert("Div n√£o encontrada nos dados!");
            return;
        }
    } else {
        const jogo = dados.jogos[0];
        const estadio = jogo.estadios[0];
        const time = estadio.times[0];
        const live = time.lives[0];
        const div = live.divsHorizontais[0];
        
        if (!div) {
            alert("Nenhuma div encontrada!");
            return;
        }
        
        resultado = { jogo, estadio, time, live, div };
    }
    
    const { jogo, estadio, time, live, div } = resultado;
    
    // Apenas mudar colunas, manter o resto
    div.layout = "colunas";
    div.colunas = colunas;
    
    console.log("Div ap√≥s mudan√ßa de colunas:", div);
    
    salvarDados();
    carregarLivesDoTime(jogo.id, estadio.id, time.id);
    
    const mensagem = elementoId
        ? `Colunas alteradas para: ${colunas} na div "${div.titulo}"`
        : `Colunas alteradas para: ${colunas}`;
    
    alert(mensagem);
}

  
////////////
////////////
////////////
////////////
////////////
////////////
function painelAdmin() {
    const senha = prompt("Senha de administrador:");
    if (senha !== "admin123") {
        alert("Senha incorreta!");
        return;
    }
    
    let painel = "=== PAINEL ADMIN ===\n\n";
    painel += "1. Estat√≠sticas Gerais\n";
    painel += "2. Gerenciar Usu√°rios\n";
    painel += "3. Gerenciar Streamers\n";
    painel += "4. Limpar Dados\n";
    painel += "5. Backup/Restore\n";
    
    const opcao = prompt(painel);
    
    switch(opcao) {
        case '1':
            verEstatisticas();
            break;
        case '2':
            gerenciarUsuarios();
            break;
        case '4':
            limparDados();
            break;
    }
}
function verEstatisticas() {
    let stats = "=== ESTAT√çSTICAS ===\n\n";
    stats += `Total de Usu√°rios: ${dados.usuarios.length}\n`;
    stats += `Total de Streamers: ${contarStreamers()}\n`;
    stats += `Total de Desafios: ${contarDesafios()}\n`;
    stats += `Total de Transa√ß√µes: ${dados.transacoes.length}\n`;
    stats += `Total em M√©rito Circulante: ${calcularMeritoTotal()}\n`;
    alert(stats);
}
function contarStreamers() {
    let count = 0;
    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            estadio.times.forEach(time => {
                if (time.lives) {
                    time.lives.forEach(live => {
                        count += live.streamers ? live.streamers.length : 0;
                    });
                }
            });
        });
    });
    return count;
}

  
////////////
////////////
////////////
////////////
////////////
////////////
function criarEvento() {
    if (!streamerLogado) {
        alert("Apenas streamers podem criar eventos");
        return;
    }
    
    const nome = prompt("Nome do evento:");
    if (!nome) return;
    
    const descricao = prompt("Descri√ß√£o do evento:");
    const data = prompt("Data do evento (ex: 25/12/2023 20:00):");
    const premio = prompt("Pr√™mio do evento:");
    
    const novoEvento = {
        id: Date.now(),
        nome: nome,
        descricao: descricao,
        data: data,
        premio: premio,
        criador: streamerLogado.nome,
        participantes: [],
        status: "inscricoes_abertas"
    };
    
    eventos.push(novoEvento);
    adicionarNotificacao("Novo Evento!", `${streamerLogado.nome} criou o evento: ${nome}`, 'info');
    alert("Evento criado com sucesso!");
}
function verEventos() {
    if (eventos.length === 0) {
        alert("Nenhum evento agendado");
        return;
    }
    
    let lista = "=== EVENTOS ===\n\n";
    eventos.forEach((evento, index) => {
        lista += `üéØ ${evento.nome}\n`;
        lista += `Descri√ß√£o: ${evento.descricao}\n`;
        lista += `Data: ${evento.data}\n`;
        lista += `Pr√™mio: ${evento.premio}\n`;
        lista += `Criador: ${evento.criador}\n`;
        lista += `Participantes: ${evento.participantes.length}\n`;
        lista += `Status: ${evento.status}\n`;
        
        if (usuarioLogado && evento.status === "inscricoes_abertas") {
            lista += `[Participar - digite 'p ${index}']\n`;
        }
        lista += "------------------------\n";
    });
    
    if (usuarioLogado) {
        lista += "\nComandos: 'p [n√∫mero]' - participar do evento";
    }
    
    const comando = prompt(lista);
    
    if (comando && comando.startsWith('p ')) {
        const index = parseInt(comando.split(' ')[1]);
        if (!isNaN(index) && index >= 0 && index < eventos.length) {
            participarEvento(eventos[index].id);
        }
    }
}
function participarEvento(eventoId) {
    if (!usuarioLogado) {
        alert("Fa√ßa login como usu√°rio para participar!");
        return;
    }
    
    const evento = eventos.find(e => e.id === eventoId);
    if (!evento) {
        alert("Evento n√£o encontrado!");
        return;
    }
    
    if (evento.status !== "inscricoes_abertas") {
        alert("Inscri√ß√µes encerradas para este evento!");
        return;
    }
    
    if (evento.participantes.includes(usuarioLogado.nome)) {
        alert("Voc√™ j√° est√° participando deste evento!");
        return;
    }
    
    evento.participantes.push(usuarioLogado.nome);
    adicionarNotificacao("Inscri√ß√£o Confirmada!", `Voc√™ se inscreveu no evento: ${evento.nome}`, 'sucesso');
    alert(`Inscri√ß√£o confirmada no evento: ${evento.nome}`);
}
function finalizarEvento(eventoId, vencedor) {
    const evento = eventos.find(e => e.id === eventoId);
    if (!evento) return;
    
    evento.status = "finalizado";
    evento.vencedor = vencedor;
    evento.dataFinalizacao = new Date().toLocaleString();
    
    adicionarNotificacao("Evento Finalizado!", `O evento ${evento.nome} foi finalizado. Vencedor: ${vencedor}`, 'info');
    alert(`Evento finalizado! Vencedor: ${vencedor}`);
}

  
  
////////////
//////////
////////////
////////////
////////////
////////////
////////////
////////////
// Sistema de c√°lculo de m√©rito
function calcularMeritoMaximoAposta(usuario) {
    // M√©rito m√°ximo = m√©rito atual * 2 (pode apostar at√© o dobro do seu m√©rito)
    return usuario.merito * 2;
}
function atualizarMerito(usuario, tipoAcao, sucesso) {
    let pontos = 0;
    
    switch(tipoAcao) {
        case 'desafio_cumprido':
            pontos = sucesso ? 50 : -30;
            if (sucesso) usuario.desafiosCumpridos++;
            else usuario.desafiosFalhados++;
            break;
            
        case 'pagamento_realizado':
            pontos = 100;
            usuario.pagamentosRealizados++;
            break;
            
        case 'pagamento_pendente':
            pontos = -150; // Penalidade alta por n√£o pagar
            usuario.pagamentosPendentes++;
            break;
            
        case 'aposta_ganha':
            pontos = 25;
            break;
            
        case 'aposta_perdida':
            pontos = -10;
            break;
            
        case 'desafio_criado':
            pontos = 5;
            break;
    }
    
    usuario.merito = Math.max(0, usuario.merito + pontos);
    return pontos;
}
// No merito.js, substituir a fun√ß√£o verPerfil por:
function verPerfil() {
    verPerfilCompleto(); // Usar a nova fun√ß√£o completa
}


  
  
////////////
////////////
/////////////
////////////
////////////
////////////
function verRankingUsuarios() {
    const usuariosOrdenados = [...dados.usuarios].sort((a, b) => b.merito - a.merito);
    
    let ranking = "=== RANKING DE USU√ÅRIOS ===\n\n";
    usuariosOrdenados.forEach((usuario, index) => {
        ranking += `${index + 1}¬∫ - ${usuario.nome}\n`;
        ranking += `M√©rito: ${usuario.merito} pontos\n`;
        ranking += `Desafios: ${usuario.desafiosCumpridos}/${usuario.desafiosCumpridos + usuario.desafiosFalhados} cumpridos\n`;
        ranking += "------------------------\n";
    });
    alert(ranking);
}
function verRankingStreamers() {
    let todosStreamers = [];
    dados.jogos.forEach(jogo => {
        jogo.estadios.forEach(estadio => {
            estadio.times.forEach(time => {
                if (time.lives) {
                    time.lives.forEach(live => {
                        if (live.streamers) {
                            todosStreamers = todosStreamers.concat(live.streamers);
                        }
                    });
                }
            });
        });
    });
    
    const streamersOrdenados = todosStreamers.sort((a, b) => b.merito - a.merito);
    
    let ranking = "=== RANKING DE STREAMERS ===\n\n";
    streamersOrdenados.forEach((streamer, index) => {
        ranking += `${index + 1}¬∫ - ${streamer.nome}\n`;
        ranking += `M√©rito: ${streamer.merito} pontos\n`;
        ranking += `Online: ${streamer.online ? 'üü¢' : 'üî¥'}\n`;
        ranking += "------------------------\n";
    });
    alert(ranking);
}

 
  
////////////
////////////
////////////
////////////
////////////
////////////

// common.js
// =====‡∑É

// ===== VARI√ÅVEIS GLOBAIS =====
// ===== INICIALIZA√á√ÉO =====


// ===== INICIALIZA√á√ÉO =====
function inicializarSistemaApostasDesafios() {
    console.log("Inicializando sistema de apostas e desafios...");

    limparSalasInvalidas();
    usuarioLogado = window.usuarioLogado || null;
    observarDOMParaBotoes();
    setInterval(() => {
        dados.apostasUsuarios.forEach(sala => verificarEncerramentosAutomaticos(sala, 'apostas'));
        dados.desafiosUsuarios.forEach(sala => verificarEncerramentosAutomaticos(sala, 'desafios'));
        salvarDados();
    }, 300000); // 5 minutos
    console.log("Sistema de apostas e desafios pronto!");
}
// ===== SALVAR DADOS =====
function salvarDados() {
    localStorage.setItem('sistemaTransmissao', JSON.stringify(dados));
    localStorage.setItem('sistemaNotificacoes', JSON.stringify(notificacoes));
    atualizarIndicadoresApostas()
}
// ===== LIMPAR SALAS INV√ÅLIDAS =====
function limparSalasInvalidas() {
    dados.apostasUsuarios = dados.apostasUsuarios.filter(sala => sala.cardId === "card-VHJhbnNt-1" || sala.apostas.length > 0);
    dados.desafiosUsuarios = dados.desafiosUsuarios.filter(sala => sala.cardId === "card-VHJhbnNt-1" || sala.desafios.length > 0);
    salvarDados();
    console.log("Salas inv√°lidas removidas!", { apostasUsuarios: dados.apostasUsuarios, desafiosUsuarios: dados.desafiosUsuarios });
}
// ===== VERIFICAR ENCERRAMENTOS AUTOM√ÅTICOS =====
function verificarEncerramentosAutomaticos(sala, tipo) {
    const agora = new Date();
    const itens = tipo === 'apostas' ? sala.apostas : sala.desafios;
    itens.forEach(item => {
        if (item.status === (tipo === 'apostas' ? 'aberta' : 'aberto') && item.dataEncerramento) {
            const dataEncerramento = new Date(item.dataEncerramento);
            if (dataEncerramento < agora) {
                item.status = tipo === 'apostas' ? 'encerrada' : 'encerrado';
                item.opcaoVencedora = null;
                console.log(`${tipo === 'apostas' ? 'Aposta' : 'Desafio'} ${item.titulo} encerrado automaticamente.`);
            }
        }
    });
    salvarDados();
}
// ===== ADICIONAR BOT√ïES DE APOSTAS E DESAFIOS =====
function adicionarBotoesApostasDesafios() {
    const videoInfos = document.querySelectorAll('.video-info');
    videoInfos.forEach(videoInfo => {
        const container = videoInfo.querySelector('.apostas-desafios-container') || document.createElement('div');
        container.className = 'apostas-desafios-container';
        
        const cardId = gerarCardId(videoInfo);
        const salaApostas = dados.apostasUsuarios.find(s => s.cardId === cardId);
        const salaDesafios = dados.desafiosUsuarios.find(s => s.cardId === cardId);

        // Bot√£o de Apostas
        if (!videoInfo.querySelector('.botao-apostas-custom')) {
            const botaoApostas = document.createElement('button');
            botaoApostas.className = 'botao-apostas-custom';
            botaoApostas.setAttribute('aria-label', 'Abrir sala de apostas');
            botaoApostas.innerHTML = 'üí∞ Apostas';
            if (salaApostas && salaApostas.apostas.length > 0) {
                botaoApostas.classList.add('with-red-dot');
            }
            botaoApostas.addEventListener('click', () => abrirModalApostas(videoInfo));
            container.appendChild(botaoApostas);
        }

        // Bot√£o de Desafios
      /*  if (!videoInfo.querySelector('.botao-desafios-custom')) {
            const botaoDesafios = document.createElement('button');
            botaoDesafios.className = 'botao-desafios-custom';
            botaoDesafios.setAttribute('aria-label', 'Abrir sala de desafios');
            botaoDesafios.innerHTML = 'üèÜ Desafios';
            if (salaDesafios && salaDesafios.desafios.length > 0) {
                botaoDesafios.classList.add('with-red-dot');
            }
            botaoDesafios.addEventListener('click', () => abrirModalDesafios(videoInfo));
            container.appendChild(botaoDesafios);
        }*/

        if (!videoInfo.contains(container)) {
            videoInfo.appendChild(container);
        }
    });
}
// ===== OBSERVADOR DE DOM PARA BOT√ïES =====
function observarDOMParaBotoes() {
    adicionarBotoesApostasDesafios();
    const observer = new MutationObserver(adicionarBotoesApostasDesafios);
    observer.observe(document.body, { childList: true, subtree: true });
}
// ===== GERAR CARD ID =====
function gerarCardId(videoInfo) {
    const card = videoInfo.closest('.card');
    if (card && card.id) return card.id;

    let titulo = videoInfo.querySelector('h3, h4, .title, .card-title, .video-title, [data-titulo]')?.textContent?.trim();
    if (!titulo) {
        const cardTitle = card?.querySelector('h3, h4, .title, .card-title, .video-title, [data-titulo]')?.textContent?.trim();
        titulo = card?.dataset?.titulo || cardTitle || 'card';
    }

    const container = videoInfo.closest('.div-horizontal, .live-container, .video-container, .live-grid') || document.body;
    const cards = container.querySelectorAll('.card');
    const index = Array.from(cards).indexOf(card) + 1 || 1;
    const id = `card-${btoa(encodeURIComponent(titulo)).substring(0, 8)}-${index}`;
    
    if (card) card.id = id;
    console.log(`gerarCardId: title=${titulo}, index=${index}, id=${id}, container=${container.className}`);
  //  console.log(`videoInfo HTML: ${videoInfo.outerHTML}`);
    return id;
}
// ===== NOTIFICA√á√ïES =====
function mostrarNotificacao(mensagem, tipo = 'info', targetUser = null) {
    const notificacao = document.createElement('div');
    notificacao.className = `notificacao ${tipo}`;
    notificacao.innerHTML = mensagem;
    document.body.appendChild(notificacao);
    setTimeout(() => notificacao.remove(), 5000);
    if (targetUser && usuarioLogado && usuarioLogado.nome === targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    } else if (!targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    }
}
function atualizarIndicadoresApostas() {
    const videoInfos = document.querySelectorAll('.video-info');

    videoInfos.forEach(videoInfo => {
        const cardId = gerarCardId(videoInfo);
        const salaApostas = dados.apostasUsuarios.find(s => s.cardId === cardId);

        const botaoApostas = videoInfo.querySelector('.botao-apostas-custom');
        if (botaoApostas) {
            const temApostasAbertas = salaApostas && salaApostas.apostas.some(a => a.status === 'aberta');
            const temApostasEncerradas = salaApostas && salaApostas.apostas.some(a => a.status === 'encerrada');

            if (temApostasAbertas || temApostasEncerradas) {
                botaoApostas.classList.add('with-red-dot');
            } else {
                botaoApostas.classList.remove('with-red-dot');
            }
        }
    });
}
// ===== ATUALIZAR INDICADORES DE DESAFIOS (NOVO - SIM√âTRICO A APOSTAS) =====
function atualizarIndicadoresDesafios() {
    const videoInfos = document.querySelectorAll('.video-info');

    videoInfos.forEach(videoInfo => {
        const cardId = gerarCardId(videoInfo);
        const salaDesafios = dados.desafiosUsuarios.find(s => s.cardId === cardId);

        const botaoDesafios = videoInfo.querySelector('.botao-desafios-custom');
        if (botaoDesafios) {
            const temDesafiosAbertos = salaDesafios && salaDesafios.desafios.some(d => d.status === 'aberto');
            const temDesafiosEncerrados = salaDesafios && salaDesafios.desafios.some(d => d.status === 'encerrado');

            if (temDesafiosAbertos || temDesafiosEncerrados) {
                botaoDesafios.classList.add('with-red-dot');
            } else {
                botaoDesafios.classList.remove('with-red-dot');
            }
        }
    });
}

// ===== MODAL DE APOSTAS =====
function abrirModalApostas(videoInfo) {
    // Check if videoInfo is a modal (from logarUsuario)
    const isModal = videoInfo.classList && videoInfo.classList.contains('modal-apostas');
    const effectiveVideoInfo = isModal ? document.querySelector(`.video-info [data-card-id="${videoInfo.querySelector('.modal-content').dataset.cardId}"]`) || videoInfo : videoInfo;

    let cardId = gerarCardId(effectiveVideoInfo);
    console.log("Generated cardId:", cardId);
    if (cardId.startsWith("card-Y2FyZA==")) {
        const expectedSala = dados.apostasUsuarios.find(s => s.cardId === "card-VHJhbnNt-1");
        if (expectedSala) {
            console.log(`Fallback: Using card-VHJhbnNt-1 instead of ${cardId}`);
            cardId = "card-VHJhbnNt-1";
        }
    }
    
    let sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    if (!sala) {
        sala = { cardId, apostas: [], criador: 'Sistema', dataCriacao: new Date().toLocaleString() };
        dados.apostasUsuarios.push(sala);
        salvarDados();
    }
    
    verificarEncerramentosAutomaticos(sala, 'apostas');
    const botaoApostas = effectiveVideoInfo.querySelector('.botao-apostas-custom');
    if (botaoApostas && botaoApostas.classList.contains('with-red-dot')) {
        botaoApostas.classList.remove('with-red-dot');
        console.log(`Ponto vermelho removido do bot√£o do card para cardId=${cardId}`);
    }
    
    console.log("Sala Apostas:", sala);
    let modal = isModal ? videoInfo : document.createElement('div');
    if (!isModal) {
        modal.className = 'modal-apostas';
        modal.setAttribute('role', 'dialog');
        modal.setAttribute('aria-modal', 'true');
    }
    const content = modal.querySelector('.modal-content') || document.createElement('div');
    if (!modal.querySelector('.modal-content')) {
        content.className = 'modal-content';
        content.setAttribute('tabindex', '-1');
        content.dataset.cardId = cardId; // Store cardId for later use
        modal.appendChild(content);
    }
    atualizarConteudoModalApostas(content, cardId, sala, effectiveVideoInfo);
    if (!isModal) {
        document.body.appendChild(modal);
    }
    content.focus();
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}
// ===== ATUALIZA√á√ÉO NA EXIBI√á√ÉO DAS APOSTAS =====
function atualizarConteudoModalApostas(content, cardId, sala, videoInfo) {
    // Filtrar apostas por m√©rito apenas se usu√°rio estiver logado
    const apostasFiltradas = usuarioLogado ? 
        sala.apostas.filter(aposta => {
            const criador = dados.usuarios.find(u => u.nome === aposta.criador);
            return criador && criador.merito === usuarioLogado.merito;
        }) : 
        sala.apostas; // Usu√°rios n√£o logados veem todas as apostas
    
    const chat = dados.chats.find(c => c.cardId === cardId) || { messages: [], voiceParticipants: [] };
    const hasUnreadMessages = chat.messages.some(m => !m.readBy?.includes(usuarioLogado?.nome));
    const hasVoiceParticipants = chat.voiceParticipants?.length > 0;

    content.innerHTML = `
        <div class="modal-header">
            <h3>üí∞ Sala de Apostas</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        ${usuarioLogado ? `
            <div class="user-info">
                <div class="user-details">
                    <span>üë§ ${usuarioLogado.nome}</span>
                    <span>Email: ${usuarioLogado.email}</span>
                    <span>Pontos: ${usuarioLogado.merito}</span>
                    ${usuarioLogado.contaBancaria ? `<span>Conta: ${usuarioLogado.contaBancaria}</span>` : ''}
                    <span>Chave Pix: ${usuarioLogado.chavePix}</span>
                </div>
                <button class="logout-button" onclick="logout()">Sair</button>
            </div>
        ` : `
            <div class="user-info">
                <div class="user-details">
                    <span>üë§ Visitante</span>
                    <span>üí° Voc√™ pode ver apostas e participar de apostas de at√© 50 pontos sem login</span>
                    <button class="login-button" onclick="abrirFormularioLoginApostas('${cardId}')">Fazer Login</button>
                </div>
            </div>
        `}
        <div class="apostas-options">
            ${usuarioLogado ? `
                <button class="create-bet-button" onclick="abrirFormularioCriarAposta('${cardId}')">üéØ Criar Nova Aposta</button>
            ` : `
                <button class="create-bet-button disabled" onclick="mostrarNotificacao('Fa√ßa login para criar apostas', 'erro')">üéØ Criar Nova Aposta</button>
            `}
            <button class="view-bets-button ${apostasFiltradas.length > 0 ? 'with-red-dot' : ''}" onclick="mostrarApostasExistentes('${cardId}')">üìã Ver Apostas (${apostasFiltradas.length})</button>
            ${usuarioLogado ? `
                <button class="open-chat-button ${hasUnreadMessages || hasVoiceParticipants ? 'with-red-dot' : ''}" onclick="abrirChat('${cardId}')">üí¨ Abrir Chat</button>
            ` : ''}
        </div>
        <div class="apostas-list hidden" id="apostas-list-${cardId}">
            <h4>üé≤ Apostas Ativas (${apostasFiltradas.length})</h4>
            ${apostasFiltradas.length === 0 ?
                '<p class="no-apostas">Nenhuma aposta ativa' + (usuarioLogado ? ' com seu m√©rito' : '') + '</p>' :
                apostasFiltradas.map(aposta => {
                    const participacao = usuarioLogado ? aposta.participantes.find(p => p.usuario === usuarioLogado.nome) : null;
                    const isParticipating = !!participacao;
                    const winner = aposta.status === 'encerrada' ? aposta.participantes.find(p => p.opcao === aposta.opcaoVencedora) : null;
                    const winnerUser = winner ? dados.usuarios.find(u => u.nome === winner.usuario) : null;
                    const isWinner = winner && winner.usuario === usuarioLogado?.nome;
                    const isLoser = isParticipating && !isWinner && aposta.status === 'encerrada';
                    const comprovanteEnviado = aposta.comprovantes?.some(c => c.usuario === usuarioLogado?.nome);

                    let resultado = '';
                    if (aposta.status === 'encerrada' && isParticipating) {
                        resultado = isWinner ?
                            '<p class="resultado-ganhou">üéâ Voc√™ ganhou!</p>' :
                            `<p class="resultado-perdeu">üòî Voc√™ perdeu. Envie ${aposta.valor} pontos via Pix para ${winnerUser?.chavePix || 'indefinido'} (vencedor: ${winner?.usuario || 'indefinido'}).</p>`;
                    }

                    return `
                        <div class="aposta-card">
                            <div class="aposta-info">
                                <strong>${aposta.titulo}</strong>
                                ${isParticipating ? `<p class="participacao">‚úÖ Voc√™ est√° participando (Op√ß√£o: ${participacao.opcao})</p>` : ''}
                                ${aposta.descricao ? `<p class="aposta-descricao">${aposta.descricao}</p>` : ''}
                                ${aposta.dataEncerramento ? `<small class="aposta-encerramento">Encerra em: ${new Date(aposta.dataEncerramento).toLocaleString()}</small>` : ''}
                                <p>Op√ß√µes: ${aposta.opcoes.join(', ')}</p>
                                <p>Valor: ${aposta.valor} pontos</p>
                                <p>Participantes: ${aposta.participantes.length}</p>
                                <small>Criado por: ${aposta.criador} em ${aposta.dataCriacao}</small>
                                ${resultado}
                                ${aposta.status === 'encerrada' && winnerUser ? `<p>Chave Pix do vencedor: ${winnerUser.chavePix}</p>` : ''}
                            </div>
                            <div class="aposta-actions">
                                ${aposta.status === "aberta" ? `
                                    ${!usuarioLogado && aposta.valor <= 50 ? `
                                        <button class="participar-button" onclick="abrirFormularioParticiparApostaVisitante('${cardId}', ${aposta.id})">Participar</button>
                                    ` : usuarioLogado ? `
                                        <button class="participar-button" onclick="abrirFormularioParticiparAposta('${cardId}', ${aposta.id})">Participar</button>
                                    ` : `
                                        <button class="participar-button disabled" onclick="mostrarNotificacao('Fa√ßa login para apostar mais de 50 pontos', 'erro')">Participar</button>
                                    `}
                                    ${aposta.criador === usuarioLogado?.nome ? `
                                        <button class="encerrar-button" onclick="abrirFormularioEncerrarAposta('${cardId}', ${aposta.id})">Encerrar</button>
                                    ` : ''}
                                ` : `
                                    <p class="encerrada">‚ùå Encerrada</p>
                                    <p>Vencedor: ${aposta.opcaoVencedora || 'N√£o definido'}</p>
                                    ${isLoser && !comprovanteEnviado ? `
                                        <div class="comprovante-form">
                                            <label for="comprovante-${aposta.id}">Comprovante de Pagamento:</label>
                                            <input type="text" id="comprovante-${aposta.id}" placeholder="Insira o ID da transa√ß√£o">
                                            <button onclick="enviarComprovantePagamento('${cardId}', ${aposta.id})">Enviar Comprovante</button>
                                        </div>
                                    ` : ''}
                                    ${comprovanteEnviado ? `<p>Comprovante enviado: ${aposta.comprovantes.find(c => c.usuario === usuarioLogado.nome)?.comprovante}</p>` : ''}
                                    ${(aposta.criador === usuarioLogado?.nome || isWinner) ? `
                                        <div class="comprovantes-list">
                                            <h5>Comprovantes Recebidos:</h5>
                                            ${aposta.comprovantes?.length > 0 ? aposta.comprovantes.map(c => `
                                                <p>${c.usuario}: ${c.comprovante} (${c.status}) - ${c.data}</p>
                                            `).join('') : '<p>Nenhum comprovante recebido.</p>'}
                                        </div>
                                    ` : ''}
                                `}
                            </div>
                        </div>
                    `;
                }).join('')
            }
        </div>
    `;
    
    content.querySelector('.close-button').addEventListener('click', () => {
        content.closest('.modal-apostas').remove();
    });
    console.log(`Modal rendered for cardId=${cardId}, apostas count=${apostasFiltradas.length}`);
}
// ===== PARTICIPA√á√ÉO PARA VISITANTES (AT√â 50 PONTOS) =====
function abrirFormularioParticiparApostaVisitante(cardId, apostaId) {
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;
    
    // Verificar se a aposta √© de at√© 50 pontos
    if (aposta.valor > 50) {
        mostrarNotificacao('Para apostas acima de 50 pontos √© necess√°rio fazer login!', 'erro');
        abrirFormularioLoginApostas(cardId);
        return;
    }
    
    const content = document.querySelector('.modal-content');
    content.innerHTML = `
        <div class="modal-header">
            <h3>Participar como Visitante - "${aposta.titulo}"</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        <div class="aposta-form-visitante">
            <p>üí∞ Valor da aposta: ${aposta.valor} pontos</p>
            <p>üí° Voc√™ est√° participando como visitante (sem login)</p>
            <label class="form-label" for="opcao-aposta-visitante">Escolha uma op√ß√£o:</label>
            <select class="form-input" id="opcao-aposta-visitante">
                ${aposta.opcoes.map((op, index) => `<option value="${index}">${op}</option>`).join('')}
            </select>
            <div class="form-actions">
                <button class="confirm-button" type="button" onclick="confirmarParticipacaoVisitante('${cardId}', ${apostaId})">Confirmar Aposta</button>
                <button class="cancel-button" type="button" onclick="atualizarConteudoModalApostas(this.closest('.modal-content'), '${cardId}', dados.apostasUsuarios.find(s => s.cardId === '${cardId}'))">Cancelar</button>
            </div>
        </div>
    `;
}
function confirmarParticipacaoVisitante(cardId, apostaId) {
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;

    const opcaoIndex = parseInt(document.getElementById('opcao-aposta-visitante').value);
    if (isNaN(opcaoIndex) || opcaoIndex < 0 || opcaoIndex >= aposta.opcoes.length) {
        mostrarNotificacao('Op√ß√£o inv√°lida!', 'erro');
        return;
    }
    
    const opcaoEscolhida = aposta.opcoes[opcaoIndex];
    
    // Verificar novamente o valor (seguran√ßa)
    if (aposta.valor > 50) {
        mostrarNotificacao('Esta aposta requer login!', 'erro');
        return;
    }
    
    // Participar como "Visitante_[ID]"
    const visitanteId = `Visitante_${Date.now()}`;
    aposta.participantes.push({
        usuario: visitanteId,
        opcao: opcaoEscolhida,
        data: new Date().toLocaleString()
    });
    
    salvarDados();
    mostrarNotificacao(`Voc√™ apostou em "${opcaoEscolhida}" como visitante!`);
    atualizarConteudoModalApostas(document.querySelector('.modal-content'), cardId, sala);
}
// ===== MOSTRAR APOSTAS EXISTENTES =====
function mostrarApostasExistentes(cardId) {
    const apostasList = document.getElementById(`apostas-list-${cardId}`);
    const viewBetsButton = document.querySelector('.view-bets-button');
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    
    // Filtrar apostas conforme o status do usu√°rio
    const apostasFiltradas = usuarioLogado ? 
        sala?.apostas.filter(aposta => {
            const criador = dados.usuarios.find(u => u.nome === aposta.criador);
            return criador && criador.merito === usuarioLogado.merito;
        }) || [] : 
        sala?.apostas || [];

    if (apostasList && viewBetsButton) {
        const isHidden = apostasList.classList.contains('hidden');
        apostasList.classList.toggle('hidden', !isHidden);
        viewBetsButton.textContent = isHidden ? 
            `üìã Ocultar Apostas (${apostasFiltradas.length})` : 
            `üìã Ver Apostas (${apostasFiltradas.length})`;
        if (isHidden && viewBetsButton.classList.contains('with-red-dot')) {
            viewBetsButton.classList.remove('with-red-dot');
            console.log(`Ponto vermelho removido do bot√£o 'Ver Apostas' para cardId=${cardId}`);
        }
    }
}
// ===== FORMUL√ÅRIO DE CRIA√á√ÉO DE APOSTA =====
function abrirFormularioCriarAposta(cardId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para criar apostas!', 'erro');
        abrirFormularioLoginApostas(cardId);
        return;
    }
  
    const content = document.querySelector('.modal-content');
    content.innerHTML = `
        <div class="modal-header">
            <h3>Criar Nova Aposta</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        <form id="form-criar-aposta" class="aposta-form">
            <label class="form-label" for="titulo-aposta">T√≠tulo:</label>
            <input class="form-input" type="text" id="titulo-aposta" required>
            
            <label class="form-label" for="descricao-aposta">Descri√ß√£o (opcional):</label>
            <textarea class="form-input" id="descricao-aposta" rows="3" placeholder="Explica√ß√£o sobre a aposta..."></textarea>
            
            <label class="form-label" for="opcoes-aposta">Op√ß√µes (separadas por v√≠rgula):</label>
            <input class="form-input" type="text" id="opcoes-aposta" required>
            
            <label class="form-label" for="valor-aposta">Valor (pontos):</label>
            <input class="form-input" type="number" id="valor-aposta" min="1" required>
            
            <label class="form-label" for="data-encerramento">Encerramento autom√°tico (opcional):</label>
            <input class="form-input" type="datetime-local" id="data-encerramento" step="1">
            <small>Deixe vazio para encerramento manual.</small>
            
            <div class="form-actions">
                <button class="confirm-button" type="button" onclick="confirmarCriacaoAposta('${cardId}')">Criar</button>
                <button class="cancel-button" type="button" onclick="atualizarConteudoModalApostas(this.closest('.modal-content'), '${cardId}', dados.apostasUsuarios.find(s => s.cardId === '${cardId}'))">Cancelar</button>
            </div>
        </form>
    `;
    content.querySelector('.close-button').addEventListener('click', () => {
        content.closest('.modal-apostas').remove();
    });
}
// ===== CONFIRMA√á√ÉO DE CRIA√á√ÉO DE APOSTA =====
function confirmarCriacaoAposta(cardId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para criar apostas!', 'erro');
        return;
    }
    
    const titulo = document.getElementById('titulo-aposta').value.trim();
    const descricao = document.getElementById('descricao-aposta').value.trim();
    const opcoes = document.getElementById('opcoes-aposta').value.trim();
    const valor = parseInt(document.getElementById('valor-aposta').value);
    const dataEncerramento = document.getElementById('data-encerramento').value ? new Date(document.getElementById('data-encerramento').value).toISOString() : null;
    
    if (!titulo || !opcoes || isNaN(valor) || valor <= 0) {
        mostrarNotificacao('Preencha os campos obrigat√≥rios corretamente!', 'erro');
        return;
    }
    
    if (dataEncerramento && new Date(dataEncerramento) <= new Date()) {
        mostrarNotificacao('A data de encerramento deve ser futura!', 'erro');
        return;
    }
    
    const opcoesArray = opcoes.split(',').map(op => op.trim()).filter(op => op);
    if (opcoesArray.length < 2) {
        mostrarNotificacao('Precisa de pelo menos 2 op√ß√µes!', 'erro');
        return;
    }
    
    if (valor > usuarioLogado.merito) {
        mostrarNotificacao(`Saldo insuficiente! Voc√™ tem ${usuarioLogado.merito} pontos.`, 'erro');
        return;
    }
    
    const novaAposta = {
        id: Date.now(),
        titulo,
        descricao: descricao || null,
        opcoes: opcoesArray,
        valor,
        dataEncerramento,
        criador: usuarioLogado.nome,
        participantes: [],
        status: "aberta",
        dataCriacao: new Date().toLocaleString(),
        opcaoVencedora: null
    };
    
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    if (sala) {
        sala.apostas.push(novaAposta);
    } else {
        dados.apostasUsuarios.push({
            cardId,
            apostas: [novaAposta],
            criador: usuarioLogado.nome,
            dataCriacao: new Date().toLocaleString()
        });
    }
    usuarioLogado.merito -= valor;
    
    salvarDados();
    mostrarNotificacao(`Aposta criada! -${valor} pontos`);
    
    atualizarConteudoModalApostas(document.querySelector('.modal-content'), cardId, dados.apostasUsuarios.find(s => s.cardId === cardId));
}
// ===== FORMUL√ÅRIO PARTICIPAR APOSTA =====
function abrirFormularioParticiparAposta(cardId, apostaId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para participar desta aposta!', 'erro');
        abrirFormularioLoginApostas(cardId);
        return;
    }
    
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;
    
    const content = document.querySelector('.modal-content');
    content.innerHTML = `
        <div class="modal-header">
            <h3>Participar de "${aposta.titulo}"</h3>
            <button class="close-button" aria-label="Fechar modal">X</button>
        </div>
        <form id="form-participar-aposta" class="aposta-form">
            <label class="form-label" for="opcao-aposta">Escolha uma op√ß√£o:</label>
            <select class="form-input" id="opcao-aposta">
                ${aposta.opcoes.map((op, index) => `<option value="${index}">${op}</option>`).join('')}
            </select>
            <div class="form-actions">
                <button class="confirm-button" type="button" onclick="confirmarParticipacaoAposta('${cardId}', ${apostaId})">Confirmar</button>
                <button class="cancel-button" type="button" onclick="atualizarConteudoModalApostas(this.closest('.modal-content'), '${cardId}', dados.apostasUsuarios.find(s => s.cardId === '${cardId}'))">Cancelar</button>
            </div>
        </form>
    `;
    content.querySelector('.close-button').addEventListener('click', () => {
        content.closest('.modal-apostas').remove();
    });
}
// ===== CONFIRMA√á√ÉO DE PARTICIPA√á√ÉO =====
function confirmarParticipacaoAposta(cardId, apostaId) {
    if (!usuarioLogado) {
        mostrarNotificacao('Fa√ßa login para participar!', 'erro');
        return;
    }
    
    const sala = dados.apostasUsuarios.find(s => s.cardId === cardId);
    const aposta = sala?.apostas.find(a => a.id === apostaId);
    if (!aposta) return;

    // Check if creator's merito matches usuarioLogado.merito
    const criador = dados.usuarios.find(u => u.nome === aposta.criador);
    if (!criador || criador.merito !== usuarioLogado.merito) {
        mostrarNotificacao('Voc√™ s√≥ pode participar de apostas de usu√°rios com o mesmo m√©rito!', 'erro');
        return;
    }

    const opcaoIndex = parseInt(document.getElementById('opcao-aposta').value);
    if (isNaN(opcaoIndex) || opcaoIndex < 0 || opcaoIndex >= aposta.opcoes.length) {
        mostrarNotificacao('Op√ß√£o inv√°lida!', 'erro');
        return;
    }
    const opcaoEscolhida = aposta.opcoes[opcaoIndex];
    if (aposta.participantes.some(p => p.usuario === usuarioLogado.nome)) {
        mostrarNotificacao('Voc√™ j√° participa desta aposta!', 'erro');
        return;
    }
    if (aposta.valor > usuarioLogado.merito) {
        mostrarNotificacao(`Saldo insuficiente! Voc√™ tem ${usuarioLogado.merito} pontos.`, 'erro');
        return;
    }
    aposta.participantes.push({
        usuario: usuarioLogado.nome,
        opcao: opcaoEscolhida,
        data: new Date().toLocaleString()
    });
    usuarioLogado.merito -= aposta.valor;
    salvarDados();
    mostrarNotificacao(`Voc√™ apostou em "${opcaoEscolhida}"! -${aposta.valor} pontos`);
    atualizarConteudoModalApostas(document.querySelector('.modal-content'), cardId, sala);
}

// desafios.js


// desafios.js
// desafios.js
// desafios.js








////////////
////////////
////////////
////////////
////////////
////////////
// chat.js




////////////
////////////
////////////
////////////
////////////
////////////




// ===== ESTILOS GLOBAIS =====
const style = document.createElement('style');
style.innerHTML = `
/* TAMANHOS */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
html, body {
    max-width: 100vw;
   /* width: 100%;*/
    height: 100%;
}
.secao {
 max-width: 100%;
 /*  
    max-width: 100vw;
 */
    min-height: fit-content;
}
.secao-header {
  max-width: 100%;
}
.lives-container {
    max-width: 100%;
    height: auto;
}
header {
    max-width: calc(100vw - 20px);
    width: auto;
}
/* DISPLAY & LAYOUT */
html, body {
   /* overflow-x: hidden;*/
}
header {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}
.secao-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
   /* gap: 15px;*/
}
.secao-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}
.divs-section {
    display: block;
}
.divs-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}
.div-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}
.div-actions {
    display: flex;
    gap: 5px;
    flex-wrap: nowrap;
}
.cards-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px;
    flex-wrap: nowrap;
    
}
.cards-container.layout-colunas {
        grid-template-columns: repeat(2, 1fr);
    }
.layout-horizontal {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px;
    flex-wrap: nowrap;
    
}
.video-card {
    display: flex;
    flex-direction: column;
    flex: 0 0 auto;
    flex-shrink: 0;
    overflow: hidden;

}
.video-actions {
    display: flex;
    gap: 3px;
    flex-shrink: 0;
    
}
.video-footer {
    display: block;
    
}
.empty-state {
    display: block;
    
}
.lives-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 400px), 1fr));
    
    
}
.item-clickable {
    display: block;
    
}
.secao img {
    display: block;
    
}
.jogo-item {
    animation: fadeIn 0.3s ease-in;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
/* OUTRAS PROPRIEDADES */
html, body {
    font-family: Arial, sans-serif;
   
}
body {
    padding: 10px;
   
}
.secao {
    
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin: 0 ;/*auto 15px auto;*/
    padding: 15px;
}
header {
    background: rgba(255, 255, 255, 0.95);
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
   
}
header button {
    padding: 6px 10px;
    font-size: 11px;
    border: none;
    border-radius: 4px;
    background: #2196F3;
    color: white;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.2s ease;
   
}
header button:hover {
    background: #1976D2;
   
}
h1 {
    margin-top: 60px;
    text-align: center;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.secao-header {
   margin-bottom: 20px;
    padding: 10px 0;
    
    border-bottom: 2px solid #e0e0e0;
  
}
.secao-header {
    background: linear-gradient(135deg, #45a049, #4CAF50);
    padding: 15px;
    margin: -15px -15px 20px -15px;
   
   
    border-radius: 8px 8px 0 0;
    border-bottom: none;

}
.secao-buttons button {
    background: rgba(255,255,255,0.9);
    color: #45a049;
    border: 1px solid white;
    font-weight: 600;
    transition: all 0.3s ease;
   /**/
}
.live-title {
    color: #333;
    font-size: 1.3rem;
    font-weight: 700;
    line-height: 1.3;
    word-wrap: break-word;
    overflow-wrap: break-word;
    margin: 0;
  /* */
}
.live-description {
    color: #555;
    font-size: 14px;
    line-height: 1.4;
    word-wrap: break-word;
    overflow-wrap: break-word;
    margin: 8px 0 0 0;
    
    
    
}
.live-meta {
    color: #777;
    font-size: 12px;
    line-height: 1.3;
    margin: 6px 0 0 0;
  
}
.live-status {
    background: #4CAF50;
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    margin-top: 2px;

}
.live-status.inactive {
    background: #ff9800;

}
.divs-section {
    margin-bottom: 20px;

}
.divs-header {
    margin-bottom: 15px;

}
.divs-title {
    color: #2196F3;
    font-size: 1.1rem;
    margin: 0;
    
}
.div-header {
    margin-bottom: 10px;
    
}
.div-title {
    color: #333;
    font-size: 14px;
    word-wrap: break-word;
    margin: 0;
    background-color: #333;
}
.div-count {
    color: #666;
    font-size: 12px;
    margin-left: 6px;
    
}
.div-meta {
    color: #888;
    font-size: 11px;
    margin: 2px 0 0 0;
    
}
.btn {
    padding: 6px 12px;
    font-size: 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.2s ease, transform 0.2s ease;
}
.btn-primary {
    background: #4CAF50;
    color: white;
}
.btn-primary:hover {
    background: #45a049;
    transform: translateY(-1px);
}
.btn-secondary {
    background: #2196F3;
    color: white;
}
.btn-secondary:hover {
    background: #1976D2;
    transform: translateY(-1px);
}
.btn-warning {
    background: #FF9800;
    color: white;
}
.btn-warning:hover {
    background: #F57C00;
    transform: translateY(-1px);
}
.btn-danger {
    background: #f44336;
    color: white;
}
.btn-danger:hover {
    background: #d32f2f;
    transform: translateY(-1px);
}
.btn-large {
    padding: 10px 16px;
    font-size: 14px;
}
.btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none;
}
.secao button {
    padding: 8px 16px;
    font-size: 14px;
    border: none;
    border-radius: 6px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
    margin: 0;
    transition: all 0.3s ease;
}
.secao button:hover {
    background: #45a049;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.secao button:disabled {
    background: #99cccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
.empty-state {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 30px;
    text-align: center;
   background: #f9f9f9;
   
}

.empty-state p {
    color: #666;
    margin: 0 0 15px 0;
    
}

.secao img {
    border-radius: 5px;
    object-fit: cover;
    border: 2px solid #e0e0e0;
    background: linear-gradient(45deg, #f5f5f5, #e0e0e0);
    padding: 2px;
  
}

.item-clickable {
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
    
}

.item-clickable:hover {
    transform: scale(1.02);
    opacity: 0.9;
    
}

.item-clickable:active {
    transform: scale(0.98);
  
}

@media (max-width: 480px) {
    body {
        padding: 5px;
    }

    header {
        position: relative;
        top: auto;
        right: auto;
        max-width: 100%;
        margin-bottom: 10px;
        justify-content: center;
    }

    h1 {
        margin-top: 10px;
        font-size: 1.3em;
    }

    .secao {
        padding: 10px;
        margin-bottom: 10px;
    }

    .secao-buttons {
        flex-direction: column;
        width: 100%;
    }

    .secao-buttons button {
        width: 100%;
        margin: 2px 0;
    }


    .secao button {
        padding: 6px 10px;
        font-size: 11px;
    }
}

/* RESPONSIVIDADE */
@media (max-width: 768px) {
    body {
        padding: 8px;
    }

    header {
        top: 5px;
        right: 5px;
        max-width: calc(100vw - 10px);
        padding: 6px;
    }

    header button {
        padding: 5px 8px;
        font-size: 10px;
    }

    h1 {
        margin-top: 50px;
        font-size: 1.5em;
    }

    .secao {
        padding: 12px;
        margin-bottom: 12px;
    }

    .secao-header {
        flex-direction: column;
        text-align: center;
       /* gap: 10px;*/
    }

    .secao-buttons {
        width: 100%;
        justify-content: center;
    }

    

    .lives-grid {
        grid-template-columns: 1fr;
    }

    



@media (min-width: 1200px) {
    .secao {
        min-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }

}


/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/* DROPDOWN BUTTON - VERS√ÉO REVISADA PRA N√ÉO BUGAR A DIV M√ÉE */
.dropdown {
    position: relative !important;
    display: inline-block !important;
    width: auto;
    isolation: isolate; /* Isola pra evitar heran√ßa do live-card.css */
}

.dropdown-menu {
    position: absolute !important;
    top: calc(100% + 4px) !important; /* Espa√ßo pra n√£o colar no bot√£o */
    right: -10px !important; /* Puxa mais pra direita sem mexer no left */
    margin-right: -20px !important; /* Ajuste fino pra alinhar √† direita */
    z-index: 10000 !important; /* Z-index alto pra ficar por cima */
    display: none;
    min-width: 200px;
    padding: 8px 0;
    margin-top: 0;
    font-size: 14px;
    text-align: left;
    background-color: #ffffff !important; /* Fundo branco pra contrastar com o verde */
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 6px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.175);
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.dropdown-menu.show {
    display: block !important;
    opacity: 1 !important;
    transform: translateY(0) !important;
}

.btn-dropdown {
    background: #6c757d !important;
    color: white !important;
    border: none !important;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 36px;
    box-sizing: border-box;
}

.btn-dropdown:hover {
    background: #5a6268 !important;
    transform: translateY(-1px);
}

.btn-dropdown:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.3);
}

.dropdown-header {
    padding: 8px 16px 4px;
    font-size: 12px;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    background-color: #f8f9fa !important;
}

.dropdown-item {
    display: block !important;
    width: 100% !important;
    padding: 8px 16px !important;
    border: none !important;
    background: none !important;
    text-align: left !important;
    font-size: 13px !important;
    cursor: pointer;
    color: #212529 !important;
    transition: background-color 0.2s ease;
    position: relative !important;
    z-index: 10001 !important; /* Um pouco mais alto que o menu */
}

.dropdown-item:hover {
    background-color: #f1f3f5 !important;
}

.dropdown-divider {
    height: 1px;
    margin: 6px 0;
    background-color: #e9ecef !important;
    border: none;
}

.dropdown-item.text-danger {
    color: #dc3545 !important;
}

.dropdown-item.text-danger:hover {
    background-color: #fce8e6 !important;
}

@keyframes dropdownFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsividade pra n√£o bugar no mobile */
@media (max-width: 768px) {
    .dropdown-menu {
        min-width: 160px;
        right: -155px !important; /* Ajustado pro mobile */
        margin-right: -15px !important; /* Menos deslocamento no mobile */
    }
    .btn-dropdown {
        min-width: 36px;
        padding: 6px 10px;
    }
}

/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/* HEADER ESPEC√çFICO - N√ÉO AFETA OUTRAS DIVS */
header {
    position: fixed ;
    top: 10px ;
    right: 10px ;
    z-index: 1000 ;
    max-width: calc(100vw - 20px) ;
    background: rgba(255, 255, 255, 0.95) ;
    padding: 8px ;
    border-radius: 8px ;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2) ;
    display: flex ;
    gap: 5px ;
    flex-wrap: wrap ;
    align-items: center ;
}

header button {
    padding: 6px 10px ;
    font-size: 11px ;
    border: none ;
    border-radius: 4px ;
    background: #2196F3 ;
    color: white ;
    cursor: pointer ;
    white-space: nowrap ;
    transition: background-color 0.2s ease ;
}

header button:hover {
    background: #1976D2 ;
}

/* √çCONE DE PERFIL NO HEADER */
.profile-icon {
    width: 35px ;
    height: 35px ;
    border-radius: 50% ;
    background: linear-gradient(45deg, #4CAF50, #2196F3) ;
    display: flex ;
    align-items: center ;
    justify-content: center ;
    cursor: pointer ;
    border: 2px solid white ;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2) ;
    transition: transform 0.2s ease ;
    font-weight: bold ;
    color: white ;
    font-size: 16px ;
}

.profile-icon:hover {
    transform: scale(1.1) ;
}

.profile-icon.logged-in {
    background: linear-gradient(45deg, #FF9800, #FF5722) ;
}

/* CONTAINER DE LOGIN FLUTUANTE */
.login-floating {
    position: fixed ;
    top: 60px ;
    right: 10px ;
    background: white ;
    padding: 15px ;
    border-radius: 8px ;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3) ;
    z-index: 1001 ;
    min-width: 200px ;
    border: 2px solid #2196F3 ;
    display: none ;
}

.login-floating.show {
    display: block ;
    animation: slideDown 0.3s ease ;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.login-floating .user-info {
    text-align: center ;
    margin-bottom: 10px ;
    padding-bottom: 10px ;
    border-bottom: 1px solid #e0e0e0 ;
}

.login-floating .user-name {
    font-weight: bold ;
    color: #333 ;
    margin: 0 0 5px 0 ;
    font-size: 14px ;
}

.login-floating .user-merito {
    color: #666 ;
    font-size: 12px ;
    margin: 0 ;
}

.login-floating .user-actions {
    display: flex ;
    flex-direction: column ;
    gap: 5px ;
}

.login-floating button {
    padding: 8px 12px ;
    font-size: 12px ;
    border: none ;
    border-radius: 4px ;
    cursor: pointer ;
    transition: background-color 0.2s ease ;
}

.login-floating .btn-profile {
    background: #4CAF50 ;
    color: white ;
}

.login-floating .btn-pix {
    background: #2196F3 ;
    color: white ;
}

.login-floating .btn-logout {
    background: #f44336 ;
    color: white ;
}

.login-floating .btn-login {
    background: #4CAF50 ;
    color: white ;
    padding: 10px ;
    font-size: 13px ;
}

.login-floating button:hover {
    opacity: 0.9 ;
}

/* OVERLAY PARA FECHAR AO CLICAR FORA */
.overlay {
    position: fixed ;
    top: 0 ;
    left: 0 ;
    width: 100vw ;
    height: 100vh ;
    background: transparent ;
    z-index: 1000 ;
    display: none ;
}

.overlay.show {
    display: block ;
}

/* MEDIA QUERIES PARA O HEADER */
@media (max-width: 768px) {
    header {
        top: 5px ;
        right: 5px ;
        max-width: calc(100vw - 10px) ;
        padding: 6px ;
    }
    
    .profile-icon {
        width: 30px ;
        height: 30px ;
        font-size: 14px ;
    }
    
    .login-floating {
        top: 50px ;
        right: 5px ;
        min-width: 180px ;
    }
}

@media (max-width: 480px) {
    header {
        position: relative ;
        top: auto ;
        right: auto ;
        max-width: 100% ;
        margin-bottom: 10px ;
        justify-content: center ;
    }
    
    .login-floating {
        top: 120px ;
        right: 50% ;
        transform: translateX(50%) ;
        min-width: 200px ;
    }
}


/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/* LAYOUTS DE CARDS - CORRIGIDO */
.cards-container.layout-colunas {
    display: grid;
    grid-template-columns: repeat(var(--colunas, 3), 1fr);
    gap: 10px;
    padding: 10px;
    overflow-y: auto;
    max-height: 100%;

}
    .live-title {
        font-size: 1.1rem;
    }

    .live-description {
        font-size: 12px;
    }

    .video-card {
        min-width: 260px;
    }


.cards-container.layout-colunas {

    padding: 10px;
}

.cards-container.layout-horizontal {
  
    padding: 10px;
}


.video-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    /*background: white;*/
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);

}
    
.video-title {
    font-size: 12px;
    line-height: 1.2;
    margin-bottom: 4px;
    color: #333;

}

.video-author {
    font-size: 10px;
    color: #666;
    margin: 0;

}

.video-footer {
    padding: 4px 8px;
  
    border-top: 1px solid #eee;
    text-align: center;
    background-color: #f5f5f5;
}




.header-live  {
    border-bottom: none;

}
.header-live .secao-header h2 {
    color: white;
    margin: 0;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);

}
.header-live  button {
    background: rgba(255,255,255,0.9);
    color: #45a049;
    border: 1px solid white;
    font-weight: 600;
    transition: all 0.3s ease;

}
.header-live .secao-buttons button:hover {
    background: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);

}
.header-live .secao-header {
        padding: 10px;
        margin: -10px -10px 12px -10px;
    }
.secao img {
    min-width: 200px;
    min-height: 200px;
    max-width: 100vw;
    width: auto;
    height: auto;
}
.live-title {
    width: 100%;
    max-width: 100%;
}
.live-description {
    width: 100%;
    max-width: 100%;
}
.video-card {
   
   width: auto;
    height: auto;
}
.video-title {
    width: 100%;
    max-width: 100%;
}
/* comportamento padr√£o: DESKTOP */
.live-card {
  width: 100%;              /* ocupa toda a largura dispon√≠vel */
  max-width: 100%;          /* n√£o ultrapassa o pai */
  
}
/* MOBILE ‚Äî impedir transbordamento */
@media (max-width: 768px) {
  .live-card {
    max-width: 100vw; /* mant√©m dentro da tela */
    overflow-x: hidden;
  }
}

.live-card {
  flex: 1 1 auto;           /* cresce junto com o pai */
  
  margin: 10px;             /* espa√ßamento visual */
  padding: 10px;
  
  box-sizing: border-box;
}

.live-header-content {
    min-width: 0;
  /*  width: auto;*/
    max-width: 100%;
}
.live-header-content {
    display: block;
    overflow: hidden;
    
}

.live-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
}



.live-status {
    display: inline-block;
    white-space: nowrap;
    flex-shrink: 0;
}
.div-horizontal {
    max-width: 100%;
/*    min-height: 200px;*/
}
.div-horizontal {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 15px;
  
  
  background: #fafafa;
    
  
  
}
.div-horizontal {
    display: flex;
    flex-direction: column;
}
.div-header-content {
    min-width: 200px;

}
.div-header-content {
    display: block;
    overflow: hidden;
    
}
.horizontal-scroll-container {
    width: 100%;
   
}
.horizontal-scroll-container {
    display: block;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
}
.horizontal-scroll-container {
    scrollbar-width: thin;
    scrollbar-color: #c1c1c1 #f1f1f1;
    margin: 0;
    background: #3afafa;
  background: #fafafa;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
}
.horizontal-scroll-container::-webkit-scrollbar {
    height: 8px;
    
}
.horizontal-scroll-container::-webkit-scrollbar-track {
    background: #f971f1;
    border-radius: 4px;
}
.horizontal-scroll-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}
.horizontal-scroll-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
.cards-flex-container {
    min-height: fit-content;
    width: max-content;
    height: auto;
    min-width: 100%;
    
}
.cards-flex-container {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    flex-wrap: wrap;
    align-content: flex-start;
}

.card-size-pequeno {
    width: 135px;
    height: 135px;
}

.card-size-medio {
    width: 180px;
    height: 180px;
}

.card-size-grande {
    width: 225px;
    height: 225px;
}

.card-size-extra-grande {
    width: 270px;
    height: 270px;
}
.video-iframe-container {
    max-width: 100%;
    height: 100%;
    
}
.video-iframe-container {
    display: block;
    overflow: hidden;
    
}
.video-iframe-container {
    background: #000;
}
.video-iframe {
    border: none;
    
}
.video-iframe {
    width: 100%;
    height: 100%;
}
.video-info {
   display: flex;
   
    flex-direction: column;
    justify-content: space-between;
    
}
.video-info {
    padding: 8px;
    
}
.video-info {
    width: 100%;
    height: 30%;
    min-height: 60px;
}

.empty-card {
    min-width: 250px;
    width: 100%;
    height: 100px;
}
.empty-card {
    color: #999;
    font-style: italic;
    border: 1px dashed #ccc;
    border-radius: 6px;
    padding: 20px;
   background: #f9f9f9;
    
}
.empty-card {
    display: flex;
    align-items: center;
    justify-content: center;
    
}

    .live-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .live-header {
    margin-bottom: 15px;

}

    .live-status {
        align-self: flex-start;
    }

    .live-title {
        font-size: 1.2rem;
    }

    .live-description {
        font-size: 13px;
    }

    .divs-title {
        font-size: 1rem;
    }



    .video-card {
        min-width: 280px;
    }

    .btn {
        padding: 8px 12px;
        font-size: 13px;
    }
}


/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */

/* ===== Modal principal ===== */
.modal-sala-webrtc {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  z-index: 10001;
  display: flex;
  flex-direction: column;
  color: white;
  font-family: Arial, sans-serif;
  
  /* üîí ESSENCIAIS para toque */
  pointer-events: auto;
  touch-action: none;
  overscroll-behavior: contain;
}
@media (max-width: 768px) {
  .modal-sala-webrtc {
    position: fixed;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    pointer-events: auto;
    touch-action: none;
  }
}




/* ===== Cabe√ßalho do modal ===== */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  border-bottom: 1px solid #333;
  background: #1a1a1a;
}

.modal-header h3 {
  margin: 0;
  color: #4caf50;
}

.modal-header button {
  background: #f44336;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
}

/* ===== Layout interno ===== */
.modal-content {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* ===== Coluna esquerda ===== */
.col-esquerda {
  flex: 3;
  display: flex;
  flex-direction: column;
  padding: 15px;
  border-right: 1px solid #333;
}

.video-container {
  flex: 1;
  background: #000;
  border-radius: 10px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
}

.video-participant {
  background: #333;
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  min-width: 150px;
}

/* ===== Bot√µes ===== */
.btn-audio {
  flex: 1;
  background: #4caf50;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 5px;
  cursor: pointer;
}

.btn-video {
  flex: 1;
  background: #2196f3;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 5px;
  cursor: pointer;
}

/* ===== Apostas & Desafios ===== */
.section-apostas,
.section-desafios {
  background: #2a2a2a;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 10px;
}

.section-apostas h4 {
  margin: 0 0 10px 0;
  color: #ff9800;
}

.section-desafios h4 {
  margin: 0 0 10px 0;
  color: #9c27b0;
}

.btn-aposta,
.btn-desafio {
  width: 100%;
  color: white;
  border: none;
  padding: 8px;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}

.btn-aposta {
  background: #ff9800;
}

.btn-desafio {
  background: #9c27b0;
}

/* ===== Coluna direita ===== */
.col-direita {
  flex: 2;
  display: flex;
  flex-direction: column;
}

.participantes-header {
  padding: 15px;
  border-bottom: 1px solid #333;
  background: #1a1a1a;
}

.participante-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 5px;
  border-radius: 5px;
  background: #2a2a2a;
  margin: 2px 0;
}

.participante-item .status {
  width: 8px;
  height: 8px;
  background: #4caf50;
  border-radius: 50%;
}

/* ===== Chat ===== */
.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.chat-messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #1a1a1a;
}

.chat-input-area {
  padding: 15px;
  border-top: 1px solid #333;
  background: #2a2a2a;
  display: flex;
  gap: 10px;
}

.chat-input-area input {
  flex: 1;
  padding: 10px;
  border: 1px solid #444;
  border-radius: 5px;
  background: #333;
  color: white;
}

.chat-input-area button {
  background: #4caf50;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
}



/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */
/*   //////////////////////  */




.div-horizontal {
  /*  background:red;*/
}
.apostas-desafios-container {
    display: flex;
  /*  background:red;*/
    gap: 10px;
}
     .modal-apostas, .modal-desafios, .modal-chat {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease-in-out;
    }
    .modal-content {
        background: white;
        padding: 20px;
        border-radius: 12px;
        max-width: 90%;
        width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        gap: 20px;
        box-sizing: border-box;
    }
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
    }
    .modal-header h3 {
        font-size: 1.5rem;
        color: #333;
        margin: 0;
        flex: 1;
        text-align: center;
    }
.close-button {
        background: transparent;
        color: #f44336;
        font-size: 1.2rem;
        font-weight: bold;
        border: 2px solid #f44336;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
    }
    .close-button:hover {
        background: #f44336;
        color: white;
    }
    .user-info {
        background: #f0f4f8;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .user-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
    }
    .user-details span {
        font-size: 1rem;
        color: #333;
        font-weight: 500;
    }
    .logout-button {
        background: #f44336;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        align-self: flex-end;
        font-size: 0.9rem;
        transition: background 0.2s;
    }
    .logout-button:hover {
        background: #d32f2f;
    }
    .apostas-options {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

        .create-bet-button, .view-bets-button, .open-chat-button {
        background: linear-gradient(90deg, #4CAF50, #66BB6A);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        transition: background 0.2s, transform 0.2s;
    }
    
    
.create-challenge-button, .view-challenges-button {
        background: linear-gradient(90deg, #4CAF50, #66BB6A);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        transition: background 0.2s, transform 0.2s;
    }
    
    
    .create-challenge-button:hover, .view-challenges-button:hover {
        background: linear-gradient(90deg, #45a049, #5cb860);
        transform: scale(1.02);
    }
    
        .create-bet-button:hover, .view-bets-button:hover, .open-chat-button:hover {
        background: linear-gradient(90deg, #45a049, #5cb860);
        transform: scale(1.02);
    }
    .open-chat-button {
        background: linear-gradient(90deg, #FF9800, #FFB300);
    }
    .open-chat-button:hover {
        background: linear-gradient(90deg, #F57C00, #FFA000);
    }
    .view-bets-button {
        background: linear-gradient(90deg, #2196F3, #42A5F5);
    }
    .view-bets-button:hover {
        background: linear-gradient(90deg, #1e88e5, #3d9df4);
    }
.view-challenges-button {
        background: linear-gradient(90deg, #2196F3, #42A5F5);
    }
    .view-challenges-button:hover {
        background: linear-gradient(90deg, #1e88e5, #3d9df4);
    }
    .with-red-dot {
        position: relative;
    }
    .with-red-dot::after {
        content: '';
        position: absolute;
        top: -4px;
        right: -4px;
        width: 10px;
        height: 10px;
        background: #f44336;
        border-radius: 50%;
        border: 1px solid white;
        box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
    }
  .apostas-list, .desafios-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}
.apostas-list.hidden, .desafios-list.hidden {
    opacity: 0;
    visibility: hidden;
}
.apostas-list h4, .desafios-list h4 {
    font-size: 1.2rem;
    color: #333;
    margin: 0 0 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid #e0e0e0;
}
    .aposta-card,.desafio-card {
        display: flex;
        flex-direction: row;
        gap: 15px;
        border: 1px solid #e0e0e0;
        padding: 15px;
        border-radius: 8px;
        background: #fafafa;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .aposta-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    .aposta-info strong {
        font-size: 1.1rem;
        color: #333;
        font-weight: 600;
    }
    .aposta-info p {
        margin: 3px 0;
        color: #555;
        font-size: 0.9rem;
    }
    .aposta-info small {
        color: #777;
        font-size: 0.8rem;
    }
    .aposta-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
    }
    .participar-button, .encerrar-button {
        background: #2196F3;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s;
    }
    .encerrar-button {
        background: #f44336;
    }
    .participar-button:hover {
        background: #1e88e5;
    }
    .encerrar-button:hover {
        background: #d32f2f;
    }
    .encerrada {
        color: #f44336;
        margin: 0;
        font-size: 0.9rem;
        font-weight: 500;
    }
    .no-apostas {
        color: #666;
        margin: 0;
        font-size: 0.9rem;
        text-align: center;
        padding: 10px;
    }
    .aposta-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
.form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        font-size: 1rem;
        color: #333;
    }
    .form-input {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 100%;
        font-size: 1rem;
        box-sizing: border-box;
    }
    .form-input:focus {
        outline: none;
        border-color: #4CAF50;
        box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
    }
    .form-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    .confirm-button {
        background: #4CAF50;
        color: white;
        padding: 8px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        flex: 1;
        font-size: 1rem;
        transition: background 0.2s;
    }
    .confirm-button:hover {
        background: #45a049;
    }
    .cancel-button {
        background: #f44336;
        color: white;
        padding: 8px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        flex: 1;
        font-size: 1rem;
        transition: background 0.2s;
    }
    .cancel-button:hover {
        background: #d32f2f;
    }
    .login-form, .comprovante-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
        text-align: center;
        padding: 20px;
    }
    .login-form h3 {
        font-size: 1.5rem;
        color: #333;
        margin: 0;
    }
.login-form p {
        color: #555;
        font-size: 1rem;
        margin: 5px 0;
    }
    .login-form input {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
        box-sizing: border-box;
    }
    .login-form button {
        background: #4CAF50;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
    }
    .login-form button:hover {
        background: #45a049;
    }
    .apostas-container {
        display: flex;
        gap: 5px;
        margin-top: 5px;
        flex-wrap: wrap;
    }
    .botao-apostas-custom,.botao-desafios-custom {
        background: #FF9800;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        min-width: 100px;
        transition: background 0.2s, transform 0.2s;
        position: relative;
    }
    .botao-apostas-custom,.botao-desafios-custom:hover {
        background: #F57C00;
        transform: scale(1.05);
    }
    
        .comprovantes-list {
        margin-top: 10px;
        padding: 10px;
        border-top: 1px solid #ccc;
    }
    .resultado-ganhou {
        color: green;
        font-weight: bold;
    }
    .resultado-perdeu {
        color: red;
        font-weight: bold;
    }
    
    .notificacao {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 5px;
        color: white;
        background: #4CAF50;
        z-index: 10001;
        animation: slideIn 0.3s ease-in-out;
        font-size: 1rem;
    }
    .notificacao.erro {
        background: #f44336;
    }
    
    
        .chat-modal {
        background: white;
        padding: 20px;
        border-radius: 12px;
        max-width: 90%;
        width: 600px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .chat-messages {
        max-height: 50vh;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background: #f9f9f9;
    }
    .chat-message {
        padding: 8px;
        margin: 5px 0;
        border-radius: 5px;
        background: #e0f7fa;
        font-size: 0.9rem;
    }
    .chat-message.own {
        background: #c8e6c9;
        margin-left: 20%;
    }
    .chat-input {
        display: flex;
        gap: 10px;
    }
    .chat-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
    }
    .chat-input button {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
    }
    .chat-input button:hover {
        background: #45a049;
    }
    .voice-controls {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    .voice-controls button {
        background: #2196F3;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
    }
    .voice-controls button:hover {
        background: #1e88e5;
    }
    .voice-controls button:disabled {
        background: #b0bec5;
        cursor: not-allowed;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
   @keyframes slideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 800px) {
        .modal-content {
            width: 95%;
            padding: 15px;
            max-height: 90vh;
        }
        .modal-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
        .user-details {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
        .apostas-options {
            flex-direction: column;
            gap: 10px;
        }
        .aposta-card {
            flex-direction: column;
            gap: 10px;
        }
        .form-actions {
            flex-direction: column;
            gap: 8px;
        }
        .botao-apostas-custom {
            font-size: 11px;
            padding: 6px 10px;
            min-width: 90px;
        }
        .create-bet-button, .view-bets-button {
            font-size: 0.9rem;
            padding: 10px;
        }
        .aposta-info strong {
            font-size: 1rem;
        }
        .aposta-info p, .aposta-info small {
            font-size: 0.85rem;
        }
        .participar-button, .encerrar-button {
            font-size: 0.85rem;
            padding: 6px 10px;
        }
        .confirm-button, .cancel-button {
            font-size: 0.9rem;
            padding: 8px;
        }
        .form-label {
            font-size: 0.9rem;
        }
        .form-input {
            font-size: 0.9rem;
        }
        
        .chat-float-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: #25D366;
    color: white;
    border-radius: 50%;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 999;
    transition: all 0.3s;
}

.chat-float-btn:hover {
    transform: scale(1.1);
    background: #128C7E;
}

.chat-window {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 320px;
    height: 450px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    z-index: 998;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

.chat-header {
    background: #25D366;
    color: white;
    padding: 12px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chat-close {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
}

.chat-body {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: #f4f4f4;
}

.chat-footer {
    padding: 10px;
    background: white;
    display: flex;
    gap: 8px;
    border-top: 1px solid #ddd;
}

.chat-footer input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 20px;
    outline: none;
}

.chat-footer button {
    padding: 10px 16px;
    background: #25D366;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
}
.btn-chat {
    background: #25D366;
    color: white;
}
    }
`;
document.head.appendChild(style);



// ===== CHAT GLOBAL INJETADO VIA JAVASCRIPT =====
// ===== CHAT WEBRTC COM SALAS - INJETADO VIA JAVASCRIPT =====
// === ENTRAR SALA - CORRIGIDA ===
// === ENTRAR SALA - MAIS ROBUSTA =


// === ENTRAR SALA - MAIS ROBUSTA COM VERIFICA√á√ÉO DE SOCKET ===
window.entrarSala = async function(room) {
  //  console.log('üö™ entrarSala chamada com room:', room);
/*    console.log('üìä Socket status:', {
        socket: !!socket,
        socketConectado: socket?.connected,
        salasDisponiveis: Object.keys(salasDisponiveis || {}).length
    });*/
    
    if (!room) {
        console.error('‚ùå Nome da sala √© undefined ou vazio');
        mostrarNotificacao('Erro: Sala n√£o especificada', 'erro');
        return;
    }

    // ‚≠ê‚≠ê CORRE√á√ÉO: Verificar se socket est√° conectado
    if (!socket || !socket.connected) {
        console.error('‚ùå Socket n√£o conectado, tentando reconectar...');
        conectarSocket();
        
        // Tentar novamente ap√≥s reconex√£o
        setTimeout(() => {
            /*console.log('üîÑ Retentando entrarSala ap√≥s reconex√£o');*/
            entrarSala(room);
        }, 1000);
        return;
    }

    // ‚≠ê‚≠ê CORRE√á√ÉO: Garantir que salasDisponiveis existe
    if (!salasDisponiveis) {
        console.warn('‚ö†Ô∏è salasDisponiveis n√£o definido, inicializando...');
        salasDisponiveis = {};
    }

    // Se a sala n√£o existe, criar automaticamente
    if (!salasDisponiveis[room]) {
       /* console.log('‚ûï Criando sala automaticamente:', room);*/
        salasDisponiveis[room] = {
            nome: room,
            usuarios: 1
        };
        
        if (socket) {
            socket.emit('create-room', {
                room: room,
                nome: room,
                criador: usuarioLogado?.nome || 'An√¥nimo'
            });
        }
    }

    // ‚≠ê‚≠ê CORRE√á√ÉO: Verificar se a sala tem nome antes de usar
    const infoSala = salasDisponiveis[room];
    const nomeDaSala = infoSala?.nome || room;
    
  /*  console.log('‚úÖ Sala configurada:', { room, nomeDaSala, infoSala });*/

    if (salaAtual === room) {
       /* console.log('‚úÖ J√° est√° na sala, mudando para aba chat');*/
        mudarAba('chat');
        return;
    }

    if (salaAtual) {
        socket.emit('leave-room', { room: salaAtual });
        socket.emit('voice-leave', { room: salaAtual });
        desativarVoz();
    }

    salaAtual = room;
    
    // ENTRAR NA SALA NO SERVIDOR
    socket.emit('join-room', {
        room: room,
        user: usuarioLogado?.nome || 'Visitante',
        merito: usuarioLogado?.merito || 0
    });

    // ATUALIZAR INTERFACE
    document.getElementById('chatInput').disabled = false;
    document.getElementById('sendBtn').disabled = false;
    document.getElementById('voiceBtn').disabled = false;
    document.getElementById('chatInput').placeholder = `Mensagem em ${nomeDaSala}...`;
    
    // ‚≠ê‚≠ê CORRE√á√ÉO: Limpar mensagens de forma segura
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) chatMessages.innerHTML = '';
    
    // ATUALIZAR T√çTULO E STATUS
    document.getElementById('headerTitle').textContent = nomeDaSala;
    atualizarStatus(`Conectado em ${nomeDaSala}`);
    document.getElementById('voiceUsers').style.display = 'block';

    // ATUALIZAR LISTAS
    renderizarSalas();
    renderizarUsuarios();
    
    // MUDAR PARA ABA DO CHAT
    setTimeout(() => {
       /* console.log('üéØ Finalmente mudando para aba chat');*/
        mudarAba('chat');
    }, 100);
};
// === MUDAR ABA - CORRIGIDA ===
window.mudarAba = function(aba) {
    abaAtual = aba;
    document.querySelectorAll('.chat-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.chat-content').forEach(c => c.classList.remove('active'));

    document.querySelector(`.chat-tab[onclick="mudarAba('${aba}')"]`).classList.add('active');
    document.getElementById(`${aba}Content`).classList.add('active');

    // ATUALIZAR T√çTULO CORRETAMENTE
    let titulo = 'Chat Global';
    if (aba === 'chat' && salaAtual) {
        titulo = salasDisponiveis[salaAtual]?.nome || salaAtual;
    } else if (aba === 'usuarios') {
        titulo = salaAtual ? `Usu√°rios - ${salasDisponiveis[salaAtual]?.nome || salaAtual}` : 'Usu√°rios na Sala';
    }
    
    document.getElementById('headerTitle').textContent = titulo;
};

// ===== FUN√á√ÉO PARA CRIAR SALAS AUTOM√ÅTICAS =====
function criarSalasAutomaticas() {
    if (!AppState.socket) {
        //console.log('Aguardando conex√£o socket...');
        setTimeout(criarSalasAutomaticas, 1000);
        return;
    }

   // console.log('üîÑ Criando salas autom√°ticas...');
    
    // Salas para Jogos
    dados.jogos.forEach(jogo => {
        criarSalaSeNaoExistir(`üéÆ ${jogo.nome}`, 'jogo');
        
        // Salas para Est√°dios
        jogo.estadios.forEach(estadio => {
            criarSalaSeNaoExistir(`üèüÔ∏è ${estadio.nome}`, 'estadio');
            
            // Salas para Times
            estadio.times.forEach(time => {
                criarSalaSeNaoExistir(`‚öΩ ${time.nome}`, 'time');
                
                // Salas para Lives
                (time.lives || []).forEach(live => {
                    criarSalaSeNaoExistir(`üì∫ ${live.titulo}`, 'live');
                    
                    // Salas para Divs Horizontais
                    (live.divsHorizontais || []).forEach(div => {
                        criarSalaSeNaoExistir(`üìä ${div.titulo || `Div ${div.id}`}`, 'div');
                        
                        // Salas para Cards
                        (div.cards || []).forEach(card => {
                            criarSalaSeNaoExistir(`üé¥ ${card.titulo || `Card ${card.id}`}`, 'card');
                        });
                        
                        // Salas para Iframes
                        (div.iframes || []).forEach(iframe => {
                            if (iframe.url) {
                                criarSalaSeNaoExistir(`üåê ${iframe.nome || 'Iframe'}`, 'iframe');
                            }
                        });
                    });
                });
            });
        });
    });
    
    console.log('‚úÖ Salas autom√°ticas criadas!');
}

// ===== FUN√á√ÉO PARA ENTRAR EM QUALQUER SALA AUTOMATICAMENTE =====

// === ENTRAR SALA POR TIPO - CORRIGIDA ===
function entrarSalaPorTipo(tipo, id, nome) {
   // console.log('üéØ entrarSalaPorTipo:', { tipo, id, nome });

    if (!usuarioLogado?.nome) {
        usuarioLogado = { 
            nome: `Visitante${Math.floor(Math.random() * 1000)}`, 
            merito: 'visitante' 
        };
    }

    const nomeSala = getNomeSalaPorTipo(tipo, nome);
    abrirChatGlobal();

    // Fun√ß√£o para atualizar o ID real da sala pelo nome
    function atualizarRoomId() {
        return Object.keys(salasDisponiveis).find(
            idSala => salasDisponiveis[idSala]?.nome === nomeSala
        );
    }

    function tentarEntrarSala() {
        const roomId = atualizarRoomId();
     /*   console.log('üîÑ Tentando entrar na sala...', {
            socketConectado: !!socket,
            salaAtualDefinida: typeof salaAtual !== 'undefined',
            salasDisponiveis: Object.keys(salasDisponiveis || {}).length,
            roomId,
        });*/

        if (socket && typeof salaAtual !== 'undefined') {
            if (roomId) {
              //  console.log('‚úÖ Sala encontrada:', roomId);
                entrarSala(roomId);
            } else {
                console.warn('‚ö†Ô∏è Sala n√£o encontrada, criando nova:', nomeSala);
                criarSalaSeNaoExistir(nomeSala, tipo);
                setTimeout(() => {
                    const novaSala = atualizarRoomId();
                    if (novaSala) {
                     //   console.log('‚úÖ Nova sala localizada ap√≥s cria√ß√£o:', novaSala);
                        entrarSala(novaSala);
                    } else {
                        console.error('‚ùå N√£o foi poss√≠vel localizar a sala criada:', nomeSala);
                    }
                }, 1000);
            }
        } else {
            console.log('‚è≥ Aguardando inicializa√ß√£o...');
            setTimeout(tentarEntrarSala, 500);
        }
    }

    // Inicia o processo
    setTimeout(tentarEntrarSala, 1000);

    // Garante que a aba de chat seja ativada
    setTimeout(() => {
        if (typeof mudarAba === 'function') {
         //   console.log('üí¨ Mudando para aba chat');
            mudarAba('chat');
        }
    }, 3000);
}


// ===== FUN√á√ÉO PARA OBTER NOME DA SALA POR TIPO =====
function getNomeSalaPorTipo(tipo, nome) {
    const prefixos = {
        'jogo': 'üéÆ',
        'estadio': 'üèüÔ∏è', 
        'time': '‚öΩ',
        'live': 'üì∫',
        'div': 'üìä',
        'card': 'üé¥',
        'iframe': 'üåê'
    };
    
    return `${prefixos[tipo] || 'üí¨'} ${nome}`;
}
// ===== FUN√á√ïES ESPEC√çFICAS PARA CADA TIPO =====
function entrarSalaJogo(jogoId) {
    const jogo = dados.jogos.find(j => j.id === jogoId);
    if (jogo) entrarSalaPorTipo('jogo', jogoId, jogo.nome);
}
function entrarSalaEstadio(jogoId, estadioId) {
    const estadio = encontrarEstadio(jogoId, estadioId);
    if (estadio) entrarSalaPorTipo('estadio', estadioId, estadio.nome);
}
// Adicionar ao container de bot√µes
function entrarSalaTime(jogoId, estadioId, timeId) {
    const time = encontrarTime(jogoId, estadioId, timeId);
    if (time) entrarSalaPorTipo('time', timeId, time.nome);
}
function entrarSalaLive(jogoId, estadioId, timeId, liveId) {
    const live = encontrarLive(jogoId, estadioId, timeId, liveId);
    if (live) entrarSalaPorTipo('live', liveId, live.titulo);
}
function entrarSalaDiv(jogoId, estadioId, timeId, liveId, divId) {
    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);
    if (div) entrarSalaPorTipo('div', divId, div.titulo || `Div ${divId}`);
}

// Adicionar ao container de bot√µes
function entrarSalaCard(cardId) {
    const card = encontrarCardPorId && encontrarCardPorId(cardId);
    if (card) entrarSalaPorTipo('card', cardId, card.titulo || `Card ${cardId}`);
}
// ===== FUN√á√ÉO PARA SALA DE IFRAME =====

function entrarSalaIframe(jogoId, estadioId, timeId, liveId, divId, iframeId) {
   /* console.log("###########################");
    console.log("liveId", liveId);
    console.log("divId", divId);
    console.log("iframeId", iframeId);
    console.log("###########################");*/

    const iframe = encontrarIframe(jogoId, estadioId, timeId, liveId, divId, iframeId);

    if (iframe) {
        const nome = iframe.titulo || iframe.nome || `Iframe ${iframeId}`;
      //  console.log("üéØ Entrando na sala do iframe:", nome);
        entrarSalaPorTipo('iframe', iframeId, nome);
    } else {
        console.warn("‚ö†Ô∏è Nenhum iframe encontrado ‚Äî criando sala gen√©rica:", iframeId);
        criarSalaSeNaoExistir(`üåê Iframe ${iframeId}`, 'iframe');
        setTimeout(() => entrarSalaPorTipo('iframe', iframeId, `Iframe ${iframeId}`), 1000);
    }
}

// ===== FUN√á√ÉO AUXILIAR PARA ENCONTRAR IFRAME =====

// ===== FUN√á√ÉO AUXILIAR PARA ENCONTRAR IFRAME =====
function encontrarIframe(jogoId, estadioId, timeId, liveId, divId, iframeId) {
   // console.log("_____encontrarIframe");

    const div = encontrarDivHorizontal(jogoId, estadioId, timeId, liveId, divId);

    if (!div) {
        console.warn("‚ö†Ô∏è Nenhuma div encontrada para IDs:", { jogoId, estadioId, timeId, liveId, divId });
        return null;
    }

    // compatibilidade com 'cards' ou 'iframes' ou 'iframers'
    const lista = div.cards || div.iframes || div.iframers || [];

   // console.log("_____div encontrada:", div);
    const iframe = lista.find(i => i.id === iframeId);

    if (!iframe) {
        console.warn("‚ö†Ô∏è Nenhum iframe encontrado dentro da div:", { divId, iframeId, lista });
    } else {
      //  console.log("‚úÖ Iframe encontrado:", iframe);
    }

    return iframe || null;
}

// ===== ATUALIZAR A FUN√á√ÉO ORIGINAL =====
function criarOuEntrarSalaJogo(jogoId) {
    entrarSalaJogo(jogoId);
}
// ===== INICIALIZAR SALAS AUTOMATICAS =====
function inicializarSalasAutomaticas() {
    // Esperar socket conectar e ent√£o criar salas
    if (AppState.socket && AppState.socket.connected) {
        criarSalasAutomaticas();
    } else {
        setTimeout(inicializarSalasAutomaticas, 1000);
    }
}
// ===== ADICIONAR ESTE HANDLER NO initializeApp ou setupGlobalChatHandlers =====
function setupSalasAutomaticasHandlers() {
    if (!AppState.socket) return;

    // Quando o servidor confirma que uma sala foi criada
    AppState.socket.on('room-created', (data) => {
     //   console.log('‚úÖ Sala criada pelo servidor:', data);
        if (data.room && data.info) {
            salasDisponiveis[data.room] = data.info;
            renderizarSalas(); // Atualizar a lista visual
        }
    });

    // Quando recebe a lista de salas do servidor
    AppState.socket.on('rooms-list', (salas) => {
      //  console.log('üìã Lista de salas recebida:', salas);
        salasDisponiveis = salas;
        renderizarSalas(); // Atualizar a lista visual
    });
}

// ===== ATUALIZAR O initializeApp =====
async function initializeApp() {
    const urlInfo = getIdFromUrl();
    
  await  initializeSocketConnection();
   await initializeAutoChats(urlInfo);
   await setupGlobalChatHandlers();
   await setupGameRoomHandlers();
  await  setupSalasAutomaticasHandlers(); // ‚≠ê‚≠ê ADICIONAR ESTA LINHA ‚≠ê‚≠ê
    
    // Inicializar salas autom√°ticas
  await  inicializarSalasAutomaticas()
    
    if (urlInfo) {
      await  handleUrlRouting(urlInfo);
    }
    
  await  joinGlobalChat()
}
// ===== MELHORAR A FUN√á√ÉO criarSalaSeNaoExistir =====

// === CRIAR SALA SE N√ÉO EXISTIR - OTIMIZADA ===
function criarSalaSeNaoExistir(nomeSala, tipo) {
    const salaExiste = Object.values(salasDisponiveis).some(
        sala => sala?.nome === nomeSala
    );

    if (!salaExiste && socket) {
        const roomId = `${tipo}-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;
      //  console.log(`üîÑ Criando sala: ${nomeSala} (${roomId})`);

        socket.emit('create-room', {
            room: roomId,
            nome: nomeSala,
            tipo,
            criador: usuarioLogado?.nome || 'Sistema'
        });

        salasDisponiveis[roomId] = { nome: nomeSala, usuarios: 0, tipo };
        renderizarSalas();

       // console.log(`‚ûï Sala criada localmente: ${nomeSala}`);
    } else if (salaExiste) {
        console.log(`‚è© Sala j√° existe: ${nomeSala}`);
    } else {
        console.warn('‚ö†Ô∏è Socket n√£o dispon√≠vel ao tentar criar sala');
    }
}

// ===== ADICIONAR DEBUG NA RENDERIZA√á√ÉO =====
// === RENDER SALAS - MAIS SEGURA ===
function renderizarSalas() {
    const container = document.getElementById('chatRoomsSection');
    
    if (!container) {
        console.error('‚ùå Container de salas n√£o encontrado');
        return;
    }
    
   // console.log('üîÑ Renderizando salas:', Object.keys(salasDisponiveis).length);

    if (Object.keys(salasDisponiveis).length === 0) {
        container.innerHTML = '<div style="text-align:center; color:#999; font-size:13px;">Nenhuma sala dispon√≠vel</div>';
        return;
    }

    container.innerHTML = Object.entries(salasDisponiveis).map(([roomId, info]) => {
        // ‚≠ê‚≠ê CORRE√á√ÉO: Verificar se info existe
        if (!info) {
            console.warn('‚ö†Ô∏è Info da sala √© undefined para roomId:', roomId);
            return '';
        }
        
        const ativo = salaAtual === roomId ? 'active' : '';
        const usuarios = info.usuarios || 0;
        const nome = info.nome || roomId; // ‚≠ê‚≠ê Fallback para roomId se nome n√£o existir
        
       // console.log(`üìù Renderizando sala: ${nome} (${roomId}) - ${usuarios} users`);
        
        return `
            <div class="room-item ${ativo}" onclick="entrarSala('${roomId}')">
                <div class="room-info">
                    <div class="room-name">${nome}</div>
                    <div class="room-users">${usuarios} online</div>
                </div>
                ${ativo ? '<div style="font-size:10px; color:#28a745;">‚úì Conectado</div>' : ''}
            </div>
        `;
    }).join('');
}
   // ===== CHAT GLOBAL + VOZ + CONTADOR + SUAS MENSAGENS APARECEM =====
  
(function() {
    'use strict';

    if (window.globalChatInjetado) return;
    window.globalChatInjetado = true;



    // === CSS (seu original, sem mudan√ßas) ===
    const style = document.createElement('style');
    style.textContent = `
        #chatFloatButton {
            position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            border-radius: 50%; font-size: 16px; font-weight: bold; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3); cursor: pointer; z-index: 1000; transition: all 0.3s ease;
            font-family: 'Segoe UI', sans-serif; user-select: none;
        }
        #chatFloatButton:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }

        #chatGlobalWindow { position: fixed; bottom: 90px; right: 20px; width: 380px; height: 520px;
            background: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; flex-direction: column;
            z-index: 999; font-family: 'Segoe UI', sans-serif; overflow: hidden; border: 1px solid #eee;
        }
        #chatGlobalWindow.show { display: flex; }

        .chat-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 14px 16px;
            font-weight: 600; font-size: 16px; display: flex; justify-content: space-between; align-items: center;
        }
        .chat-close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }

        .chat-tabs { display: flex; background: #f0f0f0; border-bottom: 1px solid #ddd; }
        .chat-tab { flex: 1; padding: 10px; text-align: center; font-size: 13px; cursor: pointer; transition: background 0.2s; }
        .chat-tab.active { background: white; font-weight: 600; border-bottom: 2px solid #667eea; }

        .chat-content { flex: 1; overflow-y: auto; display: none; }
        .chat-content.active { display: block; }

        #chatRoomsSection, #chatUsersSection, #chatMessages { padding: 16px; background: #f8f9fa; }
        .room-item, .user-item { padding: 10px; background: white; border-radius: 8px; margin-bottom: 6px; cursor: pointer; transition: background 0.2s; }
        .room-item:hover, .room-item.active, .user-item:hover { background: #667eea; color: white; }
        .room-info, .user-info { display: flex; justify-content: space-between; font-size: 14px; }
        .room-name, .user-name { font-weight: 600; }
        .room-users, .user-status { font-size: 12px; opacity: 0.8; }

        .message { max-width: 80%; padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.4; word-wrap: break-word; margin: 4px 0; }
        .message.user { align-self: flex-end; background: #667eea; color: white; }
        .message.other { align-self: flex-start; background: white; color: #333; border: 1px solid #e0e0e0; }

        .chat-input-area { padding: 12px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px; }
        .chat-input-area input { flex: 1; padding: 10px 14px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 14px; }
        .chat-input-area input:focus { border-color: #667eea; }
        .chat-input-area button { padding: 10px 16px; background: #667eea; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 600; }
        .chat-input-area button:disabled { background: #ccc; cursor: not-allowed; }

        #chatStatus { padding: 8px; text-align: center; font-size: 12px; color: #666; background: #f0f0f0; }

        #voiceUsers { padding: 8px; font-size: 12px; color: #555; border-top: 1px solid #eee; display: none; }
        #voiceUsers strong { color: #333; }
    `;
    document.head.appendChild(style);

    // === HTML ===
    const chatHTML = `
        <div id="chatFloatButton">Chat</div>
        <div id="chatGlobalWindow">
            <div class="chat-header">
                <span id="headerTitle">Chat Global</span>
                <button class="chat-close-btn" onclick="fecharChatGlobal()">√ó</button>
            </div>

            <!-- ABAS -->
            <div class="chat-tabs">
                <div class="chat-tab active" onclick="mudarAba('salas')">Salas</div>
                <div class="chat-tab" onclick="mudarAba('usuarios')">Usu√°rios</div>
                <div class="chat-tab" onclick="mudarAba('chat')">Chat</div>
            </div>

            <!-- CONTE√öDO -->
            <div id="salasContent" class="chat-content active">
                <div style="padding:16px; background:#f0f0f0; border-bottom:1px solid #ddd;">
                    <input type="text" id="novaSalaInput" placeholder="Nome da nova sala..." style="width:70%; padding:10px; border:1px solid #ddd; border-radius:8px; font-size:14px;">
                    <button onclick="criarSala()" style="width:28%; padding:10px; background:#667eea; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600; margin-left:4px;">Criar</button>
                </div>
                <div id="chatRoomsSection">
                    <div style="text-align:center; color:#999; font-size:13px;">Carregando salas...</div>
                </div>
            </div>

            <div id="usuariosContent" class="chat-content">
                <div id="chatUsersSection">
                    <div style="text-align:center; color:#999; font-size:13px;">Entre em uma sala</div>
                </div>
            </div>

            <div id="chatContent" class="chat-content">
                <div class="chat-messages" id="chatMessages"></div>
            </div>

            <div id="chatStatus">Conectando...</div>

            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Digite uma mensagem..." disabled>
                <button id="sendBtn" onclick="enviarMensagem()" disabled>Enviar</button>
                <button id="voiceBtn" onclick="toggleVoice()" disabled>Voice Off</button>
            </div>

            <div id="voiceUsers">
                <strong>Em voz:</strong> <span id="voiceList">Ningu√©m</span>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', chatHTML);

    // === FUN√á√ïES ===
    window.abrirChatGlobal = function() {
        document.getElementById('chatGlobalWindow').classList.add('show');
        document.getElementById('chatFloatButton').style.display = 'none';
        conectarSocket();
    };

    window.fecharChatGlobal = function() {
        document.getElementById('chatGlobalWindow').classList.remove('show');
        document.getElementById('chatFloatButton').style.display = 'flex';
        if (salaAtual) {
            socket.emit('leave-room', { room: salaAtual });
            socket.emit('voice-leave', { room: salaAtual });
            salaAtual = null;
            usuariosNaSala.clear();
            renderizarUsuarios();
        }
        desativarVoz();
    };

    window.mudarAba = function(aba) {
        abaAtual = aba;
        document.querySelectorAll('.chat-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.chat-content').forEach(c => c.classList.remove('active'));

        document.querySelector(`.chat-tab[onclick="mudarAba('${aba}')"]`).classList.add('active');
        document.getElementById(`${aba}Content`).classList.add('active');

        document.getElementById('headerTitle').textContent = {
            salas: 'Chat Global',
            usuarios: 'Usu√°rios na Sala',
            chat: salasDisponiveis[salaAtual]?.nome || 'Chat'
        }[aba];
    };

    // === CONEX√ÉO ===
    function conectarSocket() {
        if (socket) return; // Evita reconex√£o
        socket = io(SIGNALING_SERVER, { transports: ['websocket'] });

        socket.on('connect', () => {
            atualizarStatus('Conectado! Carregando salas...');
            socket.emit('request-rooms');
          //  console.log('Socket conectado com ID:', socket.id);
        });

        socket.on('rooms-list', (salas) => {
            salasDisponiveis = salas;
            renderizarSalas();
            //console.log('Salas recebidas:', salas);
        });

        socket.on('room-user-count', ({ room, count }) => {
            if (salasDisponiveis[room]) {
                salasDisponiveis[room].usuarios = count;
                renderizarSalas();
                if (salaAtual === room) {
                    atualizarStatus(`${count} online ‚Ä¢ ${Object.keys(peers).length} em voz`);
                }
            }
        });

        socket.on('chat-message', (data) => {
            if (data.room !== salaAtual) return;
           // console.log('Mensagem recebida:', data); // Log para depurar
            const nome = data.usuario || 'An√¥nimo';
            const tipo = (data.socketId === socket.id) ? 'user' : 'other';
            adicionarMensagem(`${nome}: ${data.mensagem}`, tipo);
        });

        socket.on('user-joined-room', (data) => {
            if (data.room === salaAtual && data.socketId !== socket.id) {
                usuariosNaSala.add(data.socketId);
                renderizarUsuarios();
            }
        });

        socket.on('user-left-room', (data) => {
            if (data.room === salaAtual) {
                usuariosNaSala.delete(data.socketId);
                renderizarUsuarios();
            }
        });

        socket.on('room-created', ({ room, info }) => {
            salasDisponiveis[room] = info;
            renderizarSalas();
            //console.log('Nova sala criada:', room, info);
        });

        socket.on('disconnect', () => {
            atualizarStatus('Desconectado');
            desativarVoz();
        });
    }

    // === RENDER SALAS ===
    function renderizarSalas() {
        const container = document.getElementById('chatRoomsSection');
        container.innerHTML = Object.entries(salasDisponiveis).map(([room, info]) => {
            const ativo = salaAtual === room ? 'active' : '';
            return `
                <div class="room-item ${ativo}" onclick="entrarSala('${room}')">
                    <div class="room-info">
                        <div class="room-name">${info.nome}</div>
                        <div class="room-users">${info.usuarios} online</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // === RENDER USU√ÅRIOS ===
    function renderizarUsuarios() {
        const container = document.getElementById('chatUsersSection');
        if (!salaAtual) {
            container.innerHTML = '<div style="text-align:center; color:#999; font-size:13px;">Entre em uma sala</div>';
            return;
        }

        container.innerHTML = Array.from(usuariosNaSala).map(id => `
            <div class="user-item">
                <div class="user-info">
                    <div class="user-name">Usu√°rio ${id.slice(0,6)}</div>
                    <div class="user-status">online</div>
                </div>
            </div>
        `).join('');
    }

    // === ENTRAR SALA ===
    /*
    window.entrarSala = async function(room) {
        if (salaAtual === room) return;

        if (salaAtual) {
            socket.emit('leave-room', { room: salaAtual });
            socket.emit('voice-leave', { room: salaAtual });
            desativarVoz();
        }

        salaAtual = room;
        usuariosNaSala.clear();
        renderizarUsuarios();
        renderizarSalas();

        const info = salasDisponiveis[room];
        socket.emit('join-room', {
            room: room,
            user: usuarioLogado?.nome || 'Visitante',
            merito: usuarioLogado?.merito || 0
        });

        document.getElementById('chatInput').disabled = false;
        document.getElementById('sendBtn').disabled = false;
        document.getElementById('voiceBtn').disabled = false;
        document.getElementById('chatInput').placeholder = `Mensagem em ${info.nome}...`;
        document.getElementById('chatMessages').innerHTML = '';
        atualizarStatus(`Entrou em ${info.nome} ‚Ä¢ ${info.usuarios} online`);
        document.getElementById('voiceUsers').style.display = 'block';
    };
*/
// === ENTRAR SALA - CORRIGIDA E ROBUSTA ===
window.entrarSala = async function(room) {
    //console.log('üö™ entrarSala chamada com room:', room);
/*    console.log('üìä Socket status:', {
        socket: !!socket,
        socketConectado: socket?.connected,
        salasDisponiveis: Object.keys(salasDisponiveis || {}).length
    });*/

    if (!room) {
        console.error('‚ùå Nome da sala √© undefined ou vazio');
        mostrarNotificacao('Erro: Sala n√£o especificada', 'erro');
        return;
    }

    if (!socket || !socket.connected) {
        console.error('‚ùå Socket n√£o conectado, tentando reconectar...');
        conectarSocket();
        setTimeout(() => entrarSala(room), 1000);
        return;
    }

    if (!salasDisponiveis) salasDisponiveis = {};

    // Criar sala se n√£o existir
    if (!salasDisponiveis[room]) {
        //console.log('‚ûï Criando sala automaticamente:', room);
        salasDisponiveis[room] = { nome: room, usuarios: 1 };

        socket.emit('create-room', {
            room,
            nome: room,
            criador: usuarioLogado?.nome || 'An√¥nimo'
        });
    }

    const infoSala = salasDisponiveis[room];
    const nomeDaSala = infoSala?.nome || room;
    //console.log('‚úÖ Sala configurada:', { room, nomeDaSala });

    // Agora permite reentrar na mesma sala
    if (salaAtual === room) {
        //console.log('‚ôªÔ∏è Reentrando na mesma sala:', room);
        atualizarStatus(`Conectado novamente em ${nomeDaSala}`);
    } else {
        if (salaAtual) {
            //console.log('üö™ Saindo da sala anterior:', salaAtual);
            socket.emit('leave-room', { room: salaAtual });
            socket.emit('voice-leave', { room: salaAtual });
            desativarVoz();
        }
        salaAtual = room;
    }

    // Entrar na nova sala
    socket.emit('join-room', {
        room,
        user: usuarioLogado?.nome || 'Visitante',
        merito: usuarioLogado?.merito || 0
    });

    // Atualizar interface
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.disabled = false;
        chatInput.placeholder = `Mensagem em ${nomeDaSala}...`;
    }

    const sendBtn = document.getElementById('sendBtn');
    const voiceBtn = document.getElementById('voiceBtn');
    if (sendBtn) sendBtn.disabled = false;
    if (voiceBtn) voiceBtn.disabled = false;

    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) chatMessages.innerHTML = '';

    const headerTitle = document.getElementById('headerTitle');
    if (headerTitle) headerTitle.textContent = nomeDaSala;

    atualizarStatus(`Conectado em ${nomeDaSala}`);

    const voiceUsers = document.getElementById('voiceUsers');
    if (voiceUsers) voiceUsers.style.display = 'block';

    renderizarSalas();
    renderizarUsuarios();

    setTimeout(() => {
        //console.log('üéØ Mudando para aba chat');
        mudarAba('chat');
    }, 100);
};

    // === CRIAR SALA ===
    window.criarSala = function() {
        if (!socket) {
            conectarSocket(); // Conecta se n√£o estiver
        }

        const input = document.getElementById('novaSalaInput');
        const nome = input.value.trim();
        if (!nome) return alert('Digite um nome!');

        const roomId = `custom-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;
        const roomName = `${nome} (criada por ${usuarioLogado?.nome || 'voc√™'})`;

        socket.emit('create-room', {
            room: roomId,
            nome: roomName,
            criador: usuarioLogado?.nome || 'An√¥nimo'
        });

        input.value = '';
        //console.log('Criando sala:', roomId, roomName);
    };

    // === ENVIAR MENSAGEM ===
    window.enviarMensagem = function() {
        const input = document.getElementById('chatInput');
        const msg = input.value.trim();
        if (!msg || !salaAtual) return;

        socket.emit('chat-message', {
            room: salaAtual,
            mensagem: msg,
            usuario: usuarioLogado?.nome || 'Visitante',
            merito: usuarioLogado?.merito || 0
        });

        //console.log('Mensagem enviada:', msg); // Log para depurar
        input.value = '';
    };

    // === ADICIONAR MENSAGEM ===
    function adicionarMensagem(texto, tipo) {
        const chat = document.getElementById('chatMessages');
        const div = document.createElement('div');
        div.className = `message ${tipo}`;
        div.textContent = texto;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
        //console.log('Mensagem adicionada na UI:', texto, tipo);
    }

    // === VOZ ===
    // (inalterado, mas com logs)
    window.toggleVoice = async function() {
        if (voiceEnabled) desativarVoz();
        else await ativarVoz();
    };

    async function ativarVoz() {
        try {
            meuStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            document.getElementById('voiceBtn').textContent = 'Voice On';
            document.getElementById('voiceBtn').style.background = '#28a745';
            voiceEnabled = true;

            socket.emit('voice-join', { room: salaAtual, user: usuarioLogado?.nome || 'Visitante' });
            for (const peerId of Object.keys(peers)) await criarConexaoP2P(peerId);
            atualizarListaVoz();
            //console.log('Voz ativada');
        } catch (err) {
            atualizarStatus('Microfone bloqueado');
            console.error('Erro voz:', err);
        }
    }

    function desativarVoz() {
        if (meuStream) meuStream.getTracks().forEach(t => t.stop());
        voiceEnabled = false;
        document.getElementById('voiceBtn').textContent = 'Voice Off';
        document.getElementById('voiceBtn').style.background = '#dc3545';
        for (const peerId of Object.keys(peers)) peers[peerId].pc.close();
        peers = {};
        atualizarListaVoz();
        //console.log('Voz desativada');
    }

    async function criarConexaoP2P(peerId, userName) {
        if (peers[peerId]) return;
        const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
        peers[peerId] = { pc, user: userName || 'An√¥nimo' };

        if (meuStream) meuStream.getTracks().forEach(t => pc.addTrack(t, meuStream));

        pc.ontrack = (e) => {
            const audio = new Audio(); audio.srcObject = e.streams[0]; audio.autoplay = true; audio.style.display = 'none';
            document.body.appendChild(audio);
            //console.log('√Åudio de peer recebido:', peerId);
        };

        pc.onicecandidate = (e) => {
            if (e.candidate) socket.emit('ice-candidate', { to: peerId, candidate: e.candidate, room: salaAtual });
        };

        if (voiceEnabled) {
            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);
            socket.emit('offer', { to: peerId, sdp: offer, room: salaAtual });
            //console.log('Oferta enviada para peer:', peerId);
        }
    }

    function atualizarListaVoz() {
        const list = Object.values(peers).map(p => p.user).join(', ') || 'Ningu√©m';
        document.getElementById('voiceList').textContent = list;
        document.getElementById('voiceUsers').style.display = list === 'Ningu√©m' ? 'none' : 'block';
    }

    function atualizarStatus(texto) {
        document.getElementById('chatStatus').textContent = texto;
    }

    // === EVENTOS ===
    document.getElementById('chatFloatButton').addEventListener('click', abrirChatGlobal);
    document.getElementById('chatInput').addEventListener('keypress', e => { if (e.key === 'Enter') enviarMensagem(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape' && document.getElementById('chatGlobalWindow').classList.contains('show')) fecharChatGlobal(); });

    //console.log('Chat pronto com logs para depura√ß√£o!');
})();

/////////////////////////
/////////////////////////
////////////apostas/////////////
/////////////////////////
/////////////////////////
(function() {
    'use strict';

    if (window.apostasIntegracaoInjetado) return;
    window.apostasIntegracaoInjetado = true;



    // === FUN√á√ÉO AUXILIAR: CHAMAR EXISTENTES SEM ALTERAR ===
    function chamarExistentes() {
        if (typeof dados !== 'undefined' && typeof usuarioLogado !== 'undefined') {
            // Chama init existente se n√£o rodou
            if (typeof inicializarSistemaApostasDesafios === 'function') {
                inicializarSistemaApostasDesafios();
            }
            // Interval para encerramentos (chama fun√ß√£o existente)
            if (intervalEncerramentos) clearInterval(intervalEncerramentos);
            intervalEncerramentos = setInterval(() => {
                if (typeof verificarEncerramentosAutomaticos === 'function' && dados.apostasUsuarios) {
                    dados.apostasUsuarios.forEach(sala => verificarEncerramentosAutomaticos(sala, 'apostas'));
                    salvarDados();
                }
            }, 300000);  // 5 min, como no original
        }
    }

// === CONECTAR SOCKETS PARA APOSTAS (ISOLADO - ATUALIZADO) ===
// === CONECTAR SOCKETS PARA APOSTAS (ATUALIZADO COM RETRY) ===
function conectarSocketsApostas() {
    if (socketApostas) return;
    if (typeof socket !== 'undefined' && socket && socket.connected) {
        socketApostas = socket;
        setupListeners();
        carregarSalasIniciais();
        return;
    }
    // Cria novo com retry e auth opcional
    setTimeout(() => {
        const script = document.createElement('script');
        script.src = `${SOCKET_SERVER}/socket.io/socket.io.js`;
        script.onload = () => {
            socketApostas = io(SOCKET_SERVER, { 
                transports: ['websocket'], 
                auth: TOKEN_JWT ? { token: TOKEN_JWT } : {}  // Auth s√≥ se tem token
            });
            setupListeners();
            socketApostas.on('connect', () => {
                console.log('[Apostas] Socket conectado (retry OK)');
                carregarSalasIniciais();  // Recarrega ap√≥s connect
                joinRoomsApostas();
            });
            socketApostas.on('disconnect', (reason) => {
                console.log('[Apostas] Desconectado por:', reason);  // Log reason para debug
                if (reason !== 'io server disconnect') {  // N√£o retry em shutdown
                    setTimeout(conectarSocketsApostas, 3000);  // Retry mais r√°pido
                }
            });
        };
        document.head.appendChild(script);
    }, 500);
}
    function initSocketNovo() {
        socketApostas = io(SOCKET_SERVER, { transports: ['websocket'], auth: { token: TOKEN_JWT } });
        setupListeners();
        socketApostas.on('connect', () => {
            console.log('[Apostas] Socket conectado para rooms de apostas');
            carregarSalasIniciais();
        });
    }

    function setupListeners() {
        // Listeners s√≥ para apostas (n√£o toca chat)
        socketApostas.on('nova-aposta', (data) => {
            if (data.cardId && dados.apostasUsuarios) {
                // Atualiza dados locais chamando fun√ß√µes existentes
                const sala = dados.apostasUsuarios.find(s => s.cardId === data.cardId);
                if (sala) {
                    sala.apostas.push(data.aposta);
                    salvarDados();
                    if (typeof atualizarIndicadoresApostas === 'function') {
                        atualizarIndicadoresApostas();
                    }
                    mostrarNotificacao(`Nova aposta: ${data.aposta.titulo}`, 'info');
                }
            }
        });

        socketApostas.on('aposta-atualizada', (data) => {
            if (data.cardId && dados.apostasUsuarios) {
                const sala = dados.apostasUsuarios.find(s => s.cardId === data.cardId);
                if (sala && data.apostaId) {
                    const aposta = sala.apostas.find(a => a.id === data.apostaId);
                    if (aposta) {
                        Object.assign(aposta, data.updates);  // Merge sem reescrever
                        salvarDados();
                        if (typeof atualizarIndicadoresApostas === 'function') {
                            atualizarIndicadoresApostas();
                        }
                    }
                }
            }
        });

        socketApostas.on('aposta-encerrada', (data) => {
            mostrarNotificacao(`Aposta encerrada em ${data.cardId}!`, 'info');
            if (typeof verificarEncerramentosAutomaticos === 'function') {
                const sala = dados.apostasUsuarios.find(s => s.cardId === data.cardId);
                if (sala) verificarEncerramentosAutomaticos(sala, 'apostas');
            }
        });

        socketApostas.on('disconnect', () => {
            console.log('[Apostas] Socket desconectado, reconectando em 5s...');
            setTimeout(conectarSocketsApostas, 5000);
        });
    }

    // === CARREGAR SALAS VIA API (ISOLADO) ===
    // === CARREGAR SALAS VIA API (ATUALIZADO COM FALLBACK SEM TOKEN) ===


    // === JOIN ROOMS PARA APOSTAS (BASEADO EM CARDS VIS√çVEIS) ===
    function joinRoomsApostas() {
        const videoInfos = document.querySelectorAll('.video-info');
        Array.from(videoInfos).forEach(videoInfo => {
            if (typeof gerarCardId === 'function') {
                const cardId = gerarCardId(videoInfo);
                const room = `${cardId}-${usuarioLogado?.merito || 'visitante'}`;
                ROOMS_APOSTAS[cardId] = room;
                if (socketApostas) {
                    socketApostas.emit('join-room', { cardId, user: usuarioLogado?.nome || 'An√¥nimo', merito: usuarioLogado?.merito || 0 });
                }
            }
        });
    }

    // === INICIALIZA√á√ÉO (RODA UMA VEZ) ===
// === INICIALIZA√á√ÉO (ATUALIZADA COM DELAY E TESTE FAKE) ===
function initApostasIntegracao() {
    // Delay para aguardar init existente e cards carregarem
    setTimeout(() => {
        chamarExistentes();  // Chama inits existentes
        conectarSocketsApostas();
        carregarSalasIniciais();  // Chama load ap√≥s delay
    }, 2000);  // 2s para "Carregando lives" terminar

    // Observer para novos cards (sem alterar DOM observer existente)
    const observerApostas = new MutationObserver(() => {
        joinRoomsApostas();
        if (typeof adicionarBotoesApostasDesafios === 'function') {
            adicionarBotoesApostasDesafios();
        }
    });
    observerApostas.observe(document.body, { childList: true, subtree: true });
    console.log('[Apostas] Integra√ß√£o separada ativada com delay');
}

// === CARREGAR SALAS VIA API (ATUALIZADO COM FAKE PARA TESTE) ===
async function carregarSalasIniciais() {
    const videoInfos = document.querySelectorAll('.video-info');
    if (videoInfos.length === 0) {
        console.warn('[Apostas] Sem cards vis√≠veis ainda - retry em 2s');
        setTimeout(carregarSalasIniciais, 2000);
        return;
    }

    const promises = Array.from(videoInfos).map(async (videoInfo) => {
        if (typeof gerarCardId === 'function') {
            const cardId = gerarCardId(videoInfo);
            let salaApi = null;
            if (TOKEN_JWT) {
                try {
                    const res = await fetch(`${API_BASE}/sala/${cardId}/apostas`, {
                        headers: { Authorization: `Bearer ${TOKEN_JWT}` }
                    });
                    if (res.ok) salaApi = await res.json();
                } catch (err) {
                    console.warn('[Apostas] Erro API:', err.message);
                }
            }
            // Fallback: Cria sala local com aposta FAKE para testar red dot
            if (!salaApi && dados.apostasUsuarios) {
                let salaLocal = dados.apostasUsuarios.find(s => s.cardId === cardId);
                if (!salaLocal) {
                    salaLocal = { 
                        cardId, 
                        apostas: [{
                            id: 1,
                            titulo: 'Teste Red Dot',
                            status: 'aberta',  // Ou 'encerrada' para testar
                            valor: 10,
                            opcoes: ['Sim', 'N√£o'],
                            participantes: [],
                            dataCriacao: new Date().toLocaleString(),
                            criador: usuarioLogado?.nome || 'An√¥nimo'
                        }],
                        criador: usuarioLogado?.nome || 'An√¥nimo', 
                        dataCriacao: new Date().toLocaleString() 
                    };
                    dados.apostasUsuarios.push(salaLocal);
                    salvarDados();
                    console.log('[Apostas] Sala fake criada para red dot:', cardId);
                }
                salaApi = salaLocal;
            }
            return salaApi;
        }
        return null;
    });

    const salas = (await Promise.all(promises)).filter(Boolean);
    if (salas.length > 0 && dados.apostasUsuarios) {
        salas.forEach(salaApi => {
            let salaLocal = dados.apostasUsuarios.find(s => s.cardId === salaApi.cardId);
            if (!salaLocal) {
                salaLocal = salaApi;
                dados.apostasUsuarios.push(salaLocal);
            } else {
                const novasApostas = salaApi.apostas.filter(a => !salaLocal.apostas.some(existing => existing.id === a.id));
                salaLocal.apostas.push(...novasApostas);
            }
            salvarDados();
        });
        // For√ßa update m√∫ltiplo para garantir red dot
        setTimeout(() => {
            if (typeof adicionarBotoesApostasDesafios === 'function') {
                adicionarBotoesApostasDesafios();
            }
            if (typeof atualizarIndicadoresApostas === 'function') {
                atualizarIndicadoresApostas();
            }
            console.log('[Apostas] UI atualizada - verifique red dot');
        }, 500);
        console.log('[Apostas] Salas carregadas:', salas.length);
    } else {
        console.warn('[Apostas] Ainda sem salas - login necess√°rio para API');
    }
}
    // === AUTO-START ===
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initApostasIntegracao);
    } else {
        initApostasIntegracao();
    }

})();







// ===== SISTEMA DE SESS√ÉO UNIFICADO =====
function salvarSessao() {
    const sessao = {
        usuarioLogado: usuarioLogado,
        streamerLogado: streamerLogado,
        timestamp: new Date().getTime()
    };
    localStorage.setItem('sistemaSessao', JSON.stringify(sessao));
}
function carregarSessao() {
    const sessaoSalva = localStorage.getItem('sistemaSessao');
    if (sessaoSalva) {
        const sessao = JSON.parse(sessaoSalva);
        
        const agora = new Date().getTime();
        const diffHoras = (agora - sessao.timestamp) / (1000 * 60 * 60);
        
        if (diffHoras < 24) {
            usuarioLogado = sessao.usuarioLogado;
            streamerLogado = sessao.streamerLogado;
            
            if (streamerLogado) {
                streamerLogado.online = true;
            }
        } else {
            limparSessao();
        }
    }
}
function limparSessao() {
    localStorage.removeItem('sistemaSessao');
    usuarioLogado = null;
    streamerLogado = null;
}
// ===== LOGIN PRINCIPAL =====
function fazerLogin() {
    const tipo = prompt("Voc√™ √©:\n1 - Usu√°rio\n2 - Streamer\n\nDigite 1 ou 2:");
    
    if (tipo === "1") {
        loginUsuario();
    } else if (tipo === "2") {
        loginStreamer();
    } else {
        alert("Op√ß√£o inv√°lida!");
    }
}
function loginUsuario() {
    const usuario = prompt("Usu√°rio:");
    if (!usuario) {
        alert("Usu√°rio √© obrigat√≥rio!");
        return;
    }
    
    const senha = prompt("Senha:");
    if (!senha) {
        alert("Senha √© obrigat√≥ria!");
        return;
    }
    
    const usuarioEncontrado = dados.usuarios.find(u => u.usuario === usuario && u.senha === senha);
    
    if (usuarioEncontrado) {
        usuarioLogado = usuarioEncontrado;
        salvarSessao();
        alert(`Bem-vindo, ${usuarioLogado.nome}!`);
        atualizarInterfaceLogin();
    } else {
        if (confirm("Usu√°rio n√£o encontrado. Deseja criar uma nova conta?")) {
            criarNovoUsuario(usuario, senha);
        }
    }
}
function loginStreamer() {
    const usuario = prompt("Usu√°rio do Streamer:");
    if (!usuario) {
        alert("Usu√°rio √© obrigat√≥rio!");
        return;
    }
    
    const senha = prompt("Senha:");
    if (!senha) {
        alert("Senha √© obrigat√≥ria!");
        return;
    }
    
    const streamerEncontrado = encontrarStreamerGlobal(usuario, senha);
    
    if (streamerEncontrado) {
        streamerLogado = streamerEncontrado;
        streamerLogado.online = true;
        salvarSessao();
        alert(`Bem-vindo, Streamer ${streamerLogado.nome}!`);
        atualizarInterfaceLogin();
    } else {
        if (confirm("Streamer n√£o encontrado. Deseja criar uma nova conta de streamer?")) {
            criarNovoStreamer(usuario, senha);
        }
    }
}
// ===== LOGOUT UNIFICADO =====
function logout() {
    if (usuarioLogado) {
        alert(`At√© logo, ${usuarioLogado.nome}!`);
        usuarioLogado = null;
    }
    if (streamerLogado) {
        streamerLogado.online = false;
        alert(`At√© logo, Streamer ${streamerLogado.nome}!`);
        streamerLogado = null;
    }
    
    limparSessao();
    atualizarInterfaceLogin();
    
    const floatingMenu = document.getElementById('loginFloating');
    const overlay = document.getElementById('overlay');
    if (floatingMenu) floatingMenu.classList.remove('show');
    if (overlay) overlay.classList.remove('show');
}

// ===== INICIAR SISTEMA =====
if (document.readyState === 'loading') {
 //   document.addEventListener('DOMContentLoaded', inicializarSistemaApostas);
   document.addEventListener('DOMContentLoaded',inicializarSistemaApostasDesafios);
} else {
  //  inicializarSistemaApostas();
    inicializarSistemaApostasDesafios();
}

// ===== CRIA√á√ÉO DE CONTAS =====
function criarNovoUsuario(usuario, senha) {
    const nome = prompt("Seu nome completo:");
    if (!nome) return;
    
    const confirmarSenha = prompt("Confirme a senha:");
    if (senha !== confirmarSenha) {
        alert("As senhas n√£o coincidem!");
        return;
    }
    
    const novoUsuario = {
        id: Date.now(),
        nome: nome,
        usuario: usuario,
        senha: senha,
        imagem: "default-usuario.png",
        chavePix: "",
        merito: 100,
        desafiosCumpridos: 0,
        desafiosFalhados: 0,
        pagamentosRealizados: 0,
        pagamentosPendentes: 0,
        amigos: [],
        dataCriacao: new Date().toLocaleString()
    };
    
    dados.usuarios.push(novoUsuario);
    usuarioLogado = novoUsuario;
    salvarSessao();
    salvarDados();
    
    alert(`Conta criada com sucesso! Bem-vindo, ${nome}!\n\nUsu√°rio: ${usuario}\nSenha: ${senha}\nM√©rito inicial: 100 pontos`);
    atualizarInterfaceLogin();
}
function criarNovoStreamer(usuario, senha) {
    const nome = prompt("Nome do Streamer:");
    if (!nome) return;
    
    const confirmarSenha = prompt("Confirme a senha:");
    if (senha !== confirmarSenha) {
        alert("As senhas n√£o coincidem!");
        return;
    }
    
    if (!dados.jogos.length) {
        alert("Primeiro crie um jogo, est√°dio e time!");
        return;
    }
    
    const novostreamer = {
        id: Date.now(),
        nome: nome,
        usuario: usuario,
        senha: senha,
        imagem: "default-streamer.png",
        chavePix: "",
        online: true,
        merito: 500,
        videos: [],
        desafiosRecebidos: [],
        desafiosEnviados: []
    };
    
    const novaLive = criarLiveParaStreamer(nome, usuario, novostreamer);
    
    streamerLogado = novostreamer;
    salvarSessao();
    salvarDados();
    
    alert(`Streamer e live criados com sucesso!\n\nStreamer: ${nome}\nUsu√°rio: ${usuario}\nSenha: ${senha}\nLive criada automaticamente!`);
    atualizarInterfaceLogin();
    
    mostrarSecao('lives');
    carregarLivesDoTime(dados.jogos[0].id, dados.jogos[0].estadios[0].id, dados.jogos[0].estadios[0].times[0].id);
}
// ===== SISTEMA DE PIX UNIFICADO =====
function configurarChavePix() {
    const usuario = usuarioLogado || streamerLogado;
    if (!usuario) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    const chaveAtual = usuario.chavePix || "N√£o configurada";
    const novaChave = prompt(`Sua chave PIX atual: ${chaveAtual}\n\nNova chave PIX (email, telefone, CPF, ou chave aleat√≥ria):\nDeixe em branco para remover:`, usuario.chavePix);
    
    if (novaChave !== null) {
        usuario.chavePix = novaChave.trim();
        salvarSessao();
        salvarDados();
        
        if (usuario.chavePix) {
            alert(`Chave PIX atualizada: ${usuario.chavePix}`);
        } else {
            alert("Chave PIX removida.");
        }
    }
}
// ===== INTERFACE DE USU√ÅRIO =====
function atualizarInterfaceLogin() {
    atualizarMenuPerfil();
    
    const floatingMenu = document.getElementById('loginFloating');
    const overlay = document.getElementById('overlay');
    if (floatingMenu) floatingMenu.classList.remove('show');
    if (overlay) overlay.classList.remove('show');
}
function toggleProfileMenu() {
    const floatingMenu = document.getElementById('loginFloating');
    const overlay = document.getElementById('overlay');
    const profileIcon = document.getElementById('profileIcon');
    
    if (floatingMenu && floatingMenu.classList.contains('show')) {
        floatingMenu.classList.remove('show');
        if (overlay) overlay.classList.remove('show');
    } else {
        atualizarMenuPerfil();
        if (floatingMenu) floatingMenu.classList.add('show');
        if (overlay) overlay.classList.add('show');
    }
}
function atualizarMenuPerfil() {
    const floatingMenu = document.getElementById('loginFloating');
    const profileIcon = document.getElementById('profileIcon');
    
    if (!floatingMenu || !profileIcon) return;
    
    if (usuarioLogado || streamerLogado) {
        const usuario = usuarioLogado || streamerLogado;
        const tipo = usuarioLogado ? 'üë§ Usu√°rio' : 'üé• Streamer';
        
        profileIcon.textContent = usuarioLogado ? 'üë§' : 'üé•';
        profileIcon.classList.add('logged-in');
        
        floatingMenu.innerHTML = `
            <div class="user-info">
                <p class="user-name">${usuario.nome}</p>
                <p class="user-merito">${tipo} | M√©rito: ${usuario.merito}</p>
            </div>
            <div class="user-actions">
                <button class="btn-profile" onclick="verPerfilCompleto(); toggleProfileMenu()">Ver Perfil</button>
                <button class="btn-pix" onclick="configurarChavePix(); toggleProfileMenu()">Configurar PIX</button>
                <button class="btn-logout" onclick="logout(); toggleProfileMenu()">Sair</button>
            </div>
        `;
    } else {
        profileIcon.textContent = 'üë§';
        profileIcon.classList.remove('logged-in');
        
        floatingMenu.innerHTML = `
            <div class="user-actions">
                <button class="btn-login" onclick="fazerLogin(); toggleProfileMenu()">Fazer Login</button>
            </div>
        `;
    }
}
// ===== FUN√á√ïES AUXILIARES =====
function encontrarStreamerGlobal(usuario, senha) {
    for (const jogo of dados.jogos) {
        for (const estadio of jogo.estadios) {
            for (const time of estadio.times) {
                if (time.lives) {
                    for (const live of time.lives) {
                        if (live.streamers) {
                            const streamer = live.streamers.find(s => 
                                s.usuario === usuario && s.senha === senha
                            );
                            if (streamer) return streamer;
                        }
                    }
                }
            }
        }
    }
    return null;
}
function criarLiveParaStreamer(nomeStreamer, usuario, streamer) {
    const jogo = dados.jogos[0];
    const estadio = jogo.estadios[0];
    const time = estadio.times[0];
    
    const novaLive = {
        id: Date.now(),
        titulo: `Live de ${nomeStreamer}`,
        descricao: "Nova live criada automaticamente",
        status: "ativa",
        imagem: "default-live.png",
        criador: usuario,
        cards: [],
        streamers: [streamer],
        usuariosOnline: [],
        dataCriacao: new Date().toLocaleString()
    };
    
    if (!time.lives) time.lives = [];
    time.lives.push(novaLive);
    
    return novaLive;
}
// ===== PERFIL COMPLETO =====
function verPerfilCompleto() {
    const usuario = usuarioLogado || streamerLogado;
    if (!usuario) {
        alert("Fa√ßa login primeiro!");
        return;
    }
    
    let perfil = `=== PERFIL ===\n\n`;
    perfil += `Nome: ${usuario.nome}\n`;
    perfil += `Usu√°rio: ${usuario.usuario}\n`;
    perfil += `M√©rito: ${usuario.merito} pontos\n`;
    perfil += `Chave PIX: ${usuario.chavePix || "N√£o configurada"}\n`;
    
    if (usuarioLogado) {
        perfil += `\n--- Estat√≠sticas ---\n`;
        perfil += `Desafios cumpridos: ${usuario.desafiosCumpridos}\n`;
        perfil += `Desafios falhados: ${usuario.desafiosFalhados}\n`;
        perfil += `Pagamentos realizados: ${usuario.pagamentosRealizados}\n`;
        perfil += `Pagamentos pendentes: ${usuario.pagamentosPendentes}\n`;
        perfil += `Amigos: ${usuario.amigos ? usuario.amigos.length : 0}\n`;
    } else if (streamerLogado) {
        perfil += `\n--- Status ---\n`;
        perfil += `Online: ${streamerLogado.online ? 'Sim' : 'N√£o'}\n`;
        perfil += `V√≠deos: ${streamerLogado.videos ? streamerLogado.videos.length : 0}\n`;
    }
    
    perfil += `\n--- A√ß√µes ---\n`;
    perfil += `1. Configurar PIX\n`;
    perfil += `2. Ver Conquistas\n`;
    perfil += `3. Ver Ranking\n`;
    
    const opcao = prompt(perfil + "\nDigite o n√∫mero da a√ß√£o:");
    
    switch(opcao) {
        case "1":
            configurarChavePix();
            break;
        case "2":
            verConquistas();
            break;
        case "3":
            verRankingUsuarios();
            break;
    }
}
// ===== NOTIFICA√á√ïES =====
function mostrarNotificacao(mensagem, tipo = 'info', targetUser = null) {
    const notificacao = document.createElement('div');
    notificacao.className = `notificacao ${tipo}`;
    notificacao.innerHTML = mensagem;
    document.body.appendChild(notificacao);
    setTimeout(() => notificacao.remove(), 5000);
    if (targetUser && usuarioLogado && usuarioLogado.nome === targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    } else if (!targetUser) {
        notificacoes.push({ mensagem, tipo, data: new Date().toLocaleString() });
        salvarDados();
    }
}
// ===== INICIALIZA√á√ÉO =====
document.addEventListener('DOMContentLoaded', function() {
    carregarSessao();
    atualizarInterfaceLogin();
    
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const floatingMenu = document.getElementById('loginFloating');
            const overlay = document.getElementById('overlay');
            if (floatingMenu) floatingMenu.classList.remove('show');
            if (overlay) overlay.classList.remove('show');
        }
    });
});




</script>
    <!-- Carregar scripts 
    <script src="variaveis-globais.js"></script>
    <script src="funcoes-auxiliares.js"></script>
    <script src="storage.js"></script>
    
    
    <script src="Perfil/login.js"></script>
    <script src="Perfil/merito.js"></script>
    <script src="Perfil/ranking.js"></script>
    <script src="Perfil/social.js"></script>
    <script src="Perfil/notificacoes.js"></script>





    
    
    <script src="Wrtc/Chat/ModalChat.js"></script>
    <script src="Wrtc/Chat/Chat.js"></script>
    <script src="Wrtc/Chat/Voice.js"></script>

    <script src="Wrtc/Apostas/ModalApostas.js"></script>
    <script src="Wrtc/Apostas/apostas.js"></script>
    <script src="Wrtc/Wrtc_geral.js"></script>
  
    <script src="Header/busca.js"></script>
    <script src="Header/navegacao.js"></script>

    
    
    
    <script src="Eventos/jogos.js"></script>
    <script src="Eventos/estadios.js"></script>
    <script src="Eventos/times.js"></script>
    <script src="Eventos/streamers.js"></script>
    <script src="Eventos/Lives/lives-manager.js"></script>
    <script src="Eventos/Lives/cards.js"></script>
    <script src="Eventos/Lives/divs-horizontais.js"></script>
    <script src="Eventos/Lives/BotoesNoheader.js"></script>
    <script src="Eventos/Lives/TamanhoDosIframes.js"></script>
    <script src="Eventos/Lives/dropdownButton.js"></script>

    -->
  
</body>
</html>
